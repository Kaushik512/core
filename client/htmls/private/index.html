<!DOCTYPE html>
<html lang="en-us">

    <head>
        <meta charset="utf-8">
        <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->
        <title>Catalyst</title>
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/Catalyst.css">

        <style>

#clickdisabler{
    width:100%;
    position:absolute;
    z-index: 100;
    height:100px;
    display: none;
}
#setting_tree > .icon{
    font-size:18px;
}
        </style>
        <script>
function showLoader(){
    $('#clickdisabler').show();
}
function hideLoader(){
$('#clickdisabler').hide(); 
}
var a,b,x;
String.prototype.capitalizeFirstLetter = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
}
        </script>
    </head>
    <body class="custom-theme">
    <div id="clickdisabler"></div>
        <!-- possible classes: minified, fixed-ribbon, fixed-header, fixed-width-->
        <!-- HEADER -->
        <!-- Header starts here -->
        <header>
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                    <div class="navbar-brand" style="width:220px;"><!-- <div class="logo"></div> --><img src="img/logo.png" style="width:112px;height:40px" alt="logo"></div>
                </div>

    
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <!--left side navbar-->
                  <ul class="nav navbar-nav" style="margin-top:20px;margin-left:28px">
                    <li class="left-projects-links hidden" data-target="#Workspace" navigation="Workspace,Workspace1">
                        <a class="active navigationTab" id="workZoneNew" style="font-size:14px!important" href="#" onclick="setleftnavigation(this,'org');">
                            <i class="fa fa-credit-card txt-color-blue"></i>&nbsp;WORKZONE 
                        </a>
                    </li>
                    <li class="left-projects-links hidden" style="margin-left:16px;" data-target="#blueprints"  navigation="blueprints">
                            <a href="#ajax/DesignBlueprint.html" style="font-size:14px!important" id="designNew" onclick="setleftnavigation(this,'Design');" class="navigationTab">
                                <i class="fa fa-puzzle-piece"></i>&nbsp;DESIGN
                            </a>
                        </li>

                        <!--track-->
                    <li class="left-projects-links hidden" style="margin-left:16px;margin-right:16px;" data-target="#Track" navigation="Track">
                                <a class="dropdown-toggle navigationTab" style="font-size:14px!important" href="#ajax/awsnotifications.html" id="trackNew"  onclick="setleftnavigation(this,'Track');"><i class="fa fa-anchor"></i>&nbsp;TRACK</a>
                            </li>
                            <!--track ends here-->
                    
                  </ul>
                  <!--right side navbar-->
                  <ul class="nav navbar-nav navbar-right" style="font-size:14px!important;margin-top:20px">
                    <li class="left-projects-links active" id="liuserinfo" style="color:white;margin-right:16px;"></li>
                    <!-- <li class="left-projects-links"></li> -->
                    
                    <!--Settings tab-->
                    <li class="left-projects-links hidden" data-target="#Settings"   navigation="Settings">
                                <a class="dropdown-toggle navigationTab" style="font-size:14px!important" href="#ajax/Settings/Dashboard.html" id="settingsNew"  onclick="setleftnavigation(this,'Settings');"><i class="fa fa-cog"></i>&nbsp;SETTINGS</a>
                            </li>
                            <li class="left-projects-links"><a style="font-size:14px!important" href="http://help.relevancelab.com:8080/dokuwiki/doku.php" target="_blank" id="dokuNew"><i class="fa fa-question"></i>&nbsp;Help</a>
                            </li>

                        <li id="logout" class="btn-header transparent pull-right logouttop">
                            <!-- ../auth/signout -->
                        <span><a href="#" logoutlink="/auth/signout" title="Sign Out" style="font-size:16px!important;">
                            <i class="fa fa-sign-out"></i>
                            </a></span></li>
                    </ul>
                </div>
            </nav>
        </header>
    <!--HEADER ends here -->
    <!-- Left panel : Navigation area -->
    <!-- Note: This width of the aside area can be adjusted through LESS variables -->
    <aside id="left-panel">

        <div id="Workspace1">
            
            <div style="height:40px;background-color:#40baf1;color:white;border-right:1px solid silver;"> 
                
                <div style="margin-top:0px;font-size:11pt;font-weight:bold;padding-left:10px;padding-top:10px" class="hiddencollapse">WORKZONE</div>
                
            </div>
            <div id="tree" style="font-size:12px;"></div>
            <!-- <span class="minifyme"> <i class="fa fa-arrow-circle-left hit"></i> </span> -->
        </div>
        <div id="Settings_nav" style="display:none;">
            
            <div style="height:40px;background-color:#40baf1;color:white;border-right:1px solid silver;"> 
                
                <div style="margin-top:0px;font-size:11pt;font-weight:bold;padding-left:10px;padding-top:10px" class="hiddencollapse">SETTINGS</div>
                
            </div>
            <div id="setting_tree" style="font-size:12px;"></div>
            <!-- <span class="minifyme"> <i class="fa fa-arrow-circle-left hit"></i> </span> -->
        </div>
       

        <nav style="font-size:12px!important;">
            
  
                
                
                
            </ul>
            <ul class="menu-item-parentdemo" id="Workspace">
                
                
            </ul>
           <ul class="menu-item-parentdemo hidden" id="Track">
             <li class="active open">
                <a href="#" style="background-color:#40baf1;margin-right:1px;"><i class="fa fa-lg fa-fw fa-sitemap"></i><span class="menu-item-parent" style="font-weight:bold">TRACK</span> </a>
                     <ul style="display:block">

<!--notification starts here-->
                <li>
                    <a href="ajax/awsnotifications.html">
                        <div>
                            <i class="fa fa-tasks fa-2x" title="Notification"></i>
                            <span style="margin-left:5px" class="trackAlign">Notifications</span>
                        </div>
                    </a>
                </li>
                <!--notification ends here-->

                <!--aws usage-->
                <li style="margin-top:10px;">
                    <a href="ajax/awslogs.html">
                        <div>
                            <i class="fa fa-tasks fa-2x" title="AWS Usage"></i>
                            <span style="margin-left:5px" class="trackAlign2">AWS Usage</span>
                        </div>
                    </a>
                </li> 
                <!--aws usage ends here-->

                <!--zabbix starts here-->
                <li style="margin-top:10px;">
                    <a href="ajax/Zabbix.html">
                        <div>
                            <i class="fa fa-reorder fa-2x" title="Zabbix"></i>
                            <span style="margin-left:5px" class="trackAlign1">Zabbix</span>
                        </div>
                    </a>
                </li>
                
                <!--zabbix ends here-->
                        <!--kibana-->
                <li style="margin-top:10px;">
                    
                  
                    <a href="ajax/Tracker.html">
                        <div>
                            <i class="fa fa-cubes fa-2x" title="Kibana"></i>
                            <span style="margin-left:5px" class="trackAlign2">Kibana</span>
                        </div>
                    </a>
                </li>
                <!--kibana ends here-->

                

                


            </li>
                </ul>                       
            </ul>
            <ul class="menu-item-parentdemo hidden" id="blueprints">
                <li class="active open">
                    <a href="#" style="background-color:#40baf1;margin-right:1px;"><i class="fa fa-lg fa-fw fa-sitemap"></i><span class="menu-item-parent trackAlign" style="font-weight:bold">PROVIDERS</span>
                    </a>
                    <ul style="display:block">
                        <li>
                            <a href="ajax/Aws-Production.html" class="devops_providers"><div class="aws" title="AWS"><span class="menu-item-parent provider-images trackAlign">&nbsp;&nbsp;AWS</span></div></a>
                        </li>
                        
                        <li>
                            <a href="ajax/Azure-DevOps.html" class="devops_providers"><div class="azure" title="Azure"><span class="menu-item-parent provider-images trackAlign">&nbsp;&nbsp;Azure</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/RL-DevOps.html" class="devops_providers"><div class="rl" title="Data Centre"><span class="menu-item-parent provider-images trackAlign">&nbsp;Data Centre</span></div></a>
                        </li>
                        
                        <li>
                            <a href="ajax/OpenStack.html" class="devops_providers"><div class="openstack" title="Open Stack"><span class="menu-item-parent provider-images trackAlign">&nbsp;Open Stack</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/cloudstack.html" class="devops_providers"><div class="cloudstack" title="Cloud Stack"><span class="menu-item-parent provider-images trackAlign">&nbsp;Cloud Stack</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/Docker.html" class="devops_providers"><div class="dock" title="Docker"><span class="menu-item-parent provider-images trackAlign">&nbsp;Docker</span></div></a>
                        </li>
                    </ul>
                </li>
            </ul>
            
        </nav>
        <span class="minifyme"> <i class="fa fa-arrow-circle-left hit"></i> </span>
    </aside>
    <!-- END NAVIGATION -->
    <!-- MAIN PANEL -->
    <div id="main" role="main">
        <!-- RIBBON -->
        <div id="ribbon">
            <div class="demo1">
                <div id="hide-menu" style="margin-top:-3px;">
                    <span> <a href="javascript:void(0);" title="Collapse Menu">
                    <i class="fa fa-sitemap txt-color-lightwhite"></i></a> </span>
                </div>
            </div>
            <!-- breadcrumb -->
            <ol class="breadcrumb">
                <!-- This is auto generated -->
            </ol>
        </div>
        
        <!-- MAIN CONTENT -->
        <div id="content">
        </div> 
        <!--hiding the comment for no org available when the organization and environments are present-->
        <div id="noenvwarning" class="hidden alert alert-warning noEnvWarning"><img style="width:50px;height:40px" src="img/warning.png" alt="warning"/><span style="margin-left:20px;">There are no Workzone items to display. Please check your </span><ul style="list-style-type:none;text-align:center"><li class="left-projects-links hidden" data-target="#Settings" navigation="Settings">
                                <a class="navigationTab" href="#ajax/Settings/Dashboard.html" id="settingsNewClick"  onclick="setleftnavigation(this,'Settings');">&nbsp;SETTINGS</a></li></ul>
        </div>

        <!--noEnv Error for consumer and designer-->
        <div id="noEnvError" class="hidden alert alert-warning noEnvWarningConsumerDesigner"><img style="width:50px;height:40px" src="img/warning.png" alt="warning"/><span style="margin-left:20px;">There are no Workzone items to display.</span>
        </div>
        <!--error ends-->
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN PANEL -->
    
    <div id="shortcut" style="margin-left: 100px;margin-top: 90px;">
        <ul class="orgsList">
            
            
        </ul>
    </div>
    <!-- END SHORTCUT AREA -->
    <div id="main-collapse" style="margin-top: 50px;">
        <ul class="" style="width:100%">
            
            <li class="collapseActive">
                <a href="#ajax/Dev.html">WORKZONE</a>
            </li>
            
            <li>
                <a href="#ajax/Aws-Production.html">DESIGN</a>
            </li>
            
            <li>
                <a href="#ajax/Dashboard.html"><span>TRACK</span></a>
            </li>
            
            <li>
                <a href="#ajax/Settings/OrgList.html"><span>SETTINGS</span></a>
            </li>
        </ul>
    </div>
    
    <script src="js/libs/jquery-2.0.2.min.js"></script>
    <script src="js/libs/jquery-ui-1.10.3.min.js"></script>
    <script src="js/libs/modernizr-2.5.3.min.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/bootstrap-treeview.js"></script>
    
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <!-- CUSTOM NOTIFICATION -->
    <script src="js/notification/SmartNotification.min.js"></script>
    <!-- JARVIS WIDGETS -->
    <script src="js/smartwidgets/jarvis.widget.min.js"></script>
    <script src="js/plugin/bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
    <script src="js/plugin/bootbox/bootbox.min.js"></script>
    
    <script src="/private/js/jquery.dataTables.min.js"></script>
    <script src="js/jquery.tablesorter.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>

   <!-- <script src="js/plugin/modalcollapse/modalcollapse.js"></script>-->

    <script src="js/app.js"></script>
    <script src="js/dev/dev.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    
    <!-- MAIN APP JS FILE -->
    <script type="text/javascript">



$(document).ready(function() {
    var hasSettingsPermission = false;
    if (haspermission("settings", "read")) {
        hasSettingsPermission = true;
    }
    if (!hasSettingsPermission) {
        $('#settingsNew').addClass('hidden');
        $('#noenvwarning').addClass('hidden');
        $('#noEnvError').removeClass('hidden');
    }

    var hasDesignPermission = false;
    if (haspermission("design", "read")) {
        hasDesignPermission = true;
    }
    if (!hasDesignPermission) {
        $('#designNew').addClass('hidden');
    }
});


function foldTreeForSetting() {
    var list = $('#setting_tree').find('.fa-angle-down'),
        len = list.length;
    for (var i = 0; i < len; i++) {
        list.eq(i).trigger('click');
    }
}


function setleftnavigation(toplink, breadcrumbHeader) {
    //alert('setting left navigation');

    var TabID = $(toplink).attr('id');
    if (TabID === "workZoneNew") {
        loadTreeFuncNew();

        $('#Settings_nav').hide();
        $('#Workspace1').show();
        // selectFirstEnv();

    } else if (TabID === "designNew") {
        $('#Workspace1').hide();
        $('#Settings_nav').hide();

    } else if (TabID === "settingsNew") {
        $('#tree').empty()
        loadSettingsTree();
        foldTreeForSetting();
        $('#Workspace1').hide();
        $('#Settings_nav').show();

    } else if (TabID === "settingsNewClick") {
        $('#tree').empty()
        loadSettingsTree();
        foldTreeForSetting();
        $('#Workspace1').hide();
        $('#Settings_nav').show();

    } else if (TabID === "trackNew") {
        $('#Workspace1').hide();
        $('#Settings_nav').hide();

    }

    if ($(toplink).hasClass('active')) {
        //alert('about to return setleftnavigation:' + $(toplink).attr('href'));
        if ($(toplink).attr('id') == 'workZoneNew') {
            //selectFirstEnv();
            selectEnv();
        }
        // alert('returning');
        return;
    }
    //showLoader();
    //$('a[onclick*="setleftnavigation"]').removeClass('active').find("i").removeClass('txt-color-blue');
    $('.navigationTab').removeClass('active').find("i").removeClass('txt-color-blue');
    $(toplink).addClass('active').find('i').addClass('txt-color-blue');
    $('nav > ul').addClass('hidden'); //hiding all navigation elements
    var navbar = $(toplink).closest("li").attr('navigation');
    $('#Workspace1').addClass('hidden');
    if (navbar.length) {
        var navs = navbar.split(',');
        for (var i = 0; i < navs.length; i++) {
            $('#' + navs[i]).removeClass('hidden').css('display', '');
        }

    }
    if (breadcrumbHeader == 'org') {
        window.selectedOrgName = $('.orgSelected').find('span').text();
        //selectFirstEnv();
        //selecting the first item in the org tree.
    } else {
        //Reverting the warning message when no org present
        $('#content').removeClass('hidden');
        $('#noenvwarning').addClass('hidden');
        $('#noEnvError').addClass('hidden');
        $('ol.breadcrumb').removeClass('hidden');
        window.selectedOrgName = breadcrumbHeader;
    }
    //Setting local storage with last selected tab
    localStorage.setItem("lasttabselected", $(toplink).attr('id'));
    if ($(toplink).attr('id') == 'workZoneNew') {
        //alert('about to call selectFirstEnv');
        // alert('selecting first env from setleftnavigation');
        //selectFirstEnv();
        selectEnv();
    }
    //alert($(toplink).attr('id'));

}

//Expanding the providers tree

/*$('#blueprints').find('li a').first().trigger('click');
    $('#blueprints').find('ul li a').first().trigger('click');*/
var serviceURL = "../d4dMasters/";
window.selectedOrgName = $('.orgSelected').text().trim();
//alert('in');
var SettingTreeJson = [{
        "name": "organizationsetup",
        "text": "Organization Setup",
        "icon": "fa fa-lg fa-fw fa-building",
        "nodetype": "org",
        "nodes": [{
            "name": "organizations",
            "text": "Organizations",
            "borderColor": "#000",
            "href": "#ajax/Settings/OrgList.html",
            "parent": "org",
            "nodetype": "OrgList",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-building"

        }, {
            "name": "organizations",
            "text": "Business Groups",
            "borderColor": "#000",
            "href": "#ajax/Settings/ProductGroupList.html",
            "parent": "org",
            "nodetype": "ProductGroupList",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-th"

        }, {
            "name": "organizations",
            "text": "Projects",
            "borderColor": "#000",
            "href": "#ajax/Settings/ProjectList.html",
            "parent": "org",
            "nodetype": "ProjectList",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-tags"

        }],
        "borderColor": "#000",
        "selectable": false,
        "href": "javascript:void(0);"


    }, {
        "name": "devopssetup",
        "text": "DevOps Setup",
        "icon": "fa fa-lg fa-fw fa-qrcode",
        "nodetype": "devops",
        "nodes": [{
                "name": "organizations",
                "text": "Config Management",
                "borderColor": "#000",
                "href": "#ajax/Settings/ConfigManagementList.html",
                "selectable": true,
                "icon": "fa fa-lg fa-fw fa-random"

            }, {
                "name": "organizations",
                "text": "Environments",
                "borderColor": "#000",
                "href": "#ajax/Settings/EnvironmentConceptList.html",
                "selectable": true,
                "icon": "fa fa-lg fa-fw fa-tint",
                "parent": "devops",
                "nodetype": "EnvironmentConceptList"

            }, {
                "name": "organizations",
                "text": "Docker",
                "borderColor": "#000",
                "href": "#ajax/Settings/DockerTemplatesList.html",
                "selectable": true,
                "icon": "fa fa-lg fa-fw fa-hdd-o"

            }, {
                "name": "organizations",
                "text": "Jenkins",
                "borderColor": "#000",
                "href": "#ajax/Settings/JenkinsConfigList.html",
                "selectable": true,
                "icon": "fa fa-lg fa-fw fa-link"

            }, {
                "name": "organizations",
                "text": "Providers",
                "borderColor": "#000",
                "href": "#ajax/Settings/ProvidersList.html",
                "selectable": true,
                "icon": "fa fa-lg fa-fw fa-sitemap"
            },

        ],
        "borderColor": "#000",
        "selectable": false,
        "href": "javascript:void(0);"

    }, {
        "name": "usersetup",
        "text": "Users Setup",
        "icon": "fa fa-lg fa-fw  fa-tasks",
        "nodes": [{
            "name": "organizations",
            "text": "User Roles",
            "borderColor": "#000",
            "href": "#ajax/Settings/RolesList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-th-list"

        }, {
            "name": "organizations",
            "text": "Users",
            "borderColor": "#000",
            "href": "#ajax/Settings/UsersList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-user"

        }, {
            "name": "organizations",
            "text": "Teams",
            "borderColor": "#000",
            "href": "#ajax/Settings/TeamsList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-users"

        }],
        "borderColor": "#000",
        "selectable": false,
        "href": "javascript:void(0);"

    }, {
        "name": "gallerysetup",
        "text": "Gallery Setup",
        "icon": "fa fa-lg fa-fw fa-building",
        "nodes": [{
            "name": "templates",
            "text": "Template Types",
            "borderColor": "#000",
            "href": "#ajax/Settings/DesignTemplateTypesList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-files-o"

        }, {
            "name": "organizations",
            "text": "Templates",
            "borderColor": "#000",
            "href": "#ajax/Settings/TemplatesList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-files-o"

        }, {
            "name": "organizations",
            "text": "Service Command",
            "borderColor": "#000",
            "href": "#ajax/Settings/ServiceCommandList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-terminal"

        }, {
            "name": "organizations",
            "text": "VMImage",
            "borderColor": "#000",
            "href": "#ajax/Settings/ImagesList.html",
            "selectable": true,
            "icon": "fa fa-lg fa-fw fa-image"

        }],
        "borderColor": "#000",
        "selectable": false,
        "href": "javascript:void(0);"

    }, {
        "name": "userguide",
        "text": "User Guide",
        "icon": "fa fa-building ",
        "borderColor": "#000",
        "selectable": false,
        "href": "ajax/Settings/Catalyst-Guide.html",
        "target": "_blank",
        "icon": "fa fa-book"
    }

];

function loadSettingsTree() {
    $('#setting_tree').empty().treeview({
        data: SettingTreeJson,
        enableLinks: true,
        collapseIcon: 'fa fa-angle-down',
        expandIcon: 'fa fa-angle-right',
        levels: -1,
        onNodeSelected: function(event, node) {
            /*Draw the braedcrumb from ol*/
            //var ol = $("#ribbon ol.breadcrumb");
            //if(ol.children().length == 0){

            drawBreadCrumb1();
            event.stopPropagation();
            //  }
        }
    });

}

var treeData;
function getTreeData(){
    $.ajax({
        type: "get",
        dataType: "json",
        async: false,
        url: "../organizations/getTreeForbtv",
        success: function(data1) {
            treeData = data1;
            console.log('ajax success');
            //alert('New Json' + JSON.stringify(data1));
            //lol=data1;
                     
            //alert('loading tree');
            console.log(data1);
           
        }
    });

}

function buildTree(){
     $('#tree').empty().treeview({
                data: treeData,
                enableLinks: true,
                collapseIcon: 'fa fa-angle-down',
                expandIcon: 'fa fa-angle-right',
                levels: 1,
                onNodeSelected: function(event, node) {
                     
                    window.selectedOrgName = $('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgname');
                    //console.log("Org Selected:" + window.selectedOrgName );
                    localStorage.setItem('selectedOrgName', $('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgname'));
                    localStorage.setItem('selectedOrgId', $('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgid'));
                    /*Description from the node*/
                    localStorage.setItem("orgname", node.orgname);
                    localStorage.setItem("projname", node.projname ? node.projname : node.text);
                    localStorage.setItem("bgname", node.bgname);
                    localStorage.setItem("envname", node.text);
                    localStorage.setItem('itProjectActive', 'no');

                    /*Draw the braedcrumb from ol*/
                    var ol = $("#ribbon ol.breadcrumb");
                    if (ol.children().length == 0) {
                        drawBreadCrumb();
                    }
                    if (node.hasOwnProperty('itemtype') && node.itemtype === "proj") {
                        localStorage.setItem('itProjectActive', 'yes');
                    }

                }
            });
}

var loadTreeFuncNew = function(lazy) {
   // alert('load tree');
    console.log('Loaded a tree');
    if(lazy) {
        buildTree();
    } else {
        getTreeData();
        buildTree();
    }
    
}




function getUrlParameter(sParam) {
    //var u = window.location.href.split('?');
    var u = $('#workZoneNew').attr('href').split('?');
    var sPageURL = u[1];
    //alert(sPageURL);
    if (typeof sPageURL != 'undefined') {
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
            var sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] == sParam) {
                return sParameterName[1];
            }
        }
    } else {
        //check local storage for last env clicked.
        var lastwzurl = localStorage.getItem("lastworkzoneurl");
        if (lastwzurl) {
            //alert('in lastwzurl' + lastwzurl);
            u = lastwzurl.split('?');
            sPageURL = u[1];
            if (typeof sPageURL != 'undefined') {
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == sParam) {
                        return sParameterName[1];
                    }
                }
            } else
                return ('');

        } else
            return ('');
    }
    return ('');
}

//Special key to bring up the logs window

$(document).keypress("l",function(e) {
  if(e.ctrlKey && e.altKey && ( String.fromCharCode(e.which) === 'l' || String.fromCharCode(e.which) === 'L' ))
    {
        // viewlogger();
        // $('#myModal').modal('show');    
        window.open('/private/catlog.html','Catalyst Log');
    }
});



window.getUrlParams = function(url) {
    var urlParams = {};
    //var url = window.location.href;
    var indexOfQues = url.lastIndexOf("?");
    if (indexOfQues != -1) {
        var sub = url.substring(indexOfQues + 1);
        console.log(sub);
        var params = sub.split('&')
        for (var i = 0; i < params.length; i++) {
            var paramParts = params[i].split('=');
            urlParams[paramParts[0]] = paramParts[1];
        }
    }
    return urlParams;

};

function selectFirstEnvironment() {
    //alert('selecting first env');
    var $workspaceTree = $('#Workspace1');
    var $orgLink = $workspaceTree.find('a[itemtype="org"][bgId][projId][envId]');
    //alert($orgLink.length);
    if ($orgLink.length) {
        $orgLink = $orgLink.first().click();
        console.log(' envIds===   ',$orgLink.attr('bgId'),$orgLink.attr('projId'),$orgLink.attr('envId'));
        var $bgLink = $workspaceTree.find('a[rowid="' + $orgLink.attr('bgId') + '"]').click();
        var $projLink = $workspaceTree.find('a[rowid="' + $orgLink.attr('projId') + '"]').click();
        var $envLink = $workspaceTree.find('a[rowid="' + $orgLink.attr('envId') + '"]');
        $('#workZoneNew').attr('href', $envLink.attr('href'));
        $envLink.click();
        return true;
    } else {
        $('#workZoneNew').attr('href','#');
        return false;
    }
}

function selectEnv() {



    var $workspaceTree = $('#Workspace1');
    var url = localStorage.getItem("lastworkzoneurl");
    if (!url) {
        url = window.location.href;
    }
   // alert(url);
    var urlParams = getUrlParams(url);
    console.log(urlParams);
    var $orgLink;

    var envFound = false;
    if (urlParams.envid && urlParams.org && urlParams.bg && urlParams.projid) { //finding env
        var treeNodes = [];

        $orgLink = $workspaceTree.find('a[itemtype="org"][rowid="' + urlParams.org + '"]');
        if ($orgLink.length) {
            $orgLink.click();
            treeNodes.push($orgLink);

        }
        var $bgLink = $workspaceTree.find('a[rowid="' + urlParams.bg + '"]');
        if ($bgLink.length) {
            $bgLink.click();
            treeNodes.push($bgLink);
        }
        var $projLink = $workspaceTree.find('a[rowid="' + urlParams.projid + '"]');
        if ($projLink.length) {
            $projLink.click();
            treeNodes.push($projLink);
        }
        var $envLink = $workspaceTree.find('a[rowid="' + urlParams.envid + '"]');
        if ($envLink.length) {
            $envLink = $envLink.first().click();
            console.log('ancor a ==>', $envLink.attr('href'));
            $('#workZoneNew').attr('href', $envLink.attr('href'));
            treeNodes.push($envLink);
            envFound = true;
        }
        //alert(envFound);
        if (!envFound) {
            console.log('treenodes',treeNodes);
            for (var i = treeNodes.length - 1; i >= 0; i--) {
                //alert('clicking' + treeNodes[i].text() + treeNodes[i].parents('li').length);

                treeNodes[i].click();
            }
            loadTreeFuncNew(true);
           envFound = selectFirstEnvironment();
        }


    } else { //not found ... trying to find first element in any org
        //alert('not found');
        envFound = selectFirstEnvironment();
    }
    if (!envFound) {
        $('#content').addClass('hidden');
        $('#noenvwarning').removeClass('hidden');
        $('ol.breadcrumb').addClass('hidden');
    } else {
        $('#content').removeClass('hidden');
    }



}


/*Created a new Method for selecting any enviornment*/

/*End of selectAnyEnviornment*/
//loadTreeFuncNew();



//Renavigate to the tab that was previously selected.
checkandnavigatetotab = function() {
    //has tab in LS
    var ltab = localStorage.getItem("lasttabselected");
    //alert(ltab);
    if (ltab) {
        //trigger click on tab
        //alert('about to click on ' + ltab);
        //alert('tab loading');
        $('#' + ltab).trigger('click');
        drawBreadCrumb();
    } else { //will be a first time load
        console.log('selecting first env');
        //selectFirstEnv();
        //selectEnv();
        $('#workZoneNew').trigger('click');
    }
};
checkandnavigatetotab();
loadSettingsTree();
foldTreeForSetting();

//function ends
</script>

<script src="js/chefmodalcommon.js"></script>
<script src="js/jquerytemplatemin.js"></script>
    <script src="/private/js/settingscommon.js"></script>
  <!--  <script src="js/dev/instance.js"></script>
    <script src="js/dev/blueprint.js"></script>
    <script src="js/dev/orchestration.js"></script>
    <script src="js/dev/controlPanel.js"></script>
    <script src="js/dev/container.js"></script>
-->


<script>
function viewlogger(){
    var socket = io.connect();

    socket.on('log',function(msg){
        $('#logwin')
        var _msg = JSON.parse(msg);
        var dt = new Date(_msg.timestamp);

        if(_msg.level != 'debug')
           $('#launchcatalystlogwindow').prepend('<br/><u>' + dt.toLocaleDateString() + ' ' + dt.toLocaleTimeString()  + '</u> <br/><span style="color:red">' + _msg.message + '</span><br/>'); 
        else
           $('#launchcatalystlogwindow').prepend('<br/>' + '<u>' + dt.toLocaleDateString() + ' ' + dt.toLocaleTimeString()  + '</u> <br/>' + _msg.message + '<br/>'); 
    });
    $('#myModal').modal('show');
    //$('#myModal').resizable();
    // $('#launchcatalystlogwindow').draggable({
 //      handle: ".modal-header"
 //     });
    //$( "#resizable" ).resizable();
}
</script>

<div id="myModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                 <h4 class="modal-title">Catalyst Log</h4>

            </div>
            <div class="modal-body"  >
                <div id="launchcatalystlogwindow" style="overflow:auto;height:400px;font-size:8pt;" >
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>



</body>
</html>