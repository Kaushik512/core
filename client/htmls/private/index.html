<!DOCTYPE html>
<html lang="en-us">

	<head>
		<meta charset="utf-8">
		<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->
		<link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
		
		<title>Catalyst</title>
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/Catalyst.css">
		
		
		<style>

#clickdisabler{
    width:100%;
    position:absolute;
    z-index: 100;
    height:100px;
    display: none;
}
        </style>
        <script>

function showLoader(){
    $('#clickdisabler').show();
}
function hideLoader(){
$('#clickdisabler').hide(); 
}
var a,b,x;
        </script>
    </head>
    <body class="custom-theme">
    <div id="clickdisabler"></div>
        <!-- possible classes: minified, fixed-ribbon, fixed-header, fixed-width-->
        <!-- HEADER -->
        <!-- Header starts here -->
        <header>
            <nav class="navbar navbar-default">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                    <div class="navbar-brand" style="width:220px;"><!-- <div class="logo"></div> --><img src="img/logo.png" style="width:112px;height:40px" alt="logo"></div>
                </div>

    
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <!--left side navbar-->
                  <ul class="nav navbar-nav" style="margin-top:20px;margin-left:28px">
                    <li class="left-projects-links hidden" data-target="#Workspace" navigation="Workspace,Workspace1">
                        <a class="active navigationTab" id="workZoneNew" style="font-size:14px!important" href="#ajax/Dev.html" onclick="setleftnavigation(this,'org');">
                            <i class="fa fa-credit-card txt-color-blue"></i>&nbsp;WORKZONE
                        </a>
                    </li>
                    <li class="left-projects-links hidden" style="margin-left:16px;" data-target="#blueprints"  navigation="blueprints">
                            <a href="#ajax/Aws-Production.html" style="font-size:14px!important" id="designNew" onclick="setleftnavigation(this,'Design');" class="navigationTab">
                                <i class="fa fa-puzzle-piece"></i>&nbsp;DESIGN
                            </a>
                        </li>
                    
                  </ul>
                  <!--right side navbar-->
                  <ul class="nav navbar-nav navbar-right" style="font-size:14px!important;margin-top:20px">
                    <li class="left-projects-links active" id="liuserinfo" style="color:white;margin-right:16px;"></li>
                    <!-- <li class="left-projects-links"></li> -->
                    <li class="left-projects-links hidden" data-target="#Settings"   navigation="Settings">
                                <a class="dropdown-toggle navigationTab" style="font-size:14px!important" href="#ajax/Settings/Dashboard.html" id="settingsNew"  onclick="setleftnavigation(this,'Settings');"><i class="fa fa-cog"></i>&nbsp;SETTINGS</a>
                            </li>

                        <li id="logout" class="btn-header transparent pull-right logouttop">
                            <!-- ../auth/signout -->
                        <span><a href="#" logoutlink="/auth/signout" title="Sign Out" style="font-size:16px!important;">
                            <i class="fa fa-sign-out"></i>
                            </a></span></li>
                    </ul>
                </div>
            </nav>
        </header>
    <!--HEADER ends here -->
    <!-- Left panel : Navigation area -->
    <!-- Note: This width of the aside area can be adjusted through LESS variables -->
    <aside id="left-panel">

        <div id="Workspace1">
            
            <div style="height:40px;background-color:#40baf1;color:white;border-right:1px solid silver;"> 
                
                <div style="margin-top:0px;font-size:11pt;font-weight:bold;padding-left:10px;padding-top:10px" class="hiddencollapse">WORKZONE</div>
                
            </div>
            <div id="tree" style="font-size:12px;"></div>
            <!-- <span class="minifyme"> <i class="fa fa-arrow-circle-left hit"></i> </span> -->
        </div>
        
        <nav style="font-size:12px!important;">
            
            <!--Workspace left panel -->
            <ul class="menu-item-parentdemo hidden" id="Settings">
                <li class="open active">
                    <a href="#" style="background-color:#40baf1;margin-right:1px;color: white !important;"><i class="fa fa-lg fa-fw fa-building"></i>
                        <span class="menu-item-parent" style="font-weight:bold">Organization Setup</span>
                    </a>
                    <ul>
                        <li class="">
                            <a href="ajax/Settings/OrgList.html"><i class="fa fa-lg fa-fw fa-building"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Organizations</span>
                                
                            </a>
                        </li>
                        
                        <!-- <li>
                            <a href="ajax/Settings/EnvironmentList.html"><i class="fa fa-lg fa-fw fa-tint"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Environments</span>
                            </a>
                        </li> -->
                        <li>
                            <a href="ajax/Settings/ProductGroupList.html"><i class="fa fa-lg fa-fw fa-th"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Business Groups</span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/ProjectList.html"><i class="fa fa-lg fa-fw fa-tags"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Projects</span>
                            </a>
                        </li>
                        
                    </ul>
                </li>
                
                <li>
                    <a href="#"><i class="fa fa-lg fa-fw fa-qrcode"></i>
                        <span class="menu-item-parent" style="font-weight:bold">DevOps Setup</span>
                    </a>
                    <ul>
                        
                        <li>
                            <a href="ajax/Settings/ConfigManagementList.html"><i class="fa fa-lg fa-fw fa-random"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Config Management
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/EnvironmentConceptList.html"><i class="fa fa-lg fa-fw fa-tint"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Environments</span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/DockerTemplatesList.html"><i class="fa fa-lg fa-fw fa-hdd-o"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Docker
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/JenkinsConfigList.html"><i class="fa fa-lg fa-fw fa-link"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Jenkins
                                </span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!--User Setup starts here -->
                <li>
                    <a href="#"><i class="fa fa-lg fa-fw  fa-tasks"></i>
                        <span class="menu-item-parent" style="font-weight:bold">Users Setup</span>
                    </a>
                    <ul>
                        
                        <li>
                            <a href="ajax/Settings/RolesList.html"><i class="fa fa-lg fa-fw fa-th-list"></i>
                                <span class="menu-item-parent" style="font-weight:bold">User Roles</span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/UsersList.html"><i class="fa fa-lg fa-fw fa-user"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Users</span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/TeamsList.html"><i class="fa fa-lg fa-fw fa-users"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Teams</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!--Gallery Setup starts-->
                <li>
                    <a href="#"><i class="fa fa-lg fa-fw fa-building"></i>
                        <span class="menu-item-parent" style="font-weight:bold">Gallery Setup</span>
                    </a>
                    <ul>
                        <li>
                            <a href="ajax/Settings/TemplatesList.html"><i class="fa fa-lg fa-fw fa-files-o"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Templates</span>
                            </a>
                        </li>
                        <li>
                            <a href="ajax/Settings/ServiceCommandList.html"><i class="fa fa-lg fa-fw fa-terminal"></i>
                                <span class="menu-item-parent" style="font-weight:bold">Service Command</span>
                            </a>
                        </li>
                        
                    </ul>
                </li>
                <li>    
                <a href="ajax/Settings/Catalyst-Guide.html" target="_blank"><i class="fa fa-book"></i>
                        <span class="menu-item-parent" style="font-weight:bold;padding-left:5px;">&nbsp;User Guide</span>
                    </a>
                </li>
                
                
                
            </ul>
            <ul class="menu-item-parentdemo" id="Workspace">
                
                
            </ul>
            <ul class="menu-item-parentdemo hidden" id="Track">
                
                
            </ul>
            <ul class="menu-item-parentdemo hidden" id="blueprints">
                <li class="active open">
                    <a href="#" style="background-color:#40baf1;margin-right:1px;"><i class="fa fa-lg fa-fw fa-sitemap"></i><span class="menu-item-parent" style="font-weight:bold">PROVIDERS</span>
                    </a>
                    <ul style="display:block">
                        <li>
                            <a href="ajax/Aws-Production.html" class="devops_providers"><div class="aws"><span class="menu-item-parent provider-images">&nbsp;&nbsp;AWS</span></div></a>
                        </li>
                        
                        <li>
                            <a href="ajax/Azure-DevOps.html" class="devops_providers"><div class="azure"><span class="menu-item-parent provider-images">&nbsp;&nbsp;Azure</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/RL-DevOps.html" class="devops_providers"><div class="rl"><span class="menu-item-parent provider-images">&nbsp;Data Centre</span></div></a>
                        </li>
                        
                        <li>
                            <a href="ajax/OpenStack.html" class="devops_providers"><div class="openstack"><span class="menu-item-parent provider-images">&nbsp;Open Stack</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/cloudstack.html" class="devops_providers"><div class="cloudstack"><span class="menu-item-parent provider-images">&nbsp;Cloud Stack</span></div></a>
                        </li>
                        <li>
                            <a href="ajax/Docker.html" class="devops_providers"><div class="dock"><span class="menu-item-parent provider-images">&nbsp;Docker</span></div></a>
                        </li>
                    </ul>
                </li>
            </ul>
            
        </nav>
        <span class="minifyme"> <i class="fa fa-arrow-circle-left hit"></i> </span>
    </aside>
    <!-- END NAVIGATION -->
    <!-- MAIN PANEL -->
    <div id="main" role="main">
        <!-- RIBBON -->
        <div id="ribbon">
            <div class="demo1">
                <div id="hide-menu" style="margin-top:-3px;">
                    <span> <a href="javascript:void(0);" title="Collapse Menu">
                    <i class="fa fa-sitemap txt-color-lightwhite"></i></a> </span>
                </div>
            </div>
            <!-- breadcrumb -->
            <ol class="breadcrumb">
                <!-- This is auto generated -->
            </ol>
        </div>
        
        <!-- MAIN CONTENT -->
        <div id="content">
        </div> 
        <!--hiding the comment for no org available when the organization and environments are present-->
        <div id="noenvwarning" style="padding-top:20px;margin-left:20px" class="hidden">Your Organization has not been fully configured yet. Use the SETTINGS tab to configure.
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN PANEL -->
    
    <div id="shortcut" style="margin-left: 100px;margin-top: 90px;">
        <ul class="orgsList">
            
            
        </ul>
    </div>
    <!-- END SHORTCUT AREA -->
    <div id="main-collapse" style="margin-top: 50px;">
        <ul class="" style="width:100%">
            
            <li class="collapseActive">
                <a href="#ajax/Dev.html">WORKZONE</a>
            </li>
            
            <li>
                <a href="#ajax/Aws-Production.html">DESIGN</a>
            </li>
            
            <li>
                <a href="#ajax/Dashboard.html"><span>TRACK</span></a>
            </li>
            
            <li>
                <a href="#ajax/Settings/OrgList.html"><span>SETTINGS</span></a>
            </li>
        </ul>
    </div>
    
    <script src="js/libs/jquery-2.0.2.min.js"></script>
    <script src="js/libs/jquery-ui-1.10.3.min.js"></script>
    <script src="js/libs/modernizr-2.5.3.min.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/bootstrap-treeview.js"></script>
    
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <!-- CUSTOM NOTIFICATION -->
    <script src="js/notification/SmartNotification.min.js"></script>
    <!-- JARVIS WIDGETS -->
    <script src="js/smartwidgets/jarvis.widget.min.js"></script>
    <script src="js/plugin/bootstrap-wizard/jquery.bootstrap.wizard.js"></script>
    <script src="js/plugin/bootbox/bootbox.min.js"></script>
    
    <script src="/private/js/jquery.dataTables.min.js"></script>
    <script src="js/jquery.tablesorter.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>

    <!--<script src="js/plugin/modalcollapse/modalcollapse.js"></script>-->

    <script src="js/app.js"></script>
    
    
    
    <!-- MAIN APP JS FILE -->
    <script type="text/javascript">


    function setleftnavigation(toplink,breadcrumbHeader){
        if($(toplink).hasClass('active')){
            //alert('about to return setleftnavigation:' + $(toplink).attr('href'));
            if($(toplink).attr('id') == 'workZoneNew'){
                selectFirstEnv();
            }
            return ;
        }
        //showLoader();
        //$('a[onclick*="setleftnavigation"]').removeClass('active').find("i").removeClass('txt-color-blue');
        $('.navigationTab').removeClass('active').find("i").removeClass('txt-color-blue');
        $(toplink).addClass('active').find('i').addClass('txt-color-blue');
        $('nav > ul').addClass('hidden'); //hiding all navigation elements
        var navbar = $(toplink).closest("li").attr('navigation');
        $('#Workspace1').addClass('hidden');
        if(navbar.length){
            var navs = navbar.split(',');
            for(var i = 0; i< navs.length;i++){
                $('#' + navs[i]).removeClass('hidden').css('display','');
            }
            
        }
        if(breadcrumbHeader == 'org') {
            window.selectedOrgName = $('.orgSelected').find('span').text();
                //selectFirstEnv();
     //selecting the first item in the org tree.
        } else {
            //Reverting the warning message when no org present
        $('#content').removeClass('hidden');
        $('#noenvwarning').addClass('hidden');
        $('ol.breadcrumb').removeClass('hidden');
        window.selectedOrgName = breadcrumbHeader;
        }
        //Setting local storage with last selected tab
        localStorage.setItem("lasttabselected", $(toplink).attr('id'));
        if($(toplink).attr('id') == 'workZoneNew'){
            //alert('about to call selectFirstEnv');
            selectFirstEnv();
        }
        //alert($(toplink).attr('id'));
    }
            
            //Expanding the providers tree
    
    /*$('#blueprints').find('li a').first().trigger('click');
    $('#blueprints').find('ul li a').first().trigger('click');*/
    var serviceURL = "../d4dMasters/";
    window.selectedOrgName = $('.orgSelected').text().trim();
    //alert('in');

    var loadTreeFuncNew = function(){
        console.log('Loaded a tree');
        $.ajax({
                type: "get",
                dataType: "json",
                async: false,
                url: "../organizations/getTreeForbtv",
                success: function (data1) {
                    console.log('ajax success');
                    //alert('New Json' + JSON.stringify(data1));

                    $('#tree').html('').treeview({
                        data:data1,enableLinks:true,
                        collapseIcon:'fa fa-angle-down',
                        expandIcon:'fa fa-angle-right',
                        levels: 1,
                        onNodeSelected: function(event, node) {     

                            window.selectedOrgName = $('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgname');
                            //console.log("Org Selected:" + window.selectedOrgName );
                            localStorage.setItem('selectedOrgName',$('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgname'));
                            localStorage.setItem('selectedOrgId',$('li[data-nodeid="' + node.nodeId + '"]').first().find('a').first().attr('orgid'));
                            /*Description from the node*/
                            localStorage.setItem("orgname", node.orgname);
                            localStorage.setItem("projname", node.projname);
                            localStorage.setItem("bgname", node.bgname);
                            localStorage.setItem("envname", node.text);

                            /*Draw the braedcrumb from ol*/
                            var ol = $("#ribbon ol.breadcrumb");
                            if(ol.children().length == 0){
                                drawBreadCrumb();
                            }
                        }
                    });
                }
            });
    }
    function getUrlParameter(sParam)
    {
        //var u = window.location.href.split('?');
        var u  = $('#workZoneNew').attr('href').split('?');
        var sPageURL = u[1];
        //alert(sPageURL);
        if(typeof sPageURL != 'undefined')
        {
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) 
            {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam) 
                {
                    return sParameterName[1];
                }
            }
        }
        else
        {
            //check local storage for last env clicked.
            var lastwzurl = localStorage.getItem("lastworkzoneurl");
            if(lastwzurl){
                //alert('in lastwzurl' + lastwzurl);
                u  = lastwzurl.split('?');
                sPageURL = u[1];
                if(typeof sPageURL != 'undefined')
                {
                    var sURLVariables = sPageURL.split('&');
                    for (var i = 0; i < sURLVariables.length; i++) 
                    {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == sParam) 
                        {
                            return sParameterName[1];
                        }
                    }
                }
                else
                    return('');

            }
            else
                return('');
        }
            return('');
    }     
    var selectFirstEnv = function(){
        
        var _org = getUrlParameter('org');
        var _bg = getUrlParameter('bg');
        var _proj = getUrlParameter('projid');
        var _env = getUrlParameter('envid');
        var hasOrg = true;
        var hasBg = true;
        var hasProj = true;
        var hasEnv = true;
        console.log('called');
        var _orgnode = $('a[itemtype="org"][rowid="' + _org + '"]').first();
        //var _orgnode = $('a[rowid="'+_org+'"]');
        //alert('orgnode:' + _orgnode.length + ',' + _org + ' ; ' +_bg  + ' ; ' +_proj   + ' ; ' + _env );
        if(_orgnode.length > 0 && _org != '' && _bg != '' && _proj   != '' && _env != ''){  
            //alert('in if' + _org + _bg + _proj + _env);
            
            {if(_orgnode.parent().find('.expand-collapse').first().attr('class').indexOf('fa-angle-right') > 0)
                          _orgnode.trigger('click');}
     
            var _bgnode = $('a[itemtype="bg"][orgid="' + _org + '"][rowid="' + decodeURIComponent(_bg) + '"]').first();
            if(_bgnode.length > 0)
            {if(_bgnode.parent().find('.expand-collapse').first().attr('class').indexOf('fa-angle-right') > 0)
                _bgnode.trigger('click');}

            var _projnode = $('a[itemtype="proj"][orgid="' + _org + '"][rowid="' + _proj + '"]').first();
            if(_projnode.length > 0)
            {if(_projnode.parent().find('.expand-collapse').first().attr('class').indexOf('fa-angle-right') > 0)
                          _projnode.trigger('click');}

            //var _envnode = $('a[itemtype="env"][orgname="' + _org + '"][bgname="' + decodeURIComponent(_bg) + '"][projname="' + decodeURIComponent(_proj) + '"]:contains("' + decodeURIComponent(_env) + '")').first();
            var _envnode = $('a[itemtype="env"][orgid="' + _org + '"][rowid="' + _env + '"]').first();
              if(_envnode.length > 0)
                  {
                    //alert('in here');
                    _envnode.first().trigger('click');
                  }
               else
                    loaddefaultenv();

        }
        else{
            loaddefaultenv();
            //alert('in else');
            
        /*//If no env found in tree show warning.
        if($('a[itemtype="env"]').length <= 0){
          $('#content').addClass('hidden');
          $('#noenvwarning').removeClass('hidden');
          $('ol.breadcrumb').addClass('hidden');
          //alert(window.location);
          if(window.location.toString().indexOf('private/index.html#ajax/Aws-Production.html') > 0)
            window.location = '#ajax/Dev.html';
          return;
        }
        else{
          $('#content').removeClass('hidden');
          $('#noenvwarning').addClass('hidden');
        }*/
    }

    };


/*Created a new Method for selecting any enviornment*/

/*End of selectAnyEnviornment*/
    loadTreeFuncNew();

    var loaddefaultenv = function(){
            //alert('loading default');
            if($('#tree').find('.fa-angle-down').length > 0) //reload the tree only if it has been expanded to refresh.
                loadTreeFuncNew();
            var hasOrg = false;
            var hasBg = false;
            var hasProj = false;
            var hasEnv = false;
            var iteratetree = function(){
              for(var o = 0;o < $('a[itemtype="org"]').length;o++){
                $('a[itemtype="org"]').eq(o).trigger('click');

               // alert($('a[itemtype="bg"]').length);
                for(var b = 0; b < $('a[itemtype="bg"]').length;b++){
                  hasOrg = true;
                  $('a[itemtype="bg"]').eq(b).trigger('click');
                  for(var p = 0; p < $('a[itemtype="proj"]').length;p++){
                    //alert("in");
                    hasBg = true;
                    $('a[itemtype="proj"]').eq(p).trigger('click');
                    if($('a[itemtype="env"]').length > 0)
                    {
                      hasProj = true;
                      hasEnv = true;
                      $('a[itemtype="env"]').first().trigger('click');
                      return;
                    }
                  }
                }
              }
            }
            iteratetree();
            if(!hasEnv || !hasProj || !hasBg || !hasOrg){
                 $('#content').addClass('hidden');
                  $('#noenvwarning').removeClass('hidden');
                  $('ol.breadcrumb').addClass('hidden');
            }
            else
            {
                $('#content').removeClass('hidden');
                $('#noenvwarning').addClass('hidden');
            }

    };

	//Renavigate to the tab that was previously selected.
	checkandnavigatetotab = function(){
		//has tab in LS
		var ltab = localStorage.getItem("lasttabselected");
		//alert(ltab);
		if(ltab){
			//trigger click on tab
			//alert('about to click on ' + ltab);
			$('#' + ltab).trigger('click');
			drawBreadCrumb();
        }
		else{ //will be a first time load
			selectFirstEnv();
		}
	};
	checkandnavigatetotab();

 //function ends
</script>
<script src="js/chefmodalcommon.js"></script>
<script src="/private/js/settingscommon.js"></script> 

</body>
</html>