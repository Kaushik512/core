 <html> 
  <head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"> </link>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet"></link>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.js" ></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-range/2.0.3/moment-range.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>  
    <style>
      .container{
        min-height: 150px;
      }
      .row{
        min-height: 90px;
        border : 1px dashed #ccc;
        margin-top: 5px;
      }
      .cell-content{
        
        min-height: 115px;
        border : 1px dashed #ccc;   
      }

      .timeStamp{
        font-size: 12px;    
        color: white;
        text-align: center;
      }

      .cpu-initial{
        background-color: #6fb3e0;
      }

      .cpu-max{
        background-color: red;
      }

      .cpu-min{
        background-color: green;
      }
      .cpu-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .cpu {
        font-size: 40px;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .mem-initial{
        background-color: #6fb3e0;
      }
      .mem-max{
        background-color: red;
      }

      .mem-min{
        background-color: green;
      }
      .mem-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .mem {
        font-size: 40px;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .net-initial{
        background-color: #6fb3e0;
      }
      .net-max{
        background-color: red;
      }

      .net-min{
        background-color: green;
      }
      .net-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .net {
        font-size: 40px;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .netin-initial{
        background-color: #6fb3e0;
      }
      .netin-max{
        background-color: red;
      }

      .netin-min{
        background-color: green;
      }
      .netin-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .netin {
        font-size: 40px;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .disk-initial{
        background-color: #6fb3e0;
      }
      .disk-max{
        background-color: red;
      }

      .disk-min{
        background-color: green;
      }
      .disk-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .disk{
        font-size: 40px;
        font-weight: bold;
        color: white;
        text-align: center;
      }

      .uptime-initial{
        background-color: #6fb3e0;
      }
      .uptime-label{
        font-size: 10px;
        font-weight: bold;
        color: white;
      }
      .uptime{
        font-size: 13px;
        font-weight: bold;
        color: white;
        text-align: center;
        margin-top: 10px;
      }

      .notification-container{
        height: 420px;
        overflow:scroll;
        font-size: 12px;
          
      }
      .notification-item{
        height: 65px;
      }
      .notification-nodeup{
        color: orange;
      }
      .notification-nodedown{
        color:red;
      }
      .notification-newNode{
        color:black;
      }
      .notification-nodeunreachable{
        color: purple;
      }
      .notification-nodealert{
        color: magenta;
      }
      .greenbox{
        background-color: green;
        color: white;
      }

      .redbox{
        background-color: red;
        color: white;
      }

      .notify-container {
        position: relative;
        width: 16px;
        height: 9px;
        top: 0px;
        left: 15px;
        
        i {
            color: #fff;
        }
    }

    .notify-counter {   
        position: absolute;
        top: 12px;
        left: 29px;
        
        background-color: rgba(212, 19, 13, 1);
        color: #fff;
        border-radius: 3px;
        padding: 1px 3px;
        font: 8px Verdana;
    }

    .bell{
      padding: 18px 31px 29px 19px;
    }

    .toast-top-right{
      top: 50px;
    }

    #loader{
      margin: auto;
    }

    .cats-eye-accounts{
      font-size: 30px;
      top: 25px;
      text-align: center;
    }
    .cats-eye-accounts-row{
      background-color: #F0F8FF;
    }
    .cats-eye-instances{
      font-size: 20px;
      top: 25px;
      text-align: center;
    }
    .cats-eye-instances-row{
      background-color: #F0F8FF;
    }
    .cats-eye-sensu{
      font-size: 30px;
      top: 25px;
      text-align: center;
    }
    .cats-eye-sensu-row{
      background-color: #F0F8FF;
    }
    .total{
      color: blue;
    }
    .running{
      color: green;
    }
    .stopped{
      color: red
    }
    div.sensut { float:left; 
                  margin-right: 5px;
                  margin-top: 5px;
                  
    }
    .clearBoth { clear:both; }

    .check-container{
      border-right: 1px dotted #ccc;
    }
    .greencircle {
      border-radius: 50%;
      width: 20px;
      height: 20px;
      background-color: green; 
      /* width and height can be anything, as long as they're equal */
    }
    .redcircle {
      border-radius: 50%;
      width: 20px;
      height: 20px;
      background-color: red; 
      /* width and height can be anything, as long as they're equal */
    }
    .timeago{
      font-style: italic;
      color: #ccc;
      font-weight: 200;
    }

    </style>  
  </head>
  <script>
    // Set Thresholds and Range for CPU, Memory and disk usage in percentages
    var cpuMax = 80;
    var cpuMin = 20;
    var bytesOutMax = 2000;
    var bytesOutMin = 1000;
    var bytesInMax = 2000;
    var bytesInMin = 1000;
    var memMax = 80;
    var memMin = 20;
    var diskMax = 70;
    var diskMin = 20;

    // Create a Socketio connection
    var socket = io.connect('http://54.67.35.103:5555');  
    
  </script>
  <body>  
    <div id="content">
      <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
          <li class="active"><a href="#catseye" data-toggle="tab">Cats Eye</a></li>        
          <li><a href="#cloudwatch-telemetry" data-toggle="tab">CloudWatch Telemetry</a></li>
          <li><a href="#sensu-telemetry" data-toggle="tab">Sensu Telemetry</a></li>
          <li><a href="#alerts" data-toggle="tab">Alerts</a></li>                
      </ul>

      <div id="telemetry-tab-content" class="tab-content">
          <div class="tab-pane active" id="catseye">
            
            <div class="container-fluid">
              <div class="row cats-eye-accounts-row">
                  <div class="col-md-6 cats-eye-accounts">AWS Accounts</div>
                  <div class="col-md-6 cats-eye-accounts" id="cats-eye-aws-accounts">0</div>
              </div>
              <div class="row cats-eye-instances-row">
                  <div class="col-md-2 cats-eye-instances">Total instances</div>
                  <div class="col-md-2 cats-eye-instances total" id="cats-eye-total-instances">0</div>
                  <div class="col-md-2 cats-eye-instances">Running</div>
                  <div class="col-md-2 cats-eye-instances running" id="cats-eye-running-instances">0</div>
                  <div class="col-md-2 cats-eye-instances ">Stopped</div>
                  <div class="col-md-2 cats-eye-instances stopped" id="cats-eye-stoppped-instances">0</div>
              </div>
              <div class="row cats-eye-sensu-row">
                  <div class="col-md-6 cats-eye-sensu">Sensu</div>
                  <div class="col-md-6 cats-eye-sensu" id="cats-eye-sensu-monitored">0</div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="cloudwatch-telemetry">
              <div class="container-fluid" id="node-container">  
                <div class="row" id="cw-loader">
                  <div class="col-md-4"></div>
                  <div class="col-md-4"><img src="spinner.gif"/></div>
                  <div class="col-md-4"></div>
                </div>
              </div>
          </div>
          <div class="tab-pane" id="sensu-telemetry">
              <div class="container-fluid" id="sensu-telemetry-container">  
                <div class="row" id="sensu-loader">
                  <div class="col-md-4"></div>
                  <div class="col-md-4"><img src="spinner.gif"/></div>
                  <div class="col-md-4"></div>
                </div>              
              </div>              
          </div>
          <div class="tab-pane" id="alerts">
              <div class="container">
                <div class="row">
                    <div class="col-sm-10 notification-container">
                      <h3>Notifications</h3>
                      <div id="live-notifications">

                      </div>
                    </div>
                </div>
              </div>
          </div>        
      </div>
    </div>  
  </body>
  <script>
    function cloudwatchRowBuilder(nodeId, nodeName, instanceType, nodeDetailsId, nodeIpAddress, nodePlacement, nodeStatus, humanizedUpTime){
      if( $('#' + nodeId).length){

      }
      else{
        $('#node-container').append('<div class= "row" id="' + nodeId + '"></div>' );      
        $('#' + nodeId).append('<div class="col-sm-4 cell-content" id="'+ nodeDetailsId + '">');
        $('#' + nodeDetailsId).append('<h4>' + nodeId + ' :: ' + nodeName + '</h4>');
        if(nodeStatus === "running"){
          $('#' + nodeDetailsId).append('<div class="col-sm-12"><div class="col-sm-4"><b>' + nodeIpAddress + '</b> </div><div class="col-sm-4 greenbox">&nbsp; ' + nodeStatus + ' &nbsp; </div><div class="col-sm-4"><img src="sensu.png" /></div></div>');  
        }
        if(nodeStatus === "terminated"){
          $('#' + nodeDetailsId).append('<div><div class="col-sm-4"><b>' + nodeIpAddress + '</b> </div><div class="col-sm-4 redbox">&nbsp; ' + nodeStatus + ' &nbsp; </div><div class="col-sm-4"><img src="sensu" /></div></div>');  
        }      
        $('#' + nodeDetailsId).append('<div class="col-sm-12"> <h6>' + nodePlacement + ' :: ' + instanceType + '</h6></div>'); 
         

        var nodeCpuContainer = "cpu-" + nodeId;
        var nodeCpu = nodeId + "_cpu";
        var nodeCpuTimeStamp = nodeId + "_cpu_timeStamp";
        $('#' + nodeId).append('<div class="col-sm-2 cell-content cpu-initial" id="' + nodeCpuContainer +'"></div>');
        $('#' + nodeCpuContainer).append('<div class="cpu-label">CPU</div>');
        $('#' + nodeCpuContainer).append('<div class="cpu" id="'+ nodeCpu +'"></div>');
        $('#' + nodeCpuContainer).append('<div class="timestamp" id="'+ nodeCpuTimeStamp +'"></div>');

        var nodeNetContainer = "net-" + nodeId;
        var nodeNet = nodeId + "_net";
        var nodeNetTimeStamp = nodeId + "_net_timeStamp";
        $('#' + nodeId).append('<div class="col-sm-2 cell-content net-initial" id="' + nodeNetContainer +'"></div>');
        $('#' + nodeNetContainer).append('<div class="net-label">NET - BYTES OUT</div>');
        $('#' + nodeNetContainer).append('<div class="net" id="'+ nodeNet +'"></div>');
        $('#' + nodeNetContainer).append('<div class="timestamp" id="'+ nodeNetTimeStamp +'"></div>');

        var nodeNetInContainer = "netin-" + nodeId;
        var nodeNetIn = nodeId + "_netin";
        var nodeNetInTimeStamp = nodeId + "_netin_timeStamp";
        $('#' + nodeId).append('<div class="col-sm-2 cell-content netin-initial" id="' + nodeNetInContainer +'"></div>');
        $('#' + nodeNetInContainer).append('<div class="netin-label">NET - BYTES IN</div>');
        $('#' + nodeNetInContainer).append('<div class="netin" id="'+ nodeNetIn +'"></div>');
        $('#' + nodeNetInContainer).append('<div class="timestamp" id="'+ nodeNetInTimeStamp +'"></div>');        

        // var nodeDiskContainer = "disk-" + nodeId;
        // var nodeDisk = nodeId + "_disk";
        // var nodeDiskTimeStamp = nodeId + "_disk_timeStamp";
        // $('#' + nodeId).append('<div class="col-sm-2 cell-content disk-initial" id="' + nodeDiskContainer +'"></div>');
        // $('#' + nodeDiskContainer).append('<div class="disk-label">DISK</div>');
        // $('#' + nodeDiskContainer).append('<div class="disk" id="'+ nodeDisk +'"></div>');
        // $('#' + nodeDiskContainer).append('<div class="timestamp" id="'+ nodeDiskTimeStamp +'"></div>');

        var nodeUptimeContainer = "uptime-" + nodeId;
        var nodeUptime = nodeId + "_uptime";
        var nodeUptimeTimeStamp = nodeId + "_uptime_timeStamp";
        $('#' + nodeId).append('<div class="col-sm-2 cell-content uptime-initial" id="' + nodeUptimeContainer +'"></div>');
        $('#' + nodeUptimeContainer).append('<div class="uptime-label">UPTIME</div>');
        $('#' + nodeUptimeContainer).append('<div class="uptime" id="'+ nodeUptime +'">'+ humanizedUpTime +'</div>');
        $('#' + nodeUptimeContainer).append('<div class="timestamp" id="'+ nodeUptimeTimeStamp +'">' + new Date() +'</div>')
      }
    }

    function sensuRowFiller(instanceId, telemetryData){
      var statusClass='';
      if(telemetryData.checkStatus == 0){
        statusClass = "greencircle";        
      }
      else{
        statusClass = "redcircle";
      }
      if($('#sensu_' + instanceId + '_' + telemetryData.checkName).length){        
        $('#sensu_'+ instanceId + '_' + telemetryData.checkName + '_status').html('<div class="' + statusClass + '"></div>');
        $('#sensu_'+ instanceId + '_' + telemetryData.checkName + '_timestamp').html(telemetryData.checkIssued);
      }
      else{
        var sensuCheckContainer = '<div class="sensut check-container">' + 
                                  '<div class="sensut" id="sensu_'+ instanceId +'_'+ telemetryData.checkName +'"> ' + telemetryData.checkName + '</div>' +
                                  '<div class="sensut" id="sensu_'+ instanceId +'_'+ telemetryData.checkName + '_status"><div class="'+ statusClass +'"></div></div>' +
                                  '<div class="sensut timeago" id="sensu_'+ instanceId + '_' + telemetryData.checkName + '_timestamp">' + telemetryData.checkIssued +'</div>';

        $('#sensu_'+ instanceId +'_telemetry').append(sensuCheckContainer);

      }      
    }

    function sensuRowBuilder(instanceId){
      if( $('#sensu_' + instanceId).length){
      }
      else{
        var sensuRow = '<div class="row" id="sensu_' + instanceId + '"><div class="col-sm-2"><h2>' + 
                        instanceId +
                        '</h2></div><div class="col-sm-10" id="sensu_' + instanceId + "_telemetry" + '"></div><div></div>';
        $('#sensu-telemetry-container').append(sensuRow);  
      }
    }

    function establishSocketForCatsEye(){
      socket.on('catsEye', function(catsEyeData){
        catsEyeBody = JSON.parse(catsEyeData);
          
          $('#cats-eye-aws-accounts').html(catsEyeBody.accounts);
          $('#cats-eye-total-instances').html(catsEyeBody.totalInstances);
          $('#cats-eye-running-instances').html(catsEyeBody.totalRunning);
          $('#cats-eye-stoppped-instances').html(catsEyeBody.totalNonRunning);
          $('#cats-eye-sensu-monitored').html(catsEyeBody.sensuMonitored);
      });
    }

    function establishSocketForCloudWatchTelemetry(nodeId){
      socket.on(nodeId, function (data) {   
          resBody = JSON.parse(data);
          //console.log("Data on Scoket for: " + nodeId);
          //console.log(resBody);          
          if(resBody.parameter === "CPUUtilization"){
            $("#" + nodeId + "_cpu").html(resBody.average.toFixed(2) + " " + resBody.unit_symbol);
            $("#" + nodeId + "_cpu_timeStamp").html(new Date(resBody.timestamp));
            if(resBody.average > cpuMax){
              $("#" + nodeId  +  "_cpu").removeClass('cpu-initial');
              $("#" + nodeId  +  "_cpu").removeClass('cpu-min');
              $("#" + nodeId  +  "_cpu").addClass('cpu-max');
            }
            if(resBody.average < cpuMin){
              $("#" + nodeId  +  "_cpu").removeClass('cpu-initial');
              $("#" + nodeId  +  "_cpu").removeClass('cpu-max');
              $("#" + nodeId  +  "_cpu").addClass('cpu-min');
            }
            if(resBody.average < cpuMax && resBody.average > cpuMin){
              $("#" + nodeId  +  "_cpu").removeClass('cpu-min');
              $("#" + nodeId  +  "_cpu").removeClass('cpu-max');
              $("#" + nodeId  +  "_cpu").addClass('cpu-initial');
            }
          }
          
          if(resBody.parameter === "NetworkOut"){
            $("#" + nodeId + "_net").html((resBody.average/(1024 * 1024)).toFixed(2) + "  M"   );
            $("#" + nodeId + "_net_timeStamp").html(new Date(resBody.timestamp));
            if(resBody.average > bytesOutMax){
              $("#" + nodeId  +  "_net").removeClass('net-initial');
              $("#" + nodeId  +  "_net").removeClass('net-min');
              $("#" + nodeId  +  "_net").addClass('net-max');
            }
            if(resBody.average < bytesOutMin){
              $("#" + nodeId  +  "_net").removeClass('net-initial');
              $("#" + nodeId  +  "_net").removeClass('net-max');
              $("#" + nodeId  +  "_net").addClass('net-min');
            }
            if(resBody.average < bytesOutMax && resBody.average > bytesOutMin){
              $("#" + nodeId  +  "_net").removeClass('net-min');
              $("#" + nodeId  +  "_net").removeClass('net-max');
              $("#" + nodeId  +  "_net").addClass('net-initial');
            }
          }

          if(resBody.parameter === "NetworkIn"){
            $("#" + nodeId + "_netin").html((resBody.average/(1024 * 1024)).toFixed(2) + "  M"   );
            $("#" + nodeId + "_netin_timeStamp").html(new Date(resBody.timestamp));
            if(resBody.average > bytesInMax){
              $("#" + nodeId  +  "_netin").removeClass('netin-initial');
              $("#" + nodeId  +  "_netin").removeClass('netin-min');
              $("#" + nodeId  +  "_netin").addClass('netin-max');
            }
            if(resBody.average < bytesInMin){
              $("#" + nodeId  +  "_netin").removeClass('netin-initial');
              $("#" + nodeId  +  "_netin").removeClass('netin-max');
              $("#" + nodeId  +  "_netin").addClass('netin-min');
            }
            if(resBody.average < bytesInMax && resBody.average > bytesOutMin){
              $("#" + nodeId  +  "_netin").removeClass('netin-min');
              $("#" + nodeId  +  "_netin").removeClass('netin-max');
              $("#" + nodeId  +  "_netin").addClass('netin-initial');
            }
          }

        }); 
    };

    function establishSocketForSensu(nodeId){
      socket.on(nodeId, function (data) {   
        resBody = JSON.parse(data);        
        if(resBody.telemetryBy === "sensu"){          
          $('#sensu-loader').hide();
          sensuRowBuilder(resBody.instanceId);
          sensuRowFiller(resBody.instanceId, resBody);
          //addSparkline();
        }
      });
    }

    function establishSocketForCloudWatch(list_of_instances){
      socket.on(list_of_instances, function (data) {   
        resBody = JSON.parse(data);
        if(resBody.telemetryBy === "aws"){
          $('#cw-loader').hide();          
          var nodeId = resBody.instanceId;
          var nodeName = resBody.instanceName;
          var instanceType = resBody.instanceType; 
          var nodeDetailsId = "details_" + nodeId;
          var nodeIpAddress = resBody.publicIp;
          var nodePlacement = "AWS, "+ resBody.placement;
          var nodeStatus = resBody.state;
          var humanizedUpTime = resBody.uptime;          
          cloudwatchRowBuilder(nodeId, nodeName, instanceType, nodeDetailsId, nodeIpAddress, nodePlacement, nodeStatus, humanizedUpTime);       
          establishSocketForCloudWatchTelemetry(nodeId);     
          establishSocketForSensu(nodeId);       
        }
      }); 
    }

    
    $( document ).ready(function() {     
      // Setup Toaster Options
      toastr.options = {
        "closeButton": true,
        "debug": false,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "preventDuplicates": false,
        "onclick": null,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
      };    
      establishSocketForCatsEye();
      establishSocketForCloudWatch("list_instances");  
      
    });
  </script>
</html>
