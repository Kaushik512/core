<style type="text/css">
  input{
    border:1px solid #cccccc;
  }
</style>
<div class="col-lg-6 col-md-6" style="padding-left: 0px; margin-bottom: 15px;">
  <label for="chooseApplication">Choose Available Application:<span style="color:red">*</span></label>
  <div class="input-groups">
    <select id="chooseApplication" name="chooseApplication" class="required chooseApplication width-100">
    </select>
  </div>                                                      
</div>
<div class="row">
  <article class="col-sm-12 col-md-12 col-lg-12">
    <div class="widget-body font-size12" id="widgetAppDeploy">
      <ul id="myTab3" class="nav nav-tabs tabs-pull-left">
          <li class="pull-left active">
              <a href="#l1" data-toggle="tab"><i class="fa fa-shield"></i>&nbsp;Application Deployment<span id="appDeployName"></span></a>
          </li>
      </ul>
      <div id="myTabContent3" class="nav tab-content">
        <div class="tab-pane active" id="l1">
          <div class="panel-group smart-accordion-default" id="accordion-AppDeploy">
           
          </div>
        </div>
      </div>
    </div>
  </article>
</div>
<div class="accordianTemplateContainer" style="display:none">
  <div class="panel panel-default accordianTemplate">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a class="envAppDeployAnchor" data-toggle="collapse" data-parent="#accordion-AppDeploy" href="#collapseAppEnv1"> 
            <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> 
            <i class="fa fa-fw fa-minus-circle txt-color-red"></i>
            <b style="font-size:12px;" class="envAppDeployName"><u></u></b>
          </a>
        </h4>
      </div>
      <div id="collapseAppEnv1" class="panel-collapse collapse in envAppDeployAccordian" style="padding: 5px;">
        <div class="table-responsive table-div">
          <table id="tableappDeploydetails" class="table table-striped table-bordered table-hover dataTable envAppDeployTable" style="border:1px solid #eeeeee !important; text-align:center;font-size:12px;margin-top:45px;" width="100%" cellpadding="5px">
                <thead>
                    <tr class="rowCustomStyle" style="font-weight:bold;">
                        <td style="color:#fff;background-color: #2c3742;">S.No.</td>
                        <td style="color:#fff;background-color: #2c3742;">App Name</td>
                        <td style="color:#fff;background-color: #2c3742;">App-Instance Name</td>
                        <td style="color:#fff;background-color: #2c3742;">Version</td>
                        <td style="color:#fff;background-color: #2c3742;">Node IP</td>
                        <td style="color:#fff;background-color: #2c3742;">Last Deploy</td>
                        <td style="color:#fff;background-color: #2c3742;">Status</td>
                        <td style="color:#fff;background-color: #2c3742;">App Links</td>
                        <td style="color:#fff;background-color: #2c3742;">Action</td>
                    </tr>
                </thead>
                <tbody>                   
                </tbody>                   
          </table>                
        </div>
      </div>
  </div>
</div>
<script type="text/javascript">
  var urlParams = {};
  (window.onpopstate = function() {
      var url = window.location.href;
      var indexOfQues = url.lastIndexOf("?");
      if (indexOfQues != -1) {
          var sub = url.substring(indexOfQues + 1);
          console.log(sub);
          var params = sub.split('&')
          for (var i = 0; i < params.length; i++) {
              var paramParts = params[i].split('=');
              urlParams[paramParts[0]] = paramParts[1];
          }
      }
  })();
  $('#widgetAppDeploy').hide();
  $.get('/app/deploy', function(data) {
    var $chooseApplication = $('#chooseApplication');
    $chooseApplication.append('<option value="">Select Application</option>');
    var applicationNameArr = [];
    $.each(data, function(key, val) {
        applicationNameArr.push(val.applicationName);
    });

    var uniqueAppName = unique(applicationNameArr);

    $.each(uniqueAppName, function(key, val) {
        $option = $('<option data-applicationName="' + val + '" value="' + val + '">' + val + '</option>');
        $option.data('selectedAppName', val);
        $chooseApplication.append($option);
    });

    function unique(list) {
        var result = [];
        $.each(list, function(i, e) {
            if ($.inArray(e, result) == -1) result.push(e);
        });
        return result;
    }
    $chooseApplication.change(function(e) {
      $("#accordion-AppDeploy").empty();
      $selectedOption = $(this).find('option:selected');
      var selectedAppName = $selectedOption.data('selectedAppName');
      console.log(selectedAppName);
      if (typeof selectedAppName != 'undefined') {
          $('#appDeployName').append().text("  for '" + selectedAppName + "'");
          $('#widgetAppDeploy').show();
      } else {
          $('#appDeployName').append().text("");
          $('#widgetAppDeploy').hide();
      }
      var $accordianTemplate = $('.accordianTemplateContainer').find('.accordianTemplate');
      for (var i = 0; i < data.length; i++) {
        applicationNameArr.push(data[i].applicationName);
        if (selectedAppName == data[i].applicationName) {
          var $clone = $accordianTemplate.clone(true);
          if($('#' + data[i].envId + '_parentAccordian').length == 0){
            $clone.attr('id', data[i].envId + '_parentAccordian');
            $clone.find('.envAppDeployAnchor').attr('data-parent', '#' + data[i].envId + '_parentAccordian');
            $clone.find('.envAppDeployName').html('<u>' + data[i].envId + '</u>');
            $clone.find('.envAppDeployAnchor').attr('href', '#' + data[i].envId + '_accordian');
            $clone.find('.envAppDeployAccordian').attr('id', data[i].envId + '_accordian');
            $clone.find('.envAppDeployTable').attr('id', data[i].envId + '_tableappDeploydetails');
            $('#accordion-AppDeploy').append($clone);
            if (!$.fn.dataTable.isDataTable('#' + data[i].envId + '_tableappDeploydetails')) {
              $('#' + data[i].envId + '_tableappDeploydetails').DataTable({
                  "pagingType": "full_numbers",
                  "iDisplayLength": 5,
                  "aLengthMenu": [
                      [5, 40, 100, -1],
                      [5, 40, 100, "All"]
                  ],
                  "aoColumns": [{
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": true
                  }, {
                      "bSortable": false
                  }]
              });
            }
          }
          var $taskenvArray = $('#' + data[i].envId + '_tableappDeploydetails');
          var rowindex = $taskenvArray.dataTable().fnGetData().length;
          // if (data[i].applicationStatus == "Successful") {
          //     data[i].applicationStatus = '<img src="img/indicator_started.png">';
          // } else if (data[i].applicationStatus == "Failure") {
          //     data[i].applicationStatus = '<img src="img/indicator_stopped.png">';
          // } else {
          //     data[i].applicationStatus = '<img src="img/indicator_unknown.png">';
          // }
          var appLinks = '<img style="height: 18px;margin-left: -5px;"src="img/projectdemo/app-performanceblack.png" title="App-Performance"><img style="height: 18px;margin-left: 5px;" src="img/projectdemo/logsblack.png" title="App-Logs"><img style="height: 18px;margin-left: 5px;" src="img/projectdemo/code_healthblack.png" title="Code-Health"><img style="height: 18px;margin-left: 5px;" src="img/projectdemo/UI_performanceblack.png" title="UI-Performance">';
          var upgrade = '<div class="updateupgrade" style="margin-left:30%;" title="Upgrade"></div>';
          $taskenvArray.dataTable().fnAddData([
            rowindex + 1,
            data[i].applicationName,
            data[i].applicationInstanceName,
            data[i].applicationVersion,
            data[i].applicationNodeIP,
            data[i].applicationLastDeploy,
            data[i].applicationStatus,
            appLinks,
            upgrade
          ]);
        }
      }
    });
    $chooseApplication.select2();
  });
</script>