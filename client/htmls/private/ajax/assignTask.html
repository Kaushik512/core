<div class="row">
   <div class="col-md-12">
      <div class="col-md-12">
         <form action="" id="taskForm">
            <div class="widget-box">
               <div class="widget-header">
                  <h4 class="widget-margin" style="color:black;">Create New Job</h4>
               </div>
               <div class="widget-body">
                  <div class="widget-main" style="min-height:200px">
                     <section id="widget-grid" class="">
                        <!-- START ROW -->
                        <div class="row">
                           <!-- Widget ID (each widget will need unique ID)-->
                           <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                              <!-- widget div-->
                              <div>
                                 <!-- widget content -->
                                 <div class="widget-body no-padding">
                                    <div class="containerTable col-lg-5 col-md-5">
                                       <!--table 1 -->
                                       <table class="table table-bordered">
                                          <thead>
                                             <tr>
                                                <th style="text-align:center">Job Details</th>
                                             </tr>
                                          </thead>
                                          <tbody>
                                             <tr>
                                                <td>
                                                   <div class="col-lg-6 col-md-6" style="margin-top:5px;">
                                                      <label>
                                                      Select Job Type
                                                      </label>
                                                      <select id="taskType" class="chooseTasktype width-100">
                                                         <option id="Chef" value="chef">Chef</option>
                                                         <option id="Jenkins" value="jenkins">Jenkins</option>
                                                      </select>
                                                   </div>
                                                   <!--chef dropdown starts here-->
                                                   <div id="chef-dropdown">
                                                      <div class="col-lg-6 col-md-6" style="margin-top:5px;">
                                                         <label>
                                                         Job Name <span style="color:red">*</span>
                                                         </label>
                                                         <input id="chefTaskName" type="text" class="form-control inputTaskName" name="ctl00$MainContent$orgname">
                                                      </div>
                                                      <!--div for description for task type-->
                                                      <div class="col-lg-12 col-md-12 margintop15">
                                                         <label>Job Description</label>
                                                         <textarea id="chefDescription" style="width:100%" rows="9" cols="15" name="description"></textarea>
                                                      </div>
                                                   </div>
                                                   <!--chef dropdown ends here-->
                                                   <!--jenkins dropdown starts here-->
                                                   <div id="Jenkins-dropdown">
                                                      <div class="col-lg-6 col-md-6" style="margin-top:5px;">
                                                         <label>Job Name<span style="color:red">*</span>
                                                         </label>
                                                         <input id="jenkinsTaskName" type="text" cat-validation="required,nospecial" cdata="catalyst" class="form-control inputTaskName" autofocus>                       
                                                      </div>
                                                      <div class="col-lg-6 col-md-6 margintop15">
                                                         <label>Select Jenkins Server<span style="color:red">*</span>
                                                         </label>
                                                         <select id="jenkinsServerList" class="width-100">
                                                            <option value="choose">Choose</option>
                                                         </select>
                                                      </div>
                                                      <div class="col-lg-6 col-md-6 margintop15">
                                                         <label>Select Job<span style="color:red">*</span></label>
                                                         <label id="spinnerForJob" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                                                         <select id="jobListJenkins" class="width-100" disabled>
                                                         </select>
                                                      </div>
                                                      <div class="col-lg-12 col-md-12 margintop15">
                                                         <label>Job Description</label>
                                                         <textarea id="jenkinsDescription"  style="width:100%" rows="8" cols="15" name="description"></textarea>
                                                      </div>
                                                   </div>
                                                   <!--jenkins dropdown ends here-->
                                                </td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </div>
                                    <!--chef task type details-->
                                    <div class="containerTable chefTaskType col-lg-7 col-md-7">
                                       <!--table 2 -->
                                       <table class="table table-bordered">
                                          <thead>
                                             <tr>
                                                <th style="text-align:center" class="chefServerName"></th>
                                             </tr>
                                          </thead>
                                          <tbody>
                                             <tr>
                                                <td>
                                                   <div class="col-lg-6 col-md-6" style="margin-top:5px;">
                                                      <div class="col-lg-12 nodesTable">
                                                         <div class="smart-form">
                                                            <label>
                                                            <img style="margin-top:-5px;" src="img/templateicons/Select-nodes---deployment.png">
                                                            Select Nodes <span style="color:red">*</span>
                                                            </label>
                                                            <ul id="selectedNodesChefTask" class="deploymentNodeList selectedNodesChefTaskCSS">
                                                            </ul>
                                                         </div>
                                                      </div>
                                                   </div>
                                                   <div class="col-lg-6 col-md-6" style="margin-top:5px;">
                                                      <label>
                                                      <i style="color:#40baf1;font-size:16px;" class="ace-icon fa fa-list-ul"></i>   
                                                      Edit Runlist
                                                      </label>
                                                      <a href="#chefRunlistModal" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;margin-top:6px;" class="addList" rel="tooltip" data-placement="top" title="Edit Runlist" /></a>
                                                      <div style="height:146px;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                                         <table id="tableRunlist" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                                                            <thead>
                                                               <tr class="rowCustomStyle">
                                                                  <th style="text-align:center">View Runlist</th>
                                                               </tr>
                                                            </thead>
                                                            <tbody>
                                                            </tbody>
                                                         </table>
                                                      </div>
                                                   </div>
                                                   <div class="col-lg-12 col-md-12" style="margin-top:22px;">
                                                      <label>
                                                      <i style="color:#40baf1;font-size:16px;" class="ace-icon fa fa-list-ul"></i>   
                                                      Cookbook Attributes <a href="#editAttributesModalContainer" id="editAttributesBtn" class="bpEditBtn btn btn-primary editAttributesBtnCSS" rel="tooltip" data-placement="top" data-original-title="Edit">
                                                      <i class="ace-icon fa fa-pencil"></i>
                                                      </a>
                                                      </label>
                                                      <textarea id="attrtextarea" style="width:100%;display:none" rows="6" onfocus="$('#attrmessage').html('');" onblur="validatejson($(this));" disabled> </textarea>
                                                      <table id="attributesViewListTable" class="table table-striped table-bordered table-hover dataTable no-footer table-condensed tablesorter" cellpadding="5px" width="100%">
                                                         <thead>
                                                            <tr>
                                                               <th>Attributes</th>
                                                               <th>Values</th>
                                                            </tr>
                                                         </thead>
                                                         <tbody class="attributesViewTableBody">
                                                         </tbody>
                                                      </table>
                                                   </div>
                                                </td>
                                             </tr>
                                          </tbody>
                                       </table>
                                       <!--table 2 ends -->
                                    </div>
                                    <!--chef task type details ends here-->
                                    <!--jenkins details for url and parameters-->
                                    <div class="containerTable jenkinsTaskType col-lg-7 col-md-7">
                                       <!--table 2 -->
                                       <table class="table table-bordered">
                                          <thead>
                                             <tr>
                                                <th style="text-align:center" class="">Jenkins</th>
                                             </tr>
                                          </thead>
                                          <tbody>
                                             <tr>
                                                <td>
                                                   <div class="col-lg-12 col-md-12" style="border:1px dotted black;">
                                                      <table id="jobParamTable" class="table" style="margin-top:20px;" cellpadding="5px" width="100%">
                                                         <thead>
                                                         </thead>
                                                         <tbody>
                                                            <tr>
                                                               <td class="jobParam">Auto sync:</td>
                                                               <td style="padding-top:16px;">
                                                                  <div class="col-lg-11 col-md-11"><input type="radio" id="radio_yes" name="auto_sync" value="true" /> Yes
                                                                     <input style="margin-left:15px;" type="radio" id="radio_no" name="auto_sync" value="false" checked="checked" /> No
                                                                  </div>
                                                                  <div class="col-lg-1 col-md-1"><img tabindex="50" style="width:16px;height:16px;margin-top:2px;" data-toggle="popover" data-placement="left" data-content="This feature fetches the entire Jenkins Job history for the particular job." src="img/help.png"/></div>
                                                               </td>
                                                            </tr>
                                                            <tr>
                                                               <td class="jobParam">Job Url:</td>
                                                               <td>
                                                                  <div class="col-lg-11 col-md-11"><span id="spinnerForUrl" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></span><input type="text" disabled class="jenkinsJobURL form-control hidden" style="margin-top:4px"></div>
                                                                  <div class="col-lg-1 col-md-1"><img style="width:16px;height:16px;margin-top:8px;" id="helpImage" tabindex="50" class="hidden" data-toggle="popover" data-placement="left" data-content="This is the URL for a particular JOB selected by the User available in the Jenkins Server" src="img/help.png"/></div>
                                                               </td>
                                                            </tr>
                                                            <tr>
                                                               <td class="jobParam" id="jobTD" style="padding-top:26px!important">Job Links:</td>
                                                               <td>
                                                                  <div class="col-lg-11 col-md-11 jobTable" style="margin-top:1px">
                                                                     <a href="#jobResultModal" id="imageLink" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;" class="addListUrl" rel="tooltip" data-placement="top" title="Add Job Links" /></a>
                                                                     <div style="height:auto;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                                                        <table id="tableJobList" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                                                                           <thead>
                                                                              <tr class="rowCustomStyle">
                                                                                 <th style="text-align:center">Job Links</th>
                                                                                 <th style="text-align:center">Action</th>
                                                                              </tr>
                                                                           </thead>
                                                                           <tbody id="jobListSave">
                                                                           </tbody>
                                                                        </table>
                                                                     </div>
                                                                  </div>
                                                                  <div class="col-lg-1 col-md-1"><img style="width:16px;height:16px;margin-top:8px;" data-toggle="popover" tabindex="50" data-placement="left" data-content="This is a URL pattern for the JOB Result or Job Output" src="img/help.png"/></div>
                                                               </td>
                                                            </tr>
                                                         </tbody>
                                                      </table>
                                                   </div>
                                                   <!--div for paremeters-->
                                                   <div class="col-lg-12" style="margin-top:20px;">
                                                      <h4 style="margin-top:12px;margin-left:8px;">This build is parameterized<!-- <input style="margin-left:5px;" id="addParameters" type="checkbox" name="addParams" value="This build is parameterized"/> -->&nbsp;&nbsp;<input type="radio" id="addParameters" name="paramCheck" value="true" /> Yes
                                                      <input style="margin-left:15px;" type="radio" id="addParametersFalse" name="paramCheck" value="false" checked="checked" /> No
                                                   </h4>
                                                   </div> 
                                                   <!--div for paremeter checkbox ends here-->
                                                   <!--dropdown for paremeters-->
                                                   <div class="col-lg-12 col-md-12" style="margin-bottom:16px;margin-top:12px;">
                                                      <div class="col-lg-12 col-md-12 addParameters hidden" style="margin-top:5px;margin-bottom:26px;">
                                                         <a href="#parameterModal" id="imageLinkParam" data-backdrop="false" type="reset" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;" class="addListParam" rel="tooltip" data-placement="top" title="Add Parameters" /></a>
                                                         <div style="height:auto;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                                            <table id="tableParameters" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                                                               <thead>
                                                                  <tr class="rowCustomStyle">
                                                                     <th style="text-align:center">Name</th>
                                                                     <th style="text-align:center">Type</th>
                                                                     <th style="text-align:center">Value</th>
                                                                     <th style="text-align:center;">Description</th>
                                                                     <th style="text-align:center">Action</th>
                                                                  </tr>
                                                               </thead>
                                                               <tbody id="paramList">
                                                               </tbody>
                                                            </table>
                                                         </div>
                                                      </div>
                                                      <!-- <div class="col-lg-1 col-md-1 addParameters hidden">
                                                         <img style="width:16px;height:16px;margin-top:8px;" data-toggle="popover" tabindex="50" data-placement="left" data-content="User can define Jenkins Parameters for this Build" src="img/help.png"/>
                                                      </div> -->
                                                   </div>
                                                   
                                                   
                                                </td>
                                             </tr>
                                          </tbody>
                                       </table>
                                       <!--table 2 ends -->
                                    </div>
                                    <!--jenkins paremeters ends here-->
                                 </div>
                                 <!-- end widget content -->
                              </div>
                              <!-- end widget div -->
                           </div>
                           <!-- end widget -->
                        </div>
                        <!-- END ROW -->
                     </section>
                     <!-- end widget grid -->
                  </div>
               </div>
               <!--assign runlist modal-->
               <div class="modal fade" id="chefRunlistModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                  <div class="modal-dialog">
                     <div class="modal-content" style="width:800px">
         <form role="form" class="cmxform" id="chefTaskRunlist" autocomplete="off">
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
         &times;
         </button>
         <h4 class="modal-title">
         <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Edit Runlist
         </h4>
         </div>
         <div class="modal-body modal-height">
         <div class="col-lg-12 runlistContainer">
         </div>
         </div>
         <div class="modal-footer">
         <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
         <input type="submit" class="btn btn-primary" id="saveRunlist" value="Update Runlist">  
         </div>   
         </form>
         </div><!-- /.modal-content -->
         </div><!-- /.modal-dialog -->
         </div>
         <!--modal for runlist ends here-->
         <!--modal for job links-->
         <div class="modal fade" id="jobResultModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
         <div class="modal-dialog">
         <div class="modal-content">
         <form role="form" class="cmxform" id="jobLinkCreate" autocomplete="off">
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
         &times;
         </button>
         <h4 class="modal-title">
         <img style="width:18px;margin-left:6px;" src="img/joboutput.jpg">&nbsp;&nbsp;Add Job Links
         </h4>
         </div>
         <div class="modal-body" style="height:100px;">
         <div class="col-lg-12 col-md-12">
         <label for="jobResultLinks">Job Link<span style="color:Red;" class="control-label">&nbsp;*</span></label>
         <input type="text" name="jobLinkName" class="form-control jobLinkCreate" id="jobLinkName" autofocus/>
         <i><span style="color:#666">ex:http://{host:port}/TestResult/$buildNumber/log.html</span></i> 
         </div>
         </div>
         <div class="modal-footer">
         <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
         <input type="submit" class="btn btn-primary" id="saveJobLinks" value="Save">  
         </div>   
         </form>
         </div><!-- /.modal-content -->
         </div><!-- /.modal-dialog -->
         </div>
         <!--modal for job links ends here-->
         <!--modal for parameters-->
         <div class="modal fade" id="parameterModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
         <div class="modal-dialog">
         <div class="modal-content">
         <form role="form" class="cmxform" id="parameterCreate" autocomplete="off">
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
         &times;
         </button>
         <h4 class="modal-title">
         <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Add Parameters
         </h4>
         </div>
         <div class="modal-body" style="height:320px">
            <!--dropdown for selecting the parameter type-->
         <label style="margin-left:10px;">Select Paremeter:</label>
         <select id="parametersSelect" style="width:40%">
         <option value="">Choose Parameter</option>
         <option value="Boolean">Boolean Parameter</option>
         <option value="String">String Parameter</option>
         <option value="Choice">Choice Parameter</option>
         </select>
         <br/><br/>
         <hr/>
         <!--dropdown ends here-->
        <!--boolean starts here-->
            <div class="col-lg-12 col-md-12 margintop15" style="margin-left:-10px;">
                  <table id="booleanTable" class="table tableLength hidden" cellpadding="5px" width="100%">
                     <thead>
                        <tr>
                           <th class="headParamTable"><input id="booleanParameter" type="hidden"/>Boolean Parameter Definition</th>
                           <th></th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td class="booleanParam"><label for="booleanName">Name:<span style="color:red">*</span></label></td>
                           <td><input id="booleanName" type="text" class="form-control" name="booleanName"></td>
                        </tr>
                        <tr>
                           <td class="booleanParam">Default Value:<span style="color:red">*</span></td>
                           <td>&nbsp;&nbsp;<input type="radio" id="booleanValueTrue" name="paramCheck" value="true" /> True&nbsp;
                           <input style="margin-left:15px;" type="radio" id="booleanValueFalse" name="paramCheck" value="false" checked="checked" /> False</td>
                        </tr>
                        <tr>
                           <td class="booleanParam"><label for="booleanDescription">Description:<span style="color:red">*</span></label></td>
                           <td><input id="booleanDescription" type="text" class="form-control" name="booleanDescription"></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!--boolean parameters ends here-->
               <!--string parameters-->
               <div class="col-lg-12 col-md-12 margintop15" style="margin-left:-10px;">
                  <table id="stringTable" class="table tableLength hidden" cellpadding="5px" width="100%">
                     <thead>
                        <tr>
                           <th class="headStringTable"><input type="hidden" id="stringParameter">String Parameter Definition</th>
                           <th></th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td class="stringParam"><label for="stringName">Name:<span style="color:red">*</span></label></td>
                           <td><input id="stringName" type="text" class="form-control" name="stringName"></td>
                        </tr>
                        <tr>
                           <td class="stringParam"><label for="stringValue">Default Value:<span style="color:red">*</span></label></td>
                           <td><input id="stringValue" type="text" class="form-control" name="stringValue"></td>
                        </tr>
                        <tr>
                           <td class="stringParam"><label for="stringDescription">Description:<span style="color:red">*</span></label></td>
                           <td><input id="stringDescription" type="text" class="form-control" name="stringDescription"></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!--string parameters ends here-->

               <!--Choice parameters-->
               <div class="col-lg-12 col-md-12 margintop15" style="margin-left:-10px;">
                  <table id="choiceTable" class="table tableLength hidden" cellpadding="5px" width="100%">
                     <thead>
                        <tr>
                           <th class="headStringTable"><input type="hidden" id="choiceParameter">Choice Parameter Definition</th>
                           <th></th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td class="choiceParam"><label for="choiceName">Name:<span style="color:red">*</span></label></td>
                           <td><input id="choiceName"  type="text" class="form-control" name="choiceName"></td>
                        </tr>
                        <tr>
                           <td class="choiceParam"><label for="choiceValue">Choices:<span style="color:red">*</span></label></td>
                           <td><input id="choiceValue" type="text" class="form-control" name="choiceValue"></td>
                        </tr>
                        <tr>
                           <td class="choiceParam"><label for="choiceDescription">Description:<span style="color:red">*</span></label></td>
                           <td><input id="choiceDescription" type="text" class="form-control" name="choiceDescription"></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!--string parameters ends here-->
         
         </div>
         <div class="modal-footer">
         <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
         <input type="submit" class="btn btn-primary" id="saveParameter" value="Save">  
         </div>   
         </form>
         </div><!-- /.modal-content -->
         </div><!-- /.modal-dialog -->
         </div>
         <!--modal for parameters ends here-->
         <!--modal for help -->
         <div class="modal fade" id="modalForHelp" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
         <div class="modal-dialog">
         <div class="modal-content"> 
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
         <h4 class="modal-title">
         &nbsp;CookBook Information
         </h4>
         </div> 
         <div class="modal-body" style="height:400px;overflow-y:auto">
         <table class="table table-bordered">
         <thead>
         <tr>
         <th>CookBook Name</th>
         <th>Description</th>
         <tr>
         </thead>
         <tbody>
         <tr>
         <td>apache2-windows</td>
         <td>Installation &amp; Configuration of Apache Server</td>
         </tr>
         <tr>
         <td>apache2</td>
         <td>Installation &amp; Configuration of Apache Server</td>
         </tr>
         <!--2nd set-->
         <tr>
         <td>cassandra</td>
         <td>Installation and configuration of Cassandra Server</td>
         </tr>
         <tr>
         <td>eclipse_windows</td>
         <td>Installtion of Eclispe on Windows</td>
         </tr>   
         <!--3rd set-->
         <tr>
         <td>visualstudio_windows</td>
         <td>Installation of Visual Studio</td>
         </tr>
         <tr>
         <td>iis</td>
         <td>Installation and configuration of IIS Server</td>
         </tr>
         <!--4th set-->
         <tr>
         <td>jboss7</td>
         <td>Installation and Configuration of JBOSS7 Server</td>
         </tr>
         <tr>
         <td>tomcat</td>
         <td>Installs and configures Tomcat, Java servlet engine and webserver</td>
         </tr>
         <!--5th set-->
         <tr>
         <td>weblogic</td>
         <td>Installation and Configuration of weblogic</td>
         </tr>
         <tr>
         <td>java</td>
         <td>Installation of Java</td>
         </tr>
         <!--6th set-->
         <tr>
         <td>java_windows</td>
         <td>Installation of Java</td>
         </tr>
         <tr>
         <td>nodejs</td>
         <td>Installation of NodeJS and npm package</td>
         </tr>   
         <!--7th set-->
         <tr>
         <td>php</td>
         <td>Installation and Configuration of PHP</td>
         </tr>
         <tr>
         <td>lamp_role</td>
         <td>Installation and Configuration of LAMP stack</td>
         </tr>   
         <!--8th set-->
         <tr>
         <td>mysql-windows</td>
         <td>Installation and Configuration of Mysql</td>
         </tr>
         <tr>
         <td>mysql</td>
         <td>Installation and Configuration of Mysql</td>
         </tr>   
         <!--9th set-->
         <tr>
         <td>oracle_windows</td>
         <td>Installation and Configuration of Oracle</td>
         </tr>
         <tr>
         <td>postgresql</td>
         <td>Installation and Configurationof postgresql</td>
         </tr>   
         <!--10th set-->
         <tr>
         <td>service_apache</td>
         <td>Service cookbook for apache server</td>
         </tr>
         <tr>
         <td>service_iptables</td>
         <td>Service cookbook for firewall</td>
         </tr>   
         <!--11th set-->
         <tr>
         <td>service_jboss</td>
         <td>Service cookbook for Jboss server</td>
         </tr>
         <tr>
         <td>service_mysql</td>
         <td>Service cookbook for Mysql</td>
         </tr>   
         <!--12th set-->
         <tr>
         <td>service_nginx</td>
         <td>Service cookbook for nginx </td>
         </tr>
         <tr>
         <td>service_tomcat</td>
         <td>Service cookbook for tomcat</td>
         </tr>   
         <!--13th set-->
         <tr>
         <td>service_weblogic</td>
         <td>service cookbook for weblogic</td>
         </tr>
         <tr>
         <td>seven_zip</td>
         <td>Installation of 7Zip</td>
         </tr>
         <!--14th set-->
         <tr>
         <td>git</td>
         <td>Installs git and optionally sets up a git server as a daemon under runit</td>
         </tr>
         <tr>
         <td>wget_windows</td>
         <td>Installs wget on windows</td>
         </tr>
         <!--15th set-->
         <tr>
         <td>toad_windows</td>
         <td>Installation and Configuration of TOAD</td>
         </tr>
         <tr>
         <td>docker</td>
         <td>Installation and Configuration of docker engine</td>
         </tr>   
         <tr>
         <td>jenkins</td>
         <td>Installs and configures Jenkins CI master &amp; node slaves.</td>
         </tr>   
         </tbody>
         </table>
         </div>
         <div class="modal-footer">
         <a class="btn btn-primary" data-dismiss="modal">Close</a>
         </div>   
         </div>
         </div>
         </div>
         <!--modal for help ends-->
         <!--execute modal starts here-->
         <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="editAttributesModalContainer" class="modal fade" data-backdrop="static">
         <div class="modal-dialog">
         <div class="modal-content">
         <div class="modal-header">
         <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
         x
         </button>
         <h4 class="modal-title">
         <i class="fa fa-eraser txt-color-blue"></i>&nbsp;&nbsp;Edit Attributes
         </h4>
         </div>
         <div class="modal-body no-padding">
         <div class="loadingContainer">
         <img class="center-block loadingContainerimageCSS" src="img/loading.gif" />
         </div>
         <div class="errorMsgContainer loadingerrorMsgContainerCSS"></div> 
         <form  class="attributesEditFormArea padding10" action="">
         <table id="attributesEditListArea" class="table table-striped table-bordered table-hover dataTable no-footer table-condensed tablesorter" cellpadding="5px" width="100%">
         <thead>
         <tr>
         <th>Attributes</th>
         <th>Values</th>
         </tr>
         </thead>
         <tbody class="attributesEditTableBody">
         </tbody>
         </table>
         </form>
         </div>
         <div class="modal-footer">
         <a class="btn btn-default" data-dismiss="modal">Close</a>
         <a type="submit" class="btn btn-primary saveAttribBtn">Save</a>
         </div>
         </div><!-- /.modal-content -->
         </div><!-- /.modal-dialog -->
         </div><!--/.modal-assignedExecute-->
         <div class="widget-toolbox clearfix">
         <div class="btn-group pull-right">
         <label id="spinnerForSave" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
         <button type="submit" class="btn btn-primary btnSaveTask btn-mini" style="margin-right:11px;">
         <i class="ace-icon fa fa-check bigger-110"></i>
         Save
         </button>
         <a class="btn btn-primary btn-mini btnBack" onclick="window.history.back();" id="btncancel">
         <i class="ace-icon fa fa-undo bigger-110"></i>
         Cancel
         </a>
         </div>
         </div>
         </div>
         </form>
      </div>
   </div>
</div>



<script type="text/javascript">
//datatable for runlist
if (!$.fn.dataTable.isDataTable('#tableRunlist')) {
    //var $taskListArea = $('.taskListArea').empty();
    $tasksRunlist = $('#tableRunlist').DataTable({
        "pagingType": "full_numbers",
        "bInfo": false,
        "bLengthChange": false,
        "paging": false,
        "bFilter": false,
        "aoColumns": [{
            "bSortable": false
        }]
    });
}

//datatable for jobResult
if (!$.fn.dataTable.isDataTable('#tableJobList')) {
    //var $taskListArea = $('.taskListArea').empty();
    $jobList = $('#tableJobList').DataTable({
        "pagingType": "full_numbers",
        "bInfo": false,
        "bLengthChange": false,
        "paging": false,
        "bFilter": false,
        "aoColumns": [{
            "bSortable": false,
            "sWidth": "80%",
         },{
            "bSortable":false,
            "sWidth": "20%"
        }]
    });
}

//datatable for parameters
if (!$.fn.dataTable.isDataTable('#tableParameters')) {
    //var $taskListArea = $('.taskListArea').empty();
    $paramList = $('#tableParameters').DataTable({
        "pagingType": "full_numbers",
        "bInfo": false,
        "bLengthChange": false,
        "paging": false,
        "bFilter": false,
        "aoColumns": [{
            "bSortable": false
         },{
            "bSortable": false
         },{
            "bSortable": false
         },{
            "bSortable": false
         },{
            "bSortable":false,
            "sWidth": "20%"
        }]
    });
}

$(document).ready(function() {
    $('[data-toggle="popover"]').popover({
       trigger: 'focus'
    });

    $('.addListUrl').click(function(e) {
        $('#jobLinkCreate').trigger("reset");
    });
    $('.addListParam').click(function(e) {
        $('#parameterCreate').trigger('reset');
        $('#parametersSelect').select2("val","");
        $('#booleanTable').addClass('hidden');
        $('#stringTable').addClass('hidden');
        $('#choiceTable').addClass('hidden');
    });
});





var urlParams = {};
(window.onpopstate = function() {
    var url = window.location.href;
    var indexOfQues = url.lastIndexOf("?");
    if (indexOfQues != -1) {
        var sub = url.substring(indexOfQues + 1);
        console.log(sub);
        var params = sub.split('&')
        for (var i = 0; i < params.length; i++) {
            var paramParts = params[i].split('=');
            urlParams[paramParts[0]] = paramParts[1];
        }
    }

})();

function validatejson(attrctrl) {
    try {
        if (attrctrl.val().trim() != '')
            var attrjson = $.parseJSON(attrctrl.val());
    } catch (err) {
        $('#attrmessage').html('Invalid JSON');
        $('#attrmessage').attr('title', 'Error:' + err);
    }
}

$(document).ready(function() {
    $(".chooseTasktype").select2();
    $("#jenkinsServerList").select2();
    $("#jobListJenkins").select2();
    $("#parametersSelect").select2();
    $(".assignuserListJenkins").select2();


    $(document).on('shown.bs.modal', function(e) {
        $('[autofocus]', e.target).focus();
    });

    var $addParameters = $('#addParameters');
    var $addParametersFalse = $('#addParametersFalse');

    $addParametersFalse.change(function(){
      if ($(this).is(":checked")){
         $('.addParameters').addClass('hidden');
      }
    });

    $addParameters.change(function() {
        if ($(this).is(":checked")) {
            $('.addParameters').removeClass('hidden');
        } else {
            $('.addParameters').addClass('hidden');
        }

    });

    function loadUIData(taskData) {
        console.log(taskData);
     //   alert(JSON.stringify(taskData));
        
        if (taskData) {
         $('.widget-header').find('.widget-margin').html('Edit Job');
            $('.inputTaskName').val(taskData.name);
            $('#taskType').val(taskData.taskType);
            $('#taskType').change();
            $('#taskType').attr('disabled', 'disabled');
            $('textarea#chefDescription').val(taskData.description);
            $('textarea#jenkinsDescription').val(taskData.description);
            
            if(taskData.taskConfig.runlist &&  taskData.taskConfig.runlist.length){
              // alert(taskData.taskConfig.runlist);
                if (taskData.taskConfig.runlist.length > 0) {
                // alert(taskData.taskConfig.runlist.length);
                    createRunlistTable(taskData.taskConfig.runlist);
                }
            }

            // console.log('urls ===> ',taskData.taskConfig.jobResultURL);

            if (taskData.taskConfig.jobResultURL && taskData.taskConfig.jobResultURL.length) {
                // alert(taskData.taskConfig.runlist);
                //alert('edit mode');
                for (var z = 0; z < taskData.taskConfig.jobResultURL.length; z++) {
                    console.log('urls ===> ',taskData.taskConfig.jobResultURL);
                    createJobLinksTable(taskData.taskConfig.jobResultURL[z]);
                   

                }
            }
            if (taskData.taskConfig.attributes && taskData.taskConfig.attributes.length) {
                //$('#attrtextarea').text(JSON.stringify(taskData.taskConfig.attributesjson));
                createAttribTableRowFromJson(taskData.taskConfig.attributes);
                //createAttribTableRowFromJson([]);
            }
            if (taskData && taskData.taskType === 'jenkins' && taskData.taskConfig.autoSyncFlag) {

                console.log('reading auto sync flag as:', taskData.taskConfig.autoSyncFlag);

                if (taskData.taskConfig.autoSyncFlag === 'true') {
                    //$('input:radio[class=test1][id=test2]').prop('checked', true);
                    $("input[type='radio'][name='auto_sync'][id='radio_yes']").prop('checked', true);
                } else {
                    $("input[type='radio'][name='auto_sync'][id='radio_no']").prop('checked', true);
                }

            }
            //condition for parameterized build while edit
            console.log("check>>>>>>>>>>>" + JSON.stringify(taskData));
            if (taskData && taskData.taskType === 'jenkins' && taskData.taskConfig.parameterized) {

                console.log('reading parameterized flag as:', taskData.taskConfig.parameterized);
              //  alert(taskData.taskConfig.parameterized.length);
                if (taskData.taskConfig.parameterized.length > 0) {
                  //alert(taskData.parameterized.length);
                    for (var j = 0; j < taskData.taskConfig.parameterized.length; j++) {
                   //  alert(JSON.stringify(taskData.taskConfig.parameterized[j]));
                        //$('input:radio[class=test1][id=test2]').prop('checked', true);
                        $("input[type='radio'][name='paramCheck'][id='addParameters']").prop('checked', true);
                        $('.addParameters').removeClass('hidden');
                        //alert(JSON.stringify(taskData.taskConfig.parameterized[j]));
                        console.log("parapapa>>>>" + taskData.taskConfig.parameterized.length);
                        //alert(JSON.stringify(taskData.taskConfig.parameterized));
                        createParametersTable(taskData.taskConfig.parameterized[j],null);
                        
                    }
                } else {
                    $("input[type='radio'][name='paramCheck'][id='addParametersFalse']").prop('checked', false);
                }

            }
            
        }


        $.get('../organizations/' + urlParams.org + '/businessgroups/' + urlParams['bg'] + '/projects/' + urlParams.projid + '/environments/' + urlParams.envid + '/instances', function(data) {
            var $deploymentNodeList = $('.deploymentNodeList').empty();
            for (var i = 0; i < data.length; i++) {
                if (data[i].instanceState == 'running' || data[i].instanceState == 'pending' || data[i].instanceState == 'unknown') {
                    var checked = false;
                    if (taskData && taskData.taskType === 'chef' && taskData.taskConfig.nodeIds && taskData.taskConfig.nodeIds.length) {
                        if (taskData.taskConfig.nodeIds.indexOf(data[i]._id) !== -1) {
                            checked = true;
                        }
                    }
                    var nodeName = data[i].chef.chefNodeName;
                    if (data[i].instanceIP) {
                        nodeName = data[i].instanceIP;
                    }
                    if (data[i].blueprintData && data[i].blueprintData.blueprintName) {
                        nodeName = data[i].blueprintData.blueprintName;
                    }
                    if (data[i].name) {
                        nodeName = data[i].name;
                    }

                    var $li = $('<li><label class="checkbox" style="margin: 5px;font-size:13px;"><input type="checkbox" name="deploymentNodesCheckBox" value="' + data[i]._id + '"><i></i>' + nodeName + '</label></li>');
                    if (checked) {
                        $li.find('input')[0].checked = true;
                        //$li.find('label').click();
                    }
                    $deploymentNodeList.append($li);
                }
            }
        });



        var runlist = null;
        if (taskData && taskData.taskType === 'chef') {
            runlist = taskData.taskConfig.runlist;
        }
        var $ccrs = $chefCookbookRoleSelector(urlParams.org, function(data) {

        }, runlist, false, {
            deploy: true,
            all: true,
            roles: false,
            cookbooks: false
        });

        $.get('/organizations/' + urlParams.org + '/chefserver', function(data) {
            console.log('chef logs ==> ', data);
            if (data && data.configname) {
                $('table').find('.chefServerName').html('Chef Server Details for -&nbsp;' + data.configname);
            }
        });
        $('.runlistContainer').append($ccrs);
        $('#loadimageandtextlabel').find('.fontsize13').after("<span style='color:red'>*</span>");
        $('.runlistContainer').data('$ccrs', $ccrs);

        // jenkins 

        $.get('/jenkins/', function(jenkinsList) {
            jenkinsList = JSON.parse(jenkinsList);
            console.log("ffffffffffffffffff"+jenkinsList);
            var $jenkinsServerListDropdown = $('#jenkinsServerList');
            for (var i = 0; i < jenkinsList.length; i++) {
                var keys = Object.keys(jenkinsList[i]);
                var $option = $('<option></option>').val(jenkinsList[i][keys[0]]).html(keys[0]);
                $jenkinsServerListDropdown.append($option);
            }
            //$jenkinsServerListDropdown.trigger();
            var $spinnerJob = $('#spinnerForJob').addClass('hidden');
            $jenkinsServerListDropdown.change(function(e) {
                    if ($(this).val() == 'choose') {
                        $spinnerJob.addClass('hidden');
                        $jobsList.prop("disabled", true);
                    }else{
                    var jenkinsServerId = $(this).val();

                    console.log(jenkinsServerId);
                    
                    $spinnerJob.removeClass('hidden');
                    $jobsList.prop("disabled", true);

                    //this is a condition for getting the list of jenkins job for a particular jenkins server..
                    $.get('/jenkins/' + jenkinsServerId + '/jobs', function(jobsList) {
                        if (jobsList) {
                            $jobsList.append('<option value="">Select Job</option>');
                            for (var i = 0; i < jobsList.length; i++) {
                                var $option = $('<option></option>').val(jobsList[i].name).html(jobsList[i].name);
                                $jobsList.append($option);
                            }



                            $jobsList.prop("disabled", false);
                            if (taskData && taskData.taskType === 'jenkins') {
                                $jobsList.val(taskData.taskConfig.jobName);
                                $jobsList.change();

                            }
                            $spinnerJob.addClass('hidden');
                        }
                    }).fail(function(jxhr) {
                        $spinnerJob.addClass('hidden');
                        var msg = "Jenkins Job Behaved Unexpectedly.";
                        if (jxhr.responseJSON && jxhr.responseJSON.message) {
                            msg = jxhr.responseJSON.message;
                        } else if (jxhr.responseText) {
                            msg = jxhr.responseText;
                        }
                        bootbox.alert(msg);


                    });

                }
            });

            //condition for getting the job url for a particular job in jenkins...
            var $jobsList = $('#jobListJenkins');
            var $spinnerJobForUrl = $('#spinnerForUrl').addClass('hidden');
            $jobsList.change(function(e) {
                var jobName = $('#jobListJenkins').val();
                console.log("giobiobibio" + jobName);
                var jenkinsServerId;
                $spinnerJobForUrl.removeClass('hidden');
                for (var i = 0; i < jenkinsList.length; i++) {
                    var keys = Object.keys(jenkinsList[i]);
                    console.log("=========== " + JSON.stringify(jenkinsList[i][keys[0]]));
                    jenkinsServerId = jenkinsList[i][keys[0]];
                }
                //alert(JSON.stringify($option));

                var $jobUrlList = $('.jenkinsJobURL').val();
                
                if (jobName) {
                   
                    $('.jenkinsJobURL').empty();
                    $.get('/jenkins/' + jenkinsServerId + '/jobs/' + jobName, function(jobsList) {
                        //for (var i = 0; i < jobsList.length; i++) {
                       // alert(JSON.stringify(jobsList));
                       $spinnerJobForUrl.addClass('hidden');
                       $('.jenkinsJobURL').removeClass('hidden');
                       $('#helpImage').removeClass('hidden');
                        var $anchor = "<span><a style='font-size:13px;word-wrap:break-word;' title='" + jobsList.url + "' href='" + jobsList.url + "'' target='_blank' >" + jobsList.url + "</a></span>";
                        //alert($anchor);
                        $('.jenkinsJobURL').val(jobsList.url);
                        //}
                    }).fail(function(jxhr) {
                        $spinnerJobForUrl.addClass('hidden');
                        var msg = "Jenkins Server Behaved Unexpectedly.";
                        if (jxhr.responseJSON && jxhr.responseJSON.message) {
                            msg = jxhr.responseJSON.message;
                        } else if (jxhr.responseText) {
                            msg = jxhr.responseText;
                        }
                        bootbox.alert(msg);


                    });
                }

                
            });


            if (taskData && taskData.taskType === 'jenkins') {
                $jenkinsServerListDropdown.val(taskData.taskConfig.jenkinsServerId);
                $jenkinsServerListDropdown.change();
            }



        });

        $.get('../users', function(userList) {
            userList = JSON.parse(userList);
            var $userLists = $('.userLists').empty();
            userList.sort(function(a, b) {
                var keyA = Object.keys(a);
                var keyB = Object.keys(b);

                if (keyA[0] < keyB[0]) return -1;
                if (keyA[0] > keyB[0]) return 1;
                return 0;
            });

            for (var i = 0; i < userList.length; i++) {
                var keys = Object.keys(userList[i]);
                var $option = $('<option></option>').append(keys[0]).val(keys[0]);
                $userLists.append($option);
            }

        });


    }

    if (urlParams.taskId) {
        $.get('../tasks/' + urlParams.taskId, function(taskData) {
            loadUIData(taskData);
        });
    } else {
        loadUIData();
    }

    //save form for jenkins and chef
    $('#taskForm').submit(function(e) {
     //   alert('check');
       // alert('breaking');
        var taskType = $('#taskType').val();
        var taskData = {};

        taskData.taskType = taskType;
        
        if (taskType === 'chef') {
            var $saveSpinner = $('#spinnerForSave');
            var taskName = $('#chefTaskName').val();
            if (!taskName) {
                alert('Please enter a Task-Name');
                return false;
            }
            taskData.name = taskName;
            console.log($('textarea#chefDescription').val());
            var chefJobDescription = $('textarea#chefDescription').val();

            taskData.description = chefJobDescription;
            var $selectedNodes = $('#selectedNodesChefTask input[type=checkbox]');
           // var $addParameters = $('#addParameters input[type=checkbox]');

            console.log($selectedNodes.length);
            var nodesList = [];
            $selectedNodes.each(function() {
                if (this.checked) {
                    nodesList.push(this.value);
                }
            });
            if (!nodesList.length) {
                alert('Please choose nodes');
                return false;
            }

            var $ccrs = $('.runlistContainer').data('$ccrs');
            var runlist = $ccrs.getSelectedRunlist();
            

            /*if (!runlist.length) {
                alert('Please choose runlist');
                return false;
            }*/
            taskData.nodeIds = nodesList;
            taskData.runlist = runlist;
            //taskData.attributesjson = $('#attrtextarea').val().trim();
            $trAttribute = $('#attributesViewListTable').find('tbody tr');
            var attributes = [];
            $trAttribute.each(function() {
                var $tr = $(this);
                attributes.push({
                    name: $tr.attr('data-attributeName'),
                    jsonObj: $tr.data('jsonObj')
                });
            });
            taskData.attributes = attributes;
            $('.btnSaveTask').attr('disabled','disabled');
        } else if (taskType === 'jenkins') {
            var $saveSpinner = $('#spinnerForSave');

            var validatorForm = $("#parameterCreate").validate();
            validatorForm.resetForm();
            
            var taskName = $('#jenkinsTaskName').val();
            if (!taskName) {
                alert('Please enter a Task-Name');
                return false;
            }
            taskData.name = taskName;
            var jenkinsServerId = $('#jenkinsServerList').val();
            if (!jenkinsServerId) {
                alert('Please Choose a Jenkins Server');
                return false;
            }

            var jenkinsJobName = $('#jobListJenkins').val();
            if (!jenkinsJobName) {
                alert('Please Choose a Jenkins Job');
                return false;
            }
            var jenkinsJobDescription = $('textarea#jenkinsDescription').val();
            var usersList = [].concat($('#jenkinsUserList').val());
            if (!usersList.length) {
                alert('Please Choose a users');
                return false;
            }
            var jobUrl = $('.jenkinsJobURL').val();
            /*if(!jobUrl){
               alert('Please Choose Jenkins Job URL');
               return false;
            }*/
            var jobResultURL = [];
            var $jobUrlTableBody = $('#tableJobList tbody');
            var $trs = $jobUrlTableBody.find('tr');
            //alert($trs);
            //alert($trs.length);
            $trs.each(function(e) {
                var $this = $(this);
                 jobResultURL.push($this.data('jobUrlData'));
            });
            $('.btnSaveTask').attr('disabled','disabled');
            //alert(jobUrlResult);            
            taskData.jenkinsServerId = jenkinsServerId;
            taskData.jobName = jenkinsJobName;
            taskData.description = jenkinsJobDescription;
            
            taskData.jobResultURL= jobResultURL;
          //  console.log(JSON.stringify(taskData.jobResultURL));
            taskData.jobURL = jobUrl;
            //alert(taskData.jobResultURL);
            
            taskData.users = usersList;
            
            var autoSyncFlag = $("input[type='radio'][name='auto_sync']:checked").val();
            console.log('autoSyncFlag:', autoSyncFlag);
            if(autoSyncFlag === "true"){
               taskData.autoSyncFlag = true;
            }else{
               taskData.autoSyncFlag = false;
            }
            

            //check for build parameters. 
            var isParameterized = false;
            if ($('#addParameters').is(":checked")) {
                isParameterized = true;
                var parameterized = [];
                var $paramBody = $('#tableParameters tbody');
                var $trs = $paramBody.find('tr');
                $trs.each(function(e) {
                    var $this = $(this);
                    parameterized.push($this.data('parameterizedObj'));
                });
                
                taskData.isParameterized = isParameterized;
                taskData.parameterized =parameterized;
                console.log(taskData.parameterized);
            }
            console.log($('#addParameters').is(":checked"));
            console.log(isParameterized);


        } else {
            return false;
        }




        var reqBody = {
            taskData: taskData
        };
        console.log(reqBody);
        if (urlParams.taskId) {
            if (taskType === 'jenkins') {
               $saveSpinner.removeClass('hidden');
                $.get('/jenkins/' + taskData.jenkinsServerId + '/job/' + taskData.jobName + '/lastBuild', function(data) {
                    //alert(JSON.stringify(taskData));
                    var url = taskData.jobResultURL;
                    taskData.jobResultURL = url;
                    $.post('../tasks/' + urlParams.taskId + '/update', reqBody, function(data) {
                        console.log(data);

                        $('.btnBack').click();
                        bootbox.alert({
                            message: 'Job&nbsp;&nbsp;<b>' + taskData.name + '</b>&nbsp;&nbsp;has been updated successfully',
                            title: "Success"
                        });

                    });
                });
                $saveSpinner.addClass('hidden');
                $('.btnSaveTask').removeAttr('disabled');

                return false;
            } else{
             //  alert(JSON.stringify(reqBody));
                $.post('../tasks/' + urlParams.taskId + '/update', reqBody, function(data) {
                    console.log(data);

                    $('.btnBack').click();
                    bootbox.alert({
                        message: 'Job&nbsp;&nbsp;<b>' + taskData.name + '</b>&nbsp;&nbsp;has been updated successfully',
                        title: "Success"
                    });

                });
                $saveSpinner.addClass('hidden');
                $('.btnSaveTask').removeAttr('disabled');
                return false;
            }
        } else {
            if (taskType === 'jenkins') {
               $saveSpinner.removeClass('hidden');
               //alert('jenkins');
                $.get('/jenkins/' + taskData.jenkinsServerId + '/job/' + taskData.jobName + '/lastBuild', function(data) {
                    var url = taskData.jobResultURL;
                    
                    taskData.jobResultURLPattern = taskData.jobResultURL;
                    //alert(taskData.jobResultURLPattern);
                    var reqBody = {
                        taskData: taskData
                    };
                    
                    $.post('../organizations/' + urlParams.org + '/businessgroups/' + urlParams['bg'] + '/projects/' + urlParams.projid + '/environments/' + urlParams.envid + '/tasks', reqBody, function(data) {
                        console.log(data);
                       //alert('spinner');
                        $('.btnBack').click();
                        bootbox.alert({
                            message: 'Job&nbsp;&nbsp;<b>' + data.name + '</b>&nbsp;&nbsp;has been successfully created',
                            title: "Success"
                        });

                    });

                    $saveSpinner.addClass('hidden');
                    $('.btnSaveTask').removeAttr('disabled');
                });
                return false;
            }else{
               $saveSpinner.removeClass('hidden');
               //alert('chef');
                var reqBody = {
                    taskData: taskData
                };
                $.post('../organizations/' + urlParams.org + '/businessgroups/' + urlParams['bg'] + '/projects/' + urlParams.projid + '/environments/' + urlParams.envid + '/tasks', reqBody, function(data) {
                    console.log(data);
                    $('.btnBack').click();
                    $(".alert-message").alert();
                    window.setTimeout(function() {
                        $(".alert-message").alert('close');
                    }, 4000);
                    bootbox.alert({
                     message:'Job&nbsp;&nbsp;<b>' + data.name + '</b>&nbsp;&nbsp;has been successfully created',
                     title:"Success"
                    });
                    $saveSpinner.addClass('hidden');
                    $('.btnSaveTask').removeAttr('disabled');
                });

                return false;
            }
        }
    });

    function createJobLinksTable(jobResultURL) {

           // alert(jobResultURL);
        var $jobListTable = $('#jobListSave');
        var $tr = $('<tr class="jobResultRow"></tr>');
        var $tdName = $('<td class="jobResultDescription" style="word-break: break-word;"></td>');


        $tr.data('jobUrlData', jobResultURL);

        $tdName.append(jobResultURL);
        var $tdAction = $('<td/>');
        $tdAction.append('<div style="margin-right:17px;float:right;" class="btn-group"><button class="deleteRow" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');

        $tdAction.find('.deleteRow').click(function() {
            $jobList.row($tr).remove().draw(true);
        });

        $tr.append($tdName).append($tdAction);
        $jobListTable.append($tr);
        $jobList.row.add($tr).draw();
    }

    function createParametersTable(param,parameterType) {
        var parameterType;
        
         var parameterized = [];
        
        var parameterizedObj = {
            parameterName: String,
            name: String,
            defaultValue: [String],
            description: String
        };
       // alert("parameterType" + JSON.stringify(parameterType));
       // alert("param" + JSON.stringify(param));
        if(parameterType){
            if (parameterType === "Boolean") {
               parameterizedObj.parameterName = "Boolean";
               parameterizedObj.name = $('#booleanName').val();
               var defaultValue=[];
               parameterizedObj.defaultValue = false;
               parameterizedObj.defaultValue = $('#booleanValueFalse').val();
               if ($('#booleanValueTrue').is(":checked")) {
                   parameterizedObj.defaultValue = true;
               }
               parameterizedObj.description = $('#booleanDescription').val();

           } else if(parameterType === "String") {
               parameterizedObj.parameterName = "String";
               parameterizedObj.name = $('#stringName').val();
               var defaultValue=[];
               parameterizedObj.defaultValue = $('#stringValue').val();
               parameterizedObj.description = $('#stringDescription').val();

           } else if(parameterType === "Choice") {
               parameterizedObj.parameterName = "Choice";
               parameterizedObj.name = $('#choiceName').val();
               var defaultValue=[];

               parameterizedObj.defaultValue = $('#choiceValue').val();
               
               defaultValue=parameterizedObj.defaultValue.split(',');

               parameterizedObj.defaultValue=defaultValue;
               
               //parameterizedObj.defaultValue= parameterizedObj.defaultValue.split(',');
               parameterizedObj.description = $('#choiceDescription').val();
               

           }
     }else if(param){
    //  alert(param);
         if (param.parameterName === "Boolean") {
               parameterizedObj.parameterName = "Boolean";
               parameterizedObj.name = param.name;
               defaultValue=[];
               parameterizedObj.defaultValue = param.defaultValue;
               if ($('#booleanValueTrue').is(":checked")) {
                   parameterizedObj.defaultValue = true;
               }
               parameterizedObj.description = param.description;

           } else if(param.parameterName === "String") {
          //  alert('check');
               parameterizedObj.parameterName = "String";
               parameterizedObj.name = param.name;
               defaultValue=[];
               parameterizedObj.defaultValue = param.defaultValue;
               parameterizedObj.description = param.description;   
           } else if(param.parameterName === "Choice") {
               parameterizedObj.parameterName = "Choice";
               parameterizedObj.name = param.name;
               defaultValue=[];
               parameterizedObj.defaultValue = param.defaultValue;
               parameterizedObj.description = param.description;   
           }
     }

        var $parameterListTable = $('#paramList');
        var $tr = $('<tr class="paramResultRow"></tr>');
        $tr.data('parameterizedObj', {
            parameterName: parameterizedObj.parameterName,
            name: parameterizedObj.name,
            defaultValue: parameterizedObj.defaultValue,
            description: parameterizedObj.description
        });
        var $tdType = $('<td class="paramType"></td>');
        var $tdName = $('<td class="paramName"></td>');
        var $tdValue = $('<td title="'+ parameterizedObj.defaultValue +'" class="paramValue"></td>');
        var $tdDescription = $('<td title="'+ parameterizedObj.description +'" class="paramDescription"></td>');
        var $tdAction = $('<td/>');
        $tdAction.append('<div style="margin-right:17px;float:right;" class="btn-group"><button class="deleteRow" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');

        $tdAction.find('.deleteRow').click(function() {
            $paramList.row($tr).remove().draw(true);
        });
        $tdType.append(parameterizedObj.parameterName);
        $tdName.append(parameterizedObj.name);
        $tdValue.append('<span>' + parameterizedObj.defaultValue + '</span>');
        $tdDescription.append(parameterizedObj.description);
        // alert(parameterizedObj.name);
        $tr.append($tdName).append($tdType).append($tdValue).append($tdDescription).append($tdAction);
        $parameterListTable.append($tr);
        $paramList.row.add($tr).draw();
        parameterized.push(parameterizedObj);
        console.log("param>>>>" + parameterized);

    }



    $('#jobLinkCreate').submit(function(e) {
        var regexpURL = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;

        // alert('chchch');
        var jobResultURL = $(this).find('.jobLinkCreate').val();
        if (!regexpURL.test(jobResultURL)) {
            alert('Please Enter a Valid URL');
            return false;
        } else {
            createJobLinksTable(jobResultURL)
            $('#jobResultModal').modal('hide');
            return false;
        }
    });

    $('#parameterCreate').submit(function(e) {
        var isValidate = $("#parameterCreate").valid();
        var parameterType = $('#parametersSelect').val();
        if (!isValidate) {
            e.preventDefault();
        } else {
            e.preventDefault();
            if (parameterType === "boolean") {
                createParametersTable(null, parameterType);
                $('#parameterModal').modal('hide');
                return false;
            } else if(parameterType === "choice"){
               createParametersTable(null, parameterType);
                $('#parameterModal').modal('hide');
                return false;
            } else {
                createParametersTable(null, parameterType);
                $('#parameterModal').modal('hide');
                return false;
            }
        }
        $('a#imageLinkParam[type="reset"]').on('click', function() {
            validator.resetForm();
        });
    });

    var validator = $('#parameterCreate').validate({
        errorPlacement: function(error, element) {
            // Append error within linked label
            $(element).closest("form").find("label[for='" + element.attr("id") + "']").append(error);

        },
        rules: {
            booleanName: {
                required: true
            },
            booleanDescription:{
               required:true
            },
            stringName:{
               required:true
            },
            stringValue:{
               required:true
            },
            stringDescription:{
               required:true
            },
            choiceName:{
               required:true
            },
            choiceValue:{
               required:true
            },
            choiceDescription:{
               required:true
            }
        },
        messages: {
            booleanName: {
                required: "&nbsp;(Required)"
            },
            booleanDescription: {
                required: "&nbsp;(Required)"
            },
            stringName:{
               required:"&nbsp;(Required)"
            },
            stringValue:{
               required:"&nbsp;(Required)"
            },
            stringDescription:{
               required:"&nbsp;(Required)"
            },
            choiceName:{
               required:"&nbsp;(Required)"
            },
            choiceValue:{
               required:"&nbsp;(Required)"
            },
            choiceDescription:{
               required:"&nbsp;(Required)"
            }
        },
        onkeyup: false,
        errorClass: "error",
    });

    function createRunlistTable(runlist) {
        //alert(runlist.length);
        //$('#tableRunlist').removeClass('hidden');
        var $options = $('#cookbooksrecipesselectedList').find('option');
        if (runlist.length == 0) {
            var runlist = [];
            $options.each(function() {
                var $option = $(this);
                runlist.push($option.val());
                console.log(runlist);
                return runlist;
            });
        }
        $tasksRunlist.clear().draw();
        //alert(runlist.length);
        for (i = 0; i < runlist.length; i++) {
         //alert('check');
            if (runlist.length > 0) {
               //alert('ch');
                console.log(runlist[i].substring(runlist[i].lastIndexOf("[") + 1, runlist[i].lastIndexOf("]")));
                var $runlistList = $('#tableRunlist');
                var $tr = $('<tr class="runlistRow"></tr>');
                var $tdName = $('<td class="runlistDescription"></td>');

                $tdName.append(runlist[i].substring(runlist[i].lastIndexOf("[") + 1, runlist[i].lastIndexOf("]")));
                $tr.append($tdName);
                $runlistList.append($tr);
                $tasksRunlist.row.add($tr).draw();
            }
        }
    }

    $('#saveRunlist').click(function(e) {
        var $ccrs = $('.runlistContainer').data('$ccrs');
        // alert($ccrs);
        console.log($ccrs);
        console.log($ccrs.getSelectedRunlist());
        var runlist = $ccrs.getSelectedRunlist();
       // alert(runlist);
        
            // alert('here');
            createRunlistTable(runlist);
            $('#chefRunlistModal').modal('hide');
            return false;
        

    });

    $('#editAttributesBtn').click(function(e) {
        var $ccrs = $('.runlistContainer').data('$ccrs');
        var runlist = $ccrs.getSelectedRunlist();
        if (!runlist.length) {
            alert('Please choose a runlist first');
            return false;
        }
        var $modal = $('#editAttributesModalContainer');
        $modal.find('.attributesEditFormArea').hide();
        $modal.find('.errorMsgContainer').hide();
        $modal.find('.loadingContainer').show();
        $modal.modal('show');

        var reqBody = {
            cookbooks: [],
            roles: []
        }
        for (var i = 0; i < runlist.length; i++) {

            if (runlist[i].indexOf('recipe') === 0) {
                className = 'cookbook';
            } else {
                className = 'roles';
            }
            var name = '';
            var item = runlist[i];
            var indexOfBracketOpen = item.indexOf('[');
            if (indexOfBracketOpen != -1) {
                var indexOfBracketClose = item.indexOf(']');
                if (indexOfBracketClose != -1) {
                    name = item.substring(indexOfBracketOpen + 1, indexOfBracketClose);
                }
            }
            if (runlist[i].indexOf('recipe') === 0) {
                reqBody.cookbooks.push(name);
            } else {
                reqBody.roles.push(name);
            }

        }
        //var chefServerId = $chefCookbookRoleSelector.getChefServerId();
        var $ccrs = $('.runlistContainer').data('$ccrs');
        var chefServerId = $ccrs.getChefServerId();
        $.post('../chef/servers/' + chefServerId + '/attributes', reqBody, function(attributesList) {
            //var dataTable = $('#attributesEditListArea').DataTable();
            //dataTable.clear();
            var $tbody = $modal.find('.attributesEditTableBody');
            $tbody.empty();
            var $tbodyViewAttributes = $('#attributesViewListTable').find('tbody');
            for (var i = 0; i < attributesList.length; i++) {
                var attributesNamesList = Object.keys(attributesList[i].attributes);
                for (var j = 0; j < attributesNamesList.length; j++) {
                    var $tr = $('<tr/>');
                    var displayName = attributesNamesList[j];
                    if (attributesList[i].attributes[attributesNamesList[j]].display_name) {
                        displayName = attributesList[i].attributes[attributesNamesList[j]].display_name;
                    }
                    var $tdAttribName = $('<td/>').html(displayName);
                    var required = false;
                    if (attributesList[i].attributes[attributesNamesList[j]]['required'] === 'required') {
                        $tdAttribName.append('<span class="control-label" style="color:Red;">&nbsp;*</span>');
                        required = true;
                    }
                    var value = '';
                    if (attributesList[i].attributes[attributesNamesList[j]]['default']) {
                        value = attributesList[i].attributes[attributesNamesList[j]]['default'];
                    }
                    var $trView = $tbodyViewAttributes.find('tr[data-attributeKey="' + attributesNamesList[j] + '"]');
                    if ($trView.length) {
                        value = $trView.attr('data-attributeValue');
                    }

                    var $attributeInput;
                    var choices = attributesList[i].attributes[attributesNamesList[j]].choice;
                    if (choices && choices.length) {
                        $attributeInput = $('<select class="attribValueInput" data-attribKey="' + attributesNamesList[j] + '" data-attribName="' + displayName + '" data-attributeRequired="' + required + '"></select>');
                        for (var k = 0; k < choices.length; k++) {
                            var $option = $('<option></option>').val(choices[k]).html(choices[k]);
                            $attributeInput.append($option);
                        }
                        $attributeInput.val(value);
                    } else {
                        var passwordField = false;
                        var keyParts = attributesNamesList[j].split('/');
                        if (keyParts.length) {
                            var indexOfPassword = keyParts[keyParts.length - 1].indexOf('password_');
                            if (indexOfPassword !== -1) {
                                passwordField = true;
                            }
                        }
                        if (passwordField) {
                            $attributeInput = $('<input type="password" class="attribValueInput" data-attribKey="' + attributesNamesList[j] + '" value="' + value + '" data-attribName="' + displayName + '" data-attributeRequired="' + required + '"/>');
                        } else {
                            $attributeInput = $('<input type="text" class="attribValueInput" data-attribKey="' + attributesNamesList[j] + '" value="' + value + '" data-attribName="' + displayName + '" data-attributeRequired="' + required + '"/>');
                        }

                    }





                    var $tdAttribEditor = $('<td/>').append($attributeInput);
                    var desc = attributesList[i].attributes[attributesNamesList[j]]['description'];
                    if (desc) {
                        var $tooltipAnchor = $('<a href="#" data-toggle="tooltip" title="' + desc + '!" style="margin-left:15px"><i class="fa fa-info"></i></a>');
                        $tooltipAnchor.tooltip();
                        $tdAttribEditor.append($tooltipAnchor);
                    }
                    $tr.append($tdAttribName).append($tdAttribEditor);
                    //dataTable.row.add($tr).draw();
                    $tbody.append($tr)
                }
            }
            $modal.find('.errorMsgContainer').hide();
            $modal.find('.loadingContainer').hide();
            $modal.find('.attributesEditFormArea').show();

        }).fail(function(e) {
            $modal.find('.errorMsgContainer').html('Unable to fetch attributes. Please try again later').show();
            $modal.find('.loadingContainer').hide();
            $modal.find('.attributesEditFormArea').hide();
        });
        return false;
    });

    function createAttribTableRowFromJson(attributes) {
        var $table = $('#attributesViewListTable').removeClass('hidden');
        var $tbody = $table.find('tbody').empty();
        console.log(attributes);
        for (var j = 0; j < attributes.length; j++) {
            var attributeObj = attributes[j].jsonObj;

            function getVal(obj, currentKey) {
                var keys = Object.keys(obj);
                for (var i = 0; i < keys.length; i++) {
                    if (typeof obj[keys[i]] === 'object') {
                        getVal(obj[keys[i]], currentKey + '/' + keys[i]);
                    } else {
                        var keyString = currentKey + '/' + keys[i];
                        keyString = keyString.substring(1);

                        var $tr = $('<tr/>').attr({
                            'data-attributeKey': keyString,
                            'data-attributeValue': obj[keys[i]],
                            'data-attributeName': attributes[j].name
                        }).data('jsonObj', attributes[j].jsonObj);;

                        var passwordField = false;
                        var passwordField = false;
                        var keyParts = keyString.split('/');
                        if (keyParts.length) {
                            var indexOfPassword = keyParts[keyParts.length - 1].indexOf('password_');
                            if (indexOfPassword !== -1) {
                                passwordField = true;
                            }
                        }

                        var $tdAttributeKey = $('<td/>').html(attributes[j].name);
                        if (passwordField) {
                            var $tdAttributeVal = $('<td/>').html("*****");
                        } else {
                            var $tdAttributeVal = $('<td/>').html(obj[keys[i]]);
                        }
                        $tr.append($tdAttributeKey).append($tdAttributeVal);
                        $tbody.append($tr);
                    }
                }
            }
            getVal(attributeObj, '');
        }
    }

    $('.saveAttribBtn').click(function(e) {
        var $modal = $('#editAttributesModalContainer');
        var $tbody = $modal.find('.attributesEditTableBody');
        var $input = $tbody.find('.attribValueInput');
        var attributes = [];
        for (var j = 0; j < $input.length; j++) {
            var $this = $($input[j]);
            var attributeKey = $this.attr('data-attribKey');
            console.log(attributeKey);
            var attribValue = $this.val();
            if (attribValue) {
                var attribPathParts = attributeKey.split('/');
                var attributeObj = {};
                var currentObj = attributeObj;
                for (var i = 0; i < attribPathParts.length; i++) {
                    if (!currentObj[attribPathParts[i]]) {
                        if (i === attribPathParts.length - 1) {
                            currentObj[attribPathParts[i]] = attribValue;
                            continue;
                        } else {
                            currentObj[attribPathParts[i]] = {};
                        }
                    }
                    currentObj = currentObj[attribPathParts[i]];
                }
                attributes.push({
                    name: $this.attr('data-attribName'),
                    jsonObj: attributeObj
                });
            } else {
                if ($this.attr('data-attributeRequired') === 'true') {
                    alert("Please fill in the required attributes");
                    return false;
                }
            }
        }

        console.log('attributeObj ==>', attributes);
        //$('#attrtextarea').text(JSON.stringify(attributeObj));
        createAttribTableRowFromJson(attributes);
        $modal.modal('hide');

    });



    $("#Jenkins-dropdown").hide();
    $('.jenkinsTaskType').hide();
    // $("#Custom-dropdown").hide();

    $('#taskType').change(function(e) {
        if (this.value == "chef") {
            $("#Jenkins-dropdown").hide();
            // $("#Custom-dropdown").hide();
            $("#chef-dropdown").show();
            $('.chefTaskType').show();
            $('.jenkinsTaskType').hide();
        } else if (this.value == "jenkins") {
            $("#Jenkins-dropdown").show();
            $('.jenkinsTaskType').show();
            $('.chefTaskType').hide();
            $("#chef-dropdown").hide();
        }
    });
    $('#parametersSelect').change(function(e) {
        if (this.value == "Boolean") {
            $("#booleanName").val('');

            $('input#booleanValue:checkbox').removeAttr('checked');
            $("#booleanDescription").val('');
            $("#booleanTable").removeClass('hidden');
            $("#stringTable").addClass('hidden');
            $("#choiceTable").addClass('hidden');
        } else if (this.value == "") {
            $("#stringTable").addClass('hidden');
            $("#booleanTable").addClass('hidden');
            $("#choiceTable").addClass('hidden');
        } else if (this.value == "Choice") {
            $("#stringTable").addClass('hidden');
            $("#booleanTable").addClass('hidden');
            $("#choiceTable").removeClass('hidden');
        } else {
            $("#stringName").val('');
            $("#stringValue").val('');
            $("#stringDescription").val('');
            $("#stringTable").removeClass('hidden');
            $("#booleanTable").addClass('hidden');
            $("#choiceTable").addClass('hidden');
        }
    });
});


$(document).ready(function() {
    var LocalBreadCrumb = localStorage.getItem("breadcrumb");
    var splitBread = null;
    if (LocalBreadCrumb != null && LocalBreadCrumb != 'undefined') {
        localStorage.removeItem("breadcrumb");
        splitBread = LocalBreadCrumb.split('>');
        if (splitBread.length > 0) {
            $('#ribbon').find('.breadcrumb').find('li').detach();
            for (var arraycount = 0; arraycount < splitBread.length; arraycount++) {
                var liNew = document.createElement('li');
                liNew.innerHTML = splitBread[arraycount];
                $('#ribbon').find('.breadcrumb').append(liNew);
            }
            var parentUl = $('li').filter(".referenceliClass.open").find('ul').find('li[data-envname=' + splitBread[3] + ']');
            parentUl.addClass('active');
        }
    }
});
//$('#loadimageandtextlabel').find('.fontsize13').text(Runlist);
</script>

