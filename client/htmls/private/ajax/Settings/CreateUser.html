<script>
   $(".tree-view").hide();
   
</script>
<div class="row">
   <div class="col-md-12">
      <div class="col-md-12">
         <form action="" id="myForm5" autocomplete="off">
            <div class="widget-box">
               <div class="widget-header">
                  <h4 class="widget-margin" style="color:black;">Create User<span id="spnloginname"></span></h4>
               </div>
               <div class="widget-body">
                  <div class="widget-main" style="min-height:300px">
                     <div>
                        <section id="widget-grid" class="">
                           <!-- START ROW -->
                           <div class="row">
                              <!-- Widget ID (each widget will need unique ID)-->
                              <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                                 <!-- widget div-->
                                 <div>
                                    <!-- widget content -->
                                    <div class="widget-body no-padding">
                                       <div class="col-lg-6">
                                          <label for="name">Login Name:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                          <label id="msgOrgName" style="display:none;color:red;float:right;">Required</label>
                                          <input name="ctl00$MainContent$orgname" value="Designer" id="loginname" class="form-control" type="text"  cdata="catalyst" unique="true" cat-validation="required,nospecial" uniqueconditionedby="loginname">
                                       </div>
                                       <div class="col-lg-6 topNew">
                                          <label for="">Email Address:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                          <label id="msgOrgName" style="display:none;color:red;float:right;">Required</label>
                                          <input type="text" name="ctl00$MainContent$orgname" value="" id="email" class="form-control" type="email" cdata="catalyst" cat-validation="required,email">
                                       </div>
                                       <div class="col-lg-6 smart-form" style="margin-top:25px">
                                          <label for="category">Roles:</label>
                                          <div id="userrolename" multiselect="multiselect" datatype="select" sourcepath="6" datapath="userrolename" class="input-group from-control col-md-12" style="height:150px;overflow-y:auto;padding:2px;border:1px solid silver;width:98%"  cdata="catalyst">
                                          </div>
                                       </div>
                                       <div class="col-lg-6 smart-form divldapcheckbox" style="margin-top:25px">
                                          <label for=""><input type="checkbox" id="chkadduserldap" >&nbsp;<label for="chkadduserldap">Add User to LDAP</label></label>
                                          <label id="msgchkadduserldap" style="display:none;color:red;"></label><br/>
                                          <div id="ldappasswordsection" class="hidden">
                                          Password: <span style="color:Red;" class="control-label">&nbsp;*</span><label id="msgpasswordmatch" style="display:none;color:red;">Passwords entered do not match or left blank</label><input name="ctl00$MainContent$orgname" value="" id="userpassword" class="form-control userpass" type="password"><br/>
                                          Confirm Password: <span style="color:Red;" class="control-label">&nbsp;*</span><input name="ctl00$MainContent$orgname" value="" id="userpassword1" class="form-control userpass" type="password">
                                        </div>
                                       </div>
                                    </div>
                                    <!-- end widget content -->
                                 </div>
                                 <!-- end widget div -->
                              </div>
                              <!-- end widget -->             
                           </div>
                           <!-- END ROW -->
                        </section>
                        <!-- end widget grid -->
                     </div>
                  </div>
               </div>
               <div class="widget-toolbox clearfix">
                  <div class="btn-group pull-right">
                     <button class="btn btn-primary btn-mini" style="margin-right:11px;">
                     <i class="ace-icon fa fa-check bigger-110"></i>
                     Save
                     </button>
                     <a class="btn btn-primary btn-mini" onclick="window.history.back();" id="btncancel">
                     <i class="ace-icon fa fa-undo bigger-110"></i>
                     Cancel
                     </a>
                  </div>
               </div>
            </div>
         </form>
         <!--form ends here-->
      </div>
   </div>
</div>
<!--row ends here-->
<!--Popup for selecting a cloud provider before proceeding-->
<script>
   //Form Name
   function cancelClicked() {
       $("#popupSelectProvider").modal('hide');
       $(".modal-backdrop.fade.in").detach();
       $('#btncancel').click();
   }
   
   function inLineReady() {
       $("input[type='text']").on("click", function () {
           $(this).select();
           $("#msgOrgName").hide();
       });
       $("#popupSelectProvider").modal({ keyboard: false, backdrop: "static" });
       readform(7); //7 is for users
       //
      var $subbutton = $('#myForm5').find('button');
      if(typeof $subbutton.attr('rowid') != "undefined")
      {
        $('#loginname').attr('disabled','disabled');
        $('.divldapcheckbox').first().addClass('hidden');
      }
       //Force opening the left navigation menu
       if ($('#navSettings').is(":visible") == false) {
           $('#navSettings').css("display", '');
           $('#navSettings > ul > li').first().addClass('open');
           $('#navSettings > ul > li > ul').css("display", "none");
           $('#navSettings > ul > li > ul').first().css("display", "block");
       }
       //redrawing the breadcrumb and selecting the tree
       $('#ulsettingstree > li').removeClass('active');
       $('#ulsettingstree > li').each(function () {
           if ($(this).text().trim() == "Users")
               $(this).addClass('active');
       });
       drawBreadCrumb1();
       enableUniqueCheckingForInputs(7);
      checkusernameexistsinldap('loginname');
      //frezing login name on edit mode.
      if(typeof $('#myForm5').find('button[rowid]').first().attr('rowid') != 'undefined'){
        // $('#loginname').attr('readonly','readonly');
      }
      else{
      //  $('#loginname').removeAttr('readonly');
      }
   
   }
   $('#chkadduserldap').change(function(){
      if($(this).is(":checked"))
        {
          $('#ldappasswordsection').removeClass('hidden');
        }
        else{
            $('#ldappasswordsection').addClass('hidden');
        }

   });

   function createUserInLdap(){
    var data1 = new FormData();
      data1.append("username",$('#loginname').val());
      data1.append("password",$('#userpassword').val());
      data1.append("fname",$('#loginname').val());
      data1.append("lname","cuser");
      //data1.append("ldaprootusername","Admin");
      //data1.append("ladaprootpassword","ReleV@ance");

      $.ajax({
        url: '/auth/createldapUser',
        data: data1,
        processData: false,
        contentType: false,
        type: 'POST',
        async: false,
        success: function(data,success){
          //alert(data);
          $('#loginname').trigger('blur');
        }
      });
   }
   
   inLineReady();
   
</script>
<script>
   $(document).ready(function () {
      $("#loginname").focus();
       $('#myForm5').submit(function() {
          
           $(this).validate();
            
           if($(this).valid){
                //if user has to be created in ldap
                if($('#chkadduserldap').is(':checked')){
                  //confirm if passwords match
                  if($('#userpassword').val() != $('#userpassword1').val() || $('#userpassword').val() == ''){
                    //alert('in here');
                    console.log('invalid pass');
                    $('#msgpasswordmatch').css("display","block");
                    $(this).find('.userpass').keyup(function(){
                      $('#msgpasswordmatch').css('style',"display:none");
                    });
                    return false;
                  }
                 createUserInLdap();
                }
                else{
                  if($('#unique_loginname')){
                    if($('#unique_loginname').text().indexOf('NOT') > 0){
                      return false;
                    }
                  }
                }

                /*alert('valid form submitted'); // for demo*/
               if(validateForm()) {

                saveform('7');
              }
           }else{
                alert('Invalid values found cannot submit'); // for demo
           }
           return false; // for demo
       });
   });
       
</script>