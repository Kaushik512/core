    <script>
     // $(".tree-view").hide();

    </script>

    <div class="row" id="createimagebody">
      <div class="col-md-12">
        <form id="myForm22" action="">
          <div class="col-md-12">
            <div class="widget-box">
              <div class="widget-header"><h4 style="color:black;padding-top:9px;">Create Image <span id="
                spnimage"></span></h4></div>
                <div class="widget-body">
                  <div class="widget-main" style="min-height:300px">
                    <div>

                      <section id="widget-grid" class="">
                        <!-- START ROW -->
                        <div class="row">
                          <!-- NEW COL START -->
                          <article class="col-sm-12 col-md-12 col-lg-12">

                            <!-- Widget ID (each widget will need unique ID)-->
                            <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">

                              <!-- widget div-->
                              <div>

                                <!-- widget content -->
                                <div class="widget-body no-padding">



                                  <fieldset>
                                  
                                    <div class="row">
                                      <div class="col-lg-6">
                                       <label for="">Name:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                       <!-- <i class="icon-append fa fa-building"></i> -->
                                       <input name="ctl00$MainContent$orgname" placeholder="Please Enter Image Name" id="name" class="form-control" type="text"  cdata="catalyst" cat-validation="required,max15">
                                       <span data-val-controltovalidate="domainname" id="name" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                     </div>                                                         


                                     <div class="col-lg-6">
                                      <label for="name">Choose Provider:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                      <select id="providerId" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" datapath="masterjson.rows.row" valuelinkfield="costcode" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                        <option value="">Choose Provider</option>


                                      </select>
                                      <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                    </div>   


                                  </div>
                                  <div class="row">
                                <!--    <div class="col-lg-6">
                                    <label for="name">Virtualization Type:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                    <select id="vType" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                     <option value="">Select Virtualization Type</option>
                                   </select>
                                   <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                 </div> -->
                                <!--  <div class="col-lg-6">
                                  <label for="name">Instance Size:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                  <select id="instancesize" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                  </select>
                                  <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                </div> -->

                              </div>                                              

                              <div class="row">
                                <div class="col-lg-6">
                                  <label for="name">Operating System:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                  <select id="osType" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                   <option value="">Select OS</option>
                                 </select>
                                 <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                               </div>
                               <div class="col-lg-6">
                                 <label for=""> Image ID:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                 <!-- <i class="icon-append fa fa-building"></i> -->
                                 <input name="ctl00$MainContent$orgname" Placeholder="Enter Image Identifier" id="imageidentifire" class="form-control" type="text"  cdata="catalyst" cat-validation="required">
                               </div>
                             </div>
                             <div class="row">
                               <div class="col-lg-6">
                                 <label for=""> Admin  User Name:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                 <!-- <i class="icon-append fa fa-building"></i> -->
                                 <input name="ctl00$MainContent$orgname" Placeholder="Enter The Admin UserName" id="UserName" class="form-control" type="text"  cdata="catalyst" cat-validation="required,max15">
                               </div> 

                               <div class="col-lg-6">
                                  <label for="name">Organization Name:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                  <select id="orgId" name="orgId" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
                                   <option value="">Select Organization</option>
                                 </select>
                                 <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                               </div>
                              </div>
                           </fieldset>
                         </div>
                         <!-- end widget content -->

                       </div>
                       <!-- end widget div -->

                     </div>
                     <!-- end widget -->             

                   </article>
                   <!-- END COL -->
                 </div>
                 <!-- END ROW -->
               </section>
               <!-- end widget grid -->

             </div>
           </div>
         </div>

         <div class="widget-toolbox clearfix">
           <div class="btn-group pull-right">
            <button id="btnsubmit" class="btn btn-primary btn-mini" style="margin-right:11px;">
              <i class="ace-icon fa fa-check bigger-110"></i>
              Save
            </button>
            <a class="btn btn-primary btn-mini" onclick="window.history.back();" id="btncancel">
              <i class="ace-icon fa fa-undo bigger-110"></i>
              Cancel
            </a>
          </div>
        </div>
      </div>

    </div>
  </form>
</div>

</div>

</div>

<script>


  function cancelClicked() {
    $("#popupSelectProvider").modal('hide');
    $(".modal-backdrop.fade.in").detach();
    $('#btncancel').click();
  }


  function inLineReady() {
    $("#providerId").select2();
    $("#region").select2();
    $("input[type='text']").on("click", function () {
      $(this).select();
      $("#msgOrgName").hide();
    });
            if (readform(22) == true) {  //22 is the reference for provider master. Function returns true if in not in edit mode
                //alert('in');
                $('#createproviderbody').css('display','');
                $('#spnprovidertype').html($('#providertype').val());
              }

              $('#content').css("opacity", "1 !important");
            //Force opening the left navigation menu
            if ($('#navSettings').is(":visible") == false) {
              $('#navSettings').css("display", '');
              $('#navSettings > ul > li').first().addClass('open');
              $('#navSettings > ul > li > ul').css("display", "none");
              $('#navSettings > ul > li > ul').first().css("display", "block");
            }
            //redrawing the breadcrumb and selecting the tree
            $('#ulsettingstree > li').removeClass('active');
            $('#ulsettingstree > li').each(function () {
              if ($(this).text().trim() == "Images")
                $(this).addClass('active');
            });
            drawBreadCrumb1();
          }


          function appendLoader(){
            removeLoader();
            $("form[id*='myForm']").find("div.pull-right > button").attr('disabled','disabled').parent().prepend('<label id="masterssavespinner" class="" style="float:left;"><img  style="margin-left:5px;margin-right:25px;margin-top:8px;" src="img/select2-spinner.gif" /></label>');
          }
          function removeLoader(){
            $('#masterssavespinner').remove();
            $("form[id*='myForm']").find("div.pull-right > button").removeAttr('disabled');
          }

          function getProviderList(){
            $.ajax({
             type: "GET",
             url: "/aws/providers",
             success: function (data) {
              data= typeof data =="string" ? JSON.parse(data) :data;
              console.log(data);
              var str=' <option value="">Select Provider</option>',len=data.length;
              for(var i=0;i<len;i++){
                str=str+'<option value="'+data[i]._id+'" secretKey="'+data[i].secretKey+'" accessKey="'+data[i].accessKey+'" providerType="'+data[i].providerType+'">'+data[i].providerName+'</option>';
              }
              //Reading providers from openstack

                
              $.ajax({
               type: "GET",
               url: "/openstack/providers",
               success: function (data) {
                data= typeof data =="string" ? JSON.parse(data) :data;
                console.log(data);
                len = data.length;
                for(var i=0;i<len;i++){
                  str+='<option value="'+data[i]._id+'" username="'+data[i].userName+'" password="'+data[i].password+'" providerType="'+data[i].providerType+'">'+data[i].providerName+'</option>';
                }
                //Reading providers from openstack
                



                $('#providerId').html(str);
                if($('#providerId').attr('answer')){
                  $('#providerId').val($('#providerId').attr('answer')).select2();
                }
                  /*.off('change').on('change',function(){
                    debugger;
                    
                    var val=$(this).val(),region=
                    $(this).find('[value="'+val+'"]').attr('region');
                    $('#region').html('<option value="'+region+'">'+region+'</option>').val(region);
                  });*/

                },
                failure: function (data) {
                 alert(data.toString());
               }
              }); 
        


              $('#providerId').html(str);
              if($('#providerId').attr('answer')){
                $('#providerId').val($('#providerId').attr('answer')).select2();
              }
                /*.off('change').on('change',function(){
                  debugger;
                  
                  var val=$(this).val(),region=
                  $(this).find('[value="'+val+'"]').attr('region');
                  $('#region').html('<option value="'+region+'">'+region+'</option>').val(region);
                });*/

          },
          failure: function (data) {
           alert(data.toString());
         }
        }); 
  }
  function isUserTypeSuperAdmin(){
    $.get('/d4dMasters/loggedInUser',function(data){
      if(!data.isSuperAdmin){
      $('#orgId').attr('disabled','disabled').select2();
      }
    });
  }

  function saveImageForm(){
    appendLoader();
    var imageIdentifier=$('#imageidentifire').val().trim(),
    name=$('#name').val().trim(),
    osName=$('#osType').val().trim(),
    providerId=$('#providerId').val().trim()
    ,url
    ,osType=$('#osType').find('option:selected').attr('ostype'),
    userName=$('#UserName').val(),
    orgId = $('#orgId').val().trim();
    var pt = $('#providerId').find('option:selected').attr('providertype');
    //alert(orgId);

    if(imageIdentifier && providerId && osType && name && osName && userName && orgId){
      appendLoader();
      if(!UtilityMethods.getIdFromURL()){
        url="/vmimages";
      }else{
        url="/vmimages/"+UtilityMethods.getIdFromURL()+"/update"
      }

      //debugger;
      $.ajax({
        method:"POST",
        url:url,
        data:{ "providerId": providerId, "osType": osType, "name": name, "imageIdentifier":imageIdentifier,"osName":osName,"userName":userName,"orgId":orgId,"providertype":pt},
        success: function(data, success) {
          if (data!=500) {
            if ($('#btncancel').length){
              $('#btncancel').click(); 
            }                
            removeLoader();
          }
          else{
           removeLoader();
           alert(data.toString());
         }
       },
       error: function(jqxhr) {
        removeLoader();
        bootbox.alert(jqxhr.responseText);
      },
      failure: function(data) {
        bootbox.alert(data.responseText);
        removeLoader();
      }
    });

    }
  }

  function getOrganizationList(){
  $.get('/d4dMasters/readmasterjsonnew/1',function(data){
    var str=' <option value="">Select Organization</option>',len=data.length;
    for(var i=0;i<data.length;i++){
        str=str+'<option value="'+data[i]._id+'">'+data[i].orgname+'</option>';
    }
    $('#orgId').html(str);
    if( $('#orgId').attr('answer')){
      $('#orgId').val($('#orgId').attr('answer')).select2();
    }else{
    $('#orgId').val("").select2();
    }
  });
}

  function populateOSList(){
    $.ajax({
     type: "GET",
     url: "/vmimages/os/type/all/list",
     success: function (data) {
      data= typeof data =="string" ? JSON.parse(data) :data;
      console.log(data);


      var str=' <option value="">Select OS Type</option>',len=data.length;


      for(var i=0;i<len;i++){

       str=str+'<option value="'+data[i]["os_name"]+'" ostype="'+data[i]["osType"]+'">'+data[i]["os_name"]+'</option>';

     }
     $('#osType').html(str).select2();
     
     if($('#osType').attr('answer')){
      $('#osType').val($('#osType').attr('answer')).select2();
    }

  },
  failure: function (data) {
   alert(data.toString());
 }
}); 
  }
  function populateVirtualizationType(){
    $.ajax({
     type: "GET",
     url: "/vmimages/instancesizes/all/list",
     success: function (data) {
      data= typeof data =="string" ? JSON.parse(data) :data;
      console.log(data);


      var str=' <option value="">Select Virtualization Type</option>',len=data.length;


      for(var i=0;i<len;i++){
        for(var key in data[i]){
         str=str+'<option value="'+key+'" list="'+(data[i][key]).join(',')+'">'+key+'</option>';
       }       
     }
     $('#vType').html(str).off('change').on('change',function(){            
      var val=$(this).val(),str='<option value="">Select Instance Size</option>',region=
      ($(this).find('[value="'+val+'"]').attr('list')).split(',');
      for(var i=0;i<region.length;i++){
        str=str+'<option value="'+region[i]+'">'+region[i]+'</option>'
      }

      $('#instancesize').html(str).select2();
    }).select2();

   },
   failure: function (data) {
     alert(data.toString());
   }
 }); 

  }


  var UtilityMethods={
    initTooltip:function(){
     var $tool=$("[rel=tooltip]");
     if ($tool.length) {
      $tool.tooltip();
    }
  },
  getRandomNumber:function(){      
    return parseInt(Math.random()*10000000000);
  },
  getIdFromURL:function(){
    var options=location.toString().split('?');
    return options.length >1 ? (options[1]!=="new" ? options[1]:"" ):"";
  },
  initializeSelect2:function(){
    $('select').select2();
  }
};

$(document).ready(function () {

//isUserTypeSuperAdmin();
  $("#name").focus();

           // $('#imageidentifire').blur(saveImageForm);

           $('#myForm22').submit(function() {
            // $(this).validate();
            if(isFormValid()){
              saveImageForm();
            }else{
                   // bootbox.alert('invalid form Data submitted'); // for demo
                  }
               return false; // for demo
             });

          // populateVirtualizationType();
          populateOSList();
          getProviderList();
          getOrganizationList();
          $('select').select2();

          if(UtilityMethods.getIdFromURL()){
           $.get('/vmimages/'+UtilityMethods.getIdFromURL(),function(data){

            $('#imageidentifire').val(data.imageIdentifier).attr('answer',data.imageidentifire);
            $('#name').val(data.name).attr('answer',data.imageidentifire);
            $('#osType').attr('answer',data.osName).val(data.osName).select2();
            $('#providerId').attr('answer',data.providerId).val(data.providerId).select2();
            $('#UserName').val(data.userName).attr('answer',data.userName);
            $('#orgId').val(data.orgId[0]).attr({'answer': data.orgId[0]}).select2();

          });
         }

       });

    inLineReady();

  </script>