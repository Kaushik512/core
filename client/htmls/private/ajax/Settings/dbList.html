<div class="row">

  <div class="col-md-12">
   <div class="col-md-12">
      <form action="" id="myForm">
         <div class="widget-box">
            <div class="widget-header">
               <h4 class="widget-margin" style="color:black;">Data-Bags</h4>
            </div>
            <div class="widget-body">
               <div class="widget-main" style="min-height:200px">
                  <section id="widget-grid" class="">
                     <!-- START ROW -->
                     <div class="row">
                        <!-- Widget ID (each widget will need unique ID)-->
                        <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                           <!-- widget div-->
                           <div>
                              <!-- widget content -->
                              <div class="widget-body no-padding">
                                 <div class="col-lg-12 col-md-12">
                                  <!--table-->

                                  <div class="widget-body">
                    <div class="widget-main" style="min-height:300px">
                        <div class="col-md-4 table-responsive" style="padding-left:0px; padding-right:0px;">
                         <table id="dbNameTable" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center">
                             <a href="#modalForDB" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;" class="addDB" rel="tooltip" data-placement="top" /></a>
                                <thead>
                                    <tr class="rowCustomStyle">
                                        <td>List of Data-Bags</td>
                                    </tr>
                                </thead>
                                <tbody id="dbNameTableTest">
                                      <tr><td class="dataAv" colspan=2>No Data Available</td></tr>
                                       
                                </tbody>
                                    
                            </table>
                        </div>
                        
                   
                    
                   
                    
                


                                  <!--table ends here-->
                                    
                                 
                                 

                        <div class="col-md-4 table-responsive tableHidden" style="padding-left:10px; padding-right:0px;display:none;">
                         <table id="listNameTable" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center">
                             <a href="#modalForItems" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;" class="addList" rel="tooltip" data-placement="top" /></a>
                                <thead>
                                    <tr class="rowCustomStyle">
                                        <td>List of Items</td>
                                    </tr>
                                </thead>
                                <tbody>
                                      <tr><td class="dataAvList" colspan=2>No Data Available</td></tr>
                                       
                                </tbody>
                                    
                            </table>
                        </div>

                         </div>
                                 
                                 </div>   
                                 
                                 
                                 
                              </div>
                              <!-- end widget content -->
                           </div>
                           <!-- end widget div -->
                        </div>
                        <!-- end widget -->
                     </div>
                     <!-- END ROW -->
                  </section>
                  <!-- end widget grid -->
               </div>
            </div>
            <!-- <div class="widget-toolbox clearfix">
               <div class="btn-group pull-right">
                  <button class="btn btn-primary btn-mini" style="margin-right:11px;">
                  <i class="ace-icon fa fa-check bigger-110"></i>
                  Save
                  </button>
                  <a class="btn btn-primary btn-mini" onclick="window.history.back();" id="btncancel">
                  <i class="ace-icon fa fa-undo bigger-110"></i>
                  Cancel
                  </a>
               </div>
            </div> -->
         </div>
      </form>
   </div>
 </div>
</div>

<!--modal for DBList-->
<div class="modal fade" id="modalForDB" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " style="">
        <div class="modal-content"> 
            <form role="form" id="instanceDBName">
             <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">
                    &nbsp;Create Data-Bags
                </h4>

            </div> 
            
            
             <div class="modal-body" style="height:78px;">
                <div class="col-lg-6 col-md-6">

                            <label for="">Name<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <input type="text" name="dbName" class="form-control dbName" id="instanceDataName" autofocus/>
                </div>
                
                    <input type="hidden" id="serverIDHiddenInput">
                

            </div>
            
               <div class="modal-footer">
        <input type="submit" id="saveBTN" class="btn btn-primary" value="Save" />
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>   
  </form>
         </div>
    </div>
</div>
<!--modal for DBlist-->

<!--modal for ItemList-->
<div class="modal fade" id="modalForItems" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " style="">
        <div class="modal-content"> 
            <form role="form" id="instanceItemName">
             <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">
                    &nbsp;Create Items
                </h4>

            </div> 
            
            
             <div class="modal-body" style="height:78px;">
                <div class="col-lg-6 col-md-6">

                            <label for="">Name<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <input type="text" name="listName" class="form-control listName" id="instanceListName" autofocus/>
                </div>
                
                    <input type="hidden" id="dataBagIDHiddenInput">
                

            </div>
            
               <div class="modal-footer">
        <input type="submit" id="saveBTN" class="btn btn-primary" value="Save" />
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>   
  </form>
         </div>
    </div>
</div>
<!--modal for Itemlist-->

<script>
var urlParams = {};
(window.onpopstate = function() {
    var url = window.location.href;
    var indexOfQues = url.lastIndexOf("?");
    if (indexOfQues != -1) {
        var sub = url.substring(indexOfQues + 1);
        console.log(sub);
        var params = sub.split('&')
        for (var i = 0; i < params.length; i++) {
            var paramParts = params[i].split('=');
            urlParams[paramParts[0]] = paramParts[1];
        }
    }

})();
$('.addDB').click(function(e) {
    $('#instanceDBName').trigger('reset');
});

$('.addList').click(function(e){
    $('#instanceItemName').trigger('reset');
    //$('#dbNameTable tbody tr.dbTest')('#dataBagIDHiddenInput').val()
});

$(document).ready(function(){

    var chefServer = '../chef/servers/' + urlParams.id + '/databag/list';

    $.get(chefServer, function(data) {
        $.each(data, function(k) {
            var $dbNameList = $('#dbNameTableTest');
            //alert(JSON.stringify(data));
            var dbNameIds = {};
            if (k.dbNameIds && k.dbNameIds.length) {
                dbNameIds = k.dbNameIds;
            }

            var name = k;
            var $tr = $('<tr class="dbTest"></tr>');
            if (k) {
                $('td.dataAv').addClass('hidden');
            }
            var $tdName = $('<td class="dBNameCheck"></td>');
            var $tdClick = $('<a id="dbNameClick" style="cursor:pointer;">' + name + '</a>');
            $tdName.append($tdClick);
            $tdName.append('<div class="btn-group del" style="float:right;"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteRow" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
            $tr.append($tdName);
            //alert(k);
            $dbNameList.append($tr);

            $tdClick.click(function(e) {
                alert('hello');
                $('.tableHidden').css('display', 'block');
                alert(JSON.stringify(k));
                $('#dataBagIDHiddenInput').val(k);
            });


        });

    });

$('#instanceDBName').submit(function(e) {
    var reqBodyName = {};
    var $row = $('<tr class="dbTest"/>');
    var $form = $('#instanceDBName');
    reqBodyName.name = $form.find('.dbName').val();
    //var serverId = $form.find('#serverIDHiddenInput').val();
    if (!(reqBodyName.name)) {
        alert("Please Enter Name");
        return false;
    }
    $.post('../chef/servers/' + urlParams.id + '/databag/create', reqBodyName, function(data) {
      $row.find('td').append('<a id="dbNameClick" href="javascript:void(0);" style="cursor:pointer;" onclick="myFunctionClick()">' + reqBodyName.name + '</a>').append('<div class="btn-group del" style="float:right;"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteRow" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
        console.log(reqBodyName.name);
        $('#dbNameTable').find('tbody tr td.dataAv').addClass('hidden');
        
        $('#dbNameTable').find('tbody').append($row);
        $('#modalForDB').modal('hide');
        /*$tdName.find('.deleteRow').click(function() {
            $row.remove();
            var emptyTr = $('#dbNameTable').find('tbody > tr');
            if (emptyTr.length === 1) {

                $('#dbNameTable').find('tbody tr td.dataAv').removeClass('hidden');
            }
        });*/
    });
    return false;
});


//for list items

$('#instanceItemName').submit(function(e) {
    var reqBodyName = {};
    var $row = $('<tr class="listTest"/>');
    var $form = $('#instanceItemName');
    reqBodyName.name = $form.find('.listName').val();
    var dataBagName = $form.find('#dataBagIDHiddenInput').val();
    if (!(reqBodyName.name)) {
        alert("Please Enter Name");
        return false;
    }
    $.post('../chef/servers/' + urlParams.id + '/databag/' + dataBagName + '/item/create', reqBodyName, function(data) {

      $tdName = $('<td/>')
      $tdName.append('<a id="listNameClick" href="javascript:void(0);" style="cursor:pointer;" onclick="myFunctionListClick()">' + reqBodyName.name + '</a>').append('<div class="btn-group del" style="float:right;"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteRow" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
        console.log(reqBodyName.name);
        $row.append($tdName);
        $('#dbNameTable').find('tbody tr td.dataAvList').addClass('hidden');
        
        $('#dbNameTable').find('tbody').append($row);
        $('#modalForDB').modal('hide');
    });
    return false;
});

});






</script>


