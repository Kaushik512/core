<div class="row">
    <div class="col-md-12">
        <div class="col-md-12">

            <div class="widget-box">
                <div class="widget-header">
                    <h5 class="widget-title" style="color:#4e5964;">
                        <strong>List of Dashboard</strong>
                    </h5>
                    <div class="widget-toolbar no-border">
                        <div>

                          <a class="btn btn-minier btn-primary" id="refreshpage" href="#ajax/Settings/ProjectList.html" style="display:none">
                            <i class="ace-icon ace-icon fa fa-refresh bigger-110"></i>
                        </a>                                                               
                    </div>
                </div>

            </div>
            <div class="widget-body">
                <div class="widget-main" style="min-height:300px">
                    <div class="col-md-12 table-responsive" style="padding-left:0px; padding-right:0px;">
                         
                          
                         <table id="trackTable" class="tableData table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center;">
                             
                                <thead>
                                    <tr class="rowCustomStyle">
                                        <td>Name</td>
                                        <td>Dashboard URL</td>
                                        <td>Action</td>
                                    </tr>
                                </thead>
                                <tbody id="trackTableInput">
                
                                </tbody>
                                    
                            </table>
                          
                        
                    </div>
                </div> <!--widget main ends here-->
              </div> <!--widget body ends here-->
            </div> <!--widget box ends here-->  
        </div>
    </div>
</div>          

<!--modal for ItemList-->
<div class="modal fade" id="modalForTrackEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " style="">
        <div class="modal-content"> 
            <form role="form" id="trackItemUrl">
             <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">
                </h4>

            </div> 
            
            
             <div class="modal-body" style="height:150px;">            
                            <div class="col-lg-12 col-md-12">
                            <label for="">URL:</label>
                            
                            <textarea rows="5" cols="60" name="trackUrlName" class="trackUrlName" id="trackUrlName"></textarea>
                </div>
                     <input type="hidden" id="trackEditHiddenInput">
                     <input type="hidden" id="trackUrlHiddenName">
                

            </div>
            
               <div class="modal-footer">
                <label id="saveItemSpinner" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <input type="submit" id="saveBtnTrack" class="btn btn-primary" value="Save" />
      </div>   
  </form>
         </div>
    </div>
</div>
<!--modal for Itemlist-->   


<script>
if (!$.fn.dataTable.isDataTable('#trackTable')) {
    //var $taskListArea = $('.taskListArea').empty();
    var $trackDatatable = $('#trackTable').DataTable({
        "pagingType": "full_numbers",
        "bInfo": false,
        "bLengthChange": false,
        "paging": false,
        "bFilter": false,
        "aoColumns": [{
            "bSortable": false
        }, {
            "bSortable": false
        }, {
            "bSortable": false
        }]

    });
}
$(document).ready(function(e){

    getGlobalTrack();
    
});

function createTableForTrack(name,url,key) {
        var $trackNameList = $('#trackTableInput');
        var $tr = $('<tr class="trackItemRow"></tr>');
        var $tdName = $('<td class="trackName">'+name+'</td>');
        var $tdURL = $('<td class="trackDashboardURL">'+url+'</td>');
        var $tdAction = $('<td/>');
        $tdAction.append('<div class="btn btn-xs btn-info pull-left" style="float:right;"><button class="editRow" value="Update" title="Update"><i class="ace-icon fa fa-pencil bigger-120"></i></button></div>');
        $tr.append($tdName).append($tdURL).append($tdAction);
        $trackNameList.append($tr);
        $trackDatatable.row.add($tr).draw();

        //for edit
        $tdAction.find('button.editRow').click(function() {
            
            var $this = $(this);
            var $trNew = $this.parents('tr.trackItemRow');
            var $editModal = $('#modalForTrackEdit');
            $('textarea#trackUrlName').val('');
            $editModal.modal('show');
           // alert(name);
            $editModal.find('h4.modal-title').html('Edit URL for &nbsp;-' + name);
            alert(key);
            $editModal.find('textarea#trackUrlName').val(url);
            $editModal.find('#trackEditHiddenInput').val();
            $editModal.find('#trackUrlHiddenName').val(key);
            return false;
        });
    };

    function getGlobalTrack() {
        var globalSettings = '../globalSettings';
        $.get(globalSettings, function(data) {

            if (data.length) {
                $('#trackEditHiddenInput').val(data[0]._id);
                var keys = Object.keys(data[0]);
                for (var i = 0; i < keys.length; i++) {
                    console.log(JSON.stringify(keys[i]));
                    
                    if (keys[i].indexOf('kibana') !== -1) {
                        createTableForTrack('Kibana', data[0][keys[i]], keys[i]);
                    } else if (keys[i].indexOf('zabbix') !== -1) {
                        createTableForTrack('Zabbix', data[0][keys[i]], keys[i]);
                        
                    } else if (keys[i].indexOf('awsUsage') !== -1) {
                        createTableForTrack('AWS Usage', data[0][keys[i]], keys[i]);
                        
                    } else if (keys[i].indexOf('awsCost') !== -1) {
                        createTableForTrack('AWS Cost', data[0][keys[i]], keys[i]);
                        
                    } else if (keys[i].indexOf('awsNotification') !== -1) {
                        createTableForTrack('AWS Notification', data[0][keys[i]], keys[i]);
                        
                    }
                }
            }
        });
    }

    $('#trackItemUrl').submit(function(e){
        var $form = $('#trackItemUrl');
        var trackEdit = $(this).find('#trackEditHiddenInput').val();
        var keyUrl = $(this).find('#trackUrlHiddenName').val();
        var trackUrl = $(this).find('textarea#trackUrlName').val();
        //alert(keyUrl);
        var reqBody ={};
         /*   keyUrl:trackUrl
        };*/
        reqBody[keyUrl]=trackUrl;
        alert(JSON.stringify(reqBody));
         $.ajax({

            method: "POST",
            url: '../globalsettings/'+ trackEdit+ '/update',
            data: {aGlobalSettings:reqBody},
            success: function(data, success) {
               // alert(data);
                $('#modalForTrackEdit').modal('hide');
              //  $('#saveItemSpinner').addClass('hidden');
                //$('#saveBTNList').removeAttr('disabled');
               // alert(itemsEditNew);

               
                 //   alert(itemID);
                    createTableForTrack(trackEdit);
                   // $('#saveBTNList').removeAttr('disabled');
               
            },
            error: function(jxhr) {
              console.log(jxhr);
                var msg = "Server Behaved Unexpectedly";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);

                $('#saveItemSpinner').addClass('hidden');
                $('#saveBTNList').removeAttr('disabled');
            },
            failure: function(jxhr) {
              console.log(jxhr);
                var msg = "Server Behaved Unexpectedly";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if(jxhr.responseText) {
                  msg = jxhr.responseText;
                }
                bootbox.alert(msg);

                $('#saveItemSpinner').addClass('hidden');
                $('#saveBTNList').removeAttr('disabled');
            }
        });
        return false;
    });

</script>
                             