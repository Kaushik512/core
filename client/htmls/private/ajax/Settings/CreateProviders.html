<script>
  // $(".tree-view").hide();

</script>
<style type="text/css">
 #createProvider .marginbottom{
  margin-bottom: 10px;
}
#createProvider .width-60{
  width:60%;
}
#createProvider .width-20{
  width:20%;
}
</style>
<div class="row" id="createProvider">
 <div class="col-md-12">
  <div class="col-md-12">
   <form action="" id="myForm54">
    <div class="widget-box">
     <div class="widget-header">
      <h4 class="widget-margin" style="color:black;">Add New Provider<span id="spnprovider"></span></h4>
    </div>
    <div class="widget-body">
      <div class="widget-main" style="min-height:300px">
       <div>
        <section id="widget-grid" class="">
         <!-- START ROW -->
         <div class="row">
          <!-- NEW COL START -->
          <article class="col-sm-12 col-md-12 col-lg-12">
           <!-- Widget ID (each widget will need unique ID)-->
           <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
            <!-- widget div-->
            <div>
             <!-- widget content -->
             <div class="row">                                                        
              <div class="col-lg-6">
               <label for="">Name:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
               <!-- <i class="icon-append fa fa-building"></i> -->
               <input name="ctl00$MainContent$orgname" value="Default" id="providername" class="form-control" type="text"  cdata="catalyst" cat-validation="required,max15">
             </div>                                                         


             <div class="col-lg-6">
              <label for="name">Provider Type:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
              <select id="providertype" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" sourcepath="1" datapath="masterjson.rows.row" valuelinkfield="costcode" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
               <option value="">Select Provider</option>
               <option value="us-west-2">AWS</option>
             </select>
             <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
           </div>   

         </div>

         <div class="row">
           <div class="col-lg-6">
            <label for="name">Region:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
            <select id="region" unique="true" uniqueconditionedby="orgname"  class="chooseOrganization width-100" sourcepath="1" datapath="masterjson.rows.row" valuelinkfield="costcode" style="vertical-align:central"  cdata="catalyst"  cat-validation="required">
             <option value="">Select Region</option>
             <option value="us-west-2">us-west-2</option>
           </select>
           <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
         </div>

         <div class="col-lg-6 smart-form">
           <div class="border-color" style="height: 124px;margin-bottom: 10px;">
             <label type="text" style="  height: 24px;width: 100%;
             background: white;
             text-align: center;line-height:2;" class="searchoptionforCookbooks form-control padding0">Security Group <span style="color:Red;" class="control-label">&nbsp;*</span></label>
             <ul id="securitygroup" class="deploymentsCookbookList deploymentsListCSS" style="height:98px;">

             </ul>
           </div>
         </div>
         <div class="col-lg-6 smart-form" id="instancesize">
           <div class="border-color" style="height: 124px;margin-bottom: 10px;">
             <label type="text" style="  height: 24px;width: 100%;
             background: white;
             text-align: center;
             line-height:2;" disabled class="searchoptionforCookbooks form-control padding0">Provider Type <span style="color:Red;" class="control-label">&nbsp;*</span></label>
             <ul class="deploymentsCookbookList deploymentsListCSS" style="height:98px;">
               <li>
                 <label class="checkbox" style="margin: 5px;">
                   <input type="checkbox" name="checkboxinstancesize" value="t1.micro" data-cookbookname="sysctl">
                   <i></i>t1.micro</label>
                 </li>

                 <li>
                   <label class="checkbox" style="margin: 5px;">
                     <input type="checkbox" name="checkboxinstancesize" value="m1.small" data-cookbookname="sysctl">
                     <i></i>m1.small</label>
                   </li>

                   <li>
                     <label class="checkbox" style="margin: 5px;">
                       <input type="checkbox" name="checkboxinstancesize" value="m1.medium" data-cookbookname="sysctl">
                       <i></i>m1.medium</label>
                     </li>

                     <li>
                       <label class="checkbox" style="margin: 5px;">
                         <input type="checkbox" name="checkboxinstancesize" value="m1.large" data-cookbookname="sysctl">
                         <i></i>m1.large</label>
                       </li>

                       <li>
                         <label class="checkbox" style="margin: 5px;">
                           <input type="checkbox" name="checkboxinstancesize" value="m1.xlarge" data-cookbookname="sysctl">
                           <i></i>m1.xlarge</label>
                         </li>
                       </ul>
                     </div>
                   </div>
                   <div class="col-lg-6">
                     <label for="">Access Key:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                     <!-- <i class="icon-append fa fa-building"></i> -->
                     <input name="ctl00$MainContent$orgname" value="Default" id="accesskey" class="form-control" type="text"  cdata="catalyst" cat-validation="required">

                     <span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                   </div>
                   <div class="col-lg-6">
                     <label for="">Secret Key:<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                     <!-- <i class="icon-append fa fa-building"></i> -->
                     <input name="ctl00$MainContent$orgname" value="Default" id="secretkey" class="form-control" type="text"  cdata="catalyst" cat-validation="required">

                     <span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                   </div>

                 </div>
               </div>
               <!-- end widget div -->
             </div>
             <!-- end widget -->             
           </article>
           <!-- END COL -->
         </div>
         <!-- END ROW -->
       </section>
       <!-- end widget grid -->
     </div>
   </div>
 </div>
 <div class="widget-toolbox clearfix">
  <div class="btn-group pull-right">
   <button class="btn btn-primary btn-mini" style="margin-right:11px;">
     <i class="ace-icon fa fa-check bigger-110"></i>
     Save
   </button>
   <a class="btn btn-primary btn-mini" onclick="window.history.back();" id="btncancel">
     <i class="ace-icon fa fa-undo bigger-110"></i>
     Cancel
   </a>
 </div>
</div>
</div>
</form>
</div>
</div>
</div>
<!--row ends here-->
<!--Popup for selecting a cloud provider before proceeding-->
<script>
   //Form Name
   function cancelClicked() {
     $("#popupSelectProvider").modal('hide');
     $(".modal-backdrop.fade.in").detach();
     $('#btncancel').click();
   }
   function setfolderpath(){ //Uncomment below line to set the folder path to uploaded files.
       var folderpath = ''; //'/' + $('#dockerreponame').val() + "/dockerfiles/";
    //   alert(folderpath);
    $('#folderpath').val(folderpath);
  }
  function validateandsaveform(){

   if(validateForm()) {
     setfolderpath(); 
     saveform('23');
   }

 }

 function loadSecurityGroupID(){
   $.ajax({
    method: "POST",
    url: "/providers/securitygroups",
    data:{ "accesskey": "AKIAI6TVFFD23LMBJUPA", "secretkey": "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", "region": "us-west-2" }
  }).done(function( msg ) {
    var str='',getTemplate=function(val){
     return '<li>'
     + '<label class="checkbox" style="margin: 5px;">'
     +'<input type="checkbox" name="securitygroup" value="'+val+'">'
     +'<i></i>'+val+'</label></li>';
   },len=msg.length;
   for(var i=0;i<len;i++){
    str=str+getTemplate(msg[i].GroupId);
  }
  $('#securitygroup').append(str);
});

}

loadSecurityGroupID();
function inLineReady() {
 $("input[type='text']").on("click", function () {
   $(this).select();
   $("#msgOrgName").hide();
 });
 $("#popupSelectProvider").modal({ keyboard: false, backdrop: "static" });
 var ten = 9;
       readformnew('9'); //9 is for Provider
       //

       $('#content').css("opacity", "1 !important");
       //Force opening the left navigation menu
       if ($('#navSettings').is(":visible") == false) {
         $('#navSettings').css("display", '');
         $('#navSettings > ul > li').first().addClass('open');
         $('#navSettings > ul > li > ul').css("display", "none");
         $('#navSettings > ul > li > ul').first().css("display", "block");
       }
       //redrawing the breadcrumb and selecting the tree
       $('#Settings  li').removeClass('active');
       $('#Settings  li').each(function () {

         if ($(this).text().trim() == "Docker"){

           $(this).addClass('active');
         }
       });

       $('#content').css('opacity','1 !important');
      // drawBreadCrumb1();
      enableUniqueCheckingForInputs(9);


    }

    inLineReady();

  </script>
  <script>
   $(document).ready(function () {
    $('#providertype').select2();
    $('#region').select2();
    $("#providername").focus();
    $('#myForm54').submit(function() {
      $(this).validate();
      if(isFormValid() && $('[name="checkboxinstancesize"]').is(":checked") && $('[name="securitygroup"]').is(":checked")){
        /*alert('valid form submitted'); // for demo*/
               //validateandsaveform();
               providerTest();
             }
             else{
              alert("invalid form data");
            }
            /* }else{
                alert('invalid valid form submitted'); // for demo
              }*/
           return false; // for demo
         });
  });

   function providerTest(){
     var inputData = new Object();
     var securityList=[],
     instancesizes=[];
     $('[name="checkboxinstancesize"]').each(function(){
      $(this).is(":checked") && instancesizes.push($(this).val().trim());
    });

     $('[name="securitygroup"]').each(function(){
      $(this).is(":checked") && securityList.push($(this).val().trim());
    });
     inputData.accesskey = $('#accesskey').val().trim();
     inputData.secretkey = $('#secretkey').val().trim();
     inputData.region = $('#region').val().trim();
     inputData.providername=$("#providername").val().trim();
     inputData.providertype=$("#providertype").val().trim();
     inputData.securitygroupids=securityList;
     inputData.type=instancesizes;

     $.ajax({
       url: '/providers/securitygroups',
       type: 'POST',
       dataType: 'json',
       data: inputData,
       async:false,
       success: function (data) {
                         //alert("Success...");
                         if(validateForm())
                          saveform(9);
                      },
                      error: function (err) {
                       bootbox.alert("Invalid UserName or Password.");
                     }
                   });

   }

 </script>