<div class="row">

    <article class="col-sm-12 col-md-12 col-lg-12" id="controlPanelContainer" style="display:none">

            <div class="widget-body" style="font-size:14px;">
                <div class="">

                    <ul class="thumbnails list-unstyled">


                        <!--Card for Planning starts here-->
                        <li class="domain-role-thumbnail" style="padding-top:58px;margin-left:17px;">
                          <div class="flip-toggle container">
                            <div class="card">
                              <div class="front">
                                <div class="domain-roles">
                                  <div class="domain-roles-caption">
                                    <div class="domain-roles-heading">
                                      
                                    </div>
                                    <hr>
                                    <div class="componentlistContainer">
                                      <div class="instance-bootstrap-list">
                                        <span style="overflow:hidden;text-overflow:ellipsis;width:62px;" class="instance-details-item">
                                          <a class="btn instance-bootstrap-list-faimage" href="javascript:void;" rel="tooltip" data-placement="top" data-original-title="View All Runlist"><i class="fa fa-2x fa-exchange txt-color-blue"></i>
                                          </a>
                                        </span>
                                      </div>
                                      <div class="forURL">
                                      
                                      </div>
                                    </div>
                                    <div>
                                      <div class="instance-details-list">
                                        <span class="instance-details-id instance-details-ip">IP : <strong></strong></span>
                                        <span class="instance-details-id">status : 
                                          <span class="instance-state instance-state-text-pending"></span>
                                        </span>
                                      </div>
                                    </div>
                                    <hr>
                                    <div style="width:152px !important;height:30px;margin-left:4px;" class="instanceActionBtnCtr">
                                      <div class="instance-bootstrap-ActionChefRun cpTop">

                                        <!-- <a class="instanceActionBtnUpdateRunlist instance-bootstrap-list-image" rel="tooltip" data-placement="top" data-original-title="Chef Client Run"><img src="img/galleryIcons/Chefimport.png" alt="Chefimport" style="width:26px;height:auto;margin-top:1px;"></a> -->
                                        <a class="instanceActionBtnUpdateRunlist instance-bootstrap-list-image chefClientRunlistImageCP" rel="tooltip" data-placement="top" data-original-title="Chef Client Run"></a>
                                      
                                      </div>
                                      <div class="actionbutton instance-bootstrap-ActionStart" style="display:none;"><a href="javascript:void(0)" class="actionbuttonStart instanceActionBtn" data-actiontype="Start" data-placement="top" rel="tooltip" data-original-title="Start"></a></div>
                                        
                                      
                                      <div class="actionbutton instance-bootstrap-ActionShutdown"style="display:none;"><a href="javascript:void(0)" class="actionbuttonShutdown instanceActionBtn" data-actiontype="stop" rel="tooltip" data-placement="top" data-original-title="Stop"></a></div>

                                      <div class="sshContainer actionbutton instance-bootstrap-ActionSSH">
                                        <a href="javascript:void(0)" class='sshShellBtn cpTop' data-actiontype="SSH" data-placement="top" rel="tooltip" data-original-title="SSH">
                                          <!-- <img src="img/galleryIcons/sshIcon.png" style="height:28px;width:28px"> -->
                                        </a>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="back card-backflip">                            
                                  <span class="card-backflip-margin">
                                    <a style="color:#333;">
                                      <i class="fa fa-lg fa-fw fa-book txt-color-blue"></i>
                                      <span style="font-size:12px;font-family:Open sans;padding-left:5px;color:#333" class="menu-item-parent">Runlists</span>
                                    </a>
                                  </span>
                                  <hr>
                                  <div class="cardBackRunlistContaner">
                                    <!-- <span class="instance-details-item" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;
                                    width:130px;color:#3a87ad"></span> -->
                                    <!-- append(data.runlist[j]) -->
                                  </div>
                                <hr>
                                <span style="width:160px;text-align:center;display:block;margin-top:8px" class="goback">
                                  <a style="color:#333;cursor:pointer">Go Back</a>
                                </span>
                              </div>
                            </div>
                          </div>
                      </li>
                      <!--Card for Planning ends here-->

                  </ul>

                </div>

<!--<div style="height:200px;border:1px solid blue;margin-left:200px;width:0px"></div>-->

    <ul id="myTab3" class="nav nav-tabs pull-left" style="padding: 10px 0 0 40px;border-bottom: medium none; position: auto; width: 80%; background-color: #2c3742;border-radius:11px 11px 0px 0px;">

        <li class="active" style="margin-right: 30px;">
              <a style="color: #eee;border-radius: 5px 5px 0 0 ; padding: 9px 10px 13px;" href="#l1" data-toggle="tab" style="font-size: 16px" ><i class="fa fa-fw fa-exclamation-circle" style="font-size: 16px"></i>Information</a>
          </li>
          <li class="pull-left" style="margin-right: 30px;">
              <a style="color: #eee;border-radius: 5px 5px 0 0 ; padding: 9px 10px 13px;" href="#l2" data-toggle="tab" style="font-size: 16px"><i class="fa fa-fw fa-share-square-o"></i>Services</a>
          </li>
          <li class="pull-left" style="margin-right: 30px;">
              <a style="color: #eee;border-radius: 5px 5px 0 0 ;padding: 9px 10px 13px;" href="#l3" data-toggle="tab" style="font-size: 14px"><i class="fa fa-fw fa-sun-o"></i>Action History</a>
          </li>
          <li class="pull-left" style="margin-right: 30px;">
              <a id="controlPanelLogTab" style="color: #eee;border-radius: 5px 5px 0 0 ; padding: 9px 10px 13px;" href="#l4" data-toggle="tab" style="font-size: 14px"> <i class="fa fa-fw fa-clock-o"></i>Logs</a>
          </li>
    </ul>
    <div id="myTabContent3" class="nav pull-left tab-content" style="position: auto; left: 0px; width: 80%;margin-top:4px;">

            <!-- info tab contents starts here -->
            <div class="tab-pane fade in active " id="l1" style="min-height:405px;overflow-y:auto;">

                 

                      <div class="panel-group smart-accordion-default">
                        <div class="panel panel-default" id="accordion-Hardware" style="border-radius:10px 10px 0px 0px;">
                            <div class="panel-heading">
                              
                              <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-Hardware" href="#collapseHardware" > 
                                  <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> 
                                  <i class="fa fa-fw fa-minus-circle txt-color-red"></i>
                                  <i class="fa fa-fw fa-wrench" style="font-size:14px;"></i>
                                  <b style="color:#3a87ad;font-size:12px;"><u>Hardware</u></b>
                                </a>
                             </h4>
                            </div>
                            <div id="collapseHardware" class="panel-collapse collapse in">
                              <div class="panel-body">
                                <table align="left">
                                       <thead>
                                           
                                       </thead>

                                       <tbody>
               

                                          </tbody>

                                      </table>

                              </div>
                             
                            </div>
                        </div>

                        <!--Role Attributes Starts here-->
                        <div class="panel panel-default" id="accordion-Software">
                          <div class="panel-heading">
                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-Software" href="#collapseSoftware" ><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i><i class="fa fa-fw fa-rss fa-dot-circle-o" style="font-size:14px;"></i> <b style="color:#3a87ad;font-size:12px;"><u>Software</u></b></a></h4>
                          </div>
                          <div id="collapseSoftware" class="panel-collapse collapse in">
                            <div class="panel-body">
                              <table align="left">
                              

                               <tbody > 
                                 
                                </tbody>
                              </table>

                            </div>

                          </div><!--collapseRoleAttr ends here-->
                        </div>
                        <!--Role Attributes ends here-->

                        <!--Configmgmt Attributes Starts here-->
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-configmgmt" href="#collapseConfigmgmt"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i><i class="fa fa-fw fa-bar-chart-o" style="font-size:14px;"></i> <b style="color:#3a87ad;font-size:12px;"><u>Configuration Management</u></b></a></h4>
                          </div>
                          <div id="collapseConfigmgmt" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <table align="left">
                                 
                                 <tbody > 
                                    
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                        <!--Configmgmt Attributes Ends here-->

                        <!--Application URL-->
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-configmgmt" href="#collapseAppURL"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i><i class="fa fa-fw fa-bar-chart-o" style="font-size:14px;"></i> <b style="color:#3a87ad;font-size:12px;"><u>Additional Parameters</u></b></a></h4>
                          </div>
                          <div id="collapseAppURL" class="panel-collapse collapse in">
                            <div class="panel-body">
                              <!--user has given no app name-->
                              <form action="" id="appUrlTemplateFormCreate" data-appURLType="1" class="appUrlFormNew hidden">
                                  <!--1st text box-->
                                            <div class="applicationURLContainer" id="appSeries12"> 
                                                <div class="col-lg-6 col-md-6" style="margin-top:15px;">

                                                <label for="">Application Name</label>

                                                <input placeholder="AppName" maxlength="8" type="text" name="appNameInput" class="form-control appName">
                                                <b class="tooltip tooltip-top-right">
                                                    <i class="fa fa-user txt-color-teal"></i> Please enter Application</b>


                                               </div>

                                               <div class="col-lg-6 col-md-6" style="margin-top:15px">

                                                <label for="">Application URL</label>
                                                
                                                <input type="url" name="appNameURL" class="form-control appURL" placeholder="http://$host[:port]/appname">
                                                <b class="tooltip tooltip-top-right">
                                                    <i class="fa fa-user txt-color-teal"></i> Please enter URL</b>
                                              </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary marginSubmit"> Submit </button>
                                            <a href="javascript:void(0)" class="clearfix pull-right addNewApp1 appDesignNew" data-backdrop="false" data-toggle="modal">Add Application URL</a>
                                </form>
                                <!--form ends here-->
                              <!--when app name is given during blueprint save or Import by IP-->
                                <form action="" id="appUrlTemplateForm" style="display:none" data-appURLType="1" class="appUrlForm">
                                  <!--1st text box-->
                                  <div class="col-lg-6 col-md-6 appTop">
                                    <input type="hidden" class="appUrlId" />
                                    <label class="appNameLabel" for=""></label><span class="hidden urlsaved" >&nbsp;&nbsp;Saved</span>
                                    <br>
                                      <input name="check" type="text" class="appUrlInput" type="url">

                                    <span name="editText" class="glyphicon glyphicon-pencil" style="cursor:pointer;"></span>
                                  </div>
                                </form>
                                

                              
                            </div>
                          </div>
                        </div>
                        <!--Application URL Ends here-->
                      </div>

            </div> <!-- info tab contents ends here-->

            <!-- tab of Actions starts here -->
            <div class="tab-pane" id="l2" style="height:415px;overflow-y: auto;border-radius:11px;">


                
                <div role="content">

                    <!-- widget content -->
                    <div class="table-responsive" style="border:1px solid #dddddd;min-height:400px;border-radius:11px">
                        <!-- class="table table-hover" -->
                        <table  id="tableServices" class="table table-striped table-bordered table-hover dataTable no-footer text-align-center table-condensed tablesorter" style="margin-top:72px;">
                            <thead>
                              <tr>
                                <th style="font-size: 13px;">
                                  <i class="fa fa-fw fa-archive "></i>
                                  <strong style="color:#3a87ad">Service Name</strong>
                                </th>
                                <th style="font-size: 13px;">
                                  <i class="fa fa-fw fa-sort-amount-asc "></i>
                                  <strong style="color:#3a87ad">Actions </strong>
                                </th>
                                <th style="font-size: 13px;">
                                  <i class="fa fa-fw fa-flash "></i>
                                  <strong style="color:#3a87ad">Options</strong>
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                                <tbody class="servicesTbody">
                                  
                                </tbody> 
                            </tbody>
                            <a class="btn btn-primary addServiceBtn" style="float:right;padding-right:10px;margin-right:10px;" data-toggle="modal" href="#serviceModalContainer">Add New Service</a>
                        </table>

                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div> <!-- Tab of Action ends here -->
            <div class="modal fade" id="serviceModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Add New Service</h4>
                  </div>
                  <div class="modal-body">
                    
                    <!--<select id="serviceList" class="col col-6" multiple></select>-->
                      <table  class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                       <thead>
                        <tr>
                          <th>Name</th>
                          <th>Actions</th>
                          <th>Select</th>
                        </tr>
                       </thead>
                       <tbody id="serviceList">
                            <tr><td colspan=3>No Data Available</td></tr>

                       </tbody>
                      </table>

                  </div>
                  
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-primary btnsaveDeploymentBP btnSaveService"><i class="ace-icon fa fa-check bigger-110"></i>&nbsp;Save</button>
                    <button type="button" class="btn btn-default btn-primary" data-dismiss="modal"><i class="ace-icon fa fa-undo bigger-110"></i>&nbsp;Cancel</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Configure tab contents starts here -->
            <div class="tab-pane" id="l3" style="height:415px;overflow-y: auto;">
              <div class="table-responsive" style="border:1px solid #dddddd;min-height:400px;border-radius:11px">

                        <table id="tableactionHistory" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                            <thead style="font-size: 13px">
                              <tr>
                              <td>
                                <!-- <i class="fa fa-fw fa-archive "></i> -->
                                <strong style="color:#3a87ad";>Type</strong>
                              </td>
                              <td>
    
                                <strong style="color:#3a87ad;">Status</strong>
                              </td>
                              <td>
    
                                <strong style="color:#3a87ad;">Data</strong>
                              </td>
                              <td>
                                
                                <strong style="color:#3a87ad;">Timestamp</strong>
                              </td>
                              <td>
                                
                                <strong style="color:#3a87ad;">Users</strong>
                              </td>
                              <td>
                                
                                <strong style="color:#3a87ad;">MoreInfo</strong>
                              </td> 
                            </tr>
                            </thead>
                            <tbody>
                             
                                
                            </tbody>
                        </table>
                    </div>

            </div> <!--Configure tab contents ends here -->

            <div class="tab-pane" id="l4" style="height:415px;overflow-y: auto;overflow-x:hidden;border:1px solid #ddd;border-radius:11px;">
              <div class="logsArea"></div>
            </div>
            <!-- History tab contents starts here -->
        


           <!--  <div class="row" > -->
              
            <!-- </div> -->

    </div> 

</div>
</article>
<!-- <div class="col-md-10 col-lg-10 col-xs-12 col-sm-12" style="bottom:0px;position:fixed;">
                <div class="clearfix form-actions" style="text-align:center">
                  <div class="btn-group">
                      <button class="btn pull-left btn-primary" id="getViewAttr" onclick="getInfoLi();">
                        Back to Instances
                      </button>
                  </div>
                </div>
</div> -->
<!--article ended-->
<div class="loadingControlPanelIndicator">
<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />
</div>

</div>


<div class="modal fade bs-example-modal-lg" id="controlPanelChefRunModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-pencil-square-o txt-color-blue"></i>Update Runlist</h4>
      </div>
      <div class="modal-body" style="padding:0px !important">
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-primary btnUpdateInstanceRunlist">Update</button>
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    Edit Data Bag Item
                </h4>
            </div>
            <div class="modal-body no-padding">

                <form action="" id="" class="">
                        <div action="" id="" class="smart-form" novalidate="novalidate">

                        <div class="row" style="margin:0px;">
                           <div style="height:200px; width:200px; padding-left:20px; padding-top:10px;" contenteditable="true">
                              <ul style="list-style:none outside none;font-size:12px;">
                                 <li> id: frank </li>
                                 <li> comment: Frank </li>
                                 <li> uid: 2000 </li>
                                 <li> gid: 0 </li>
                                 <li> home: /home/frank </li>
                                 <li> shell: /bin/bash </li>
                             </ul>
                           </div>
    
                        </div>


                    

                            <footer>
                                <button type="submit" class="btn btn-primary">
                                    Save
                                </button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                    Cancel
                                </button>

                            </footer>
                        </div>
                    
                </form>                     
                        

            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<br><br>
<footer class="footer">
  <div class="clearfix form-actions" style="text-align:center">
    <div class="btn-group">
      <button class="btn pull-left btn-primary" id="getViewAttr" onclick="getInfoLi();" style="margin-left:200px;">Back to Instances</button>
    </div>
  </div>
</footer>

<!-- Modal SSH Shell-->
<div class="modal fade" id="modalSSHShellContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog " style="">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">
          <i class="fa fa-terminal txt-color-blue"></i>Terminal
        </h4>
      </div>
      <div class="modal-body" style="height:430px">
            
      </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div> -->
    </div>
  </div>
</div>



<div class="modal fade" id="actionLogMoreInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog " style="">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="">
          <i class="fa fa-bar-chart-o txt-color-blue"></i>Instance Logs
        </h4>
      </div>
      <div class="modal-body instanceBody">

           
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>



<!-- div of Contant tab starts here -->

<style>
  #myTab3 .active a{
  color: #40baf1 !important;
}
#myTab3 li a:hover{
  color: #000000 !important;
}
</style>

<script type="text/javascript">
var urlParams ={};
(window.onpopstate = function () {
  var url = window.location.href;
  var indexOfQues = url.lastIndexOf("?");
  if(indexOfQues!=-1) {
  var sub =  url.substring(indexOfQues+1);
  console.log(sub);
  var params = sub.split('&')
  for(var i=0;i<params.length;i++) {
    var paramParts = params[i].split('=');
    urlParams[paramParts[0]] = paramParts[1];
  }
 }
     
})();


function disableSSHBtn(instanceId) {
  var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
  $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshIcon').addClass('sshIcondisable');
}



function enableInstanceActionStartBtn(instanceId){
  var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
  var osType = $cardViewInstanceId.attr('data-osType');
 
  $cardViewInstanceId.find('.instance-bootstrap-ActionChefRun a').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('chefClientRunlistImageCP');
  
  if (osType === 'linux') {
      $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshShellBtn');
  }
  
  $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').removeClass('isStopedInstance').removeClass('actionbuttonShutdowndisable').addClass('actionbuttonShutdown');
  $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
}
function enableInstanceActionStopBtn(instanceId){
  var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");

  $cardViewInstanceId.find('.instance-bootstrap-ActionChefRun a').addClass('isStopedInstance').removeClass('chefClientRunlistImageCP').addClass('actionbuttonChefClientRundisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshShellBtn').addClass('sshIcondisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').removeClass('isStopedInstance').removeClass('actionbuttonStartdisable').addClass('actionbuttonStart');
}
function disableInstanceActionBtns(instanceId){
  var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");

  $cardViewInstanceId.find('.instance-bootstrap-ActionChefRun a').addClass('isStopedInstance').removeClass('chefClientRunlistImageCP').addClass('actionbuttonChefClientRundisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshShellBtn').addClass('sshIcondisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
}
function disableInstanceStartStopActionBtns(instanceId){
  var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
  var osType = $cardViewInstanceId.attr('data-osType');
  
  $cardViewInstanceId.find('.instance-bootstrap-ActionChefRun a').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('chefClientRunlistImageCP');
  
  if(osType === 'linux') {
    $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshShellBtn');
  }
  
  $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
  $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
}

var logTimeout;
var stateTimeout;
$.get('../instances/'+urlParams.id,function(data){

   //setting tree and drawing breadcrumb
   //alert(data.projectId)
   var $selectedOrg = $('.orgsList').find('[data-org="'+urlParams.org+'"]');
   // alert($selectedOrg);

   var orgid = $selectedOrg.click().attr('data-id');
   //alert(orgid);
   if(orgid) {
    console.log('orgid ==>',orgid);
    // var $li = $('.'+orgid).find('li[data-envName="'+data.envId+'"]').addClass('active');
    // $li.parents('li').addClass('active open');
    // $li.parents('ul').css({'display':'block'});
    // drawBreadCrumb();
   } 
 
   console.log(data);
   

    //fetching services list
    //alert(data.chef.serverId);
    $.get('/d4dMasters/19/chefserverid/' + data.chef.serverId, function(services) {
        $.get('/d4dMasters/19/commandtype/Service%20Command', function(servicesCmd) {
            
            servicesCmd = JSON.parse(servicesCmd);
            services = JSON.parse(services);
            for(var k=0;k<servicesCmd.length;k++) {
              if(servicesCmd[k].chefserverid !==data.chef.serverId ) {
                services.push(servicesCmd[k]);
              }
            }
            //alert('Out json :' + JSON.stringify(services)+ services.length);
            var $serviceList = $('#serviceList');
            console.log(services, "length==>", services.length);
            var serviceIds = [];
            if (data.serviceIds && data.serviceIds.length) {
                serviceIds = data.serviceIds;
            }

            for (var i = 0; i < services.length; i++) {

                var name = services[i].servicename;
                if (!name) {
                    name = services[i].commandname;
                }
                var $tr = $('<tr></tr>').attr('data-listServiceId', services[i].rowid);
                var $tdName = $('<td></td>').append(name);
                $tr.append($tdName);

                var commandType = services[i].commandtype;
                if (commandType === 'Chef Cookbook/Recepie') {
                    var html = getCookbookActionHtml(services[i].rowid, services[i]);
                } else {
                    var html = getCommandActionHtml(services[i].rowid, services[i]);
                }

                var $tdActions = $('<td></td>').append(html);
                $tr.append($tdActions);
                var $checkBox = $('<input type="checkbox" name="svcCkb"></input>').val(services[i].rowid).data('serviceData', services[i]);
                var $tdCheckBox = $('<td></td>').append($checkBox);
                $tr.append($tdCheckBox);
                if (serviceIds.indexOf(services[i].rowid) !== -1) {
                    $tr.addClass('hidden');
                }

                $serviceList.append($tr);
            }
        })
        //console.log('hi ==>',serviceList);



    });
    if (data.serviceIds && data.serviceIds.length) {
        $.post('/d4dMasters/getrows/19', {
            serviceids: data.serviceIds
        }, function(services) {
            services = JSON.parse(services);
            for (var i = 0; i < services.length; i++) {
                console.log("sd1 = ", services[i]);
                addServiceToDom(services[i]);
            }
        });
    }

    // setting up action logs
    $.get('/instances/'+urlParams.id+'/actionLogs',function(actionLogs){
      addActionLogsToTable(actionLogs);
    });
    
    var getOS=function(data){
                        var basePath='img/osIcons/',imgPath,title='';
                        console.log(data.hardware.os+' :: OS ::'+data.hardware.platform.toLowerCase())
                        switch(data.hardware.platform.toLowerCase()){
                            case "window 2008":
                            imgPath='windows.png';
                            break;
                            case "centos":
                            imgPath='centos.png';
                            break;
                            case "ubuntu":
                            imgPath='ubuntu.png';
                            break;
                            default:
                            imgPath='unknown.png';
                        }
                        title=data.hardware.platform;
                        if(imgPath==="unknown.png"){
                            if(data.hardware.os.toLowerCase()==="linux"){
                                imgPath="linux.png";
                                title=data.hardware.os;

                            }else if(data.hardware.os.toLowerCase().indexOf('window')>-1){
                                imgPath="windows.png";
                                title=data.hardware.os;

                            }

                        }
                        return '<span class="card_os" style="float:right;"><img src="'+basePath+imgPath +'" height="25" width="25" data-placement="top" data-original-title="'+ title.capitalizeFirstLetter() +'" rel="tooltip"/></span>'
                    },
                    getStartStopToggler=function(data){
                      var title=data.instanceState=="running" ?"Stop" :data.instanceState=="stopped"?"Start":"";
                        return '<div class="startstoptoggler '+data.instanceState+'" instanceID="'+data._id+'" style="float:left;margin-left:14px;margin-top:4px;" data-placement="top" data-original-title="'+title+'" rel="tooltip"></div>'
                    },
                    startAndStopToggler=function (e){
        if($(this).hasClass('unknown') || $(this).hasClass('pending') || $(this).hasClass('stopping')){
            console.log('pending or Unknow State');
            return false;
        }
        else if($(this).hasClass('running')){
            console.log('running State');
            var hasStopPermissionCP=false;
                if(haspermission("instancestop","execute")){
                  hasStopPermissionCP=true;
                }
                if(!hasStopPermissionCP){
                  bootbox.alert('User has No Permission to Stop');
                  return;
                }
            //debugger;
            $(this).parent().find('.actionbuttonShutdown').trigger('click');

        }else if($(this).hasClass('stopped')){
            console.log('Stopped State');
            var hasStartPermissionCP=false;
                if(haspermission("instancestart","execute")){
                  hasStartPermissionCP=true;
                }
                if(!hasStartPermissionCP){
                  bootbox.alert('User has No Permission to Start');
                  return;
                }
            //debugger;
            $(this).parent().find('.actionbuttonStart').trigger('click');
        }
}

  
   var $domainRolesCaption = $('.domain-roles-caption').attr('data-instanceId',data._id).attr('data-chefServerId',data.chef.serverId).attr('data-osType',data.hardware.os).attr('data-instanceIP',data.instanceIP).data('runlist',data.runlist).data('orgId',data.orgId).data('serviceList',data.serviceIds);
   var $divHeadingCP = $domainRolesCaption.find('.domain-roles-heading').empty();

   var $spanheadingLeftCP = $('<span></span>').addClass('domain-roles-icon').html('<img src="'+data.blueprintData.iconPath+'" style="width:27px;margin-right:5px;margin-top:-10px;"/>').attr('contenteditable', 'false');

    var $spanheadingMiddleCP = $('<span>' + data.blueprintData.blueprintName + '</span>').addClass('cardHeadingTextoverflow').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', ''+ data.blueprintData.blueprintName +'');
    var $spanheadingRightCP = $('<span></span>').css({
      'float':'left','margin-top':'4px','margin-left':'8px'
    }).append($('<a href="javascript:void(0)" data-instanceId="' + data._id + '"></a>').addClass('moreInfo').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'MoreInfo'));

    $divHeadingCP.append($spanheadingLeftCP);
    $divHeadingCP.append($spanheadingMiddleCP);
    $divHeadingCP.append($(getOS(data)));

$('.instanceActionBtnCtr').append([$(getStartStopToggler(data)),$spanheadingRightCP]);
    //$divHeadingCP.append($spanheadingRightCP);
    //$domainRolesCaption.append($divHeadingCP);

$('.startstoptoggler').click(startAndStopToggler);
   // .append('<img src="img/templateicons/'+data.blueprintData.templateId+'.png" style="height:20px;width:20px;margin-right:5px;">').append(data.blueprintData.blueprintName);
  $domainRolesCaption.find('.instance-details-ip strong').html(data.instanceIP);
  $domainRolesCaption.find('.instance-state').html(data.instanceState);
  if(data.instanceState == 'running'){
           $domainRolesCaption.find('.componentlistContainer').addClass('started');
           $domainRolesCaption.find('.instance-state').html(data.instanceState).addClass('instance-state-text-started');
  } else if(data.instanceState == 'terminated'){
            $domainRolesCaption.find('.componentlistContainer').addClass('stopped');          
            $domainRolesCaption.find('.instance-state').html(data.instanceState).addClass('instance-state-text-stopped');
  } else if(data.instanceState == 'stopped'){
            $domainRolesCaption.find('.componentlistContainer').addClass('stopped');
            $domainRolesCaption.find('.instance-state').html(data.instanceState).addClass('instance-state-text-stopped');          
  } else {
            $domainRolesCaption.find('.componentlistContainer').addClass('pending');
            $domainRolesCaption.find('.instance-state').html(data.instanceState).addClass('instance-state-text-pending');            
  }

  if(data.hardware.os !== 'linux') {
    disableSSHBtn(data._id);
  }


  if (data.instanceState == 'stopped'){
    enableInstanceActionStopBtn(data._id);
  }
  if (data.instanceState == 'running'){
    enableInstanceActionStartBtn(data._id);
  }
  if (data.instanceState == 'pending' || data.instanceState == 'stopping'){
    disableInstanceActionBtns(data._id);
  }
  if (data.instanceState == 'unknown'){
    disableInstanceStartStopActionBtns(data._id);
  }

  if (data.docker != null) {
      //docker image out of circle.
    if(data.docker.dockerEngineStatus != '' && data.docker.dockerEngineStatus != null)
    {
      var $componentList = $('.instance-bootstrap-list');
      var $dockerStatus = $('<img class="dockerIMG" whatever="2" alt="Docker" src="img/galleryIcons/Docker.png">');
      $componentList.append($dockerStatus);
    }
  }

  
  var $backRunlistContainer = $('.cardBackRunlistContaner');
  for (var j = 0; j < data.runlist.length; j++) {
        var $divComponentItem;
      
            $divComponentItem = $('<span title="' + data.runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:130px;color:#3a87ad;font-size:13px;"></span>').addClass('instance-details-item').append(data.runlist[j]);
        $backRunlistContainer.append($divComponentItem);
    }
  pageSetUp();

  
  
  var displayLog = function(e){
         var instanceId =  $('.domain-roles-caption').attr('data-instanceId');
         
         if(logTimeout) {
                clearTimeout(logTimeout);
          }
         var $logTabBtn = $('#controlPanelLogTab');
         $('.logsArea').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
         $logTabBtn.trigger('click');
         var lastTimestamp;
         function pollLogs(timestamp,delay,clearData) {
         var url = '../instances/'+instanceId+'/logs';
         if(timestamp) {
            url = url + '?timestamp='+timestamp;
         }
         
         logTimeout = setTimeout(function(){
         $.get(url,function(data){
            var $modalBody = $('.logsArea');
            if(clearData) {
               $modalBody.empty();
            }
            var $table = $('<table></table>');

                for (var i = 0; i < data.length; i++) {
                    var $rowDiv = $('<tr class="row rowSpacing"></tr>');
                    var timeString = new Date().setTime(data[i].timestamp);
                    var date = new Date(timeString).toLocaleString(); //converts to human readable strings
                    /*$rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));*/

                    if (data[i].err) {
                        $rowDiv.append($('<td class="col-lg-12 col-sm-12" style="color:red;"></td>').append('<span class="textLogs">'+ date + '</span>' + '&nbsp;&nbsp;&nbsp;' + '<span>' +data[i].log + '</span>'));
                    } else {
                        $rowDiv.append($('<td class="col-lg-12 col-sm-12" style="color:DarkBlue;"></td>').append('<span class="textLogs">'+ date + '</span>' + '&nbsp;&nbsp;&nbsp;'+ '<span>' + data[i].log + '</span>'));
                    }

                    $table.append($rowDiv);


                }
           
           
            if(data.length) {
                 lastTimestamp = data[data.length -1].timestamp;
                 console.log(lastTimestamp);
                 $modalBody.append($table);
                 $modalBody.scrollTop($modalBody[0].scrollHeight+100);
            }
           
            
            
            if($logTabBtn.parent('li').hasClass('active')) {
                   console.log('polling again');
                   pollLogs(lastTimestamp,1000,false);
            } else {
                 console.log('not polling again');
            }            
          });
         },delay);
        }
        pollLogs(lastTimestamp,0,true);
        // $.get('../instances/' + data.id, function(data) {
        //     //$('#tabInstanceStatus').hide();
        //     addInstanceToDaddInstanceToDOMOMaddInstanceToDOM(data);
        // });
    };

  $('.moreInfo').click(displayLog);
  $('#controlPanelLogTab').on('shown.bs.tab',displayLog);
  
    $('#modalSSHShellContainer').on('hide.bs.modal', function(e) {
        $('#modalSSHShellContainer').find('#ssh-terminateBtn').click();
        $('#modalSSHShellContainer').find('.modal-body').empty();
    });


    $('.sshShellBtn').click(function() {
      if($(this).hasClass('isStopedInstance')){
        return false;
      }
      var hasConnectPermission= false;
          if(haspermission("instanceconnect","execute")){
            hasConnectPermission=true;
          }
          if(!hasConnectPermission){
            bootbox.alert('User has no permission to do SSH');
            return;
          }
        var $sshModal = $('#modalSSHShellContainer');
        var instanceId = $(this).parents('.domain-roles-caption').attr('data-instanceId');
        $sshModal.find('.modal-body').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        $sshModal.modal('show');
        $.get('sshShell.html?id=' + instanceId, function(data) {

            $sshModal.find('.modal-body').empty().append(data);
            $sshModal.find('#ssh-instanceId').val(instanceId);
        });
    });

  function getCssClassFromStatus(status) {
        var cssClasses = {

        };
        switch(status) {
            
            case 'running':
            cssClasses.ringClass = 'started';
             cssClasses.textClass = 'instance-state-text-started';
             cssClasses.tableViewStatusClass ="started";
            break;

            case 'stopped':
             cssClasses.ringClass = 'stopped';
             cssClasses.textClass = 'instance-state-text-stopped';
             cssClasses.tableViewStatusClass ="stopped";
            break;

            case 'terminated':
             cssClasses.ringClass = 'stopped';
             cssClasses.textClass = 'instance-state-text-stopped';
             cssClasses.tableViewStatusClass ="stopped";
            break;

            default :
             cssClasses.ringClass = 'pending';
             cssClasses.textClass = 'instance-state-text-pending';
             cssClasses.tableViewStatusClass ="pending";

        }

        return cssClasses;
     } 
 


  $('.instanceActionBtn').click(function(e){

   
        if($(this).hasClass('isStopedInstance')){
          return false;
        }
        var $this = $(this);
        var $parent = $('.domain-roles-caption');
        var instanceId = $parent.attr('data-instanceId');
        var type = $this.attr('data-actionType');
        var url = '../instances/'+instanceId+'/startInstance';
        if(type==='stop') {
            url = '../instances/'+instanceId+'/stopInstance'
        }
        function makeRequest(url) {
           $parent.find('.moreInfo').trigger('click');
            $.get(url, function(data) {
                if (data.actionLogId) {
                    $.get('../instances/' + instanceId + '/actionLogs/' + data.actionLogId, function(actionLog) {
                        addActionLogRow(actionLog);
                    });
                }

                console.log($parent.length, $parent);

                var cssClassed = getCssClassFromStatus(data.instanceCurrentState);

                var oldState = data.instanceCurrentState;

                $parent.find('.componentlistContainer').removeClass().addClass('componentlistContainer').addClass(cssClassed.ringClass);

                $parent.find('.instance-state').removeClass().addClass('instance-state').addClass(cssClassed.textClass).html(data.instanceCurrentState);

                function pollInstanceState(state, delay) {
                    stateTimeout = setTimeout(function() {
                        $.get('../instances/' + instanceId, function(data) {
                            if (data) {
                                title=data.instanceState=="running" ?"Stop" :data.instanceState=="stopped"?"Start":"";
                          $('[instanceID="'+data._id+'"]').removeClass('stopped running pending stopping unknown').addClass(data.instanceState).attr('data-original-title',title);   

                                if (data.instanceState == 'stopped') {

                                    enableInstanceActionStopBtn(data._id);
                                }
                                if (data.instanceState == 'running') {
                                    enableInstanceActionStartBtn(data._id);
                                }
                                if (data.instanceState == 'pending' || data.instanceState == 'stopping') {
                                    disableInstanceActionBtns(data._id);
                                }
                                if (data.instanceState == 'unknown'){
                                  disableInstanceStartStopActionBtns(data._id);
                                }
                                if (data.instanceState === state) {
                                    pollInstanceState(state, 5000);
                                } else {
                                    console.log('polling complete');
                                    var cssClassed = getCssClassFromStatus(data.instanceState);
                                    $parent.find('.componentlistContainer').removeClass().addClass('componentlistContainer').addClass(cssClassed.ringClass);
                                    $parent.find('.instance-state').removeClass().addClass('instance-state').addClass(cssClassed.textClass).html(data.instanceState);
                                    if (data.appUrls && data.appUrls.length) {
                                             for (var k = 0; k < data.appUrls.length; k++) {
                                                 var url = data.appUrls[k].url;
                                                 url = url.replace('$host', data.instanceIP);
                                                 $('.app-url[data-appUrlId="' + data.appUrls[k]._id + '"]').attr('href', url);
                                             }
                                      }
                                }
                            }
                        })
                    }, delay);
                }
                pollInstanceState(oldState, 2000);
            }).fail(function(jxObj) {
                console.log(jxObj);
                if (jxObj.responseJSON && jxObj.responseJSON.actionLogId) {
                    console.log('calling actionLog');
                    $.get('../instances/' + instanceId + '/actionLogs/' + jxObj.responseJSON.actionLogId, function(actionLog) {
                        addActionLogRow(actionLog);
                    });
                }
            });

        }

        if(type==='stop') {
          bootbox.confirm("Stop Instance ?",function(result){
            if(result) {
               makeRequest(url);
            } 
          });
        } else {
          makeRequest(url);
        }
        
       

         
    });

  
    $('.instanceActionBtnUpdateRunlist').click(function(e){
        if($(this).hasClass('isStopedInstance')){
          return false;
        }
        var hasChefRunPermissionCP= false;
          if(haspermission("instancechefclientrun","execute")){
            hasChefRunPermissionCP=true;
          }
          if(!hasChefRunPermissionCP){
            $('.btnUpdateInstanceRunlist').addClass('disabled');
          }
        var $this = $(this);
         var $parent = $('.domain-roles-caption');
         var instanceId = $parent.attr('data-instanceId');
         var chefServerId = $parent.attr('data-chefServerId');
         var orgId = $parent.data('orgId');
         var runlist = $parent.data('runlist');
         console.log(orgId);
         var readMode = false;
         if(localStorage.getItem('userRole') === '[Consumer]') {
          readMode = true;
         }
         var $ccrs = $chefCookbookRoleSelector(urlParams.org,null,runlist,readMode);
         var $controlPanelChefRunModalContainer = $('#controlPanelChefRunModalContainer');
         $controlPanelChefRunModalContainer.find('.modal-body').empty().append($ccrs);
         $controlPanelChefRunModalContainer.modal('show');

    });

    $('.btnUpdateInstanceRunlist').click(function(e) {
      if($(this).hasClass('isStopedInstance')){
        return false;
      }
      bootbox.confirm("Update runlist?", function(result) {
        if (!result) {
            return;
        }
        var $parent = $('.domain-roles-caption');
        var instanceId = $parent.attr('data-instanceId');
        $chefRunModalContainer = $('#controlPanelChefRunModalContainer');
        var runlist = $chefCookbookRoleSelector.getSelectedRunlist();
               
        if(!runlist.length) {
          bootbox.alert("Runlist is empty");
          return;
        }
        console.log('runlist == ',runlist);

        // $.post('../instances/' + instanceId + '/updateRunlist', {
        //     runlist: runlist
        // }, function(data) {
        //     $chefRunModalContainer = $('#controlPanelChefRunModalContainer').modal('hide');
        //     var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
        //     $parent.find('.moreInfo').trigger('click');
        //     console.log(data);
        // });
        $.post('../instances/' + instanceId + '/updateRunlist', {
            runlist: runlist
        }, function(data) {

            $chefRunModalContainer.modal('hide');
            var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
            $parent.find('.instance-bootstrap-list-image').data('runlist', runlist);
            var $backRunlistContainer = $parent.parents('.card').find('.cardBackRunlistContaner').empty();
            for (var j = 0; j < runlist.length; j++) {
               var $divComponentItem;
      
                $divComponentItem = $('<span title="' + runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:130px;color:#3a87ad"></span>').addClass('instance-details-item').append(runlist[j]);
                $backRunlistContainer.append($divComponentItem);
            }

            //$parentTr.find('.instance-bootstrap-list-image').data('runlist', runlist
            $parent.data('runlist',runlist);
            $parent.find('.moreInfo').trigger('click');
            console.log(data);
            if (data.actionLogId) {
                $.get('../instances/' + instanceId + '/actionLogs/' + data.actionLogId, function(actionLog) {
                    addActionLogRow(actionLog);
                });
            }
        }).fail(function(jxObj){
            if (jxObj.responseJSON && jxObj.responseJSON.actionLogId) {
              $.get('../instances/' + instanceId + '/actionLogs/' + jxObj.responseJSON.actionLogId, function(actionLog) {
                addActionLogRow(actionLog);
              });
            }
        });

    });
  });




  //hardware
  var $hrdwareTbody =  $('#collapseHardware').find('tbody');
  $hrdwareTbody.empty();
  var $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Machine</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.hardware.architecture+'</td>');
  $hrdwareTbody.append($tr);
  
  $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Total Memory</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.hardware.memory.total+'</td>');
  $hrdwareTbody.append($tr);

  $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Free Memory</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.hardware.memory.free+'</td>');
  $hrdwareTbody.append($tr);
  

  //software
  var $sfwareTbody =  $('#collapseSoftware').find('tbody');
  $sfwareTbody.empty();
  var $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">OS</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.hardware.platform+'</td>');
  $sfwareTbody.append($tr);
  
  $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Version</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.hardware.platformVersion+'</td>');
  $sfwareTbody.append($tr);

  //consfigManagement
   var $cfmwareTbody =  $('#collapseConfigmgmt').find('tbody');
  $cfmwareTbody.empty();
  var $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Environment</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.envId+'</td>');
  // $cfmwareTbody.append($tr); //commented as we were receiving the id instead of the name : Vinod
  
  $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Chef Bootstrap</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.bootStrapStatus+'</td>');
  $cfmwareTbody.append($tr);

  $tr = $('<tr style="line-height:2.3"></tr>');
  $tr.append('<td scope="col" style="font-size:12px;">Runlist</td><td scope="col"> : </td><td scope="col" style="font-size:12px;"> '+data.runlist.join()+'</td>');
  $cfmwareTbody.append($tr);

/*
 if(data.appUrl2 && data.appUrl2.name && data.appUrl2.url) {
     var anchor = "<a class='app-url1' href='"+data.appUrl2.url+"'' target='_blank' title='"+data.appUrl2.url+"'>"+data.appUrl2.name+"</a>";
     $('.instance-bootstrap-list').last().append(anchor);
     $('#appURL2NameInput').val(data.appUrl2.name);
     $('#appURL2name').html(data.appUrl2.name);
     $('#txtapplicationurl1').val(data.appUrl2.url);
     $('#myForm31').show();
 }

 if(data.appUrl1 && data.appUrl1.name && data.appUrl1.url) {
     var anchor = "<a class='app-url' href='"+data.appUrl1.url+"'' target='_blank' title='"+data.appUrl1.url+"'>"+data.appUrl1.name+"</a>";
     $('.instance-bootstrap-list').last().append(anchor);
     $('#appURL1NameInput').val(data.appUrl1.name);
     $('#appURL1name').html(data.appUrl1.name);
      $('#txtapplicationurl').val(data.appUrl1.url);
      $('#myForm30').show();
 }*/

    if (data.appUrls && data.appUrls.length) {
      var $collapseAppURL = $('#collapseAppURL');
      var $cardAppUrlListContanier = $('.instance-bootstrap-list');
        for (var k = 0; k < data.appUrls.length; k++) {
          var url = data.appUrls[k].url;
          url = url.replace('$host',data.instanceIP);
          var anchor = "<span class='marginForURLCP'><a class='app-url ' data-appUrlId='"+data.appUrls[k]._id+"' href='"+url+"'' target='_blank' title='"+data.appUrls[k].name+"'>"+data.appUrls[k].name+"</a></span>";
            $cardAppUrlListContanier.last().append(anchor);
            var $form = $('#appUrlTemplateForm').clone(true);
            $form.find('.appNameLabel').html(data.appUrls[k].name);
            $form.find('.appUrlId').val(data.appUrls[k]._id);
            $form.find('.appUrlInput').val(data.appUrls[k].url);
            $collapseAppURL.append($form);
            $form.show();
        }
    } else {
      $('#appUrlTemplateFormCreate').removeClass('hidden');
    }
   

 

    $('.loadingControlPanelIndicator').hide();
    $('#controlPanelContainer').show();
  


});

function getActionBtnClass(actionType) {
  console.log(actionType)
   switch(actionType) {
    case 'start' : 
      return {
        bg : 'frontGreen',
        icon:'fa-play',
        actionType:'start'
      }
    case 'stop' : 
      return {
        bg : 'frontRed',
        icon:'fa-power-off',
        actionType:'stop'
      }
    case 'restart' : 
      return {
        bg : 'frontRestart',
        icon:'fa-undo',
         actionType:'restart'
      }
    case 'kill' : 
      return {
        bg : 'frontKill',
        icon:'fa-times-circle',
        actionType:'kill'
      }
    case 'status' : 
      return {
        bg : 'frontKill',
        icon:'fa-bell-o',
        actionType:'status'
      }
    default: 
     return {
     }


   }
}

function getCommandActionHtml(serviceId,serviceData) {
  var commandActions = serviceData.commandaction.split(',');
  var html ='';
  for(var i=0;i<commandActions.length;i++) {
    var actionBtnClass = getActionBtnClass(commandActions[i]);
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="'+commandActions[i]+'" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';

  }
  return html;

}

function getCookbookActionHtml(serviceId,serviceData) {
  var html = '';
  if(serviceData.servicestart && serviceData.servicestart !== 'none') {
    var actionBtnClass = getActionBtnClass('start');
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="start" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';
  }
  if(serviceData.servicestop && serviceData.servicestop !== 'none') {
    var actionBtnClass = getActionBtnClass('stop');
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="stop" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';
  }

  if(serviceData.servicerestart && serviceData.servicerestart !== 'none') {
    var actionBtnClass = getActionBtnClass('restart');
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="restart" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';
  }
  if(serviceData.servicekill && serviceData.servicekill !== 'none') {
    var actionBtnClass = getActionBtnClass('kill');
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="kill" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';
  }
  if(serviceData.servicestatus && serviceData.servicestatus !== 'none') {
    var actionBtnClass = getActionBtnClass('status');
    console.log(actionBtnClass);
     html += '<div class="container1" style="display:inline-block"><div><div class="cardGreenRedYellowBlack ' + actionBtnClass.bg + '"><div><div class=""><a rel="tooltip" data-placement="top" data-original-title="status" data-action-type="' + actionBtnClass.actionType + '" href="javascript:void(0)"><i class="fa ' + actionBtnClass.icon + ' fa-1x txt-color-white"></i></a></div></div></div></div></div>';
  }
  pageSetUp();
  return html;
  //pageSetUp();

}

var $serviceTableBody = $('.servicesTbody');

function addActionToServiceDom(serviceId,serviceData,$tr) {
    console.log("sd==",serviceData);
    $td = $tr.find('td[data-serviceId='+serviceId+']');
    var commandType = serviceData.commandtype;
    if(commandType === 'Chef Cookbook/Recepie') {
      var html =  getCookbookActionHtml(serviceId,serviceData);
    } else {
       var html =  getCommandActionHtml(serviceId,serviceData);
    }
    
    
    $td.append(html);
    $td.find('a').click(function(e) {
        var actionType = $(this).attr('data-action-type');
        $.get('../instances/' + urlParams.id + '/services/' + serviceId +'/' + actionType, function(data) {
            var $parent = $('.domain-roles-caption[data-instanceId="' + urlParams.id + '"]');
            console.log($parent.length,$parent.find('.moreInfo').length);
            $parent.find('.moreInfo').trigger('click');
            if (data.actionLogId) {
                $.get('../instances/' + urlParams.id + '/actionLogs/' + data.actionLogId, function(actionLog) {
                    addActionLogRow(actionLog);
                });
            }

        }).fail(function(jxhr){
            if(jxhr.responseJSON && jxhr.responseJSON.actionLogId) {
              $.get('../instances/'+urlParams.id+'/actionLogs/'+jxhr.responseJSON.actionLogId,function(actionLog){
                  addActionLogRow(actionLog);
              });
            }
        });
    });

}

function addServiceToDom(serviceData) {
  var $tr = $('<tr></tr>').attr('data-serviceId',serviceData.rowid);
  // $('.servicesTbody').append($tr);
  var name = serviceData.servicename;
  if(!name) {
    name = serviceData.commandname;
  }
  var $tdName = $('<td></td>').append(name);
  $tr.append($tdName);
  $tr.append($('<td></td>').attr('data-serviceId',serviceData.rowid))
  
  addActionToServiceDom(serviceData.rowid,serviceData,$tr);
  
    var $tdOption = $('<td></td>').append('<div class="btn-group tableactionWidth"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteServiceBtn" rel="tooltip" data-placement="top" data-original-title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
    $tdOption.find('.deleteServiceBtn').click(function(e) {
        $.ajax({
            url: '../instances/' + urlParams.id + '/services/' + serviceData.rowid,
            type: 'DELETE',
            success: function() {
              console.log($tr);
              var $modalServiceList = $('.serviceNameList');
              var $option = $modalServiceList.find('option[value='+serviceData.rowid+']');
               $servicesDatatable.row($tr).remove().draw( false );
              //$tr.remove();
              $option.remove();
               var $serviceList = $('#serviceList');
                var $input = $serviceList.find('input[value=' +serviceData.rowid + ']');
                if ($input.length) {
                    $input.get(0).checked = false;
                    $input.parents('tr').removeClass('hidden');
                }
                
            }
        });
    });

  

  $tr.append($tdOption);

  $servicesDatatable.row.add($tr).draw(); 

}

 var actionLogsPollTimeouts = []; 
function pollActionLogCompleteStatus(instanceId,actionLogId,$td) {
  $.get('../instances/'+instanceId+'/actionLogs/'+actionLogId,function(actionLog){
      if(!actionLog.completed) {
        var timeout = setTimeout(function(){
          pollActionLogCompleteStatus(instanceId,actionLogId,$td);
          var indexTimeout = actionLogsPollTimeouts.indexOf(timeout);
          if(indexTimeout) {
            actionLogsPollTimeouts.splice(indexTimeout,1);
          }
        },2000);
        actionLogsPollTimeouts.push(timeout);
      } else {
        var status = 'failed'
        if (actionLog.success) {
            status = 'success';
        }
        $td.html(status);
      }
  });
}

function addActionLogRow(actionLog) {
    var $tr = $(document.createElement('tr'));
    var $tdName = $('<td></td>').append(actionLog.name);
    $tr.append($tdName);
    
    var $tdStatus = $('<td></td>');
    var status = 'failed';
    if (!actionLog.completed) {
        status = 'running';
        //polling
      if(actionLog.type !== 8) {
        pollActionLogCompleteStatus(urlParams['id'],actionLog._id,$tdStatus);          
      }
 
    } else {
        if (actionLog.success) {
            status = 'success';
        }
    }
    $tdStatus.append(status);
    $tr.append($tdStatus);

    var $tdData = $('<td></td>');
    var actionData = actionLog.actionData;
    if (actionData) {
        var keys = Object.keys(actionData);
        for (var j = 0; j < keys.length; j++) {
            if (actionData[keys[j]] && actionData[keys[j]].length) {
                $tdData.append($('<span></span>').append(keys[j] + ' : ').append(actionData[keys[j]]));
                $tdData.append('<br/>');
            }
        }
    } else {
        $tdData.append($('<span> - </span>'));
    }
    $tr.append($tdData);


    var timeString = new Date().setTime(actionLog.timeStarted);
    var dateStarted = new Date(timeString).toLocaleString(); //converts to human readable strings
    var $tdTimeStarted = $('<td></td>').append(dateStarted);
    $tr.append($tdTimeStarted);

    var $tdUser = $('<td></td>').append(actionLog.user);
    $tr.append($tdUser);

    var $tdMorInfo = $('<td></td>').append($('<a data-toggle="modal" href="javascript:void(0)" class="moreinfoactionHistory" rel="tooltip" data-placement="top" data-original-title="MoreInfo"></a>').data('actionLogId', actionLog._id).click(function(e) {
        var actionId = $(this).data('actionLogId');
        var $actionLogMoreInfo = $('#actionLogMoreInfo');
        $.get('/instances/' + urlParams['id'] + '/actionLogs/' + actionId+'/logs', function(data) {
            var $table = $('<table></table>');

            for (var i = 0; i < data.length; i++) {
                var $rowDiv = $('<tr class="row rowSpacing"></tr>');
                var timeString = new Date().setTime(data[i].timestamp);
                var date = new Date(timeString).toLocaleString(); //converts to human readable strings
                //$rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));

                if (data[i].err) {
                              $rowDiv.append($('<td class="col-lg-12 col-sm-12" style="color:red;"></td>').append('<span class="textLogs">' + date + '</span>' + '&nbsp;&nbsp;&nbsp;' + '<span>' + data[i].log + '</span>'));
                          } else {
                              $rowDiv.append($('<td class="col-lg-12 col-sm-12" style="color:DarkBlue;"></td>').append('<span class="textLogs">' + date + '</span>' + '&nbsp;&nbsp;&nbsp;' + '<span>' + data[i].log + '</span>'));
                          }

                $table.append($rowDiv);
                

            }

            $actionLogMoreInfo.find('.modal-body').empty().append($table);
            $actionLogMoreInfo.modal('show');

        });
    }));

    $tr.append($tdMorInfo);
    $actionhistoryDatatable.row.add($tr).draw();
}

function addActionLogsToTable(actionLogs) {
    console.log('loadin logs',actionLogs);
    if(!(actionLogs && actionLogs.length)) {
      return;
    }

    for (var i = 0; i < actionLogs.length; i++) {
        addActionLogRow(actionLogs[i]);
    }
}

$('.btnSaveService').click(function(e) {
    var $serviceList = $('#serviceList');
    var $checkbox = $serviceList.find('input[type="checkbox"]:checked');
    var serviceIds = [];
    $checkbox.each(function() {
        serviceIds.push($(this).val());
    })
    console.log('serviceIds ==>', serviceIds);
    if (!serviceIds.length) {
        alert('please choose a service');
        return;
    }
    $.post('../instances/' + urlParams.id + '/services/add', {
        serviceIds: serviceIds
    }, function(data) {

        for (var i = 0; i < data.length; i++) {

            var $input = $serviceList.find('input[value=' + data[i] + ']');
            if ($input.length) {
                var serviceData = $input.data('serviceData');
                $input.get(0).checked = false;
                $input.parents('tr').addClass('hidden');
                addServiceToDom(serviceData);

            }
        }
        
        $('#serviceModalContainer').modal('hide');

    });

});

$('.addServiceBtn').click(function(){
  $serviceList = $('#serviceList');
  var hasServicesPermission= false;
    if(haspermission("instanceservices","execute")){
      hasServicesPermission=true;
    }
    if(!hasServicesPermission){
      bootbox.alert('User has no permission to Add Services');
      return false;
    }
  //alert($serviceList.find('tr[data-listServiceId]:not(.hidden)').length);
  if($serviceList.find('tr[data-listServiceId]:not(.hidden)').length === 0) {
     
      $serviceList.find('tr:first-child').show();
  } else {
    $serviceList.find('tr:first-child').hide();
  }

});

</script>
<!--<script>
  var containerHeight = $(".getContentWidth").height();
  $("#wid-id-10").css("height", containerHeight );
  //var contentWidth = containerWidth - staticIconWidth;
  // $("#myTabContent3").css({'width': contentWidth});
  var totalHeight = $("#content").height();
  $(".thumbnails").css("height", totalHeight);
  console.log(totalHeight);
</script>-->

<script type="text/javascript">
  
  $( document ).ready(function() {
    $('#data_bag_div2').hide();
  });
  $('.panel-databag').click(function(e){
      $('#data_bag_div2').show();
  });


  $( document ).ready(function() {
    $('#data_bag_div3').hide();
  });
  $('.panel-databag1').click(function(e){
      $('#data_bag_div3').show();
  });

  function getInfoLi(){
    $('#controlPanelLogTab').parent('li').removeClass('active');
    if(logTimeout) {
      console.log('clearint log timeout');
      clearTimeout(logTimeout);
    }
    if(stateTimeout) {
       console.log('clearint log state timeout');
      clearTimeout(stateTimeout);
    }
    for(var i=0;i<actionLogsPollTimeouts.length;i++) {
       if(actionLogsPollTimeouts[i]) {
        console.log('clearing timeout');
        clearTimeout(actionLogsPollTimeouts[i]);
       }
    }

   var getURL = localStorage.getItem("dataEx");
    var x= location.href;
    var z= x.lastIndexOf("=");
    var ControlID = x.slice(z+1, z.length);
    localStorage.setItem("ControlID",ControlID);
    location.href=getURL;
  }
$(document).ready(function() {

  //emptying ssh container 
 
    var LocalBreadCrumb = localStorage.getItem("breadcrumb");
    var splitBread = null;
    if(LocalBreadCrumb != null && LocalBreadCrumb != 'undefined')
    {
        localStorage.removeItem("breadcrumb");
        splitBread = LocalBreadCrumb.split('>');
        if(splitBread.length > 0)
        {
            $('#ribbon').find('.breadcrumb').find('li').detach();
            for(var arraycount=0;arraycount< splitBread.length;arraycount++){
              var liNew = document.createElement('li');
              liNew.innerHTML = splitBread[arraycount];
              $('#ribbon').find('.breadcrumb').append(liNew);
            }
            var liCP = document.createElement('li');
            liCP.innerHTML = "Control panel";
            $('#ribbon').find('.breadcrumb').append(liCP);
            var parentUl = $('li').filter(".referenceliClass.open").find('ul').find('li[data-envname='+splitBread[3]+']');
            parentUl.addClass('active');
        }
    }
});

</script>
<script type="text/javascript">
$('.instance-details-item').click(function(e) {
        $(this).parents('.flip-toggle').toggleClass('flip');
        $('.front').hide();
        $('.back').show();
    });

$('.goback').click(function(e) {
        $(this).parents('.flip-toggle').toggleClass('flip');
        $('.front').show();
        $('.back').hide();
    });
</script>

<script>
$(document).ready(function(e){
  $('span[name=editText]').click(function(e){
      $('input[name=check]',$(this).closest('div')).focus();
  });
});
</script>
<script>
   $(document).ready(function() {

       $('.appUrlForm').submit(function(e) {
           var $this = $(this);
           var appUrlId = $this.find('.appUrlId').val();
           var appUrl = $this.find('.appUrlInput').val();
           var $div = $('.domain-roles-caption');
           var instanceId = $div.attr('data-instanceid');
           var instanceIP = $div.attr('data-instanceIP');
           if (instanceId) {
               $.post('../instances/' + instanceId + '/appUrl/' + appUrlId + '/update', {
                   url: appUrl
               }, function(data) {
                   var url = appUrl.replace('$host',instanceIP); 
                   $('.app-url[data-appUrlId="'+appUrlId+'"]').attr('href',url);
                   $this.find('.urlsaved').removeClass('hidden');
                   setTimeout(function() {
                       $this.find('.urlsaved').addClass('hidden');
                   }, (2000));
               });
           }
            e.preventDefault();
            return false;
       });

   });
</script>
<script>
 
</script>
<script type="text/javascript">
  if (!$.fn.dataTable.isDataTable('#tableactionHistory')) {
      //var $taskListArea = $('.taskListArea').empty();
      $actionhistoryDatatable = $('#tableactionHistory').DataTable({
          "pagingType": "full_numbers",
          "aaSorting": [],
          "aoColumns": [{
              "bSortable": false
          }, {
              "bSortable": false
          }, {
              "bSortable": false
          }, {
              "bSortable": true
          }, {
              "bSortable": false
          }, {
              "bSortable": false
          }]

      });
  }
  if (!$.fn.dataTable.isDataTable('#tableServices') ){
    //var $taskListArea = $('.taskListArea').empty();
       $servicesDatatable =  $('#tableServices').DataTable({
            "pagingType": "full_numbers",
            "aoColumns": [
                {
                    "bSortable": true
                },
                {
                    "bSortable": false
                },
                {
                    "bSortable": false
                }
            ]

        });
     }
</script>

<script>
//for cloning the app Url
              $('.addNewApp1').click(function() {
                  $('#appSeries12').clone().find("input").val("").end().appendTo('.applicationURLContainer:last');

                  var countApp = $('.applicationURLContainer').length;

                  if (countApp === 2) {
                      $(this).addClass('hidden');
                      return;
                  }

              });

              $('#appUrlTemplateFormCreate').submit(function(e) {
                  var appUrls = []
                  $(this).find('.applicationURLContainer').each(function() {
                      var appUrlData = {};
                      appUrlData.name = $(this).find('.appName').val();
                      appUrlData.url = $(this).find('.appURL').val();
                      if (appUrlData.name && appUrlData.url) {
                          appUrls.push(appUrlData);
                      }
                      console.log('===>', appUrlData);

                  });


                  console.log('arrr===>', appUrls);
                  if (appUrls.length) {
                      $.post('../instances/' + urlParams.id + '/appUrl', {
                          appUrls: appUrls
                      }, function(data) {
                        $('#appUrlTemplateFormCreate').addClass('hidden');
                          $.get('../instances/' + urlParams.id, function(data) {
                              if (data.appUrls && data.appUrls.length) {
                                  var $collapseAppURL = $('#collapseAppURL');
                                  var $cardAppUrlListContanier = $('.instance-bootstrap-list');
                                  for (var k = 0; k < data.appUrls.length; k++) {
                                      var url = data.appUrls[k].url;
                                      url = url.replace('$host', data.instanceIP);
                                      var anchor = "<span class='marginForURLCP'><a class='app-url ' data-appUrlId='" + data.appUrls[k]._id + "' href='" + url + "'' target='_blank' title='" + data.appUrls[k].name + "'>" + data.appUrls[k].name + "</a></span>";
                                      $cardAppUrlListContanier.last().append(anchor);
                                      var $form = $('#appUrlTemplateForm').clone(true);
                                      $form.find('.appNameLabel').html(data.appUrls[k].name);
                                      $form.find('.appUrlId').val(data.appUrls[k]._id);
                                      $form.find('.appUrlInput').val(data.appUrls[k].url);
                                      $collapseAppURL.append($form);
                                      $form.show();
                                  }
                              }
                          })
                      });
                  }
                  return false;

              });
</script>