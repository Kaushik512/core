<div class="row">

    <article class="col-sm-12 col-md-12 col-lg-12">

        <div class="widget-body" style="font-size:12px;">


            <ul id="myTab3" class="nav nav-tabs tabs-pull-left">
                <li class="active Instances">
                    <a href="#l1" style="display:block!important" data-toggle="tab" ><i class="fa fa-reorder"></i>&nbsp;Instances</a>
                </li>
                <li class="pull-left Blueprints">
                    <a href="#l2" style="display:block!important" data-toggle="tab"><i class="fa fa-crosshairs"></i>&nbsp;Blueprints</a>
                </li>

                <li class="pull-left Orchestration">
                    <a href="#l3" style="display:block!important" data-toggle="tab"><i class="fa fa-indent"></i>&nbsp;Orchestration</a>
                </li>
                <li class="pull-left Containers hidden">
                    <a href="#l4" style="display:block!important" data-toggle="tab"><i class="fa fa-briefcase"></i>&nbsp;Containers</a>
                </li>
            </ul>

            <div id="myTabContent3" class="nav tab-content">

                <div class="tab-pane fade in active" id="l1">
                    <div class="jarviswidget jarviswidget-color-blueLight" id="wid-id-10" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-sortable="false">

                        <div>

                            <div class="widget-body no-padding">

                                <div class="panel-group smart-accordion-default" id="accordion-1" style="height:444px;overflow-y: auto;">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse">Instance</a>
                                            </h4>


                                <span class="pull-right swap-view">
                                    
                                    <a class="btn1" id="defaultViewButton" style="" onclick="showHideControl(this.id)"> <i class="fa fa-th fa-2x txt-color-blue" title="Card View"/></a>&nbsp;
                                    <a id="instanceview" class="btn1" onclick="showHideControl(this.id)"> <i class="fa fa-align-justify fa-2x txt-color-blue" title="Table View"/></a></span>
                                        </div>
                                        <div id="collapseOne-1" class="panel-collapse collapse in">
                                            <div class="panel-body" style="padding:0px !important;">
                                                <div id="tabInstanceStatus">&nbsp;</div>
                                                <div class="widget-box" id="divinstancestableview">
                                                    <div class="widget-body">
                                                        <div class="widget-main " style="min-height:300px">
                                                            <div class="col-md-12" style="padding-left:0px; padding-right:0px;padding-top:50px">
                                                                <div class="table-responsive table-div" >

                                                                    <table id="tableinstanceview" class="table table-bordered dataTable" cellpadding="5px" width="100%" style="border:1px solid #eeeeee !important; text-align:center;">
                                                                        <thead>
                                                                        <tr class="rowCustomStyle" style="font-weight:bold;">
                                                                            <td>S.No.</td>
                                                                            <td>Logo</td>
                                                                            <td>Name</td>
                                                                            <td>IPAddress</td>
                                                                            <td>Runlists</td>
                                                                            <td>Status</td>
                                                                            <td>URL Links</td>
                                                                            <td>Log Info</td>
                                                                            <td>Chef Run</td>
                                                                            <td class="widthAdjustment">Action</td>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>


                                                                        </tbody>

                                                                    </table>

                                                                </div>

                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>

                                                <div id="divinstancescardview" class="carousel slide">
                                                    <div class="carousel-inner">
                                                        <!-- Slide 1 -->

                                                    </div>
                                                    <a class="left carousel-control" href="#divinstancescardview" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left txt-color-blue"></span> </a>
                                                    <a class="right carousel-control" href="#divinstancescardview" data-slide="next"> <span class="glyphicon glyphicon-chevron-right txt-color-blue"></span> </a>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <footer class="footer">
                        <div class="clearfix form-actions" style="text-align:center;">
                            <div class="btn-group">

                                <button class="btn btn-primary actionControlPanel" style="margin-left:200px">
                                    <i class="fa fa-gears"></i>
                                    Control Panel
                                </button>



                            </div>
                            <a class="btn pull-right btn-danger right-button" title="Remove Instance" onClick="removeSelectedInstance()" >
                                <i class="fa fa-trash-o"></i>
                            </a>&nbsp;
                            <a class="btn pull-right btn-info right-button" id="ipaddressimport" data-original-title="Import Instance" data-placement="top" title="Import By IP" rel="tooltip" href="#modalContainerimportInstance" data-toggle="modal">
                                <i class="fa fa-laptop"/>
                            </a>

                            &nbsp;&nbsp;<a  data-toggle="modal" href="#mybootstrapandimport" class="btn pull-right btn-primary hidden" title="Bootstrap & Import" onClick="$('#bootstrapandimportnode').modal('show');" style="margin-right:10px;"> <i class="fa fa-plug"></i></a>

                        </div>
                    </footer>



                </div> <!--tab-pane l1 gets over-->

                <div class="tab-pane" id="l2">
                    <div class="jarviswidget jarviswidget-color-blueLight" id="wid-id-10" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-sortable="false">

                        <div>

                            <div class="widget-body no-padding">

                                <div class="panel-group smart-accordion-default" id="accordion-2" style="height:444px;overflow-y: auto;">
                                    <div class="devopsRolePanel panel panel-default blueprintContainer">
                                        <div class="panel-heading">
                                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-2" href="#collapseOne-2"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Devop Roles</a></h4>
                                        </div>
                                        <div id="collapseOne-2" class="panel-collapse collapse">
                                            <div class="panel-body">


                                            </div>
                                        </div>
                                    </div>


                                    <!--App Factory Starts here-->
                                    <div class="appFactoryPanel panel panel-default blueprintContainer">
                                        <div class="panel-heading">
                                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-2" href="#collapse2"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>App Factory</a></h4>
                                        </div>
                                        <div id="collapse2" class="panel-collapse collapse">
                                            <div class="panel-body">

                                            </div>
                                        </div>
                                    </div>
                                    <!--App Factory ends here-->

                                    <div class="panel panel-default blueprintContainer">
                                        <div class="panel-heading ">
                                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-2" href="#collapse3" class="collapsed"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Cloud Formation</a></h4>
                                        </div>
                                        <div id="collapse3" class="panel-collapse collapse in">
                                            <div class="panel-body">

                                            </div>
                                        </div>
                                    </div>
                                    <div class="desktopProvisioningPanel panel panel-default blueprintContainer">
                                        <div class="panel-heading">
                                            <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-2" href="#collapse4"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Desktop Provisioning</a></h4>
                                        </div>
                                        <div id="collapse4" class="panel-collapse collapse">
                                            <div class="panel-body">

                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>


                        </div>


                    </div>

                    <footer class="footer">
                        <div class="clearfix form-actions" style="text-align:center">
                            <div class="btn-group">

                                <button class="btn pull-left btn-primary launchBtn" style="margin-left:200px;">
                                    <i class="ace-icon fa  fa-location-arrow bigger-110"></i>
                                    Launch
                                </button>
                            </div>
                            <button class="btn pull-right btn-danger right-button" title="Remove Blueprint" onClick="removeSelectedBlueprint()" > <i class="fa fa-trash-o"></i></button>
                        </div>

                    </footer><!--Launch div ends here-->
                </div> <!--tab-pane l2 gets over -->


                <div class="tab-pane" id="l3">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-12">

                                <div class="widget-box">
                                    <div class="widget-header">
                                        <h5 class="widget-title" style="color:#4e5964;">
                                            <strong>List of Tasks</strong>
                                        </h5>
                                        <div class="widget-toolbar no-border">
                                            <div>
                                                <button class="btn btn-minier btn-primary createTaskLink" href="javascript:void(0)">
                                                    <i class="ace-icon ace-icon fa fa-plus bigger-110"></i>
                                                    New
                                                </button>

                                            </div>
                                        </div>

                                    </div>
                                    <div class="widget-body">
                                        <div class="widget-main" style="min-height:300px">
                                            <div class="col-md-12 table-responsive" style=" padding-top: 40px;">
                                                <table id="tableOrchestration" class="table table-striped table-bordered table-hover dataTable no-footer text-align-center table-condensed tablesorter" cellpadding="5px" width="100%">
                                                    <thead>
                                                    <tr class="rowCustomStyle">
                                                        <td>Name</td>
                                                        <td>Assigned Nodes</td>
                                                        <td>Assigned Runlists</td>
                                                        <td>Execute</td>
                                                        <td>Last Run</td>
                                                        <td>Action</td>
                                                    </tr>
                                                    </thead>
                                                    <tbody class="taskListArea">

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- Container tab started  -->
                <div class="tab-pane" id="l4">
                    <div class="widget-body">
                        <div class="widget-main" style="min-height:300px">
                            <div class="col-md-12 table-responsive" style="padding-left:0px; padding-right:0px;">

                                <table class="table table-striped table-bordered table-hover dataTable" id="dockercontainertable" cellpadding="5px" width="100%">
                                    <thead>
                                    <tr class="rowCustomStyle">
                                        <th>Actions</th>
                                        <th>State</th>
                                        <th>Created</th>
                                        <th>Name</th>
                                        <th>Host Instance IP</th>
                                        <th>Container ID</th>
                                        <th>Image</th>
                                        <th>More Info</th>
                                    </tr>
                                    </thead>
                                    <tbody style="padding:4px 4px">
                                    <tr id="dockercontainertabletemplatetr" class="hidden dockercontainertabletemplatetr">
                                        <td>
                                            <div class="container1 " style="display:inline-block">
                                                <div id="card1">
                                                    <div class="card1 front1 flipper hidden stop"  title="Stop" >
                                                        <div id="flip1" style="margin-top:5px;">
                                                            <div class="">
                                                                <a href="javascript:void(0);" data-original-title="Stop" dockercontaineraction="2" data-placement="top" rel="tooltip"  class="dockeractionbutton" ><i class="fa fa-power-off fa-1x txt-color-white"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card1 front1 flipper start"  title="Start" >
                                                        <div id="flip1" style="margin-top:5px;">
                                                            <div class="">
                                                                <a href="javascript:void(0);" data-original-title="Start"  dockercontaineraction="1"  data-placement="top" rel="tooltip"  class="dockeractionbutton"><i class="fa fa-play fa-1x txt-color-white"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="container1" style="display:inline-block;margin-left:4px">
                                                <div id="card3">
                                                    <div class="card3 front3"  title="Restart" >
                                                        <div style="margin-top:5px;">
                                                            <div class="">
                                                                <a href="javascript:void(0);" data-original-title="Restart"  dockercontaineraction="3"  data-placement="top" rel="tooltip" class="dockeractionbutton"><i class="fa fa-undo fa-16px txt-color-white"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="container1" style="display:inline-block;margin-left:4px">
                                                <div id="card2">
                                                    <div class="card2 front2  hidden pause"  title="Pause" >
                                                        <div id="flip3" style="margin-top:5px;">
                                                            <div class="">
                                                                <a href="javascript:void(0);" data-original-title="Pause"  dockercontaineraction="4"  data-placement="top" rel="tooltip" class="dockeractionbutton"><i class="fa fa-pause fa-16px txt-color-white" ></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card2 front2  unpause">
                                                        <div id="flip3" style="margin-top:5px;"  title="UnPause" >
                                                            <div class="">
                                                                <a href="javascript:void(0)" data-original-title="Unpause"  dockercontaineraction="5"  data-placement="top" rel="tooltip" class="dockeractionbutton"><i class="fa fa-eject fa-1x txt-color-white" style="transform:rotate(90deg)"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="container1" style="display:inline-block;margin-left:4px">
                                                <div id="card3">
                                                    <div class="card3 front1"  title="Terminate" >
                                                        <div style="margin-top:5px;">
                                                            <div class="">
                                                                <a href="javascript:void(0);" data-original-title="Terminate"  dockercontaineraction="6"  data-placement="top" rel="tooltip" class="dockeractionbutton"><i class="fa fa-sign-out fa-16px txt-color-white"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </td>
                                        <td class="" width="150px"><span class="dockercontainerstatus"></span></td>
                                        <td  class="dockercontainerstartedon"></td>
                                        <td  class="dockercontainername"></td>
                                        <td  class="dockercontainerhostip"></td>
                                        <td  class="dockercontainerid"></td>
                                        <td  class="dockercontainerimagename"></td>
                                        <td>
                                            <a href="#modalContainermoreInfo" class="moreInfo btn1 modelcontainermoreinfo" data-actiontype="start" dockercontaineraction="info"  rel="tooltip" data-placement="top" data-original-title="MoreInfo" data-toggle="modal">
                                                <img class="dockercontainerprogress hidden" style="margin-left:30px" src="img/select2-spinner.gif"></img>
                                            </a>
                                        </td>
                                    </tr>
                                    </tbody>

                                </table>
                                <div class="loadingimagefordockertable hidden">
                                    <img src="img/select2-spinner.gif">&nbsp; Loading...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Container tab ended -->
            </div>

        </div>

    </article>
</div>

<!-- Modal -->
<div class="modal fade" id="launchDockerInstanceSelector__" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog" style="width:750px">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="dockerInstanceSelectionTitle">Select Instances for </h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary dockerinstancestartold" style="margin-right:5px;">Start</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="launchDockerInstanceSelector" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="DockerLaunch">Launch Parameters-Docker Blueprints</h4>
            </div>
            <div class="modal-body">
                <section id="wizard">
                    <form id="commentForm" action="" class="smart-form">
                        <div id="rootwizard">
                            <ul style="display:none">
                                <li><a href="#tab1" data-toggle="tab">First</a></li>
                                <li><a href="#tab2" data-toggle="tab">Second</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane" id="tab1">
                                    <div style="margin:0px;" class="row control-group">
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Container Name<span style="color:red">*</span><span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Containernamefield" name="namefield" class="form-control" placeholder="" dockerparamkey="--name" onclick="$('.dockerparamrequired').addClass('hidden')">
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Port Mappings
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Portmappingfield" name="Portmappingfield" class=" form-control" placeholder="Map host ports to container ports" dockerparamkey="-p">
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Volumes
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Volumesfield" name="Volumesfield" class=" form-control" placeholder="Map host folders to container folders"  dockerparamkey="-v">
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Volumes-from
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Volumes-fromfield" name="Volumes-fromfield" class=" form-control" placeholder="Comma separated container names" dockerparamkey="--volumes-from">
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Linked Container
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Linkedcontainerfield" name="Linkedcontainerfield" class=" form-control" placeholder="The name of a container this one links to"  dockerparamkey="--link">
                                            </label>
                                        </section>
                                        <section class="col col-6">
                                            <label class="control-label" for="category">Startup Command
                                            </label>
                                            <label class="input controls">
                                                <input type="text" id="Startupcommandfield" name="Startupcommandfield" class=" form-control" placeholder="Optional startup command for the container" dockerparamkey="-c">
                                            </label>
                                        </section>
                                        <section class="col col-6 hidden">
                                            <label class="control-label" for="category">Removed Linked Containers on Exit
                                            </label>
                                            <label class="select controls">
                                                <select class="chooseSelect width-100" id="Removelinkedcontainersonexitfield" placeholder="Should this & linked containers be removed on exit">
                                                    <option>False</option>
                                                    <option>True</option>

                                                </select>
                                            </label>
                                        </section>
                                        <section class="col col-6 hidden">
                                            <label class="control-label" for="category">Remove on Exit
                                            </label>
                                            <label class="select controls">
                                                <select class="chooseSelect width-100 " id="Removeonexitfield" placeholder="Should this container be removed when it exits">
                                                    <option>False</option>
                                                    <option>True</option>

                                                </select>
                                            </label>
                                        </section>
                                        <section class="col col-6 hidden">
                                            <label class="control-label" for="">Startup Script</label>
                                            <label class="input input-file" for="file">
                                                <div class="button"><input type="file" id="Startupscriptfield" name="Startupscriptfield">Browse</div><input type="text" readonly="">
                                            </label>
                                        </section>
                                    </div>
                                </div>
                                <div class="tab-pane" id="tab2">
                                    <div id="dockerinstancesselctorview" style="margin-left: 8px;margin-top: 26px;width: 98%;">
                                        <!-- <div class="control-group">
                  <label class="control-label" for="url">URL</label>
                  <div class="controls">
                    <input type="text" id="urlfield" name="urlfield" class="required url">
                  </div>
                </div> -->
                                    </div>
                                    <div class="btn-group">

                                        <a type="button" class="btn btn-default btn-primary hidden" data-dismiss="modal">Close</a>
                                    </div>
                                </div>
                                <br><hr>
                                <ul class="pager wizard">
                                    <!-- <li class="previous first" style="display:none;"><a href="#">First</a></li> -->
                                    <li class="previous disabled"><a href="javascript:void(0);" class="btn btn-primary" style="border-radius:0px">Previous</a></li>
                                    <!-- <li class="next last" style="display:none;"><a href="#">Last</a></li> -->
                                    <li class="next"><a href="javascript:void(0);" class="btn btn-primary" style="border-radius:0px;margin-left:5px;">Next</a></li>
                                    <button type="button" class="btn btn-primary nav nav-pills dockerinstancestart hidden" style="margin-right:5px;height:30px;width:80px">Start</button>

                                </ul>
                            </div>
                        </div>
                    </form>
                </section>
            </div>
            <!-- <div class="modal-footer">
        
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">
          <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel</button>
      </div> -->
        </div>
    </div>
</div>

<div class="modal fade" id="launchResultContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Launching Blueprint</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-lg" id="blueprintEditResultContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Blueprint Edit</h4>
            </div>
            <div class="modal-body" style="padding:0px !important">

            </div>
            <div class="modal-footer" style="margin-top:0px !important;">

                <button type="button" class="btn btn-default btn-primary blueprintUpdateBtn" data-dismiss="modal">Save Version</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="chefRunModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-pencil-square-o txt-color-blue"></i>Update Runlist</h4>
            </div>
            <div class="modal-body" style="padding:0px !important">


                <div class="chefRunlistContainer">

                </div>


            </div>
            <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary btnUpdateInstanceRunlist">Update</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="instanceLogModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">
                    <i class="fa fa-bar-chart-o txt-color-blue"></i>
                    Instance Logs
                </h4>
            </div>
            <div class="modal-body">
                <div class="logsArea" style="font-size:12px !important;"></div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalTableRunlist" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    Chef-Runlists
                </h4>
            </div>
            <div class="modal-body no-padding">


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Modal -->
<div class="modal fade" id="modalDesktopProvisioningLaunch" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    Enter instance details
                </h4>
            </div>
            <div class="modal-body no-padding">
                <form role="form" class="smart-form1">
                    <fieldset>
                        <div class="">
                            <section class="col col-12">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Instance IP</label>
                                    <div class="">
                                        <input type="text" id="instanceIPInput">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Instance Username</label>
                                    <div class="">
                                        <input type="text" id="instanceUsernameInput">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="exampleInputEmail1">Instance Password</label>
                                    <div class="">
                                        <input type="password" id="instancePasswordInput">
                                    </div>
                                </div>
                            </section>

                        </div>

                    </fieldset>
                </form>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-primary desktopProvisioningLaunchBtn">Provision</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div aria-hidden="true" aria-labelledby="cadvisorpopup" role="dialog" tabindex="-1" id="cadvisorpopup" class="modal fade" data-backdrop="static">

    <div class="modal-dialog"  style="width:80%;">
        <div class="modal-content" style="height:500px">

            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                    X
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-line-chart fa-lg txt-color-blue"></i>&nbsp;&nbsp;Monitoring Container
                </h4>
            </div>
            <div class="modal-body no-padding"  style="height:480px">
                <form class="smart-form" id="login-form" action="" novalidate="novalidate">
                    <fieldset style="padding-top:7px !important;height:366px;">
                        <div id="cadvisorloadingicon" class="" style="text-align:center"><img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;margin-left:50%" src="img/loading.gif" /></div>
                        <iframe id="cAdvisorPageFrame"  style="width:100%;height:100%;border:0px;">
                        </iframe>
                    </fieldset>
                    <footer>
                        <button class="btn btn-primary" type="submit" data-dismiss="modal">
                            <i class="fa fa-undo fa-1x"></i>&nbsp;Close
                        </button>
                    </footer>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!--/.modal-assignedNode-->

<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="assignedNode" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                    x
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-sitemap txt-color-blue"></i>&nbsp;&nbsp;Assigned Nodes
                </h4>
            </div>
            <div class="modal-body no-padding">
                <form class="smart-form" id="login-form" action="" novalidate="novalidate">
                    <fieldset style="padding-top:7px !important;">
                        <section>
                            <div class="">
                                <table align="left" style="margin-left:20px;">
                                    <thead>
                                    <tr style="line-height:2.3">
                                        <th style="width:100px" scope="col"><u style="font-size:12px;">Name</u>
                                        </th>
                                        <th style="width:100px" scope="col"> <u style="font-size:12px;">IP Address</u></th>
                                        <th scope="col"> <u style="font-size:12px;">Status</u></th>
                                    </tr>
                                    </thead>

                                    <tbody class="taskNodeListContainer">

                                    </tbody>
                                </table>
                            </div>
                        </section>
                    </fieldset>
                    <div>

                    </div>
                    <footer>
                        <button class="btn btn-primary" type="submit" data-dismiss="modal">
                            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
                        </button>
                    </footer>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!--/.modal-assignedNode-->
<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="assignedRunlist" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                    x
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-list txt-color-blue"></i>&nbsp;&nbsp;Assigned Runlists
                </h4>
            </div>
            <div class="modal-body no-padding">

                <form class="smart-form" id="login-form" action="" novalidate="novalidate">
                    <fieldset style="padding-top:7px !important;">
                        <section class="col col-6">
                            <label class="label">
                                <img src="img/templateicons/Order-run-list---deployment.png">
                                <strong>RunLists</strong>
                            </label>
                            <div class="row">
                                <div class="col col-10">
                                    <ul class="taskRunListContainer" style="border:1px solid #dddddd;list-style:none outside none;min-height:100px;overflow-y:auto;">

                                    </ul>
                                </div>
                            </div>
                        </section>
                    </fieldset>
                    <div>

                    </div>
                    <footer>
                        <button class="btn btn-primary" type="submit" data-dismiss="modal">
                            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
                        </button>
                    </footer>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!--/.modal-assignedRunlist-->





<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="assignedExecute" class="modal fade" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">
                    x
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-eraser txt-color-blue"></i>&nbsp;&nbsp;Execute Logs
                </h4>
            </div>
            <div class="modal-body no-padding">

                <form class="smart-form" id="login-form" action="" novalidate="novalidate">
                    <fieldset style="padding-top:7px !important;">
                        <section>

                            <div role="content">
                                <div class="widget-body">

                                    <ul id="taskExecuteTabsHeader" class="nav nav-tabs bordered">


                                    </ul>

                                    <div id="taskExecuteTabsContent" class="tab-content padding-10">


                                    </div>

                                </div>
                            </div>

                        </section>
                    </fieldset>
                    <footer>
                        <button class="btn btn-primary" type="submit" data-dismiss="modal">
                            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
                        </button>
                    </footer>
                </form>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!--/.modal-assignedExecute-->


<!-- Modal SSH Shell-->
<div class="modal fade" id="modalSSHShellContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " style="">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">
                    <i class="fa fa-terminal txt-color-blue"></i>Terminal
                </h4>
            </div>
            <div class="modal-body" style="height:430px;">

            </div>
            <!-- <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div> -->
        </div>
    </div>
</div>


<!-- Modal for Container tab started-->
<div class="modal fade" id="modalContainermoreInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Details of Container
                </h4>
            </div>
            <div class="modal-body no-padding">
                <form novalidate="novalidate" action="" id="login-form" class="smart-form">
                    <fieldset style="padding-top:7px !important;">
                        <section>
                            <div class="widget-body">

                                <ul id="myTab1" class="nav nav-tabs bordered">
                                    <li class="active">
                                        <a href="#s1" data-toggle="tab">General-Info</a>
                                    </li>
                                    <li class="">
                                        <a href="#s2" data-toggle="tab">State</a>
                                    </li>
                                    <li class="">
                                        <a href="#s3" data-toggle="tab">Image</a>
                                    </li>
                                </ul>

                                <div id="myTabContent1" class="tab-content padding-10">
                                    <div class="tab-pane fade active in" id="s1">
                                        <div class="logsArea">
                                            <section class="col col-10">
                                                <div class="">
                                                    <table align="left">
                                                        <thead>
                                                        <tr style="line-height:2.3">
                                                            <th scope="col" style="width:80%"><u style="font-size:12px;"></u>
                                                            </th>
                                                            <th scope="col"> <u style="font-size:12px;"></u></th>
                                                        </tr>
                                                        </thead>

                                                        <tbody>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;" width="20%" >Name&nbsp;:</td>
                                                            <td style="font-size:12px;" width="80%"   containerdata="Config.Hostname"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">ContainerID&nbsp;:</td>
                                                            <td style="font-size:12px;"  containerdata="Id"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Created&nbsp;:</td>
                                                            <td style="font-size:12px;"  containerdata="Created"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Docker Repo&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata=""></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Working Dir&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata="Config.WorkingDir"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Entry Point&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata="Config.Entrypoint">[&nbsp;]</td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Virtual Size&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata="Config.Memory"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Port Specs&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata="Config.PortSpecs"></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="s2">
                                        <div class="logsArea">
                                            <section class="col col-10">
                                                <div class="">
                                                    <table align="left">
                                                        <thead>
                                                        <tr style="line-height:2.3">

                                                            <th scope="col" style="width:80%"><u style="font-size:12px;"></u>
                                                            </th>
                                                            <th scope="col"> <u style="font-size:12px;"></u></th>
                                                        </tr>
                                                        </thead>

                                                        <tbody>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;" width="20%" >Running&nbsp;:</td>
                                                            <td style="font-size:12px;"  width="80%" containerdata="State.Running"></td>
                                                        </tr>

                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">PID&nbsp;:</td>
                                                            <td style="font-size:12px;"  containerdata="State.Pid"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">ExitCode(If Stopped)&nbsp;:</td>
                                                            <td style="font-size:12px;" containerdata="State.ExitCode"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Started At&nbsp;:</td>
                                                            <td style="font-size:12px;"  containerdata="State.StartedAt"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Finished At&nbsp;:</td>
                                                            <td style="font-size:12px;"  containerdata="State.FinishedAt">-</td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="s3">
                                        <div class="logsArea">
                                            <section class="col col-10">
                                                <div class="">
                                                    <table align="left">
                                                        <thead>
                                                        <tr style="line-height:2.3">

                                                            <th scope="col" style="width:80%"><u style="font-size:12px;"></u>
                                                            </th>
                                                            <th scope="col"> <u style="font-size:12px;"></u></th>
                                                        </tr>
                                                        </thead>

                                                        <tbody>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;" width="20%" >ImageID</td>
                                                            <td style="font-size:12px;" width="80%"  containerdata="Image"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Storage Driver</td>
                                                            <td style="font-size:12px;"  containerdata=""></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Execution Driver</td>
                                                            <td style="font-size:12px;" containerdata="ExecDriver"></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Kernel Version</td>
                                                            <td style="font-size:12px;"  containerdata=""></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Operating System</td>
                                                            <td style="font-size:12px;"  containerdata=""></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Pool Name</td>
                                                            <td style="font-size:12px;"  containerdata=""></td>
                                                        </tr>
                                                        <tr style="line-height:2.1">
                                                            <td style="font-size:12px;">Pool Block Size</td>
                                                            <td style="font-size:12px;"  containerdata=""></td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </section>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" type="submit" data-dismiss="modal">
                    <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
                </button>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal for Container tab ended-->

<!-- Modal for Container tab started-->
<div class="modal fade" id="modalContainerimportInstance" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <form role="form" id="addInstanceForm" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title">
                        <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Import Instance By IP
                    </h4>
                </div>

                <div class="modal-body modal-height">
                        

                        <span id="spanforshefserverfound">
                        <div class="col-lg-6">

                            <label for="">Enter IP Address<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <input type="text" name="ipaddressInput" class="form-control" id="instanceFQDN" autofocus/>
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-user txt-color-teal"></i>Please enter IP Address/FQDN</b>


                        </div>
                        <div class="col-lg-6 topNew">

                            <label for="">Choose Operating System<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                            <select id="importinstanceOS"  class="width-100" >
                                <option value="linux">linux</option>
                                <option value="windows">windows</option>
                            </select>

                        </div>
                    
                    
                        <div class="col-lg-6" style="margin-top:15px">

                            <label for="">Username<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <input type="text" name="usernameInput" class="form-control" id="instanceUsername">
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-user txt-color-teal"></i> Please enter Username</b>


                        </div>
                        <div class="col-lg-6" style="margin-top:15px">

                            <label for="">Choose Authentication Type<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                            <select id="pemFileDropdown"  class="authenticationType width-100" >
                                <option value="password">Password</option>
                                <option value="pemFile">Pem File</option>
                            </select>

                        </div>
                    
                       
                        <div class="col-lg-6 authPassword" style="margin-top:15px">

                            <label for="">Password<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <input type="password" class="form-control" id="instancePassword" />
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-lock txt-color-teal"></i> Please enter Password</b>


                        </div>
                        <div class="col-lg-6 authPemFile" style="margin-top:15px">
                            <div class="smart-forms">
                                <label for="">Pem File<span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                <label for="templatesicon" name="field" class="file">
                                    <span class="button btn-primary btn-importbyIP">Browse</span>
                                    <input id="importPemfileInput" type="file" class="gui-file">
                                    <input type="text" readonly="" class="gui-input">
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-6" style="margin-top:15px;">
                            <label class="">Assign Users<span style="color:Red;" class="control-label">&nbsp;*</span></label>

                            <div class="userListLoadingContainer"></div>
                            <select class="custom-scroll" multiple="" id="importbyipuserListSelect" style="display:none" cat-validation="required">
                            </select>

                        </div>


                </div>
                <div class="modal-footer">
                    <label id="nodeimportipspinner" class=" hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></img> </label>
                    <label id="nodeimportipresultmsg" class=" hidden"></label>
                    <div class="marginForButtons">
                        <button id="addInstanceBtn" class="btn btn-primary" type="submit">
                            <i class="fa fa-upload fa-1x"></i>&nbsp;Import
                        </button>
                        <a class="btn btn-primary" type="submit" data-dismiss="modal">
                            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
                        </a>
                    </div>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal for Container tab ended-->
<script type="text/javascript">


</script>
<script type="text/javascript">
    $(".authPassword").show();
    $(".authPemFile").hide();
    $('.authenticationType').change(function(e) {
        if (this.value == "password") {
            $(".authPassword").show();
            $(".authPemFile").hide();
        } else {
            $(".authPassword").hide();
            $(".authPemFile").show();
        }
    });

    $('.searchInstances').keyup(function(e){
        var searchText = $(this).val();
        //alert(searchText);
        $allListElements = $('#divinstancescardview ul li .domain-roles-heading .cardHeadingTextoverflow');
        //alert($allListElements.length);
        $matchingListElements = $allListElements.filter(function(i,el){
            //alert(el);
            return $(el).text().indexOf(searchText) !== -1;
        });
        // $allListElements.parents().eq(6).hide();
        // $matchingListElements.parents().eq(6).show();
        $allListElements.parents(".domain-role-thumbnail").hide();
        $matchingListElements.parents(".domain-role-thumbnail").show();
        // $allListElements.parent().parent().parent().parent().parent().parent().parent().hide();
        // $matchingListElements.parent().parent().parent().parent().parent().parent().parent().show();
    });
</script>
<script type="text/javascript">
    $('#ipaddressimport').click(function(e){
        $('#nodeimportipresultmsg').addClass("hidden");
        $('#addInstanceForm').trigger("reset");
        $('#pemFileDropdown').change();
        $('#importinstanceOS').change();
    });

    // $(document.body).on('click', '.card', function () {

    //       document.querySelector('#flip-toggle').classList.toggle('flip');
    //   });

    //setting the workzone link to current page
    //alert(window.location.href);
    //alert('what is this');
    var wzlink = window.location.href.split('#')[1];
    //alert(wzlink);
    $('li[navigation*="Workspace"]').find('a').attr('href','#' + wzlink);
    //Set localstorage to hold the last wz href
    //update lastworkzone only when you have ? in url
    if(window.location.href.indexOf('?') > 0)
        localStorage.setItem("lastworkzoneurl", window.location.href);

    var urlParams = {};
    (window.onpopstate = function() {
        var url = window.location.href;
        var indexOfQues = url.lastIndexOf("?");
        if (indexOfQues != -1) {
            var sub = url.substring(indexOfQues + 1);
            console.log(sub);
            var params = sub.split('&')
            for (var i = 0; i < params.length; i++) {
                var paramParts = params[i].split('=');
                urlParams[paramParts[0]] = paramParts[1];
            }
        }

    })();
    console.log(urlParams);
    var projectId = urlParams['projid'];
    var envId = urlParams['envid'];
    var orgId = urlParams['org'];
    var bgId = urlParams['bg'];

    $(document).ready(function() {
        //$('.modal').modalCollapse();
        $(document).on('shown.bs.modal', function(e) {
            $('[autofocus]', e.target).focus();
        });

        $('#importinstanceOS').select2();
        $('#pemFileDropdown').select2();


        if(localStorage.getItem("SelectedClass") == "Orchestration")
        {
            localStorage.removeItem("SelectedClass");
            $('#myTab3').find('.Instances').removeClass('active');
            $('#myTab3').find('.Orchestration').addClass('active');
            $('#myTabContent3').find('#l1').removeClass('active');
            $('#myTabContent3').find('#l3').addClass('active');
            $('#myTab3').click();
        }
        $('#Removelinkedcontainersonexitfield').select2();
        $('#cAdvisorPageFrame').on('load', function () {
            $('#cadvisorloadingicon').hide();
        });
    });
    $('.Instances').click(function(e){
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li:lt(5)');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                //alert(getbreadcrumbulname);
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            DummyBreadCrumb += '>' + 'Instances';

            if(DummyBreadCrumb != null && DummyBreadCrumb != 'undefined'
            )
            {
                localStorage.removeItem("breadcrumb");
                splitBread = DummyBreadCrumb.split('>');
                if(splitBread.length > 0)
                {
                    $('#ribbon').find('.breadcrumb').find('li').detach();
                    for(var arraycount=0;arraycount< splitBread.length;arraycount++){
                        var liNew = document.createElement('li');
                        liNew.innerHTML = splitBread[arraycount];
                        $('#ribbon').find('.breadcrumb').append(liNew);
                    }
                }
            }
            //$('#ribbon').find('.breadcrumb').append('<li>"'+ DummyBreadCrumb'"</li>');
            //alert(DummyBreadCrumb);
        }

    });

    $('.Blueprints').click(function(e){
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li:lt(5)');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                //alert(getbreadcrumbulname);
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            DummyBreadCrumb += '>' + 'Blueprints';

            if(DummyBreadCrumb != null && DummyBreadCrumb != 'undefined')
            {
                localStorage.removeItem("breadcrumb");
                splitBread = DummyBreadCrumb.split('>');
                if(splitBread.length > 0)
                {
                    $('#ribbon').find('.breadcrumb').find('li').detach();
                    for(var arraycount=0;arraycount< splitBread.length;arraycount++){
                        var liNew = document.createElement('li');
                        liNew.innerHTML = splitBread[arraycount];
                        $('#ribbon').find('.breadcrumb').append(liNew);
                    }
                }
            }
            //$('#ribbon').find('.breadcrumb').append('<li>"'+ DummyBreadCrumb'"</li>');
            //alert(DummyBreadCrumb);
        }

    });

    $('.Orchestration').click(function(e){
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li:lt(5)');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                //alert(getbreadcrumbulname);
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            DummyBreadCrumb += '>' + 'Orchestration';

            if(DummyBreadCrumb != null && DummyBreadCrumb != 'undefined')
            {
                localStorage.removeItem("breadcrumb");
                splitBread = DummyBreadCrumb.split('>');
                if(splitBread.length > 0)
                {
                    $('#ribbon').find('.breadcrumb').find('li').detach();
                    for(var arraycount=0;arraycount< splitBread.length;arraycount++){
                        var liNew = document.createElement('li');
                        liNew.innerHTML = splitBread[arraycount];
                        $('#ribbon').find('.breadcrumb').append(liNew);
                    }
                }
            }
            //$('#ribbon').find('.breadcrumb').append('<li>"'+ DummyBreadCrumb'"</li>');
            //alert(DummyBreadCrumb);
        }

    });

    $('.Containers').click(function(e){
        //debugger;
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li:lt(5)');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                //alert(getbreadcrumbulname);
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            DummyBreadCrumb += '>' + 'Containers';

            if(DummyBreadCrumb != null && DummyBreadCrumb != 'undefined')
            {
                localStorage.removeItem("breadcrumb");
                splitBread = DummyBreadCrumb.split('>');
                if(splitBread.length > 0)
                {
                    $('#ribbon').find('.breadcrumb').find('li').detach();
                    for(var arraycount=0;arraycount< splitBread.length;arraycount++){
                        var liNew = document.createElement('li');
                        liNew.innerHTML = splitBread[arraycount];
                        $('#ribbon').find('.breadcrumb').append(liNew);
                    }
                }
            }
            //$('#ribbon').find('.breadcrumb').append('<li>"'+ DummyBreadCrumb'"</li>');
            //alert(DummyBreadCrumb);
        }

    });

    function setBreadCrumbAndViewOrchestration() {
        localStorage.setItem("SelectedClass","Orchestration");

        //var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li').length;
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                //alert(getbreadcrumbulname);
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            localStorage.setItem("breadcrumb", DummyBreadCrumb);
        }

        var getmyTab3selectedli = $('#myTab3').find('.pull-left.active');
        var getmyTab3selectedlilength = getmyTab3selectedli.length;
        //alert(getmyTab3selectedlilength);
        if(getmyTab3selectedlilength > 0){
            var myTabContent3 = $('#myTabContent3').find('tab-pane.active').innerHTML;
            //alert(myTabContent3);
        }
    }

    //event for orchatration tab show 
    $(function() {
        var $createTaskBtn = $('.createTaskLink');
        // var $instanceList = $('.instancesList');
        $('a[data-toggle="tab"][href="#l3"]').on('show.bs.tab', function() {
            var cardCount = $('.instancesList').find('.componentlistContainer:not(.stopped)').length;

            if (cardCount === 0) {
                $createTaskBtn[0].disabled = true;
            } else {
                $createTaskBtn[0].disabled = false;
            }
        });

    });

    $('.createTaskLink').click(function(e){
        setBreadCrumbAndViewOrchestration();

        window.location.href = 'index.html#ajax/assignTask.html?org='+urlParams.org+'&bg='+urlParams['bg']+'&projid='+urlParams['projid']+'&envid='+urlParams['envid'];
    });

    //for Table view
    $('#defaultViewButton').click(); //setting the detault view





    $('.dockerinstancestart').click(function(e){
        $('.instanceselectedfordocker').each(function(){
            if($(this).is(':checked')){

                var instid = $(this).closest('tr').attr('data-instanceid');
                if(instid)
                    var $that = $(this);
                var $td =$that.closest('td');
                var tdtext = $td.text();
                $td.find('.dockerspinner').detach();
                $td.find('.dockermessage').detach();
                $td.append('<img class="dockerspinner" style="margin-left:5px" src="img/select2-spinner.gif"></img>');
                $td.attr('title','Pulling in Images');
                var imagename = $('.productdiv1.role-Selected1').first().attr('dockercontainerpaths');
                var repotag = $('.productdiv1.role-Selected1').find('.dockerrepotagselect').first().val();

                var repopath = $('.productdiv1.role-Selected1').first().attr('dockerreponame');

                // var dockerlaunchparameters = $('.productdiv1.role-Selected1').first().attr('dockerlaunchparameters');
                var dockerlaunchparameters = generateDockerLaunchParams();
                if(!dockerlaunchparameters)
                    dockerlaunchparameters = 'null';
                var lp = 'null'; //launch parameter
                var sp = 'null'; //start parameter
                if(dockerlaunchparameters)
                {
                    if(dockerlaunchparameters[0])
                        lp = dockerlaunchparameters[0];
                    if(dockerlaunchparameters[1])
                        sp = dockerlaunchparameters[1];
                }
                // alert(lp + ' ' + sp);
                // alert('../instances/dockerimagepull/' + instid + '/' + repopath + '/' + encodeURIComponent(imagename) + '/' + repotag + '/' + encodeURIComponent(lp) + '/' + encodeURIComponent(sp));
                $.get('../instances/dockerimagepull/' + instid + '/' + repopath + '/' + encodeURIComponent(imagename) + '/' + repotag + '/' + encodeURIComponent(lp) + '/' + encodeURIComponent(sp),function(data){
                    if(data == "OK"){
                        var $statmessage = $td.find('.dockerspinner').parent();
                        $td.find('.dockerspinner').detach();
                        $td.find('.dockermessage').detach();
                        $statmessage.append('<span style="margin-left:5px;text-decoration:none" class="dockermessage">Pull done</span>');
                        //Updating instance card to show the docker icon.
                        $dockericon = $('<img src="img/galleryIcons/Docker.png" alt="Docker" style="width:42px;height:42px;margin-left:32px;" class="dockerenabledinstacne"/>');
                        //find the instance card - to do instance table view update
                        var $instancecard = $('div[data-instanceid="' + instid + '"]');
                        if($instancecard.find('.dockerenabledinstacne').length <= 0){
                            $instancecard.find('.componentlistContainer').first().append($dockericon);
                        }
                        //debugger;
                        loadContainersTable(); //Clearing and loading the containers again.                
                    }
                    else
                    {
                        var $statmessage = $('.dockerspinner').parent();
                        $('.dockerspinner').detach();
                        $td.find('.dockermessage').detach();
                        $statmessage.append('<span style="margin-left:5px;color:red" title="' + data + '"  class="dockermessage"><i class="fa  fa-exclamation"></i></span>');
                    }
                });
            }
        });
    });

    $('#importPemfileInput').change(function(){
        //console.log(this.files);
        $(this).next().val(this.files[0].name);
    });

    $('#modalContainerimportInstance').on('show.bs.modal',function(e){
        $('#addInstanceBtn').removeAttr('disabled');
        //$('#addInstanceForm').get(0).reset();
        var _org = getUrlParameter('org');
        $.get('/d4dMasters/readmasterjsonnew/10',function(data){
            if(data && JSON.parse(data).length <= 0){
                $('#modalContainerimportInstance').modal('hide');
                alert('A chef server is required to import an instance. Use settings to add a new one.');
                return false;
            }
            else
            {
                var found = false;
                JSON.parse(data).forEach(function(k,v){
                    var kt = Object.keys(k);

                    if(k['orgname_rowid'] == _org){
                        found = true;
                    }
                });

                if(!found){
                    $('#modalContainerimportInstance').modal('hide');
                    alert('A chef server is required to import an instance. Use settings to add a new one.');
                }
            }
            importbyipusers();
        });
    });

    function importbyipusers(){

        var $loadingContainer = $('.userListLoadingContainer').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />').show();
        $.get('../users',function(userList){
            userList = JSON.parse(userList);
            var $importbyipuserListSelect = $('#importbyipuserListSelect').empty();
            userList.sort(function(a, b){
                var keyA =Object.keys(a);
                var keyB =Object.keys(b);

                if(keyA[0] < keyB[0]) return -1;
                if(keyA[0] > keyB[0]) return 1;
                return 0;
            });
            for(var i=0;i<userList.length;i++) {
                var keys = Object.keys(userList[i]);
                var $option = $('<option></option>').append(keys[0]).val(keys[0]);
                $importbyipuserListSelect.append($option);
            }
            $loadingContainer.hide();
            $importbyipuserListSelect.show();
        }).error(function(){
            $loadingContainer.empty().append('Unable to load users. Please try again later.');
        });
    }

    //$('#addInstanceBtn').click(function(e) {
    $("#addInstanceForm").submit( function(e) {
        var ipAddresRegExp=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/; var hostname=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/;

        var $spinner = $('#nodeimportipspinner').addClass('hidden');
        var $result = $('#nodeimportipresultmsg').addClass('hidden');
        var reqBody = {};
        var $form = $('#addInstanceForm');
        reqBody.fqdn = $form.find('#instanceFQDN').val();
        reqBody.os = $form.find('#importinstanceOS').val();
        reqBody.users = $('#importbyipuserListSelect').val();
        reqBody.credentials = {
            username: $form.find('#instanceUsername').val()
        };

        if(!reqBody.fqdn) {
            alert('Please enter IP');
            e.preventDefault();
            return false;
        }
        if(!reqBody.fqdn.match(ipAddresRegExp) || !reqBody.fqdn.match(hostname)){
            alert("Please provide a valid IP Address or Hostname");
            e.preventDefault();
            return false;
        }

        if(!reqBody.users) {
            alert('Please assign atleast one user');
            e.preventDefault();
            return false;
        }
        if(!reqBody.os) {
            alert('Please choose OS');
            e.preventDefault();
            return false;
        }

        function makeRequest() {
            $('#addInstanceBtn').attr('disabled','disabled');
            $spinner.removeClass('hidden');
            // $('#addInstanceBtn').attr('disabled','disabled');
            $.post('../organizations/'+urlParams.org+'/businessgroups/'+urlParams['bg']+'/projects/'+urlParams.projid+'/environments/'+urlParams.envid+'/addInstance',reqBody,function(data){
                $('#tabInstanceStatus').hide();
                addInstanceToDOM(data);

                $spinner.addClass('hidden');
                $result.addClass('hidden');
                $('#addInstanceBtn').removeAttr('disabled');
                $('#addInstanceForm').get(0).reset();
                $('#importinstanceOS').change();
                $('#pemFileDropdown').change();
                var $divinstancescardview = $('#divinstancescardview');
                if ($divinstancescardview.find('li').length > 0) {
                    $divinstancescardview.find('li').first().find('.flip-toggle').trigger('click');
                }
                $divinstancescardview.find('.item').first().addClass('active');
                $('#modalContainerimportInstance').modal('hide');
                //Updating the tree
                //loadTreeFuncNew();
                console.log('success---3---3');
                //selectFirstEnv();
                //selectAnyEnviornment(urlParams.org,urlParams.envid);
                $('.domain-roles-caption[data-instanceId="' + data._id + '"]').find('.moreInfo').click();
            }).fail(function(jxhr){
                $spinner.addClass('hidden');
                $result.empty();
                $result.css({color:'red'});
                if(jxhr.status === 400) {
                    if(jxhr.responseJSON) {
                        $result.html(jxhr.responseJSON.message);
                    } else {
                        $result.html("Invalid request");
                    }
                } else {
                    $result.html("Server Behaved Unexpectedly");
                }
                $result.removeClass('hidden');
                $('#addInstanceBtn').removeAttr('disabled');

            });

        }

        var $dropdown = $('#pemFileDropdown');
        if ($dropdown.val()==='pemFile') {

            var pemFileInput = $form.find('#importPemfileInput').get(0);
            if(!reqBody.credentials.username){
                alert('Please Enter Username');
                e.preventDefault();
                return false;
            }
            if(!pemFileInput.files.length) {
                alert('Please Choose a Pem file');
                e.preventDefault();
                return false;
            }
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = function(e) {
                // Render thumbnail.
                reqBody.credentials.pemFileData = e.target.result;

                makeRequest();

            };
            // Read in the image file as a data URL.

            reader.readAsText(pemFileInput.files[0]);
        } else {
            reqBody.credentials.password = $form.find('#instancePassword').val();
            if(!reqBody.credentials.password) {
                alert("Please enter password");
                e.preventDefault();
                return false;
            }
            makeRequest();
        }

        e.preventDefault();
        return false;

    });// end form.submit


    /**
     * Loading tasks, instances blueprints and creating html
     *
     */
    $(function() {

        function initializeTaskArea(data) {
            if (!$.fn.dataTable.isDataTable('#tableOrchestration') ){
                //var $taskListArea = $('.taskListArea').empty();
                $taskDatatable =  $('#tableOrchestration').DataTable({
                    "pagingType": "full_numbers",
                    "aoColumns": [
                        null,{
                            "bSortable": false
                        },
                        {
                            "bSortable": false
                        },
                        {
                            "bSortable": false
                        }, null,
                        {
                            "bSortable": false
                        }
                    ]

                });
            }


            for (var i = 0; i < data.length; i++) {
                var $tr = $('<tr></tr>').attr('data-taskId', data[i]._id);
                var $tdName = $('<td></td>').append(data[i].name);
                $tr.append($tdName);
                var $tdNodeList = $('<td></td>').append('<a rel="tooltip" data-placement="top" data-original-title="Assigned Nodes" data-toggle="modal" class="btn btn-primary btn-sg tableactionbutton"><i class="ace-icon fa fa-sitemap fa-14x"></i></a>');
                $tdNodeList.find('a').data('nodeList', data[i].nodesIdList).click(function(e) {
                    $.post('../instances/', {
                        instanceIds: $(this).data('nodeList')
                    }, function(instances) {
                        var $taskNodeListContainer = $('.taskNodeListContainer').empty();
                        for (var i = 0; i < instances.length; i++) {
                            var $tr = $('<tr></tr>').css({
                                'line-height': '2.1'
                            });
                            var $tdInstanceName = $('<td></td>').append(instances[i].chef.chefNodeName).css({
                                'font-size': '12px'
                            });
                            var $tdInstanceIp = $('<td></td>').append(instances[i].instanceIP).css({
                                'font-size': '12px'
                            });
                            var $tdInstanceStatus = $('<td></td>').append(instances[i].instanceState).css({
                                'font-size': '12px'
                            });
                            $tr.append($tdInstanceName).append($tdInstanceIp).append($tdInstanceStatus);
                            $taskNodeListContainer.append($tr);
                        }
                        $('#assignedNode').modal('show');
                    });
                });
                $tr.append($tdNodeList);

                var $tdRunlist = $('<td></td>').append('<a rel="tooltip" data-placement="top" data-original-title="Assigned Runlists" data-toggle="modal" href="#assignedRunlist" class="btn btn-primary btn-sg tableactionbutton"><i class="ace-icon fa fa-list-ul bigger-120"></i></a>');
                $tdRunlist.find('a').data('taskRunlist', data[i].runlist).click(function(e) {
                    var $taskRunListContainer = $('.taskRunListContainer').empty();
                    var runlist = $(this).data('taskRunlist');
                    if (runlist && runlist.length) {
                        for (var i = 0; i < runlist.length; i++) {
                            $li = $('<li></li>').append(runlist[i]).css({
                                "font-size": "12px"
                            });
                            $taskRunListContainer.append($li);
                        }
                    }
                    $('#assignedRunlist').modal('show');
                });
                $tr.append($tdRunlist);

                var $tdExecute = $('<td></td>').append('<a rel="tooltip" data-placement="top" data-original-title="Execute" data-toggle="modal" href="#assignedExecute" class="btn btn-primary btn-sg tableactionbutton"><i class="ace-icon fa fa-play bigger-120"></i></a>');
                $tdExecute.find('a').data('taskId', data[i]._id).click(function(e) {
                    var taskId = $(this).data('taskId');
                    var $taskExecuteTabsHeaderContainer = $('#taskExecuteTabsHeader').empty();
                    var $taskExecuteTabsContent = $('#taskExecuteTabsContent').empty();
                    $.get('../tasks/' + taskId + '/run', function(data) {
                        var instances = data.instances;
                        var date = new Date().setTime(data.timestamp);
                        var taskTimestamp = new Date(date).toUTCString(); //converts to human readable strings
                        $('tr[data-taskId="'+taskId+'"] .taskrunTimestamp').html(taskTimestamp);
                        for (var i = 0; i < instances.length; i++) {
                            var $liHeader = $('<li><a href="#tab_' + instances[i]._id + '" data-toggle="tab" data-taskInstanceId="' + instances[i]._id + '">' + instances[i].chef.chefNodeName + '</a></li>');
                            if (i === 4) {
                                var $liMoreHeader = $('<li class="dropdown dropdownlog"><a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown">More... <b class="caret"></b></a><ul class="dropdown-menu"></ul></li>');

                                $taskExecuteTabsHeaderContainer.append($liMoreHeader);

                                $taskExecuteTabsHeaderContainer = $liMoreHeader.find('ul');

                            }

                            $taskExecuteTabsHeaderContainer.append($liHeader);

                            var $tabContent = $('<div class="tab-pane fade" id="tab_' + instances[i]._id + '"><div class="taskLogArea" style="height:400px !important;overflow: scroll;padding-left: 20px;"></div></div>');

                            $taskExecuteTabsContent.append($tabContent);


                        }
                        //shown event



                        $('#taskExecuteTabsHeader').find('a[data-toggle="tab"]').each( function(e) {
                            $(this).attr('data-taskPolling', 'true');
                            $(this).attr('data-taskPollLastTimestamp', new Date().getTime());
                            var tabId = $(this).attr('href')
                            pollTaskLogs($(this), $(tabId), null, 0, false);
                            //e.relatedTarget // previous active tab
                        });

                        $('#taskExecuteTabsHeader').find('a[data-toggle="tab"]').on('hidden.bs.tab', function(e) {
                            $(e.target).attr('data-taskPolling', 'true');
                            //e.relatedTarget // previous active tab
                        }).first().click();

                        $('#assignedExecute').modal('show');



                    });



                });
                $tr.append($tdExecute);
                var timestamp = "-";
                if (data[i].lastRunTimestamp) {
                    var date = new Date().setTime(data[i].lastRunTimestamp);
                    timestamp = new Date(date).toUTCString(); //converts to human readable strings
                }

                var $tdTime = $('<td></td>').append(timestamp).addClass('taskrunTimestamp');
                $tr.append($tdTime);

                var $tdOptions = $('<td></td>').append('<div class="btn-group tableactionWidth"><a rel="tooltip" data-placement="top" data-original-title="Remove" class="btn btn-danger pull-left btn-sg tableactionbutton btnDeleteTask"><i class="ace-icon fa fa-trash-o bigger-120"></i></a><a class="btn btn-info pull-left tableactionbutton btnEditTask tableactionbuttonpadding btn-sg" data-original-title="Edit" data-placement="top" rel="tooltip"><i class="ace-icon fa fa-pencil bigger-120"></i></a></div>').attr('data-taskId', data[i]._id);
                $tdOptions.find('.btnDeleteTask').click(function(e) {
                    var taskId = $(this).parents('td').attr('data-taskId');
                    var that = this;
                    $.ajax({
                        url: '../tasks/' + taskId,
                        method: 'DELETE',
                        success: function(data) {
                            //$(that).parents('tr').remove();
                            //var totalTask = $taskListArea.children('tr').length;
                            //$('.taskListFooter').text('Showing ' + totalTask + ' of ' + totalTask + ' entries');
                            $taskDatatable.row($(that).parents('tr')).remove().draw( false );
                        }
                    })
                });
                $tdOptions.find('.btnEditTask').click(function(e) {
                    setBreadCrumbAndViewOrchestration();

                    var taskId = $(this).parents('td').attr('data-taskId');

                    window.location.href = 'index.html#ajax/assignTask.html?org=' + urlParams.org + '&bg='+urlParams['bg']+'&projid=' + urlParams['projid'] + '&envid=' + urlParams['envid'] + '&taskId=' + taskId;

                });
                $tr.append($tdOptions);

                $taskDatatable.row.add($tr).draw();
                //$taskListArea.append($tr);

                //aaaa
                if($("#sorttableheader").length){
                    //alert(1);
                    $("#sorttableheader").tablesorter();
                }
                //     $("#sorttableheader").tablesorter(); 
                pageSetUp();

            }

            function pollTaskLogs($tabLink, $tab, timestamp, delay, clearData) {
                var instanceId = $tabLink.attr('data-taskInstanceId');
                var timestamp = $tabLink.attr('data-taskPollLastTimestamp');
                var poll = $tabLink.attr('data-taskPolling');

                if (poll !== 'true') {
                    console.log('not polling');
                    return;
                }


                var url = '../instances/' + instanceId + '/logs';
                if (timestamp) {
                    url = url + '?timestamp=' + timestamp;
                }

                timeout = setTimeout(function() {
                    $.get(url, function(data) {
                        var $modalBody = $tab.find('.taskLogArea')
                        if (clearData) {
                            $modalBody.empty();
                        }
                        var $table = $('<div></div>');

                        for (var i = 0; i < data.length; i++) {
                            var $rowDiv = $('<div class="row"></div>');
                            var timeString = new Date().setTime(data[i].timestamp);
                            var date = new Date(timeString).toUTCString(); //converts to human readable strings
                            $rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));

                            if (data[i].err) {
                                $rowDiv.append($('<div class="col-lg-7 col-sm-7" style="color:red;"></div>').append('<span style="width:100%">' + data[i].log + '</span>'));
                            } else {
                                $rowDiv.append($('<div class="col-lg-7 col-sm-7 " style="color:DarkBlue;"></div>').append('<span style="width:100%">' + data[i].log + '</span>'));
                            }

                            $table.append($rowDiv);
                            $table.append('<hr/>');

                        }


                        if (data.length) {
                            lastTimestamp = data[data.length - 1].timestamp;
                            console.log(lastTimestamp);
                            $modalBody.append($table);
                            $modalBody.scrollTop($modalBody[0].scrollHeight + 100);
                            $tabLink.attr('data-taskPollLastTimestamp', data[data.length - 1].timestamp);

                        }


                        console.log('polling again');
                        if ($tabLink.attr('data-taskPolling') === 'true' && $('#assignedExecute').data()['bs.modal'].isShown) {

                            pollTaskLogs($tabLink, $tab, $tabLink.attr('data-taskPollLastTimestamp'), 1000, false);

                        } else {
                            console.log('not polling again');
                        }
                    });
                }, delay);
            }

            //updating footer 
            $('.taskListFooter').text('Showing ' + data.length + ' of ' + data.length + ' entries');
            pageSetUp();
        };



        function initializeBlueprintArea(data) {

            var $AppFactpanelBody = $('.appFactoryPanel').find('.panel-body');
            $AppFactpanelBody.empty();

            var $devopsRolepanelBody = $('.devopsRolePanel').find('.panel-body');
            $devopsRolepanelBody.empty();

            var $desktopProvisioningPanelBody = $('.desktopProvisioningPanel').find('.panel-body');
            $devopsRolepanelBody.empty();

            //alert(orgId + "/" + projectId + "/" + envId + data.length);

            //Displaying the Template Types.
            $.get("/d4dMasters/readmasterjsonnew/16", function(tdata) {
                tdata = JSON.parse(tdata);
                var rowLength = tdata.length;
                //alert(rowLength);
                var $containerTemp = "";
                var selectedrow = false;
                var getDesignTypeImg;
                var getDesignTypeRowID;
                var getDesignTypeName;
                $('#accordion-2').empty();
                console.log(tdata);
                for (var i = 0; i < rowLength; i += 1) {
                    getDesignTypeImg = tdata[i]['designtemplateicon_filename'];
                    getDesignTypeRowID = tdata[i]['rowid'];
                    getDesignTypeName = tdata[i]['templatetypename'];
                    // for (var x = 0; x < tdata.masterjson.rows.row[i].field.length; x++) {
                    //     if (tdata.masterjson.rows.row[i].field[x].name == "rowid") {
                    //         getDesignTypeRowID = tdata.masterjson.rows.row[i].field[x].values.value;
                    //     }
                    //     if (tdata.masterjson.rows.row[i].field[x].name == "designtemplateicon_filename") {
                    //         getDesignTypeImg = tdata.masterjson.rows.row[i].field[x].values.value;

                    //     }
                    //     if (tdata.masterjson.rows.row[i].field[x].name == "templatetypename") {
                    //         getDesignTypeName = tdata.masterjson.rows.row[i].field[x].values.value;

                    //     }
                    // }
                    //Extracting the TT definitions. Add New Template types
                    var $currRolePanel = null;
                    //alert(getDesignTypeName);
                    switch (getDesignTypeName) {
                        case "AppFactory":
                            $AppFactpanelBody = $('<div class="panel-body AppFactory"></div>');
                            $currRolePanel = $AppFactpanelBody;
                            break;
                        case "DevopsRoles":
                            $DevopsRolespanelBody = $('<div class="panel-body DevopsRoles"></div>');
                            $currRolePanel = $DevopsRolespanelBody;
                            break;
                        case "CloudFormation":
                            $CloudFormationBody = $('<div class="panel-body CloudFormation"></div>');
                            $currRolePanel = $CloudFormationBody;
                            break;
                        case "Docker":
                            $DockerpanelBody = $('<div class="panel-body Docker"></div>');
                            $currRolePanel = $DockerpanelBody;
                            break;
                        case "Desktop":
                            $DesktopProvisioningPanelBody = $('<div class="panel-body Desktop"></div>');
                            $currRolePanel = $DesktopProvisioningPanelBody;
                            break;
                        case "Environment":
                            $EnvironmentpanelBody = $('<div class="panel-body Environment"></div>');
                            $currRolePanel = $EnvironmentpanelBody;
                            break;

                    }


                    $containerTemp = '<div class="panel panel-default blueprintContainer hidden">' +
                    '<div class="panel-heading">' +

                    '<h4 class="panel-title">' +
                    '<a href="#collapse' + i + '" data-parent="#accordion-2" data-toggle="collapse" class="collapsed"> ' +
                    '<i class="fa fa-fw fa-plus-circle txt-color-blue"></i> ' +
                    '<i class="fa fa-fw fa-minus-circle txt-color-red"></i>' + getDesignTypeName + '</a>' +
                    '</h4></div><div class="panel-collapse collapse" id="collapse' + i + '">' +
                    '<div class="panel-body ' + getDesignTypeName + '"></div>' +
                    '</div>';
                    // $($containerTemp).find('#collapse' + i).append($currRolePanel);
                    /*if($('#accordion-2').find('#collapse' + i).length > 0){
                     alert('in');
                     $('#accordion-2').find('#collapse' + i).first().append($containerTemp);
                     }*/
                    $('#accordion-2').append($containerTemp);

                }
                //To fix template id and template type
                // alert('in' + data.length);
                for (var i = 0; i < data.length; i++) {
                    //alert(JSON.stringify(data[i]));
                    //Find a panel-body with the template type class
                    var $currRolePanel = $('#accordion-2').find('.' + data[i].templateType);
                    //   alert($currRolePanel.length);
                    if ($currRolePanel.length > 0) {
                        var $itemContainer = $('<div></div>').addClass("productdiv4");

                        var $itemBody = $('<div></div>').addClass('productdiv1 cardimage').attr('data-blueprintId', data[i]._id).attr('data-projectId', data[i].projectId).attr('data-envId', data[i].envId).attr('data-chefServerId', data[i].chefServerId).attr('data-templateType', data[i].templateType);
                        var $ul = $('<ul></ul>').addClass('list-unstyled system-prop').css({
                            'text-align': 'center'
                        });
                        var $img
                        if (data[i].iconpath)
                            $img = $('<img />').attr('src', data[i].iconpath).attr('alt', data[i].name).addClass('cardLogo');
                        else
                            $img = $('<img />').attr('src', '').attr('alt', data[i].name).addClass('cardLogo');
                        var $liImage = $('<li></li>').append($img);
                        $ul.append($liImage);

                        var $liCardName = $('<li title="' + data[i].name + '"></li>').addClass('Cardtextoverflow').html('<u><b>' + data[i].name + '</b></u>');

                        $ul.append($liCardName);
                        var $selecteditBtnContainer = $('<div style="position:absolute;padding-left:27px;bottom:11px;"></div>');
                        if (data[i].versionsList) {
                            var $selectVerEdit = $('<a style="padding:0px 4px;margin-left:3px;border-radius:5px;" class="bpEditBtn"><i class="ace-icon fa fa-pencil"></i></a>').addClass('btn btn-primary').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'Edit');
                            var $selectVer = null;
                            var tagLabel = '';
                            //Docker Check
                            if (data[i].templateType == "Docker") {
                                console.log("data[i}" + JSON.stringify(data[i]));
                                //$selectVer = $('<select style="padding:1px;"></select>').addClass('blueprintVersionDropDown').attr('data-blueprintId', data[i]._id);
                                $selectVer = $('<select style="padding:1px;margin-right:5px;"></select>').addClass('dockerrepotagselect').attr('data-blueprintId', data[i]._id);
                                $itemBody.attr('dockerreponame', data[i].dockerreponame);
                                $itemBody.attr('dockerrepotags', data[i].dockerrepotags);
                                $itemBody.attr('dockercontainerpaths', data[i].dockercontainerpaths);

                                if(data[i].dockerlaunchparameters)
                                    $itemBody.attr('dockerlaunchparameters', 't ' + data[i].dockerlaunchparameters);
                                var $liDockerRepoName = $('<li title="Docker Repo Name" ><i class="fa fa-check-square" style="padding-right:5px"/>' + data[i].dockerreponame + '</li>');
                                $ul.append($liDockerRepoName);
                                if (data[i].dockerrepotags && data[i].dockerrepotags != '') {
                                    $selectVer.empty();
                                    var dockerrepostags = data[i].dockerrepotags.split(',');
                                    $.each(dockerrepostags, function(k) {
                                        $selectVer.append('<option value="' + dockerrepostags[k] + '">' + dockerrepostags[k] + '</option>');
                                    });
                                }

                                $selectVerEdit.hide();
                                tagLabel = '<span>Tags&nbsp;</span';
                                //alert(JSON.stringify(data[i]));
                            } else {
                                $selectVer = $('<select style="padding:1px;padding-left:5px;"></select>').addClass('blueprintVersionDropDown').attr('data-blueprintId', data[i]._id);
                                $selectVerEdit.click(function(e) {

                                    var $parent = $(this).parents('.cardimage');
                                    var $blueprintEditResultContainer = $('#blueprintEditResultContainer');


                                    $blueprintEditResultContainer.modal('show');

                                    var projectId = $parent.attr('data-projectId');
                                    var envId = $parent.attr('data-envId');
                                    var blueprintId = $parent.attr('data-blueprintId');
                                    var chefServerId = $parent.attr('data-chefServerId');
                                    var version = $parent.find('.blueprintVersionDropDown').val();
                                    $.get('../blueprints/' + blueprintId + '/versions/' + version, function(versionData) {
                                        console.log('blueprint data', versionData);
                                        var $ccrs = $chefCookbookRoleSelector(urlParams.org, function(data) {

                                        }, versionData.runlist);
                                        $ccrs.find('.deploymentSelectedRunList').attr('data-blueprintId', blueprintId);
                                        $blueprintEditResultContainer.find('.modal-body').empty().append($ccrs);


                                    }).error(function() {
                                        $blueprintEditResultContainer.find('.modal-body').empty();
                                        $blueprintEditResultContainer.find('.modal-body').append('<span>Oops! Something went wrong. Please try again later</span>');
                                    });

                                });
                            }
                            var $li = $('<li></li>').css({
                                "font-size": '10px'
                            }).append(tagLabel, $selectVer, $selectVerEdit);
                            if($selectVer.attr('class').indexOf('dockerrepotagselect') < 0)
                            {
                                for (var j = 0; j < data[i].versionsList.length; j++) {
                                    var $options = $('<option></option>').append(data[i].versionsList[j].ver).val(data[i].versionsList[j].ver);
                                    $selectVer.append($options);
                                }
                            }
                            $selecteditBtnContainer.append($li);
                        }
                        $itemBody.append($ul);
                        $itemBody.append($selecteditBtnContainer);
                        $itemContainer.append($itemBody);

                        //Find the template type container and add to it.
                        //var $currpanel = $('#accordion-2').find('div[".' +  data[i].templateType + '"]').first();
                        //alert($currpanel.length);
                        $currRolePanel.append($itemContainer);
                        //enabling the bluepintContiner div when item added.
                        $currRolePanel.closest('.blueprintContainer').removeClass('hidden');
                        // alert($currRolePanel.html());
                        $currRolePanel.parent().parent().show();
                        //Attaching the selection event.
                        if (i == (data.length - 1)) {
                            var $productdiv1 = $('.productdiv1');

                            $productdiv1.click(function(e) {

                                $productdiv1.removeClass('role-Selected1');
                                $(this).addClass('role-Selected1');
                            });
                        }

                    }
                }

                // $("#myTabContent3").append(containerTemp);   
                // $("#templateContent #grid0").addClass("role-Selected");
                if ($('#accordion-2').length > 0) {
                    console.log('object ==>', $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a'));
                    $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a').click();
                }
                pageSetUp();
            }); //end of readmasterjson to be pushed to the end of the function.

            $('#accordion-2').on('show.bs.collapse', function(e) {
                console.log(e.target);
                $(e.target).find('.productdiv1').first().click();
            });
            //Expanding the fist Accordion.
        };

        function initializeInstanceArea(data) {
            //alert('starting');
            if(data.length) {
                $('#tabInstanceStatus').hide();
            }

            //var $instancesList = $('.instancesList').empty();
            if (!$.fn.dataTable.isDataTable('#tableinstanceview')) {
                //alert('loading table');
                tableinstanceview = $('#tableinstanceview').DataTable({
                    "pagingType": "full_numbers",
                    "aoColumns": [
                        null, {
                            "bSortable": false
                        },
                        null,
                        null, {
                            "bSortable": false
                        }, {
                            "bSortable": false
                        }, {
                            "bSortable": false
                        }, {
                            "bSortable": false
                        }, {
                            "bSortable": false
                        }, {
                            "bSortable": false,
                            "sWidth": "20%"
                        }
                    ],
                    "fnRowCallback": function(nRow, aData, iDisplayIndex) {
                        $("td:first", nRow).html(iDisplayIndex + 1);
                        return nRow;
                    }

                });
            }


            for (var i = 0; i < data.length; i++) {

                addInstanceToDOM(data[i]);

            }



            $('#tableinstanceview tbody tr').eq(0).addClass("rowcustomselected");

            function tableupdownRow(evt) {
                evt = evt || window.event;
                var key = evt.keyCode;
                switch (key) {
                    case 38: // UP arrow
                        var $selectedRowPre = $('#tableinstanceview tbody').find(".rowcustomselected");
                        if ($('#tableinstanceview tbody').find(".rowcustomselected").prev().length == 1) {
                            var $newSelectedRowPre = $('#tableinstanceview tbody').find(".rowcustomselected").prev();
                            $newSelectedRowPre.addClass('rowcustomselected');
                            $selectedRowPre.removeClass('rowcustomselected');
                            break;
                        }
                        break;
                    case 40: // DOWN arrow
                        var $selectedRow = $('#tableinstanceview tbody').find(".rowcustomselected");
                        if ($('#tableinstanceview tbody').find(".rowcustomselected").next().length == 1) {
                            var $newSelectedRow = $('#tableinstanceview tbody').find(".rowcustomselected").next();
                            $newSelectedRow.addClass('rowcustomselected');
                            $selectedRow.removeClass('rowcustomselected');
                            break;
                        }
                        break;
                }
            }
            document.onkeydown = tableupdownRow;
            $('#tableinstanceview tbody').on('click', 'tr', function() {
                if ($(this).hasClass('rowcustomselected')) {
                    $(this).removeClass('rowcustomselected');
                } else {
                    tableinstanceview.$('tr').removeClass('rowcustomselected');
                    $(this).addClass('rowcustomselected');
                }

            });



            var $divinstancescardview = $('#divinstancescardview');
            if ($divinstancescardview.find('li').length > 0) {
                //Arab
                var cardIndexInfo = localStorage.getItem("cardIndex");

                if(cardIndexInfo) {
                    var li = $divinstancescardview.find('li').get(cardIndexInfo);
                    //console.log('container ==>',li);
                    if(li) {
                        $(li).find('.flip-toggle').trigger('click');
                    } else {
                        $divinstancescardview.find('li').first().find('.flip-toggle').trigger('click');
                    }

                } else {
                    $divinstancescardview.find('li').first().find('.flip-toggle').trigger('click');
                }
            }
            $divinstancescardview.find('.item').first().addClass('active');

            loadContainersTable();

            $(".appFactoryPanel").find(".productdiv1").first().trigger('click');

        }

        $.get('../organizations/' + orgId + '/businessgroups/' + urlParams['bg'] + '/projects/' + projectId + '/environments/' + envId + '/', function(data) {
            console.log('success---3---4');
            /*selecting the environment which is already having values in the url intstead of the 1st*/
            /* selectAnyEnviornment();
             if ($('#tree').find('a[itemtype="env"]').length <= 0) {
             $('#content').addClass('hidden');
             $('#noenvwarning').removeClass('hidden');
             $('ol.breadcrumb').addClass('hidden');
             } else {
             $('#content').removeClass('hidden');
             $('#noenvwarning').addClass('hidden');
             $('ol.breadcrumb').removeClass('hidden');
             }*/

            //Syncing up the tree view based on url
            initializeBlueprintArea(data.blueprints);
            initializeTaskArea(data.tasks);
            initializeInstanceArea(data.instances);

        });

        // if (orgId && urlParams['bg'] && projectId && envId) {

        // } else {
        //     selectFirstEnv();
        //     if ($('#tree').find('a[itemtype="env"]').length <= 0) {
        //         $('#content').addClass('hidden');
        //         $('#noenvwarning').removeClass('hidden');
        //         $('ol.breadcrumb').addClass('hidden');
        //     } else {
        //         $('#content').removeClass('hidden');
        //         $('#noenvwarning').addClass('hidden');
        //         $('ol.breadcrumb').removeClass('hidden');
        //     }
        // }
    });
    function generateDockerLaunchParams(){
        if($('#Containernamefield').val() == ''){
            $('.dockerparamrequired').removeClass('hidden');
            return('');
        }

        var launchparams = [];
        var preparams = '';
        var startparams = '';
        $('[dockerparamkey]').each(function(){
            if($(this).val() != ''){
                var itms = $(this).val().split(',');
                for(itm in itms)
                {
                    if($(this).attr('dockerparamkey') != '-c') //checking for start parameter
                        preparams += ' ' + $(this).attr('dockerparamkey') + ' ' + itms[itm];
                    else
                        startparams += ' ' + itms[itm];
                }
                launchparams[0] = preparams;
                launchparams[1] = startparams;
            }
        });
        return(launchparams);
    }

    function loadLaunchParams(){
        var lparam =  $('.productdiv1.role-Selected1').first().attr('dockerlaunchparameters');
        if(lparam != ''){
            $('[dockerparamkey]').val(''); //clearing the popup input boxes
            //split by -c to get startup and other parameters
            var preparams = lparam.split('-c');
            var cparams = ''; //this is the startup parameters
            if(preparams.length > 1){
                lparam = preparams[0];
                cparams = preparams[1];
            }
            console.log(lparam + ' ' + cparams);
            var params = lparam.split(' -');
            for(para in params){
                var subparam = params[para].split(' ');
                if(subparam.length > 0){
                    $inp = $('[dockerparamkey="-' + subparam[0] + '"]').first();
                    if($inp.val() != '')
                        $inp.val($inp.val() + ',' + subparam[1]);
                    else
                        $inp.val(subparam[1]);
                }
                //alert(params[para]);
            }
            //Updating the startup parameter
            $('[dockerparamkey="-c"]').first().val(cparams);
        }
        else
            $('[dockerparamkey]').val('');
        $('#myModalLabelDockerContainer').modal('show');
    }


    $(document).ready(function(){
        //Expanding the first accordion

        //alert($('#accordion-2').find('a').first().html());
        $('.dockerrepotagselect').parent().prepend('Tags&nbsp;');

        $('#rootwizard').bootstrapWizard({
            'tabClass': 'nav nav-pills',
            'onNext': function(tab, navigation, index) {

                $('.dockerinstancestart').first().removeClass('hidden');
                var $valid = $("#commentForm").valid();
                if(!$valid) {
                    $validator.focusInvalid();
                    return false;
                }
            },
            'onPrevious' : function(tab,navigation,index){
                $('.dockerinstancestart').first().addClass('hidden');
            }

        });
    });

    function getCssClassFromStatus(status) {
        var cssClasses = {

        };
        switch (status) {

            case 'running':
                cssClasses.ringClass = 'started';
                cssClasses.textClass = 'instance-state-text-started';
                cssClasses.tableViewStatusClass = "started";
                break;

            case 'stopped':
                cssClasses.ringClass = 'stopped';
                cssClasses.textClass = 'instance-state-text-stopped';
                cssClasses.tableViewStatusClass = "stopped";
                break;

            case 'terminated':
                cssClasses.ringClass = 'stopped';
                cssClasses.textClass = 'instance-state-text-stopped';
                cssClasses.tableViewStatusClass = "stopped";
                break;

            default:
                cssClasses.ringClass = 'pending';
                cssClasses.textClass = 'instance-state-text-pending';
                cssClasses.tableViewStatusClass = "pending";

        }

        return cssClasses;
    }

    function removeSelectedInstance(){
        var instanceId = null;
        var blueprintName = null;
        if ($('#divinstancescardview').is(':visible')) {
            var $selectedCard = $('.container.role-Selectedcard').find('.domain-roles-caption');
            instanceId = $selectedCard.attr('data-instanceid');
            blueprintName = $selectedCard.attr('data-blueprintName');
        } else if ($('#divinstancestableview').is(':visible')) {
            var $selectedRow = $('#tableinstanceview').find('tr.rowcustomselected');
            instanceId=$selectedRow.attr('data-instanceId');
            blueprintName = $selectedRow.attr('data-blueprintName');
        } else {
            instanceId = null;
        }
        if(instanceId){
            //found now delete
            var dialog = bootbox.dialog({
                title: "Remove Instance.",
                message: '<div class="row">  ' +
                '<div class="col-md-12"> ' +
                '<div id="deleteInstanceWorkingIndicator" style="display:none"><img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" /></div>'+
                '<form id="deleteInstanceForm" class="form-horizontal"> ' +
                '<input type="hidden" id="deleteInstanceIdInput" value="'+instanceId+'"/>'+
                '<div class="form-group"> ' +
                '<span class="col-md-12" for="name">Are you sure you would like to remove this instance?<br/>Note : This will not terminate the instance from the provider.</span> ' +
                '</div>' +
                '<div class="form-group"> ' +
                '<label class="col-md-4 control-label forBootBox1" for="name">Name : </label> ' +
                '<span class="col-md-4 forBootBox" for="name">' + blueprintName + '</span> ' +
                '</div> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-3 control-label" for="ckbChefDelete"></label> ' +
                '<div class="col-md-8"> <div class="checkbox"> <label for="ckbChefDelete-0"> ' +
                '<input type="checkbox" name="ckbChefDelete" id="ckbChefDelete"> ' +
                'Delete this node from chef server </label> ' +
                '</div>' +
                '</div>' +
                '</form> </div>  </div>',
                buttons: {
                    success: {
                        label: "Delete",
                        className: "btn-primary",
                        callback: function(evt,arg2) {
                            $('#deleteInstanceForm').hide();
                            $('#deleteInstanceWorkingIndicator').show();
                            $(evt.target).attr('disabled', 'disabled');


                            var url = '/instances/' + instanceId;
                            if ($('#ckbChefDelete').is(':checked')) {
                                url = url + '?chefRemove=true';
                            }

                            $.ajax({
                                url: url,
                                type: 'DELETE',
                                success: function() {
                                    $('#divinstancescardview').find('.domain-roles-caption[data-instanceId=' + instanceId + ']').parents('.domain-role-thumbnail').remove();
                                    var table = $('#tableinstanceview').DataTable();
                                    table.row('[data-instanceid=' + instanceId + ']').remove().draw(false);
                                    dialog.modal('hide');
                                }
                            }).fail(function() {
                                $('#deleteInstanceForm').html('Server Behaved Unexpectedly. Unable to delete instance');
                            });
                            return false;
                        }
                    },
                    cancel: {
                        label: "Close",
                        className: "btn-primary",
                        callback: function() {

                        }
                    }
                }
            });
        }
        else
        {
            bootbox.alert('Please select an instance to remove.');
        }
    }


    function removeSelectedBlueprint() {
        var blueprintId = $('.productdiv1.role-Selected1').attr('data-blueprintid');
        if (blueprintId) {
            //found now delete
            bootbox.confirm("Are you sure you would like to remove this blueprint?", function(result) {
                if (!result) {
                    return;
                }
                $.get('/blueprints/delete/' + blueprintId, function(data) {
                    //  alert(data);
                    if (data == 'OK') {
                        var $bcc = $('.productdiv1.role-Selected1').closest('.blueprintContainer');
                        $('.productdiv1.role-Selected1').parent().detach();
                        //Check if the closest bluprintcontainer is empty, if empty then hide it.
                        // alert($bcc.find('.panel-body').children().length);
                        if ($bcc.find('.panel-body').children().length <= 0) {
                            $bcc.addClass('hidden');
                        }
                    } else
                        alert(data);
                });
            });

        } else {
            alert('Please select a blueprint to remove.');
        }
    }


    function pollInstanceState(instanceId, state, delay) {
        var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
        var timeout = setTimeout(function() {
            $.get('../instances/' + instanceId, function(data) {
                if (data) {
                    if (data.instanceState == 'stopped'){
                        enableInstanceActionStopBtn(instanceId);
                    }
                    if (data.instanceState == 'running'){
                        enableInstanceActionStartBtn(instanceId);
                    }
                    if (data.instanceState == 'pending' || data.instanceState == 'stopping'){
                        disableInstanceActionBtns(instanceId);
                    }
                    if (data.instanceState == 'unknown'){
                        disableInstanceStartStopActionBtns(data._id);
                    }
                    if (data.instanceState === state) {
                        pollInstanceState(instanceId, state, 5000);
                    } else {
                        console.log('polling complete');
                        var cssClassed = getCssClassFromStatus(data.instanceState);
                        $parent.find('.componentlistContainer').removeClass().addClass('componentlistContainer').addClass(cssClassed.ringClass);
                        $parent.find('.instance-state').removeClass().addClass('instance-state').addClass(cssClassed.textClass).html(data.instanceState);
                        $('.instancestatusindicator[data-instanceId="' + instanceId + '"]').removeClass().addClass('instancestatusindicator').addClass(cssClassed.tableViewStatusClass);
                        $parent.find('.instance-details-id strong').html(data.instanceIP).attr('instanceip',data.instanceIP);
                        $('tr[data-instanceId="' + instanceId + '"] td.instanceIPCol').html(data.instanceIP);
                    }
                }
            })
        }, delay);
    }
    var startStopInstanceHandler = function(e) {
        if($(this).hasClass('isStopedInstance')){
            return false;
        }
        var $this = $(this);
        var instanceId = $this.parents('.instanceActionBtnCtr').attr('data-instanceId');;
        var type = $this.attr('data-actionType');

        function makeRequest(url) {
            var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
            $parent.find('.moreInfo').trigger('click');
            $.get(url, function(data) {

                console.log($parent.length, $parent);
                var cssClassed = getCssClassFromStatus(data.instanceCurrentState);

                var oldState = data.instanceCurrentState;


                $parent.find('.componentlistContainer').removeClass().addClass('componentlistContainer').addClass(cssClassed.ringClass);

                $parent.find('.instance-state').removeClass().addClass('instance-state').addClass(cssClassed.textClass).html(data.instanceCurrentState);

                $('.instancestatusindicator[data-instanceId="' + instanceId + '"]').removeClass().addClass('instancestatusindicator').addClass(cssClassed.tableViewStatusClass);

                pollInstanceState(instanceId, oldState, 2000);
            });

        }
        var url = '../instances/' + instanceId + '/startInstance';
        if (type === 'Stop') {
            url = '../instances/' + instanceId + '/stopInstance'
        }
        if (type === 'Stop') {
            bootbox.confirm(type + " instance?", function(result) {
                if (!result) {
                    return;
                }
                makeRequest(url);
            });
        } else {
            makeRequest(url);
        }
    }



    var instanceUpdateRunlistHandler = function(e) {
        if($(this).hasClass('isStopedInstance')){
            return false;
        }
        var $this = $(this);
        //alert($this);
        var instanceId = $this.attr('data-instanceId');
        //alert(instanceId);
        var chefServerId = $this.attr('data-chefServerId');
        //alert(chefServerId);
        var runlist = $this.data('runlist');
        console.log("runlist",runlist);
        var  $chefRunModalContainer = $('#chefRunModalContainer');

        var $ccrs = $chefCookbookRoleSelector(urlParams.org, function(data) {

        },runlist);
        $ccrs.find('.deploymentSelectedRunList').attr('data-instanceid',instanceId);



        $chefRunModalContainer.find('.chefRunlistContainer').empty().append($ccrs);
        $chefRunModalContainer.modal('show');

    };

    var instanceLogsHandler = function(e) {
        var instanceId = $(this).attr('data-instanceId');
        var timeout;
        var $instanceLogModalContainer = $('#instanceLogModalContainer');
        $instanceLogModalContainer.on('hidden.bs.modal', function(e) {
            $instanceLogModalContainer.off('hidden.bs.modal');
            if (timeout) {
                clearTimeout(timeout);
            }
        });
        $instanceLogModalContainer.find('.logsArea').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        $instanceLogModalContainer.modal('show');
        var lastTimestamp;

        function pollLogs(timestamp, delay, clearData) {
            var url = '../instances/' + instanceId + '/logs';
            if (timestamp) {
                url = url + '?timestamp=' + timestamp;
            }

            timeout = setTimeout(function() {
                $.get(url, function(data) {
                    var $modalBody = $instanceLogModalContainer.find('.logsArea')
                    if (clearData) {
                        $modalBody.empty();
                    }
                    var $table = $('<div></div>');

                    for (var i = 0; i < data.length; i++) {
                        var $rowDiv = $('<div class="row"></div>');
                        var timeString = new Date().setTime(data[i].timestamp);
                        var date = new Date(timeString).toLocaleString(); //converts to human readable strings
                        $rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));

                        if (data[i].err) {
                            $rowDiv.append($('<div class="col-lg-8 col-sm-8" style="color:red;"></div>').append('<span>' + data[i].log + '</span>'));
                        } else {
                            $rowDiv.append($('<div class="col-lg-8 col-sm-8 " style="color:DarkBlue;"></div>').append('<span>' + data[i].log + '</span>'));
                        }

                        $table.append($rowDiv);
                        $table.append('<hr/>');

                    }


                    if (data.length) {
                        lastTimestamp = data[data.length - 1].timestamp;
                        console.log(lastTimestamp);
                        $modalBody.append($table);
                        $modalBody.scrollTop($modalBody[0].scrollHeight + 100);
                    }


                    console.log('polling again');
                    if ($instanceLogModalContainer.data()['bs.modal'].isShown) {
                        pollLogs(lastTimestamp, 1000, false);
                    } else {
                        console.log('not polling again');
                    }
                });
            }, delay);
        }
        pollLogs(lastTimestamp, 0, true);
    };


    //emptying ssh container 
    $('#modalSSHShellContainer').on('hide.bs.modal',function(e){
        $('#modalSSHShellContainer').find('#ssh-terminateBtn').click();
        $('#modalSSHShellContainer').find('.modal-body').empty();
    });
    function showSSHModal() {
        if($(this).hasClass('isStopedInstance')){
            return false;
        }
        var $sshModal = $('#modalSSHShellContainer');
        var instanceId = $(this).attr('data-instanceId');
        $sshModal.find('.modal-body').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        $sshModal.modal('show');
        $.get('sshShell.html?id=' + instanceId,function(data){

            $sshModal.find('.modal-body').empty().append(data);
            $sshModal.find('#ssh-instanceId').val(instanceId);
        });
    }



    function enableInstanceActionStartBtn(instanceId){
        var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
        var $tableViewInstanceId =  $("tr[data-instanceId='"+instanceId+"']");
        $cardViewInstanceId.find('.chefClientRunlistImage').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('actionbuttonChefClientRun');
        $tableViewInstanceId.find('.chefClientRunlistImage').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('actionbuttonChefClientRun');
        $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshIcon');
        $tableViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshIcon');
        $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').removeClass('isStopedInstance').removeClass('actionbuttonShutdowndisable').addClass('actionbuttonShutdown');
        $tableViewInstanceId.find('.instance-bootstrap-ActionShutdown a').removeClass('isStopedInstance').removeClass('actionbuttonShutdowndisable').addClass('actionbuttonShutdown');
        $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
    }
    function enableInstanceActionStopBtn(instanceId){
        var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
        var $tableViewInstanceId =  $("tr[data-instanceId='"+instanceId+"']");
        $cardViewInstanceId.find('.chefClientRunlistImage').addClass('isStopedInstance').removeClass('actionbuttonChefClientRun').addClass('actionbuttonChefClientRundisable');
        $tableViewInstanceId.find('.chefClientRunlistImage').addClass('isStopedInstance').removeClass('actionbuttonChefClientRun').addClass('actionbuttonChefClientRundisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshIcon').addClass('sshIcondisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshIcon').addClass('sshIcondisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').removeClass('isStopedInstance').removeClass('actionbuttonStartdisable').addClass('actionbuttonStart');
        $tableViewInstanceId.find('.instance-bootstrap-ActionStart a').removeClass('isStopedInstance').removeClass('actionbuttonStartdisable').addClass('actionbuttonStart');
    }
    function disableInstanceActionBtns(instanceId){
        var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
        var $tableViewInstanceId =  $("tr[data-instanceId='"+instanceId+"']");
        $cardViewInstanceId.find('.chefClientRunlistImage').addClass('isStopedInstance').removeClass('actionbuttonChefClientRun').addClass('actionbuttonChefClientRundisable');
        $tableViewInstanceId.find('.chefClientRunlistImage').addClass('isStopedInstance').removeClass('actionbuttonChefClientRun').addClass('actionbuttonChefClientRundisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshIcon').addClass('sshIcondisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionSSH a').addClass('isStopedInstance').removeClass('sshIcon').addClass('sshIcondisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
    }
    function disableInstanceStartStopActionBtns(instanceId){
        var $cardViewInstanceId = $(".domain-roles-caption[data-instanceId='"+instanceId+"']");
        var $tableViewInstanceId =  $("tr[data-instanceId='"+instanceId+"']");
        $cardViewInstanceId.find('.chefClientRunlistImage').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('actionbuttonChefClientRun');
        $tableViewInstanceId.find('.chefClientRunlistImage').removeClass('isStopedInstance').removeClass('actionbuttonChefClientRundisable').addClass('actionbuttonChefClientRun');
        $cardViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshIcon');
        $tableViewInstanceId.find('.instance-bootstrap-ActionSSH a').removeClass('isStopedInstance').removeClass('sshIcondisable').addClass('sshIcon');
        $cardViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionShutdown a').addClass('isStopedInstance').removeClass('actionbuttonShutdown').addClass('actionbuttonShutdowndisable');
        $cardViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
        $tableViewInstanceId.find('.instance-bootstrap-ActionStart a').addClass('isStopedInstance').removeClass('actionbuttonStart').addClass('actionbuttonStartdisable');
    }
    function addInstanceToDOM(data) {
        //var dataTable = $('#tableinstanceview').DataTable()
        // TEMP Hack for the multiple cards issue. 
        // Import also needs to be fixed as it inserts 2 records in the db..
        if(data._id){// instanceId    
            var alreadyAdded = $("#content").find("div[data-instanceid='"+data._id+"']").length;
            //alert(">>>>>" data._id  " >>>>>> " alreadyAdded);  
            if(alreadyAdded) return;
        }

        var $instanceDataTable = $("#tableinstanceview");
        var $divinstancescardview = $('#divinstancescardview .carousel-inner');
        var $carouselItemContainers = $divinstancescardview.find('.item');
        // var $instancesList = null;
        // var $item = null;
        var $instancesList,$item;
        //alert($carouselItemContainers.length);
        if(!$carouselItemContainers.length) {
            //creating Item tag
            $item = $('<div></div>').addClass('item');
            $instancesList = $('<ul></ul>').addClass("thumbnails marginleft-40 padding-top-30 list-unstyled instancesList");
            $item.append($instancesList);
            $divinstancescardview.append($item);
        } else {
            var $item = $($carouselItemContainers.get($carouselItemContainers.length -1));
            var $instancesList = $item.find('ul');
            if($instancesList.children().length === 5) {

                $item = $('<div></div>').addClass('item');
                $instancesList = $('<ul></ul>').addClass("thumbnails marginleft-40 padding-top-30 list-unstyled instancesList");
                $item.append($instancesList);
                $divinstancescardview.append($item);
            }
        }

        var $rowContainter = $('<tr></tr>').attr({
            'data-instanceId': data._id,
            'data-blueprintName': data.blueprintData.blueprintName
        });



        var $li = $('<li></li>').addClass('domain-role-thumbnail');
        var $container = $('<div class="flip-toggle"></div>').addClass('container'); //<div class="container" id="flip-toggle">
        var $card = $('<div></div>').addClass('card'); //<div class="card">
        var $front = $('<div></div>').addClass('front'); //<div class="front">
        var $div = $('<div></div>').addClass('domain-roles ');
        var $divDomainRolesCaption = $('<div></div>').addClass('domain-roles-caption').attr({
            'data-instanceId': data._id,
            'data-blueprintName': data.blueprintData.blueprintName
        });
        var $divHeading = $('<div></div>').addClass('domain-roles-heading');


        var $spanheadingLeft = $('<span></span>').addClass('domain-roles-icon').html('<img src="'+data.blueprintData.iconPath+'" style="margin-right:5px;margin-top:-10px;width:27px"/>').attr('contenteditable', 'false');

        var $spanheadingMiddle = $('<span>' + data.blueprintData.blueprintName + '</span>').addClass('cardHeadingTextoverflow').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', ''+ data.blueprintData.blueprintName +'');
        var $spanheadingRight = $('<span></span>').css({
            'float': 'right'
        }).append($('<a href="javascript:void(0)" data-instanceId="' + data._id + '"></a>').addClass('moreInfo').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'MoreInfo'));

        $divHeading.append($spanheadingLeft);
        $divHeading.append($spanheadingMiddle);
        $divHeading.append($spanheadingRight);
        $divDomainRolesCaption.append($divHeading);
        $divDomainRolesCaption.append($('<hr>'));
        var $divComponentListContainer;
        var $tdInstanceStatusIndicator;

        if (data.instanceState == 'running') {
            $divComponentListContainer = $('<div></div>').addClass('componentlistContainer started');
            $tableInstanceStatusIndicator = $('<td></td>').addClass('instancestatusindicator started');
        } else if (data.instanceState == 'terminated') {
            $divComponentListContainer = $('<div></div>').addClass('componentlistContainer stopped');
            $tableInstanceStatusIndicator = $('<td></td>').addClass('instancestatusindicator stopped');
        } else if (data.instanceState == 'stopped') {
            $divComponentListContainer = $('<div></div>').addClass('componentlistContainer stopped');
            $tableInstanceStatusIndicator = $('<td></td>').addClass('instancestatusindicator stopped');
        } else {
            $divComponentListContainer = $('<div></div>').addClass('componentlistContainer pending');
            $tableInstanceStatusIndicator = $('<td></td>').addClass('instancestatusindicator pending');
        }
        $tableInstanceStatusIndicator.attr('data-instanceId', data._id);


        $divComponentList = $('<div></div>').addClass('instance-bootstrap-list');

        $divComponentItem = $('<span style="overflow:hidden;text-overflow:ellipsis;width:62px;padding-right:0px;"></span>').addClass('instance-details-item')
                .append($('<a class="btn"><i class="fa fa-2x fa-exchange txt-color-blue"></i></a>')
                        .attr({
                            'href': 'javascript:void(0)',
                            'rel': 'tooltip',
                            'data-placement': 'top',
                            'data-original-title':'ViewAllRunlist'
                        }).addClass('instance-bootstrap-list-faimage'));

        $divComponentItem.click(function(e) {

            var $par= $(this).parents('.flip-toggle');

            $par.find('.tooltip').remove();

            if($par.length && $par.hasClass('flip')){
                $par.removeClass('flip');
            }else{
                $par.addClass('flip');
            }
            //   alert(1);
            // debugger;

            //  $(this).parents('.flip-toggle').find('fa-exchange').tooltip('hide');
        });


        $divComponentList.append($divComponentItem);


        $divComponentListContainer.append($divComponentList);



        $divComponentListImage = $('<a class="chefClientRunlistImage actionbuttonChefClientRun"></a>').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'Chef Client Run').addClass('instance-bootstrap-list-image').attr('data-chefServerId', data.chef.serverId).attr('data-instanceId',data._id);

        //Check if the docker status is succeeded
        if(data.docker != null){
            var $dockerStatus = $('<img style="width:42px;height:42px;margin-left:32px;" alt="Docker" src="img/galleryIcons/Docker.png">').addClass('dockerenabledinstacne');

            $divComponentListContainer.append($dockerStatus);
        }
        if(typeof data.applicationUrl != 'undefined')
        {
            if(data.applicationUrl != 'http://'){
                var $anchor = "<a style='font-size:10px;' class='app.url marginForURL' title='"+data.applicationUrl+"' href='"+data.applicationUrl+"'' target='_blank' >WSS</a>";
                $divComponentListContainer.append($anchor);
            }
        }
        if(typeof data.applicationUrl1 != 'undefined'){
            if(data.applicationUrl1 != 'http://'){
                var $anchor1 = "<br><a style='margin-left:44px;font-size:10px;margin-top:-10px;' title='"+data.applicationUrl1+"' class='app.url1 forURL' href='"+data.applicationUrl1+"'' target='_blank'>AD</a>";
                $divComponentListContainer.append($anchor1);
            }
        }

        /*else{
         $divComponentListContainer.detach($anchor1); 
         }*/




        //For Table View
        // var dataTableCount = $instanceDataTable.dataTable();
        //var numberOfRows = dataTableCount.fnGetData().length;
        //console.log('rows ==>',dataTableCount.fnGetData().length);

        $rowContainter.append('<td></td>');
        $rowContainter.append('<td><img src="'+data.blueprintData.iconPath+'" style="width:auto;height:30px;" /></td>');


        $rowContainter.append('<td>' + data.blueprintData.blueprintName.toString().substring(0,15) + '</td>');
        //$rowContainter.append('<td>' +$divComponentList.text()+ '</td>');
        $rowContainter.append('<td class="instanceIPCol">' + data.instanceIP + '</td>');
        var $tableRunlistDiv = $('<div></div>'); /*.append('<span>'+data.runlist.join()+'</span>');*/

        var $viewAllA;
        //alert(data.runlist);
        if (data.runlist.length) {
            $viewAllA  = $('<a></a>').attr('href', 'javascript:void(0)').append("View All Runlist");
            $viewAllA.click(function(e) {
                e.preventDefault();
                e.stopPropagation();

                var $modal = $('#modalTableRunlist');
                var $modalBody = $('#modalTableRunlist .modal-body').empty();
                var runlist =  $(this).parents('tr').find('.instance-bootstrap-list-image').data('runlist');
                for (var j = 0; j < runlist.length; j++) {
                    var $divComponentItem;
                    if (j == 0) {

                        $divComponentItem = $('<span title="' + runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:300px;"></span>').addClass('instance-details-item').append(runlist[j]);

                    } else {
                        $divComponentItem = $('<span title="' + runlist[j] + '" style="overflow:hidden;text-overflow:ellipsis;width:300px;"></span>').addClass('instance-details-item').append(runlist[j]);
                    }

                    $modalBody.append($divComponentItem);
                }
                $modal.modal('show');
                return false;
            });
        } else {
            $viewAllA  = $('<span></span>').append("View All Runlist");
        }
        var $divComponentItem = $('<span title="View all runlist" style="overflow:hidden;text-overflow:ellipsis;width:111px;"></span>').addClass('instance-details-item').append($viewAllA);
        $tableRunlistDiv.append($divComponentItem);


        $rowContainter.append($('<td></td>').append($tableRunlistDiv));
        //$rowContainter.append('<td><img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/aws_logo.png" /></td>');
        $rowContainter.append($tableInstanceStatusIndicator);
        var temp=($anchor ? $anchor: "")+""+($anchor1 ? $anchor1 :"");
        $rowContainter.append('<td>'+temp+'</td>');

        $rowContainter.append('<td><a class="tableMoreInfo moreInfo" data-instanceId="' + data._id + '" href="javascript:void(0)" rel="tooltip" data-placement="top" data-original-title="MoreInfo"></a></td>');

        $divDomainRolesCaption.append($divComponentListContainer);
        var $divInstanceDetails = $('<div></div>')
        var $instanceDetailsList = $('<div></div>').addClass('instance-details-list');
        var $instanceDetailItemId = $('<span></span>').addClass('instance-details-id').html('IP : <strong class="instanceip">' + data.instanceIP + '</strong>');
        //Arab
        // var $instanceDetailItemIdTest = $('<span style="float:right"><a data-content="TestPopover" data-original-title="CardInformation" data-placement="right" rel="popover" class="btn btn-primary moreinfoactionHistory" href="javascript:void(0);"></a></span>');

        // $instanceDetailsList.append($instanceDetailItemIdTest);


        $instanceDetailsList.append($instanceDetailItemId);
        var $instanceDetailItemStatus;
        if (data.instanceState == 'running') {
            $instanceDetailItemStatus = $('<span></span>').addClass('instance-details-id').html('status : <span class="instance-state instance-state-text-started">' + data.instanceState + '</strong>');
        } else if (data.instanceState == 'terminated') {
            $instanceDetailItemStatus = $('<span></span>').addClass('instance-details-id').html('status : <span class="instance-state instance-state-text-stopped">' + data.instanceState + '</strong>');
        } else if (data.instanceState == 'stopped') {
            $instanceDetailItemStatus = $('<span></span>').addClass('instance-details-id').html('status : <span class="instance-state instance-state-text-stopped">' + data.instanceState + '</strong>');
        } else {
            $instanceDetailItemStatus = $('<span></span>').addClass('instance-details-id').html('status : <span class="instance-state instance-state-text-pending">' + data.instanceState + '</strong>');
        }

        $instanceDetailsList.append($instanceDetailItemStatus);



        $divInstanceDetails.append($instanceDetailsList);

        $divDomainRolesCaption.append($divInstanceDetails);

        $divDomainRolesCaption.append($('<hr>'));


        //data-placement="top" rel="tooltip" width:140px;margin-left:6px;
        var $divActionBtnContainer = $('<div style="height:30px;width:152px;"></div>').addClass('instanceActionBtnCtr').attr('data-instanceId', data._id);
        //alert($divComponentListImage.html());


        var $divActionChefRunContainer = $('<div></div>').addClass('instance-bootstrap-ActionChefRun').append($divComponentListImage);
        $divActionBtnContainer.append($divActionChefRunContainer);

        var $divActionStartContainer = $('<div class="actionbutton"></div>').addClass('instance-bootstrap-ActionStart').append($('<a href="javascript:void(0)"></a>').addClass('actionbuttonStart instanceActionBtn').attr('data-actionType', 'Start').attr('data-placement', 'top').attr('rel', 'tooltip').attr('data-original-title', 'Start'));
        $divActionBtnContainer.append($divActionStartContainer);
        if (!data.chef) {
            data.chef = {};
        }
        // var $divActionReStartContainer = $('<div class="actionbutton"></div>').addClass('instance-bootstrap-ActionRestart').append($('<a href="javascript:void(0)"></a>').addClass('actionbuttonRestart instanceActionBtnUpdateRunlist').attr('data-chefServerId', data.chef.serverId).attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'Restart'));
        // $divActionBtnContainer.append($divActionReStartContainer);
        var $divActionShutdownContainer = $('<div class="actionbutton"></div>').addClass('instance-bootstrap-ActionShutdown').append($('<a href="javascript:void(0)"></a>').addClass('actionbuttonShutdown instanceActionBtn').attr('data-actionType', 'Stop').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'Stop'));
        $divActionBtnContainer.append($divActionShutdownContainer);

        // <img src="img/galleryIcons/sshIcon.png"/ height="27px" width="27px" >
        var $divActionSSHContainer = $('<div class="sshBtnContainer actionbutton"></div>').addClass('instance-bootstrap-ActionSSH').append($('<a href="javascript:void(0)" class="sshIcon" data-instanceid="'+data._id+'"></a>').addClass('').attr('data-actionType', 'SSH').attr('rel', 'tooltip').attr('data-placement', 'top').attr('data-original-title', 'SSH'));
        $divActionBtnContainer.append($divActionSSHContainer);

        var $back = $('<div></div>').addClass('back card-backflip');
        var $backRunlistContainer = $('<div></div>').addClass('cardBackRunlistContaner');

        var $backdiv = $('<span></span>').addClass('card-backflip-margin');
        var $backdiva = $('<a style="color:#333;"></a>');
        var $backdivai = $('<i></i>').addClass('fa fa-lg fa-fw fa-book txt-color-blue');

        var $backdivaspan = $('<span style="font-size:12px;font-family:Open sans;padding-left:5px;color:#333"></span>').addClass('menu-item-parent').html('Runlists');
        var $backhr = $('<hr>');



        $backdiva.append($backdivai);
        $backdiva.append($backdivaspan);
        //$backdiva.append($backhr);
        $backdiv.append($backdiva);

        $back.append($backdiv);
        //rrr alert(data.runlist);

        for (var j = 0; j < data.runlist.length; j++) {
            var $divComponentItem;

            $divComponentItem = $('<span title="' + data.runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:130px;color:#3a87ad"></span>').addClass('instance-details-item').append(data.runlist[j]);
            $backRunlistContainer.append($divComponentItem);
        }

        //console.log($backRunlistContainer);
        $back.append($backRunlistContainer);
        $backdiv.append($backhr);


        var $flipbackdivaspanhr = $('<hr>');
        $back.append($flipbackdivaspanhr);
        var $flipbackdivaspan = $('<span style="width:160px;text-align:center;display:block;margin-top:8px"></span>').append($('<a style="color:#333"></a>').attr('href', 'javascript:void(0)').append("Go Back"));
        $flipbackdivaspan.click(function(e) {
            $(this).parents('.flip-toggle').toggleClass('flip');
        });
        $back.append($flipbackdivaspan);

        //Testing
        //$divActionBtnContainer.empty().append("<div style="float:left">One</div>").append("<div style="float:left">Two</div>").append("<div style="float:left">Three</div>");



        $divDomainRolesCaption.append($divActionBtnContainer);
        $front.append($div);
        $card.append($front);
        $card.append($back);
        $container.append($card);
        $li.append($container);
        //$li.append($div);
        $div.append($divDomainRolesCaption);

        $instancesList.append($li);
        //alert($instancesList.length);
        // alert($("#divinstancescardview li").length);
        // if($("#divinstancescardview li").length > 10){
        //     $('#myCarousel-2 .item active').append($instancesList);
        // }
        //For Table View
        //$divComponentListImage
        $rowContainter.append('<td>' + $('<div></div>').append($divComponentListImage.clone()).html() + '</td>');
        var $tableActionBtnContainer = $divActionBtnContainer.clone();
        $tableActionBtnContainer.find('.instance-bootstrap-ActionChefRun').remove();
        $rowContainter.append('<td>' + $('<div></div>').append($tableActionBtnContainer).html() + '</td>');

        //alert($rowContainter.html());
        //$("#tableinstanceview").find('tbody').append($rowContainter);
        var dataTable = $instanceDataTable.DataTable();
        dataTable.row.add($rowContainter).draw();




        if (data.instanceState === 'pending' || data.instanceState === 'stopping') {
            pollInstanceState(data._id, data.instanceState, 2000);
            // To be removed from comment later - Vinod
        }



        //handling events

        $rowContainter.find('.instanceActionBtn').click(startStopInstanceHandler);
        $li.find('.instanceActionBtn').click(startStopInstanceHandler);


        $rowContainter.find('.instance-bootstrap-list-image').click(instanceUpdateRunlistHandler).data('runlist',data.runlist);
        $li.find('.instance-bootstrap-list-image').click(instanceUpdateRunlistHandler).data('runlist',data.runlist);

        $rowContainter.find('.sshBtnContainer a').click(showSSHModal);
        $li.find('.sshBtnContainer a').click(showSSHModal);


        $rowContainter.find('.tableMoreInfo').click(instanceLogsHandler);
        $li.find('.moreInfo').click(instanceLogsHandler);

        var $cardContainer = $li.find('.container').click(function(e) {
            $('.container').removeClass('role-Selectedcard');
            $(this).addClass('role-Selectedcard');
            //Arab 
            localStorage.setItem("cardIndex", $(".container").index($(this)));
            console.log($(".container").index($(this)));
        });
        pageSetUp();

        if (data.instanceState == 'stopped'){
            enableInstanceActionStopBtn(data._id);
        }
        if (data.instanceState == 'running'){
            enableInstanceActionStartBtn(data._id);
        }
        if (data.instanceState == 'pending' || data.instanceState == 'stopping'){
            disableInstanceActionBtns(data._id);
        }
        if (data.instanceState == 'unknown'){
            disableInstanceStartStopActionBtns(data._id);
        }


        setTimeout(function(){
            var $l=$('#divinstancescardview').find('.active');
            if($l.length>1){
                $l.not(':first').removeClass('active');
            }
        },3);
        $('#divinstancescardview .carousel-inner .item').addClass('active');
    }

    //Containers table build
    function loadContainersTable(){
        //alert('called');
        //debugger;
        console.log('called');
        //Shwoing the loader spinner and clearing the rows.
        $('tr[id*="trfordockercontainer_"]').remove();
        $('.loadingimagefordockertable').removeClass('hidden');
        $dockercontainertable = $('#dockercontainertable tbody');

        $('.container').each(function(){
            var $docker = $(this).find('.dockerenabledinstacne');
            if($docker.html() != undefined){
                //Get the instance ID
                $('li.Containers').removeClass('hidden');
                var instanceid = $(this).find('[data-instanceid]').attr('data-instanceid');
                $.get('/instances/dockercontainerdetails/' + instanceid,function(data){
                    if(!data){
                        $('.loadingimagefordockertable').addClass('hidden');
                        return;
                    }
                    if(data){
                        $('.loadingimagefordockertable').addClass('hidden');
                    }
                    var dockerContainerData = JSON.parse(data);
                    //   alert(JSON.stringify(dockerContainerData));

                    $.each(dockerContainerData,function(i,item){
                        var $docctr = createdockercontainerrow(item,instanceid);
                        // alert($docctr.html());

                        $dockercontainertable.append($docctr);
                        if(i >= dockerContainerData.length - 1)
                        {
                            // alert('in' + i);
                            $('.dockeractionbutton').unbind("click");
                            $('.cadvisorenablebase').each(function(j,itm){
                                if($(this).attr('cadvisorip')){
                                    var cadip = $(this).attr('cadvisorip');
                                    $('a[cadvisorip="' + cadip +'"]').removeClass('hidden');
                                }

                            });

                            $('.dockeractionbutton').click(function(){
                                // alert('test' + $(this).attr('dockercontaineraction'));
                                //append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');


                                var action =  $(this).attr('dockercontaineraction');
                                var instanceid =  $(this).closest('tr').attr('instanceid');
                                var containerid =  $(this).closest('tr').attr('containerid');
                                var $contextRow = $(this).closest('tr');
                                var $thistr = $(this);
                                // alert('Url : ' + '/instances/dockercontainerdetails/' + instanceid + '/' + containerid + '/' + action);
                                var performAction = function(){
                                    $thistr.closest('tr').fadeTo('slow',0.5);
                                    var $progressicon = $thistr.closest('tr').find('.dockercontainerprogress').first();

                                    $progressicon.removeClass('hidden');
                                    if(action == '1' || action == '2' || action == '3' || action == '4' || action == '5' || action == '6'){
                                        $.get('/instances/dockercontainerdetails/' + instanceid + '/' + containerid + '/' + action,function(data){
                                            // alert(data);
                                            if(data == 'OK'){
                                                //$(this).parents('.flip-toggle').toggleClass('flip1');
                                                //alert('ok');
                                                //  $(this).closest('.container1').first().find('.flipper').toggleClass('hidden');
                                                //alert($thistr.closest('.dockercontainertabletemplatetr').html());
                                                if(action == '6'){
                                                    $contextRow.detach(); //removing the row on terminate.
                                                }
                                                else{
                                                    $.get('/instances/dockercontainerdetails/' + instanceid,function(data){
                                                        var dockerContainerData = JSON.parse(data);
                                                        //alert(JSON.stringify(dockerContainerData));
                                                        //Updating More Info dialog
                                                        // $('#modalContainermoreInfo').find('td[containerdata]').each(function(){
                                                        //     console.log("dockerContainerData." +  $(this).attr('containerdata'));
                                                        //      if($(this).attr('containerdata') != '')
                                                        //         $(this).html(eval("dockerContainerData." +  $(this).attr('containerdata')));
                                                        // });
                                                        // // updating row.
                                                        // $contextRow.find('dockercontainerstatus').html(dockerContainerData);
                                                        $.each(dockerContainerData,function(i,item){
                                                            //alert(item.Id.substring(0,12) + ':' + containerid);
                                                            if(item.Id.substring(0,12) == containerid){
                                                                //   alert('found constructing ' + item.toString())
                                                                var $updatedContainerRow = createdockercontainerrow(item,instanceid);
                                                                //Do not bind any action buttons
                                                                $updatedContainerRow.find('td').each(function(i,k){
                                                                    //alert(i + ':' + k);
                                                                    if(i > 0 && i < 7){
                                                                        $contextRow.find('td:eq(' + i + ')').html('').append($(k).html());
                                                                    }

                                                                });
                                                                $thistr.closest('.container1').find('.flipper').toggleClass('hidden');
                                                                //Managing the pause and unpause buttons
                                                                if(item.Status.indexOf('Exited') >= 0){
                                                                    //  alert('in');
                                                                    $thistr.closest('.container1').find('.pause').addClass('hidden');
                                                                    $thistr.closest('.container1').find('.unpause').addClass('hidden');
                                                                }

                                                            }
                                                        });



                                                        $thistr.closest('tr').fadeTo('slow',1);
                                                        $progressicon.addClass('hidden');
                                                    });
                                                }

                                            }
                                            else
                                                $progressicon.addClass('hidden');

                                        });
                                    }
                                    return(false);
                                }



                                if(action == '6'){
                                    bootbox.confirm("Are you sure you would like to terminate container : " + containerid + "?.<br/>This action could have an impact on other containers.", function(result) {
                                        if (!result) {
                                            return;
                                        }
                                        performAction();
                                    });
                                }
                                else if(action == '2'){
                                    bootbox.confirm("Are you sure you would like to stop container : " + containerid + "?.<br/>This action could have an impact on other containers.", function(result) {
                                        if (!result) {
                                            return;
                                        }
                                        performAction();
                                    });
                                }
                                else{
                                    performAction();
                                }


                            });
                            return;
                        }
                    });
                });
            }
            else{ //no docker found
                $('.loadingimagefordockertable').addClass('hidden');
                $('li.Containers').addClass('hidden');
            }
        });
        //dockercontaineraction


    }



    function createdockercontainerrow(dockerContainerItem, instanceid){
        // <td class="dockercontainerstatus"></td>
        // <td  class="dockercontainerstartedon"></td>
        // <td  class="dockercontainername"></td>
        // <td  class="dockercontainerhostip"></td>
        // <td  class="dockercontainerid"></td>
        // <td  class="dockercontainerimagename"></td>
        //alert(instanceid); $modalDesktopProvisioning.modal('show');
        var $cadvisor = $('<a class="linkcadvisor hidden pull-right" target="_blank" title="Open cAdvisor"></a>');


        var $docctr = $('#dockercontainertabletemplatetr').clone().removeClass('hidden');
        $docctr.attr('id','trfordockercontainer_' + dockerContainerItem.Id);
        $docctr.find('.dockercontainerstatus').html(dockerContainerItem.Status).parent().append($cadvisor);
        var docdate = new Date(1000*dockerContainerItem.Created);
        $docctr.find('.dockercontainerstartedon').html(docdate.toLocaleString());
        $docctr.find('.dockercontainername').html(dockerContainerItem.Names[0]);
        //Get the host IP from the card

        var instanceip = $('.domain-roles-caption[data-instanceid="' + instanceid + '"]').first().find('.instanceip').text();

        //Building the cadvisor href
        $cadvisor.append('<i class="fa fa-line-chart fa-lg " style="margin-top:9px"></i>').attr('href','http://' + instanceip + ':8080/docker/' + dockerContainerItem.Id);
        $cadvisor.attr('cadvisorip',instanceip); //
        $cadvisor.attr('dockercontainerid',dockerContainerItem.Id );

        //Once CORS is enabled in cAdvisor uncomment below function to load in a frame
        $cadvisor.click(function(e){
            $('#cadvisorpopup').modal('show');

            if(typeof $('#cAdvisorPageFrame').attr('src') != 'undefined'){
                $('#cadvisorloadingicon').hide();
            }
            else{
                $('#cadvisorloadingicon').show();
            }
            $('#cAdvisorPageFrame').attr('src', "");
            $('#cAdvisorPageFrame').attr('src','http://' + instanceip + ':8080');
            //$('#cAdvisorPageFrame').load('http://' + instanceip + ':8080/docker/');
            e.preventDefault();
            return(false);
        });


        $docctr.attr('instanceid',instanceid);
        $docctr.attr('containerid',dockerContainerItem.Id.substring(0,12));
        $docctr.find('.dockercontainerhostip').html(instanceip);
        $docctr.find('.dockercontainerid').attr('containerid',dockerContainerItem.Id).html(dockerContainerItem.Id.substring(0,12));
        $docctr.find('.dockercontainerimagename').html(dockerContainerItem.Image);
        //Updating the more info popup event
        $docctr.find('.modelcontainermoreinfo').click(function(){
            $.get('/instances/dockercontainerdetails/' + instanceid + '/' + dockerContainerItem.Id,function(data){
                var dockerContainerData = JSON.parse(data);
                //alert(JSON.stringify(dockerContainerData));
                $('#modalContainermoreInfo').find('td[containerdata]').each(function(){
                    console.log("dockerContainerData." +  $(this).attr('containerdata'));
                    if($(this).attr('containerdata') != '')
                        $(this).html(eval("dockerContainerData." +  $(this).attr('containerdata')));
                });

            });
        });
        //Analysing the status cell 
        if(dockerContainerItem.Status.indexOf('Up') >= 0)
        {
            //Show Stop
            //If the container is of type cadvisor show the link
            if(dockerContainerItem.Image.indexOf('cadvisor') >= 0){
                $cadvisor.removeClass('hidden');
                $cadvisor.addClass('cadvisorenablebase');
            }

            $docctr.find('.stop').removeClass('hidden');
            $docctr.find('.start').addClass('hidden');


            if(dockerContainerItem.Status.indexOf('Paused') >= 0){
                $docctr.find('.pause').addClass('hidden');
                $docctr.find('.unpause').removeClass('hidden');
            }else
            {
                $docctr.find('.unpause').addClass('hidden');
                $docctr.find('.pause').removeClass('hidden');
            }

        }
        else if(dockerContainerItem.Status.indexOf('Exited') >= 0){
            $docctr.find('.stop').addClass('hidden');
            $docctr.find('.start').removeClass('hidden');
            $docctr.find('.pause').addClass('hidden');
            $docctr.find('.unpause').addClass('hidden');
        }
        else if(dockerContainerItem.Status.indexOf('Paused') >= 0){
            $docctr.find('.pause').addClass('hidden');
            $docctr.find('.unpause').removeClass('hidden');
        }
        else
        {
            $docctr.find('.stop').addClass('hidden');
            $docctr.find('.start').removeClass('hidden');
        }

        return($docctr);

    }

    //End Containers table build
    var tableinstanceview = null;


    $('.launchBtn').click(function(e) {
        var $selectedItems = $('.role-Selected1');
        if(!$selectedItems.length) {
            return;
        }
        if($selectedItems.attr('data-templateType') === 'desktopProvisioning') {
            var $modalDesktopProvisioning =$('#modalDesktopProvisioningLaunch');
            var blueprintId = $selectedItems.attr('data-blueprintId');
            var version = $selectedItems.find('.blueprintVersionDropDown').val();
            $modalDesktopProvisioning.data('blueprintId',blueprintId);
            $modalDesktopProvisioning.data('blueprintVersion',version);
            $modalDesktopProvisioning.modal('show');
            return;
        }
        if($selectedItems.attr('data-templateType') === 'Docker') {
            loadLaunchParams();
            var $launchDockerInstanceSelector = $('#launchDockerInstanceSelector');
            var blueprintId = $selectedItems.attr('data-blueprintId');
            var dockerreponame = $selectedItems.attr('dockerreponame');
            $launchDockerInstanceSelector.data('blueprintId',blueprintId);
            //  $launchDockerInstanceSelector.data('blueprintId',blueprintId);



            $('#dockerinstancesselctorview').empty().append('<span><div class=\"modal-body\"><div><div class=\"row\"><div style=\"color:;\" class=\"col-lg-12 col-sm-12\ dockerinstances"></div></div></div></div></div></span>');
            var $newinstancetable = $("<table></table>").append("<thead><tr><td>Instance Name</td><td>IP Address</td><td class='hidden'>Add Docker Engine</td></tr></thead>");
            var $newinstancetbody = $('<tbody></tbody>');
            $newinstancetable.append($newinstancetbody);
            var $instancetable = $('#tableinstanceview').clone();
            $instancetable.find('tbody tr').each(function(){
                var $newinstancetr = $("<tr><tr>");
                $(this).find('td').each(function(k,v){
                    $newinstancetr.append('<td>' + v +  $(this).html() + '</td>');
                });
                $newinstancetbody.append($newinstancetr);
            });

            $instancetable.attr('id','dockerintsancestab');
            $('.dockerinstances').first().append($instancetable);

            $('#dockerintsancestab thead td').each(function(k,v){
                if(k > 3 )
                    $(this).detach();
            });
            $('#dockerintsancestab thead tr').append('<td class="hidden" title="Select to add a docker engine">Add Engine</td>');
            $('#dockerintsancestab tbody tr').each(function(k,v){

                $(this).removeClass('rowcustomselected');
                $(this).click(function(){
                    $('#dockerintsancestab tbody tr').removeClass('rowcustomselected');
                    $(this).addClass('rowcustomselected');
                });
                $(this).find('td').each(function(k1,v1){
                    if(k1 > 3 )
                        $(this).detach();
                    //inserting a checkbox to select instance
                    if(k1 == 0){
                        $(this).prepend('<input type="checkbox" class="instanceselectedfordocker">&nbsp;');
                    }
                });
                $(this).append('<td  class="hidden"><input type="checkbox"></td>');

            });
            $('.launchdockerinstance').click(function(){
                $launchResultContainer.find('.modal-body').empty().append('<span><div class=\"modal-body\"><div><h3 class=\"alert alert-success\"><b>Congratulations!</b> Blueprint Launched Successfully !!!</h3>Instance Id : 5460690c6e5c99913e37d0e4<br>Instance Logs :- </div><div class=\"logsAreaBootstrap\"><div><div class=\"row\"><div style=\"color:white;\" class=\"col-lg-12 col-sm-12\"><span>Starting instance</span></div></div></div></div></div></span>');
                $('#myModalLabel').first().html('Launching Blueprint');

            });
            $('#dockerInstanceSelectionTitle').empty().append('Select Instances to pull  "' + dockerreponame + '" into');
            $launchDockerInstanceSelector.modal('show');
            $('#dockerintsancestab thead').empty().append('<tr><td>Select Instance</td><td>Logo</td><td>Instance Name</td><td>IP Address</td><td  class="hidden">Add Docker Engine</td></tr>');
            $('#dockerintsancestab').dataTable({
                "bPaginate": false
            });
            return;
        }


        var $launchResultContainer = $('#launchResultContainer');
        $launchResultContainer.find('.modal-body').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        $launchResultContainer.find('.modal-title').html('Launching Blueprint');
        $launchResultContainer.modal('show');
        for (var i = 0; i < $selectedItems.length; i++) {
            var projectId = $($selectedItems.get(i)).attr('data-projectId');
            var envId = $($selectedItems.get(i)).attr('data-envId');
            var blueprintId = $($selectedItems.get(i)).attr('data-blueprintId');
            var version = $($selectedItems.get(i)).find('.blueprintVersionDropDown').val();
            // alert('launching -> ' +'../blueprints/' + blueprintId + '/launch?version=' + version);
            $.get('/blueprints/' + blueprintId + '/launch?version=' + version, function(data) {

                var $msg = $('<div></div>').append('<h3 class=\"alert alert-success\"><b>Congratulations!</b> Blueprint Launched Successfully</h3>').append('Instance Id : ' + data.id).append('<br/>Instance Logs :- ');

                $launchResultContainer.find('.modal-body').empty();
                $launchResultContainer.find('.modal-body').append($msg);

                var instanceId = data.id;
                var timeout;

                $launchResultContainer.on('hidden.bs.modal', function(e) {
                    $launchResultContainer.off('hidden.bs.modal');
                    if (timeout) {
                        clearTimeout(timeout);
                    }
                });
                $divBootstrapLogArea = $('<div></div>').addClass('logsAreaBootstrap');

                $launchResultContainer.find('.modal-body').append($divBootstrapLogArea);

                var lastTimestamp;

                function pollLogs(timestamp, delay, clearData) {
                    var url = '../instances/' + instanceId + '/logs';
                    if (timestamp) {
                        url = url + '?timestamp=' + timestamp;
                    }

                    timeout = setTimeout(function() {
                        $.get(url, function(data) {
                            var $modalBody = $divBootstrapLogArea;
                            if (clearData) {
                                $modalBody.empty();
                            }
                            var $table = $('<div></div>');

                            for (var i = 0; i < data.length; i++) {
                                var $rowDiv = $('<div class="row"></div>');
                                var timeString = new Date().setTime(data[i].timestamp);
                                var date = new Date(timeString).toLocaleString(); //converts to human readable strings
                                //$rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));

                                if (data[i].err) {
                                    $rowDiv.append($('<div class="col-lg-12 col-sm-12" style="color:red;"></div>').append('<span>' + data[i].log + '</span>'));
                                } else {
                                    $rowDiv.append($('<div class="col-lg-12 col-sm-12 " style="color:white;"></div>').append('<span>' + data[i].log + '</span>'));
                                }

                                $table.append($rowDiv);
                            }


                            if (data.length) {
                                lastTimestamp = data[data.length - 1].timestamp;
                                console.log(lastTimestamp);
                                $modalBody.append($table);
                                $modalBody.scrollTop($modalBody[0].scrollHeight + 100);
                            }


                            console.log('polling again');
                            if ($launchResultContainer.data()['bs.modal'].isShown) {
                                pollLogs(lastTimestamp, 1000, false);
                            } else {
                                console.log('not polling again');
                            }
                        });
                    }, delay);
                }
                pollLogs(lastTimestamp, 0, true);

                $.get('../instances/' + data.id, function(data) {
                    $('#tabInstanceStatus').hide();
                    addInstanceToDOM(data);

                });

                // //Check if docker has been added.
                // $.get('/instances/dockercontainerdetails/' + data.id,function(data){
                //     if(JSON.stringify(data) != ""){
                //         $dockericon = $('<img src="img/galleryIcons/Docker.png" alt="Docker" style="width:42px;height:42px;margin-left:32px;" class="dockerenabledinstacne"/>');
                //         //find the instance card - to do instance table view update
                //         var $instancecard = $('div[data-instanceid="' + data.id + '"]');
                //         if($instancecard.find('.dockerenabledinstacne').length <= 0){
                //             $instancecard.find('.componentlistContainer').first().append($dockericon);
                //         }
                //      }
                // });


            }).error(function() {
                $launchResultContainer.find('.modal-body').empty().append('<span>Oops!!! Something went wrong. Please try again later</span>');
            });
        }
    });

    $('.desktopProvisioningLaunchBtn').click(function(e) {
        var $modalDesktopProvisioning = $('#modalDesktopProvisioningLaunch');
        var blueprintId = $modalDesktopProvisioning.data('blueprintId');
        var version = $modalDesktopProvisioning.data('blueprintVersion');;
        var reqBody = {};
        reqBody.version = version;
        reqBody.username = $('#instanceUsernameInput').val();
        reqBody.password = $('#instancePasswordInput').val();
        reqBody.instanceIP = $('#instanceIPInput').val();

        $modalDesktopProvisioning.modal('hide');
        var $launchResultContainer = $('#launchResultContainer');
        $launchResultContainer.find('.modal-body').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        $launchResultContainer.find('.modal-title').html('Provisioning Instance');
        $launchResultContainer.modal('show');


        $.post('/blueprints/' + blueprintId + '/provision', reqBody, function(data) {
            var $msg = $('<div></div>').append('<h3 class=\"alert alert-success\"><b>Congratulations!</b> Blueprint Launched Successfully</h3>').append('Instance Id : ' + data.id).append('<br/>Instance Logs :- ');

            $launchResultContainer.find('.modal-body').empty();
            $launchResultContainer.find('.modal-body').append($msg);

            var instanceId = data.id;
            var timeout;

            $launchResultContainer.on('hidden.bs.modal', function(e) {
                $launchResultContainer.off('hidden.bs.modal');
                if (timeout) {
                    clearTimeout(timeout);
                }
            });
            $divBootstrapLogArea = $('<div></div>').addClass('logsAreaBootstrap');

            $launchResultContainer.find('.modal-body').append($divBootstrapLogArea);

            var lastTimestamp;

            function pollLogs(timestamp, delay, clearData) {
                var url = '/instances/' + instanceId + '/logs';
                if (timestamp) {
                    url = url + '?timestamp=' + timestamp;
                }

                timeout = setTimeout(function() {
                    $.get(url, function(data) {
                        var $modalBody = $divBootstrapLogArea;
                        if (clearData) {
                            $modalBody.empty();
                        }
                        var $table = $('<div></div>');

                        for (var i = 0; i < data.length; i++) {
                            var $rowDiv = $('<div class="row"></div>');
                            var timeString = new Date().setTime(data[i].timestamp);
                            var date = new Date(timeString).toLocaleString(); //converts to human readable strings
                            //$rowDiv.append($('<div class="col-lg-4 col-sm-4"></div>').append('<div>' + date + '</div>'));

                            if (data[i].err) {
                                $rowDiv.append($('<div class="col-lg-12 col-sm-12" style="color:red;"></div>').append('<span>' + data[i].log + '</span>'));
                            } else {
                                $rowDiv.append($('<div class="col-lg-12 col-sm-12 " style="color:white;"></div>').append('<span>' + data[i].log + '</span>'));
                            }

                            $table.append($rowDiv);
                        }


                        if (data.length) {
                            lastTimestamp = data[data.length - 1].timestamp;
                            console.log(lastTimestamp);
                            $modalBody.append($table);
                            $modalBody.scrollTop($modalBody[0].scrollHeight + 100);
                        }


                        console.log('polling again');
                        if ($launchResultContainer.data()['bs.modal'].isShown) {
                            pollLogs(lastTimestamp, 1000, false);
                        } else {
                            console.log('not polling again');
                        }
                    });
                }, delay);
            }
            pollLogs(lastTimestamp, 0, true);
            $.get('/instances/' + data.id, function(data) {
                addInstanceToDOM(data);
            });

        }).error(function() {
            $launchResultContainer.find('.modal-body').empty().append('<span>Oops! Something went wrong. Please try again later</span>');
        });;



    });



    $('.blueprintUpdateBtn').click(function(e) {

        var $blueprintEditResultContainer = $('#blueprintEditResultContainer');
        var $selectedRunlist =  $blueprintEditResultContainer.find('.deploymentSelectedRunList');
        var blueprintId = $selectedRunlist.attr('data-blueprintId');
        if (blueprintId) {
            var runlist = [];
            var $inputs = $selectedRunlist.find('input');
            $inputs.each(function(){
                runlist.push($(this).val());
            });

            var blueprintData = {
                runlist: runlist,
                expirationDays: 0,
            };

            $.post('../blueprints/' + blueprintId + '/update', {
                blueprintUpdateData: blueprintData
            }, function(data) {
                $('.blueprintVersionDropDown[data-blueprintId="' + blueprintId + '"]').append($('<option value="' + data.version + '">' + data.version + '</option>').attr('selected', true));
                console.log(data);
                $blueprintEditResultContainer.modal('hide');
            });

        }
    });

    $('.btnUpdateInstanceRunlist').click(function(e) {
        bootbox.confirm("Update runlist?", function(result) {
            if (!result) {
                return;
            }
            $chefRunModalContainer = $('#chefRunModalContainer');
            var $selectedRunlist = $chefRunModalContainer.find('.deploymentSelectedRunList');
            var instanceId = $selectedRunlist.attr('data-instanceId');

            var runlist = [];
            var $inputs = $selectedRunlist.find('input');
            $inputs.each(function() {
                runlist.push($(this).val());
            });


            console.log(runlist);
            $.post('../instances/' + instanceId + '/updateRunlist', {
                runlist: runlist
            }, function(data) {
                $chefRunModalContainer.modal('hide');
                var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
                var $parentTr = $('#tableinstanceview tr[data-instanceId="' + instanceId + '"]');
                //console.log($('.domain-roles-caption[data-instanceId="' + instanceId + '"]'), $parent.find('.instance-bootstrap-list-image'));
                $parent.find('.instance-bootstrap-list-image').data('runlist', runlist);
                var $backRunlistContainer = $parent.parents('.card').find('.cardBackRunlistContaner').empty();
                for (var j = 0; j < runlist.length; j++) {
                    var $divComponentItem;

                    $divComponentItem = $('<span title="' + runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:130px;color:#3a87ad"></span>').addClass('instance-details-item').append(runlist[j]);
                    $backRunlistContainer.append($divComponentItem);
                }

                $parentTr.find('.instance-bootstrap-list-image').data('runlist', runlist);
                $parent.find('.moreInfo').trigger('click');
                console.log(data);
            }).fail(function(jxObj){

            });
        });


    });

    $('.actionControlPanel').click(function(e) {
        //var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li').length;
        var getbreadcrumbul = $('#ribbon').find('.breadcrumb').find('li');
        var getbreadcrumbullength = getbreadcrumbul.length;
        var DummyBreadCrumb;
        if(getbreadcrumbullength > 0)
        {
            //alert(getbreadcrumbullength);
            for(var counter=0;counter<getbreadcrumbullength;counter++){
                //alert('hi');
                var getbreadcrumbulname = getbreadcrumbul[counter].innerHTML;
                if(DummyBreadCrumb != null && DummyBreadCrumb != "" && DummyBreadCrumb !="undefined")
                {
                    DummyBreadCrumb += '>' + getbreadcrumbulname;
                }
                else
                {
                    DummyBreadCrumb = getbreadcrumbulname;
                }
            }
            localStorage.setItem("breadcrumb", DummyBreadCrumb);
        }

        var controlId = $(".visibleClass").attr("id");
        //alert(controlId);
        var urlText;
        localStorage.setItem("dataEx", location.href);


        if ($('#divinstancescardview').is(':visible')) {

            var $selectedCard = $('.role-Selectedcard');
            //console.log($selectedCard.length);
            if ($selectedCard.length) {
                var instanceId = $selectedCard.find('.domain-roles-caption').attr('data-instanceId');
                if (instanceId) {
                    urlText = 'index.html#ajax/Controlpanel.html?org='+urlParams.org+'&id=' + instanceId + '&visibleControlid=' + controlId ;
                    window.location.href = urlText;
                    // window.location.href = 'index.html#ajax/Controlpanel.html?org='+urlParams.org+'&id=' + instanceId;
                }
            }
        } else {
            var $selectedCard = $('.rowcustomselected');
            if ($selectedCard.length) {
                var instanceId = $selectedCard.attr('data-instanceId');
                if (instanceId) {
                    urlText = 'index.html#ajax/Controlpanel.html?org='+urlParams.org+'&id=' + instanceId + '&visibleControlid=' + controlId ;
                    //localStorage.setItem("dataEx", urlText);
                    window.location.href = urlText;
                    // window.location.href = 'index.html#ajax/Controlpanel.html?org='+urlParams.org+'&id=' + instanceId;
                }
            }
        }
    });

    function showHideControl(objID)
    {
        if(objID)
        {
            if(objID == "divinstancescardview" || objID == "defaultViewButton")
            {
                $("#divinstancestableview").removeClass("visibleClass");
                $("#divinstancescardview").addClass("visibleClass");
                $("#divinstancestableview").hide();
                $("#divinstancescardview").show();
            }
            else
            {

                $("#divinstancestableview").addClass("visibleClass");
                $("#divinstancescardview").removeClass("visibleClass");
                $("#divinstancestableview").show();
                $("#divinstancescardview").hide();
            }
            //localStorage.clear();
        }
    }
    window.onload= getViewTile();

    function getViewTile(){
        var locationData = localStorage.getItem("ControlID");
        if(locationData)
        {
            showHideControl(locationData);
            //alert("clearing");
            //localStorage.clear();
        }
    }

    function loadcarousel() {
        $('.carousel.slide').carousel({
            interval : false,
            cycle : false
        });

    }
    loadcarousel();

</script>
<script type="text/javascript">
    // $(document).ready(function() {
    //   $('#tableinstanceview tbody').on('click','tr',function () {
    //       $(this).toggleClass('selected');
    //   });
    // });

</script>
