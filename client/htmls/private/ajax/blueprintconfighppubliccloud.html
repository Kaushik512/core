<ul class="nav nav-tabs">
<li class="pull-left active">
 <a href="#l2" id="tabheader3" data-toggle="tab">Configure Blueprint</a>
 </li>
</ul>
<div class="tab-pane" id="blueprintconfigdiv" style="padding-bottom:20px;">
    <div class="row" style="padding-top:5px">
        <div class="col-lg-12">
            <div class="col-lg-2">
                <div class="row  selectedTemplateArea" style="margin-bottom:10px;padding-left:10px;margin-left:0px;margin-right:0px;">
                </div>
                <select id="providerId" name="providerId" class="required chooseOSProvider width-100 ">
                                        </select>
            </div>
            <div class="col-lg-10">
                <div class="panel-group smart-accordion-default" id="accordion-Design">
                    <div class="panel panel-default divconfigureparameterrunlist">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                            	<a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseConfigureproviderParameter"> 
                            		<i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>
                            		Configure Provider Parameters
                            	</a>
                            </h4>
                        </div>
                        <div id="CollapseConfigureproviderParameter" class="panel-collapse collapse in">
                            <div class="panel-body" style="padding-left: 20px;">
                                <div class="col-lg-6 col-md-6">
                                    <label for="instanceOS">Choose Operating System:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="instanceOS" name="instanceOS" class="required chooseOS width-100">
                                        </select>
                                    </div>
                                </div>
                                <!-- <div class="col-lg-6 col-md-6">
                                    <label for="providerId">Choose Provider:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        
                                    </div>
                                </div> -->
                                <div class="col-lg-6 col-md-6">
                                    <label for="imageId">Choose Available Images:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="imageId" name="imageId" class="required chooseSecurity width-100">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                    <label for="region">Choose Flavour:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="openstackflavour" name="openstackflavour" class="required chooseSecurity width-100">
                                            <option value="">Select Flavour</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                    <label for="region">Network:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="openstacknetwork" name="openstacknetwork" class="chooseSecurity width-100">
                                            <option value="">Select Network</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                    <label for="region">Subnet:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="openstacksubnet" name="openstacksubnet" class="chooseSecurity width-100">
                                            <option value="">Select Subnet</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                    <label for="region">Security Group:<span style="color:red">*</span></label>
                                    <div class="input-groups">
                                        <select id="openstacksecuritygroup" name="openstacksecuritygroup" class="chooseSecurity width-100">
                                            <option value="">Select Group</option>
                                        </select>
                                    </div>
                                </div>
                                
                              
                            </div>
                        </div>
                        <div class="panel panel-default divOrganizationParameter">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditorgParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Organization Parameters</a>
                                </h4>
                            </div>
                            <div id="CollapseEditorgParam" class="panel-collapse collapse">
                                <div class="panel-body" style="padding-left: 8px;">
                                    <div class="col-lg-6 col-md-6">
                                        <label for="orgnameSelect">Choose Organization <span style="color:red">*</span></label>
                                        <div class="input-groups">
                                            <select id="orgnameSelect" name="orgnameSelect" class="required chooseOrgselect2 width-100">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6">
                                        <label for="blueprintNameInput">Enter Blueprint Name:
                                            <span style="color:Red;" class="control-label">&nbsp;*</span></label>
                                        <div class="input-groups">
                                            <input id="blueprintNameInput" name="blueprintNameInput" class="required form-control" type="text" autofocus="autofocus">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                        <label for="bgListInput">Choose Business Group <span style="color:red">*</span>
                                        </label>
                                        <div class="input-groups">
                                            <select id="bgListInput" name="bgListInput" class="required chooseBG width-100">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                        <label for="projectListInput">Choose Project <span style="color:red">*</span>
                                        </label>
                                        <div class="input-groups">
                                            <select id="projectListInput" name="projectListInput" class="required chooseProject width-100">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default divRunlistParameter notforCFT notForDocker">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditRunlistParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Runlist Parameters</a></h4>
                            </div>
                            <div id="CollapseEditRunlistParam" class="panel-collapse collapse">
                                <div class="panel-body" style="padding-left: 8px;">
                                    <div class="col-lg-6 col-md-6 notForDocker notforCFT" style="margin-top:19px">
                                        <label>
                                            <i style="color:#40baf1;font-size:16px;" class="ace-icon fa fa-list-ul"></i> Edit Runlist
                                        </label>
                                        <a href="#chefRunlistModal" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;margin-top:6px;" class="addList" rel="tooltip" data-placement="top" title="Edit Runlist" /></a>
                                        <div style="height:146px;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                            <table id="tableRunlistForBlueprint" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center" ;>
                                                <thead>
                                                    <tr class="rowCustomStyle">
                                                        <th style="text-align:center">View Runlist</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-md-4 notForDocker notforCFT" style="margin-top:25px;margin-left:2px;"><a style="font-size:14px!important" href="#modalForHelp" data-toggle="modal" id="dokuNew"><i class="fa fa-question"></i>&nbsp;Help</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default appSeriesNameURL notForDocker notforCFT">
                            <div class="panel-heading">
                                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseApp" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Application URL</a></h4>
                            </div>
                            <div id="CollapseApp" class="panel-collapse collapse">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-12">
                                            <div class="widget-box">
                                                <div class="widget-header">
                                                    <h5 class="widget-title" style="color:#4e5964;"><strong>Application URL</strong></h5>
                                                    <div class="widget-toolbar no-border">
                                                        <a id="newAppSeries" class="btn btn-minier btn-primary" href="#modalAppNameURL" data-toggle="modal">
                                                            <i class="ace-icon ace-icon fa fa-plus bigger-110"></i> New
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="widget-body">
                                                    <div class="widget-main" style="min-height:100px">
                                                        <div class="col-md-12 table-responsive" style="padding-left:0px; padding-right:0px;">
                                                            <table id="appTable" class="hidden" cellpadding="5px" width="100%">
                                                                <thead>
                                                                    <tr class="rowCustomStyle">
                                                                        <td>Name</td>
                                                                        <td>URL</td>
                                                                        <td>Action</td>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr class="hidden rowtemplate">
                                                                        <td datafield="appName"></td>
                                                                        <td datafield="appURL"></td>
                                                                        <td>
                                                                            <div class="btn-group tableactionWidth">
                                                                                <button class="btn btn-xs btn-danger pull-left" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button>
                                                                                <a class="btn btn-xs btn-info pull-left" title="Update">
                                                                                    <i class="ace-icon fa fa-pencil bigger-120"></i>
                                                                                </a>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <table id="appUrlTable" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center" ;>
                                                                <thead>
                                                                    <tr class="rowCustomStyle">
                                                                        <td style="width:20%">Name</td>
                                                                        <td style="width:40%">URL</td>
                                                                        <td style="width:20%" class="">Action</td>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td colspan=3 id="appEntry">No Data Available</td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div id="envtable_tools1"></div>
                                                            <div class="col-md-5">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="widget-toolbox padding-8 clearfix dataTables_wrapper">
                                                        <div id="tableFooterLeft" class="pull-left"></div>
                                                        <div id="tableFooterRight" class="pull-right"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--collapseapp ends here-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

    // var initblueprintconfig = function(index){
    // 	if ($('#individualTemplateNameGrid .role-Selected').length > 0) {
    //             console.log('cloning');
    //             $('#blueprintconfigdiv .selectedTemplateArea').empty().append($('#individualTemplateNameGrid .role-Selected').clone());
    //         }
    // }
     $('document').ready(function() {
        $('select').select2().trigger('change');
        //alert(JSON.stringify(selectedProvider));
        if(selectedProvider){
            var option = '<option selected="selected" value="' + selectedProvider.providerId + '">' + selectedProvider.providerName + '</option>';
            
            $('#providerId').on('change',function(){
                loadData();
            });
            $('#providerId').append(option).select2().trigger('change');
        }
    });
    function loadData() {
        //loading images for provider
        $.get("/vmimages/providers/" + selectedProvider.providerId, function(data) {
            var str = ' <option value="">Select Image</option>',
                data = getFilteredList(data, $('#instanceOS').val()),
                len = data.length;
           // alert('in');
            str = str + helperConstructOption(data, ['providerId', 'vType', 'osType', '_id'], 'name', 'imageIdentifier');
            $('#imageId').html(str);

            //setting image value for ami type and disabling it- vn
            if ($('.productdiv2.role-Selected').first().attr('templatetype') == 'ami') {
                var vmimage = JSON.parse($('.productdiv2.role-Selected').first().attr('imagedata'));
                $('#imageId').val(vmimage.imageIdentifier).attr('disabled', 'disabled');
            }
            //setting the selection
            $('#imageId').select2().trigger('change');
        });

        //loading os's
        $.get('../aws/ec2/amiids', function(data) {
            var $instanceOS = $('#instanceOS');
            $instanceOS.append('<option value="">Select Operating System</option>')
            for (var i = 0; i < data.length; i++) {
                $option = $('<option data-instanceOS="' + data[i].osType + '" value="' + data[i].os_name + '">' + data[i].os_name + '</option>');
                $option.data('supportedInstanceType', data[i].supportedInstanceType);
                $instanceOS.append($option);
            }
            var $instanceType = $('#intanceTypeControl');
            $instanceOS.change(function(e) {
                $instanceType.empty();

                $selectedOption = $(this).find('option:selected');
                var supportedInstanceType = $selectedOption.data('supportedInstanceType');
                console.log(supportedInstanceType);
                if (typeof supportedInstanceType != 'undefined') {
                    for (var i = 0; i < supportedInstanceType.length; i++) {
                        var $option = $('<option></option>').val(supportedInstanceType[i]).html(supportedInstanceType[i]);
                        $instanceType.append($option);
                    }
                }
                $instanceType.select2();


            });
            $instanceOS.select2();
            $instanceOS.trigger('change');
        });
        
        //load org parms
       // alert(JSON.stringify(selectedProvider));
        loadOrgParams(selectedProvider.orgId);

        //loading provider specific selections
        $.get('/hppubliccloud/' + selectedProvider.providerId + '/flavors', function(data) {
                if (data) {
                    var str = ' <option value="">Select Flavors</option>';
                    var data = JSON.parse(JSON.stringify(data));
                    for (var i = 0; i < data.flavors.length; i++) {
                        str += '<option value="' + data.flavors[i].id + '">' + data.flavors[i].name + '</option>';
                        //alert(str);
                    }
                    $('#openstackflavour').html(str);
                    $('#openstackflavour').select2().trigger('change');
                }
            });

            $.get('/hppubliccloud/' + selectedProvider.providerId + '/networks', function(data) {
                if (data) {
                    var str = ' <option value="">Select Network</option>';
                    var data = JSON.parse(JSON.stringify(data));
                    for (var i = 0; i < data.networks.length; i++) {
                        str += '<option value="' + data.networks[i].id + '" subnets="' + data.networks[i].subnets.join() + '">' + data.networks[i].name + '</option>';
                        //alert(str);
                    }
                    $('#openstacknetwork').html(str);
                    $('#openstacknetwork').select2().trigger('change');
                    $('#openstacknetwork').on('change', function() {
                        // alert($(this).find(':selected').attr('subnets'));
                        var ss = ' <option value="">Select Subnet</option>';
                        var subn = $(this).find(':selected').attr('subnets').split(',');

                        for (var i = 0; i < subn.length; i++) {
                            ss += '<option value="' + subn[i] + '">' + subn[i] + '</option>';
                        }

                        $('#openstacksubnet').html(ss);
                        $('#openstacksubnet').select2().trigger('change');
                    });
                }
            });

            $.get('/hppubliccloud/' + selectedProvider.providerId + '/securityGroups', function(data) {
                if (data) {
                    var str = ' <option value="">Select Group</option>';
                    var data = JSON.parse(JSON.stringify(data));
                    for (var i = 0; i < data.security_groups.length; i++) {
                        str += '<option value="' + data.security_groups[i].id + '">' + data.security_groups[i].name + '</option>';
                        //alert(str);
                    }
                    $('#openstacksecuritygroup').html(str);
                    $('#openstacksecuritygroup').select2().trigger('change');
                }
            });
    }

    </script>