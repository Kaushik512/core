<div class="row">

    <article class="col-sm-12 col-md-12 col-lg-12">

        <div class="widget-body" style="font-size:12px;">

            <ul id="myTab3" class="nav nav-tabs tabs-pull-left">
                <!--<li class="active">
                    <a href="#l1" data-toggle="tab">Domains</a>
                </li>-->
                <li class="pull-left active">
                    <a href="#l2" data-toggle="tab">Create Blueprint</a>
                </li>
                <!--<li class="pull-left">
                    <a href="#l3" data-toggle="tab">App Factory</a>
                </li>
                <li class="pull-left">
                    <a href="#l4" data-toggle="tab">Enviornments</a>
                </li>
                <li class="pull-left">
                    <a href="#l5" data-toggle="tab">Usage</a>
                </li>-->
            </ul>

                <div id="myTabContent3" class="nav tab-content">


                    <div class="tab-pane fade in active" id="l2">


                        <section id="widget-grid" class="">


                            <div class="row">


                                <article class="col-sm-12 col-md-12 col-lg-12">


                                    <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-editbutton="false" data-widget-deletebutton="false">



                                        <div role="content">


                                            <div class="jarviswidget-editbox">


                                            </div>

                                            <div class="widget-body">

                                                <div class="row">
                                                    <form id="wizard-1" novalidate="novalidate">
                                                        <div id="bootstrap-wizard-1" class="col-sm-12">
                                                            <div class="form-bootstrapWizard">
                                                                <ul class="bootstrapWizard form-wizard" style="margin-left:13%;display:none">
                                                                    <li class="active" data-target="#step1">
                                                                        <a href="#tab1" data-toggle="tab"> <span class="step">1</span>  
                                                                            <span class="title"><b></b></span> 
                                                                        </a>
                                                                    </li>
                                                                    <li data-target="#step2">
                                                                        <a id="addlink" data-target='#tab2' data-toggle="tab" onclick="">

                                                                            <span class="step">2</span>  
                                                                            <span class="title"><b></b></span>
                                                                        </a>
                                                                    </li>
                                                                    <li data-target="#step3">
                                                                        <a href="#tab3" data-toggle="tab">
                                                                            <span class="step">3</span>  <span class="title"><b></b></span> 
                                                                        </a>
                                                                    </li>
                                                                    <li data-target="#step4">
                                                                        <a href="#tab4" data-toggle="tab">
                                                                            <span class="step">4</span>  <span class="title"><b></b></span> 
                                                                        </a>
                                                                    </li>
                                                                    <li data-target="#step5">
                                                                        <a href="#tab5" data-toggle="tab">
                                                                            <span class="step">4</span>  <span class="title"><b></b></span> 
                                                                        </a>
                                                                    </li>

                                                                </ul>
                                                                <div class="clearfix"></div>
                                                            </div>
                                                            <div class="tab-content">
                <div class="tab-pane active" id="tab1" style="height: 250px;overflow-y: auto;">
                   
                    <div class="row " style="margin:0px;min-height:200px;">
                        <!--App Factory -->
                        <div class="" style="width:222px;float:left">

                            <div class="blueprintdiv appfactory role-Selected" data-templateType="templatesAppfactory">
                               <div style="">
                                  <img  style="height:25px;padding:2px" alt="JBoss Stack" src="img/app-store-icons/Logoheader.png">
                                  <span style="padding-top:4px;position:absolute;padding-left: 4px;"><b>AppFactory</b></span> 
                                </div>
                                <div style="padding-top:10px;padding-left:27px;">
                                    <img  style="" alt="JBoss Stack" src="img/app-store-icons/Appfactory.png">
                                </div>

                            </div>
                        </div>
                         
                        <!--Devops Roles-->
                        <div class="" style="width:222px;float:left">

                            <div class="blueprintdiv devopsrole" data-templateType="templatesdevopsrole">
                                <div>
                                  <img style="height:25px;padding:2px;" alt="Logoheader" src="img/app-store-icons/Logoheader.png">
                                  <span style="padding-top:4px;position:absolute;padding-left: 4px;"><b>DevopsRoles</b></span> 
                                </div>
                                <div style="padding-top:10px;padding-left:20px;"><img alt="DevOps Role" src="img/app-store-icons/DevopsRoles.png"></div>

                            </div>
                        </div>
                    </div>
                </div>
                                                                
                <div class="tab-pane" id="tab2" style="height:450px;overflow-y: auto;">

                </div>

                <div class="tab-pane" id="tab3" style="height:450px;overflow-y: auto;">
                                                                    
                </div>
                                                                
                <div class="tab-pane" id="tab4" style="height:450px;overflow-y: auto;">
                                                                                                    
                </div>

                <div class="tab-pane" id="tab5" style="height:450px;overflow-y: auto;">

                </div>
                                                                <div class="col-lg-6">
                                                                    <h3>New features available in the next version release...</h3>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>

                                            </div>


                                        </div>


                                    </div>


                                </article>

                            </div>

                        </section>

                    </div>

                </div>

            </div>
        <!--<footer style="position: fixed; bottom: 0">
            <div class="clearfix form-actions" style="text-align:center">

                <div class="btn-group">
                    <ul class="pager wizard no-margin">

                        <li class="previous disabled">
                            <a href="javascript:void(0);" class="btn btn-primary" style="border-radius:0px"> Previous </a>
                        </li>

                        <li class="next">
                            <a href="javascript:void(0);" class="btn btn-primary" style="border-radius:0px;margin-left:5px;"> Next </a>
                        </li>
                    </ul>
                    
                </div>
            </div>
        </footer>-->

    </article>
    

</div>
<script type="text/javascript">
    
</script>


<script type="text/javascript">
 var reqBody;
$('#bootstrap-wizard-1').bootstrapWizard({
    'tabClass': 'form-wizard',
    'onNext': function (tab, navigation, index) {
        console.log(navigation,index)
        if (index === 1) {
            //console.log('in here')

            var $selectedItem = $('.role-Selected');
            if (!$selectedItem.length) {
                alert('please choose a blueprint design')
                return false;
            }
            var $clone = $selectedItem.clone().removeClass('role-Selected');
            $('#tab' + (index + 1)).find('.temp').empty().append($clone);

        } else if(index == 2){
            var $selectedTemplateArea = $('.selectedTemplateArea')
            var $selectedItem = $selectedTemplateArea.find('.productdiv2');
            console.log($selectedItem.length);
            if(!$selectedItem.length) {
              alert('please choose a template');
              return false;
            }
           

        } else if(index == 3){
            var $selectedTemplateArea = $('.selectedTemplateArea')
            var $selectedItem = $selectedTemplateArea.find('.productdiv2');
            console.log($selectedItem.length);
            if(!$selectedItem.length) {
              alert('please choose a template');
              return false;
            }

            if($('#orgnameSelect').val() === 'choose') {
                alert('please choose an Organization');
                return false;
            }


            reqBody = {};
            reqBody.templateId = $selectedItem.attr('data-templateId');
            reqBody.templateType = $selectedItem.attr('data-templateType');
            reqBody.templateComponents = $selectedItem.attr('data-templateComponent').split(',');
            reqBody.runlist = $('#cookbookSelect').val();
            reqBody.chefServerId = $('#cookbookSelect').data('chefServerId')
            reqBody.instanceType = $('.instanceType').val();
            console.log(reqBody);


        } else if(index == 4){
            reqBody.projectId = $('#projectListInput').val();
            reqBody.envId = $('#envList').val();
            reqBody.name =$('#blueprintNameInput').val();
            if(!reqBody.name) {
                alert("Please enter a blueprint name");
                return false;
            }
            if(!reqBody.projectId || reqBody.projectId  === 'choose') {
                alert("Please choose a project");
                return false;
            }

            if(!reqBody.envId || reqBody.envId  === 'choose') {
                alert("Please choose an environment");
                return false;
            }



            console.log('pushing');
            $.post('/projects/'+reqBody.projectId+'/environments/'+reqBody.envId+'/blueprints',{
                blueprintData:reqBody
            },function(data){
             console.log(data);
            })
            console.log('final',reqBody);
        } 


        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).addClass(
            'complete');
        $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index - 1).find('.step')
        .html('<i class="fa fa-check"></i>');
            //$('#tab'+(index)).removeClass('active');
            //$('#tab'+(index+1)).addClass('active');
            //return true;


        },
        'onPrevious': function (tab, navigation, index) {
            //console.log(index);
            $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index + 1).removeClass(
                'complete');
            $('#bootstrap-wizard-1').find('.form-wizard').children('li').eq(index + 1).find('.step')
            .html(index + 2);

        }
    });


    var $rolesCards = $('.blueprintdiv')

    $('.blueprintdiv').click(function (e) {
        $rolesCards.removeClass('role-Selected');
        if ($(this).hasClass('role-Selected')) {
            $(this).removeClass('role-Selected');
        } else {
            $(this).addClass('role-Selected');
        }
        $('.templates').hide();
        console.log($(this).attr('data-templateType'));
        $('.'+$(this).attr('data-templateType')).show();
        //$('.next a').attr('disabled',false);
    })

    var $selectedTemplate = $('.productdiv2').click(function(e){
              $selectedTemplate.removeClass('role-Selected');

              var $this = $(this);
              $('.selectedTemplateArea').empty().append($this.clone(false).css({'cursor':'auto'}));

              $this.addClass('role-Selected');
    });

     $.ajax({
                    type: "get",
                    dataType: "json",

                    async: false,
                    url: "/organizations/getTree",
                    success:function(data){
                        var $orgListInput = $('#orgnameSelect');
                        $orgListInput.append($('<option></option>').val('choose').html('Choose'));
                        $bgList = $('#bgListInput');
                        var $envList = $('#envList');
                        for(var i=0;i<data.length;i++) {
                            $orgListInput.append($('<option></option>').val(data[i].name).html(data[i].name).data('bglist',data[i].businessGroups).data('envList',data[i].environments));
                        }
                        $orgListInput.change(function(e){
                             var orgName = $(this).val();
                             if(orgName == 'choose') {
                                return;
                             }
                             var $selectedOrgOption =  $(this).find(":selected");
                            $bgList.empty();
                            $bgList.append($('<option></option>').val('choose').html('Choose'));
                            var getBGs =  $selectedOrgOption.data('bglist');
                            for(var i=0;i<getBGs.length;i++) {
                                $bgList.append($('<option></option>').val(getBGs[i].name).html(getBGs[i].name).data('projList',getBGs[i].projects));
                            }
    
                             $envList.empty();
                            var getEnv = $selectedOrgOption.data('envList');
                            for(var i=0;i<getEnv.length;i++) {
                                 $envList.append($('<option></option>').val(getEnv[i]).html(getEnv[i]));
                            }
                            $('.cookbookShow img').remove();
                             $('#cookbookSelect').hide();
                            $('.cookbookShow').append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');



                            $.ajax({
                            url:'/organizations/'+orgName+'/cookbooks',
                            method:'GET',
                            async:false,
                            success :function(data) {
                             var keys = Object.keys(data.cookbooks);
                             $('.cookbookShow img').remove();
                             var $cookbooksList = $('#cookbookSelect').data('chefServerId',data.serverId); 
                             for(var i=0;i<keys.length;i++) {
                                var $option =  $('<option></option>').append(keys[i]).val('recipe['+keys[i]+']');
                                $cookbooksList.append($option);
                             }
                             $cookbooksList.show();
                             $cookbooksList.multiSelect({});
                            },
                          });    

                        });

                        var $projectList = $('#projectListInput');
                            $bgList.change(function(e){
                            var bgName = $(this).val();
                            if(bgName == 'choose') {
                                return;
                            }
                            var $selectedOrgOption =  $(this).find(":selected");
                            $projectList.empty();
                            $projectList.append($('<option></option>').val('choose').html('Choose'));
                            var getProjs = $selectedOrgOption.data('projList');
                            for(var i=0;i<getProjs.length;i++) {
                                $projectList.append($('<option></option>').val(getProjs[i]).html(getProjs[i]));
                            }
                        });

                    }
                });


/*
 $.ajax({
    url:'/chef/cookbooks',
    method:'GET',
    async:false,
    success :function(data) {
        var keys = Object.keys(data);
        var $cookbooksList = $('#cookbookSelect'); 
          for(var i=0;i<keys.length;i++) {
            var $option =  $('<option></option>').append(keys[i]).val('recipe['+keys[i]+']');
            $cookbooksList.append($option);
          }
        $cookbooksList.multiSelect({});
    },
 })*/
 /*$.get('/chef/cookbooks',function(data){
    var keys = Object.keys(data);
    var $cookbooksList = $('#cookbookSelect'); 
        for(var i=0;i<keys.length;i++) {
         var $option =  $('<option></option>').append(keys[i]).val('recipe['+keys[i]+']');
         $cookbooksList.append($option);
    }
    $cookbooksList.multiSelect({});


});*/



</script>

