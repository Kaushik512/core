<html>
  <head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"> </link>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"></link>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="css/Dashboard.css">
    <link rel="stylesheet" type="text/css" media="screen" href="css/application.css">
    </script>
    </script>
  </head>
  <body>
    <div class="panel-group smart-accordion-default">
      <div class="panel panel-default" id="accordion-Infrastructure">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion-Infrastructure" href="#collapseInfrastructure" > 
                <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> 
                <i class="fa fa-fw fa-minus-circle txt-color-blue"></i>
                <b style="color:#3a87ad;font-size:12px;">Infrastructure</b>
              </a>
           </h4>
            <!-- <a href="#modaldashboardinfrastructurecardConfigure" data-toggle="modal" class="createAppConfigure" style="float:right;margin-top:-30px">
              <i class="fa fa-th fa-cogs" style="margin-right: 5px; color: rgb(64, 186, 241); font-size: 18px;"></i>
            </a> -->
          </div>

          <div class="row rowTemplate" style="display:none">
          
          </div>


          <div class="col-lg-3 col-md-3 col-xs-6 childProviderTemplate" style="display:none">
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3>&nbsp;</h3>
                <p>
                  <div style="margin-top:-15px;">Provider name </div>
                  <br>
                  <span class="providerName" style="font-weight:bold"></span>
                </p>
              </div>
              <div class="icon">
                <i class="fa fa-th"></i>
              </div>
              <a class="small-box-footer" href="#">
                More info <i class="fa fa-arrow-circle-right"></i>
              </a>
            </div>
          </div>


          <div class="col-lg-3 col-md-3 col-xs-6 childTotalInstanceTemplate" style="display:none">
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3>0</h3>
                <p> <br>No. of Instances</p>
              </div>
              <div class="icon">
                <i class="fa fa-laptop"></i>
              </div>
              <a class="small-box-footer" href="#">
                More info <i class="fa fa-arrow-circle-right"></i>
              </a>
            </div>
          </div>


          <div class="col-lg-3 col-md-3 col-xs-6 childManagedInstanceTemplate" style="display:none">
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3 class="countMangedInstance">0</h3>
                <p> <br>No. of Managed Instances</p>
              </div>
              <div class="icon">
                <i class="fa fa-cube"></i>
              </div>
              <a class="small-box-footer" href="#">
                More Info <i class="fa fa-arrow-circle-right"></i>
              </a>
            </div>
          </div>
          


          <div class="col-lg-3 col-md-3 col-xs-6 childUnmanagedInstanceTemplate" style="display:none">
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3 class="countUnmangedInstance">0</h3>
                <p> <br>No. of Unmanaged Instances</p>
              </div>
              <div class="icon">
                <i class="fa fa-external-link"></i>
              </div>
              <a class="small-box-footer" href="#">
               More info <i class="fa fa-arrow-circle-right"></i>
              </a>
            </div>
          </div>




          <div id="collapseInfrastructure" class="panel-collapse collapse in">
            <div class="panel-body">
              <div id="infrastructurecardview">
                <div class="row">
                  <div class="col-lg-3 col-md-3 col-xs-6 infrastructureClass" data-text="Total Number of Providers">
                    <div class="small-box bg-aqua">
                      <div class="inner">
                        <h3 id="totalProviders">&nbsp;</h3>
                        <p>Total <br>Number of Providers</p>
                      </div>
                      <div class="icon">
                        <i class="fa fa-th"></i>
                      </div>
                      <a id="providerMoreInfo" class="small-box-footer" href="#">
                        More info <i class="fa fa-arrow-circle-right"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-3 col-xs-6 infrastructureClass" data-text="Total Instances">
                    <div class="small-box bg-aqua">
                      <div class="inner">
                        <h3 id="totalInstances">&nbsp;</h3>
                        <p>Total <br>No. of Instances</p>
                      </div>
                      <div class="icon">
                        <i class="fa fa-laptop"></i>
                      </div>
                      <a id="totalInstancesMoreInfo" class="small-box-footer" href="#">
                        More info <i class="fa fa-arrow-circle-right"></i>
                      </a>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-3 col-xs-6 infrastructureClass" data-text="Total Managed Instances">
                    <div class="small-box bg-aqua">
                      <div class="inner">
                        <h3 id="managedInstances">&nbsp;</h3>
                        <p>Total <br>No. of Managed Instances</p>
                      </div>
                      <div class="icon">
                        <i class="fa fa-cube"></i>
                      </div>
                      <a id="totalmanagedInstancesMoreInfo" class="small-box-footer" href="#">
                        More Info <i class="fa fa-arrow-circle-right"></i>
                      </a>
                    </div>
                  </div>
                  
                  <div class="col-lg-3 col-md-3 col-xs-6 infrastructureClass" data-text="Total Spend in Today">
                    <div class="small-box bg-aqua">
                      <div class="inner">
                        <h3 id="totalunmanagedInstances">&nbsp;</h3>
                        <p>Total <br>No. of Unmanaged Instances</p>
                      </div>
                      <div class="icon">
                        <i class="fa fa-external-link"></i>
                      </div>
                      <a id="unmanagedInstancesMoreInfo" class="small-box-footer" href="#">
                       More info <i class="fa fa-arrow-circle-right"></i>
                      </a>
                    </div>
                  </div>

                </div>
                <div id="awsProviderView">
                </div>
                <div id="openstackProviderView">
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
  </body>
<script type="text/javascript">
  $(document).ready(function() {
    $.get('../allproviders/list', function(totalProviders) {
      var totalCountProviders;
      var awsProvidersCount = totalProviders.awsProviders.length;
      var openstackProvidersCount = totalProviders.openstackProviders.length;
      var vmwareProvidersCount = totalProviders.vmwareProviders.length;
      var hpPlublicCloudProvidersCount = totalProviders.hpPlublicCloudProviders.length;
      var azureProvidersCount = totalProviders.azureProviders.length;

      totalCountProviders = awsProvidersCount + openstackProvidersCount + vmwareProvidersCount + hpPlublicCloudProvidersCount + azureProvidersCount;
      $('#totalProviders').empty();
      $('#awsProviderView').empty();
      $('#openstackProviderView').empty();
      $('#totalProviders').append(totalCountProviders);
      for(var i=0;i<awsProvidersCount;i++){
        //alert(totalProviders.awsProviders[i].providerName);
        var $rowTemplate = $('.rowTemplate').clone();
        $rowTemplate.removeClass('rowTemplate');

        var $childProviderTemplate = $('.childProviderTemplate').clone();
        $childProviderTemplate.removeClass('childProviderTemplate');
        var awsSpecificProvName = totalProviders.awsProviders[i].providerName;
        $childProviderTemplate.find('.providerName').empty().append(awsSpecificProvName);

        var providerId = totalProviders.awsProviders[i]._id;
        var totalInstances;
        //var managedInstances;
        //var unmanagedInstances;

        var $childManagedInstanceTemplate = $('.childManagedInstanceTemplate').clone();
        $childManagedInstanceTemplate.removeClass('childManagedInstanceTemplate');
        $.get('../providers/'+providerId+'/managedInstances', function(data) {
          $childManagedInstanceTemplate.find('.countMangedInstance').empty().append(data.length);
          //managedInstances = data.length;
          //alert(managedInstances);
        });


        var $childUnmanagedInstanceTemplate = $('.childUnmanagedInstanceTemplate').clone();
        $childUnmanagedInstanceTemplate.removeClass('childUnmanagedInstanceTemplate');
        $.get('../providers/'+providerId+'/unmanagedInstances', function(data) {
          $childUnmanagedInstanceTemplate.find('.countUnmangedInstance').empty().append(data.length);
          //unmanagedInstances = data.length;
        });

        var $childTotalInstanceTemplate = $('.childTotalInstanceTemplate').clone();
        $childTotalInstanceTemplate.removeClass('childTotalInstanceTemplate');
        //totalInstances = managedInstances + unmanagedInstances;
        //alert(totalInstances);

        
        $rowTemplate.append($childProviderTemplate);
        $rowTemplate.append($childTotalInstanceTemplate);
        $rowTemplate.append($childManagedInstanceTemplate);
        $rowTemplate.append($childUnmanagedInstanceTemplate);


        $childUnmanagedInstanceTemplate.css({display:'block'});
        $childManagedInstanceTemplate.css({display:'block'});
        $childTotalInstanceTemplate.css({display:'block'});
        $childProviderTemplate.css({display:'block'});
        $rowTemplate.css({display:'block'});
        $('#awsProviderView').append($rowTemplate);
      }
      /*for(var i=0;i<openstackProvidersCount;i++){
        //alert(totalProviders.awsProviders[i].providerName);
        var $rowTemplate = $('.rowTemplate').clone();
        $rowTemplate.removeClass('rowTemplate');

        var $childProviderTemplate = $('.childProviderTemplate').clone();
        $childProviderTemplate.removeClass('childProviderTemplate');
        var openstackSpecificProvName = totalProviders.openstackProviders[i].providerName;
        $childProviderTemplate.find('.providerName').empty().append(openstackSpecificProvName);

        var providerId = totalProviders.openstackProviders[i]._id;
        var totalInstances;
        //var managedInstances;
        //var unmanagedInstances;

        var $childManagedInstanceTemplate = $('.childManagedInstanceTemplate').clone();
        $childManagedInstanceTemplate.removeClass('childManagedInstanceTemplate');
        // $.get('../providers/'+providerId+'/managedInstances', function(data) {
        //   $childManagedInstanceTemplate.find('.countMangedInstance').empty().append(data.length);
        //   //managedInstances = data.length;
        //   //alert(managedInstances);
        // });


        var $childUnmanagedInstanceTemplate = $('.childUnmanagedInstanceTemplate').clone();
        $childUnmanagedInstanceTemplate.removeClass('childUnmanagedInstanceTemplate');
        // $.get('../providers/'+providerId+'/unmanagedInstances', function(data) {
        //   $childUnmanagedInstanceTemplate.find('.countUnmangedInstance').empty().append(data.length);
        //   //unmanagedInstances = data.length;
        // });

        var $childTotalInstanceTemplate = $('.childTotalInstanceTemplate').clone();
        $childTotalInstanceTemplate.removeClass('childTotalInstanceTemplate');
        //totalInstances = managedInstances + unmanagedInstances;
        //alert(totalInstances);

        
        $rowTemplate.append($childProviderTemplate);
        $rowTemplate.append($childTotalInstanceTemplate);
        $rowTemplate.append($childManagedInstanceTemplate);
        $rowTemplate.append($childUnmanagedInstanceTemplate);


        $childUnmanagedInstanceTemplate.css({display:'block'});
        $childManagedInstanceTemplate.css({display:'block'});
        $childTotalInstanceTemplate.css({display:'block'});
        $childProviderTemplate.css({display:'block'});
        $rowTemplate.css({display:'block'});
        $('#openstackProviderView').append($rowTemplate);
      }*/
    }).fail(function() {});
    /*
    $('#totalInstancesMoreInfo').click(function() {
      //alert("Clicked");
      $.ajax({
        type: "get",
        dataType: "json",
        async: false,
        url: '../track',
        success: function(data) {
          for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < data[i].itemUrls.length; j++) {
              //alert(data[i].itemUrls[j].url); 
              if(data[i].itemUrls[j].url == 'http://awsdashboard.rlcatalyst.com/summary'){
                $('#totalInstancesMoreInfo').attr("href","http://awsdashboard.rlcatalyst.com/summary").attr("target","_blank");
              }
              for (var k = 0; k < data[i].itemUrls[j].childItem.length; k++) {
                //alert(data[i].itemUrls[j].childItem.url);
                if(data[i].itemUrls[j].childItem.url == 'http://awsdashboard.rlcatalyst.com/summary'){
                  $('#totalInstancesMoreInfo').attr("href","http://awsdashboard.rlcatalyst.com/summary").attr("target","_blank");
                }
              }
            }
          }
        }
      });
    });
    $('#costMoreInfo').click(function() {
      //alert("Clicked");
      $.ajax({
        type: "get",
        dataType: "json",
        async: false,
        url: '../track',
        success: function(data) {
          for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < data[i].itemUrls.length; j++) {
              //alert(data[i].itemUrls[j].url); 
              if(data[i].itemUrls[j].url == 'http://awsdashboard.rlcatalyst.com/cost'){
                $('#costMoreInfo').attr("href","http://awsdashboard.rlcatalyst.com/cost").attr("target","_blank");
              }
              for (var k = 0; k < data[i].itemUrls[j].childItem.length; k++) {
                //alert(data[i].itemUrls[j].childItem.url);
                if(data[i].itemUrls[j].childItem.url == 'http://awsdashboard.rlcatalyst.com/cost'){
                  $('#costMoreInfo').attr("href","http://awsdashboard.rlcatalyst.com/cost").attr("target","_blank");
                }
              }
            }
          }
        }
      });
    });
    $('.infrastructureConfigureSaveBtn').click(function() {
      var $tableinfrastructureDashboard = $('#tableinfrastructureDashboard');
      var $collapseInfrastructure = $('#collapseInfrastructure');
      $collapseInfrastructure.find('.infrastructureClass').hide();

      $tableinfrastructureDashboard.find('tbody tr input').filter(':checked').each(function() {
        createInfrastructureDashboard($(this).val());
      });

      function createInfrastructureDashboard(uniqueText){
        $collapseInfrastructure.find('.infrastructureClass').filter('[data-text="' + uniqueText + '"]').show();
      }
      $('#modaldashboardinfrastructurecardConfigure').modal('hide');
    });
    $('.buildConfigureSaveBtn').click(function() {
      var $tablebuildDashboard = $('#tablebuildDashboard');
      var $collapseBuild = $('#collapseBuild');

      $collapseBuild.find('.buildCiCdClass').hide();

      $tablebuildDashboard.find('tbody tr input').filter(':checked').each(function() {
        createBuildDashboard($(this).val());
      });
      
      function createBuildDashboard(uniqueText){
        $collapseBuild.find('.buildCiCdClass').filter('[data-text="' + uniqueText + '"]').show();
      }
      $('#modaldashboardbuildcardConfigure').modal('hide');
    });

    $.get('/dashboard/providers/dashboardlanding', function(dashboardlandingDetails) {
      var jenkinsServerId = dashboardlandingDetails[0].jenkinsReferenceValue;
      var jobName = dashboardlandingDetails[0].jobsListValue;
      $.get('/jenkins/' + jenkinsServerId + '/dashboardjobs/' + jobName, function(jobsList) {
        $('#totalBuilds').empty();
        $('#totalbuildsPassed').empty();
        $('#totalbuildsDeployed').empty();
        $('#totalBuilds').append(jobsList.buildCount);
        $('#totalbuildsPassed').append(jobsList.sucessbuildCount);
        $('#totalbuildsDeployed').append(jobsList.sucessbuildCount);
      }).fail(function(jxhr) {
        var msg = "Jenkins Server Behaved Unexpectedly.";
        if (jxhr.responseJSON && jxhr.responseJSON.message) {
          msg = jxhr.responseJSON.message;
        } else if (jxhr.responseText) {
          msg = jxhr.responseText;
        }
        bootbox.alert(msg);
      });
    });

    $.get('../allproviders/list', function(totalProviders) {
      var totalCountProviders;
      var awsProvidersCount = totalProviders.awsProviders.length;
      var openstackProvidersCount = totalProviders.openstackProviders.length;
      var vmwareProvidersCount = totalProviders.vmwareProviders.length;
      var hpPlublicCloudProvidersCount = totalProviders.hpPlublicCloudProviders.length;
      var azureProvidersCount = totalProviders.azureProviders.length;

      totalCountProviders = awsProvidersCount + openstackProvidersCount + vmwareProvidersCount + hpPlublicCloudProvidersCount + azureProvidersCount;
      $('#totalProviders').empty();
      $('#totalProviders').append(totalCountProviders);
    }).fail(function() {});

    //Total Instances API
    $.get('../dashboard/providers/totalinstances', function(totalinstances) {
      $('#totalInstances').empty();
      $('#totalInstances').append(totalinstances[0].totalinstancecount);
    }).fail(function() {});

    //Total Costs API
    $.get('../dashboard/providers/totalcosts', function(totalcosts) {
      $('#totalCosts').empty();
      var totalcostcount;
      if(!totalcosts.length){
        totalcostcount = "Yet to fetch..."
      }else{
        totalcostcount = '$'+totalcosts[0].totalcostcount;
      }
      $('#totalCosts').append(totalcostcount);
    }).fail(function() {});



    //Total managedinstances API
    $.get('../dashboard/providers/totalmanagedinstances', function(totalmanagedinstances) {
      $('#managedInstances').empty();
      $('#managedInstances').append(totalmanagedinstances);
    }).fail(function() {});*/
  });

</script>