<html>
<head>
	<title>User Cookbooks</title>
	<link rel="stylesheet" href="css/bootstrap.css" />
	<link rel="stylesheet" href="js/jq-plugins/jquery-filetree/jqueryFileTree.css" />
<style>
html {
	height:100%;
	width:100%;
}
#cookbookdir {
	border-right: 1px solid #000000;
    height: 100%;
    overflow: auto;
    width: 19.9%;
    float:left;
    display: none;
}
#fileEditorArea {
	height: 100%;
    overflow: auto;
    width: 80%;
    float:right;
    display: none;
}
#fileEditorContainer {
	height: 90%;
    width: 100%;
    display:none;

}
#fileEditorDiv{
	height: 100%;
	width: 100%;
	border-bottom: 1px solid black; 
}
#workingIndicatorContainer {
	position: absolute;
	top:0;
	left: 0;
	z-index: 10;
	height: 100%;
	width: 100%;
	background-color:rgba(255,255,255,0.8); 
	padding-top: 18%;
	display: none;
	
}
#editorBtnContainer {
	display: none;
    padding-left: 21%;
    padding-top: 10px;
}

#fileEditorMsgContainer{
	height: 100%;
    padding-top: 15%;
    text-align: center;
    width: 100%;
}

#workingMsg{
	display: block;
    padding-top: 10px;
}
.editorBtn {
	margin-left: 10%;
}

</style>
</head>
<body>
	
<div id="cookbookdir">
</div>

<div id="fileEditorArea">
	<div id="fileEditorContainer">
		<div id="fileEditorDiv"></div>

	</div>
	<div id="editorBtnContainer"><button class="btn btn-primary btn-lg editorBtn" role="button" disabled>Clone</button><button class="btn btn-primary btn-lg save editorBtn" role="button">Save</button><button class="btn btn-primary btn-lg editorBtn" role="button" disabled>Test</button></div>
	<div id="fileEditorMsgContainer">
     <span id='chefAccountMsg' style="display:block;position:absolute;top:4px"></span>
     <span id='chefInstructionMsg'> <span style="font-size:24px">Welcome to Chef Factory </span><br/><br/>
     <span style="font-size:20px">You can Clone, Edit and Upload a Cookbook to Chef Server.</span><br/>
     <span style="font-size:20px">
     Please select a Cookbook. </span> </span>
	</div>
</div>
<div id="workingIndicatorContainer" class="text-center">
<img src="img/loading.gif" style="height:10%;width:auto"/>
<span id="workingMsg"></span>
</div>
</body>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')
</script>
<script src="js/bootstrap.js"></script>
<script src="js/jq-plugins/jquery-filetree/jqueryFileTree.js" type="text/javascript"></script>
<script src="js/js-plugins/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
$(function() {
	var $fileEditorDivContianer = $('#fileEditorContainer').hide();
	var $fileEditorDiv = $('#fileEditorDiv');
	var $editorBtnContainer = $('#editorBtnContainer').hide();
	var $workingIndicatorContainer = $('#workingIndicatorContainer');
	var $workingMsg = $('#workingMsg');
	var $fileEditorMsgContainer = $('#fileEditorMsgContainer');
	var editor = ace.edit("fileEditorDiv");

    editor.setTheme("ace/theme/clouds");
    editor.getSession().setMode("ace/mode/ruby");
    $workingMsg.empty().append('Please Wait ... Syncing Cookbooks');
    $workingIndicatorContainer.show();
    $cookbookdir = $('#cookbookdir');
	$cookbookdir.fileTree({
		root: '/',
		script : 'userCookbooks',
		onFolderLoad : function(path,data) {
           if(path === '/') {
             $cookbookdir.show();
             $('#fileEditorArea').show();
             $('#chefAccountMsg').append('Chef Account : '+data.chefUserName);          
             $workingIndicatorContainer.hide()
           } 
		}
	}, function(file) {
		$fileEditorMsgContainer.hide();
		$.get('userCookbooks/?path='+file,function(data){
           if(data.resType == 'file') {
           	 $fileEditorDivContianer.show();
           	 $editorBtnContainer.show();
		     $fileEditorDiv.attr('data-file-path',file);
           	 editor.setValue(data.fileData);
           }
		});
	});

	$('.save').click(function(e){
		var filePath = $fileEditorDiv.attr('data-file-path');
		var fileContent =editor.getValue();
		 $workingMsg.empty().append('Please Wait ... Uploading Cookbook');
		$workingIndicatorContainer.show();
		$.post('/userCookbooks/save',{filePath:filePath,fileContent:fileContent},function(data,success){
			$workingIndicatorContainer.hide();
			console.log(data);
		});

	});

    

});



</script>
</html>